(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.XMPP=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({"/Users/spaksa/stanza/node_modules/stanza.io/index.js":[function(require,module,exports){"use strict";exports.VERSION="7.2.1";exports.JID=require("xmpp-jid").JID;exports.Client=require("./lib/client");exports.createClient=function(opts){var client=new exports.Client(opts);client.use(require("./lib/plugins"));return client}},{"./lib/client":"/Users/spaksa/stanza/node_modules/stanza.io/lib/client.js","./lib/plugins":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/index-browser.js","xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/client.js":[function(require,module,exports){"use strict";var each=require("lodash.foreach");var extend=require("lodash.assign");var isArray=require("lodash.isarray");var jxt=require("jxt");var WildEmitter=require("wildemitter");var util=require("util");var BPromise=require("bluebird");var uuid=require("uuid");var JID=require("xmpp-jid").JID;var StreamManagement=require("./sm");var getHostMeta=require("hostmeta");var SASLFactory=require("saslmechanisms");var SASL_MECHS={external:require("sasl-external"),"scram-sha-1":require("sasl-scram-sha-1"),"digest-md5":require("alt-sasl-digest-md5"),plain:require("sasl-plain"),anonymous:require("sasl-anonymous")};function Client(opts){var self=this;WildEmitter.call(this);opts=opts||{};this._initConfig(opts);this.stanzas=jxt.getGlobalJXT();this.jid=new JID;this.stanzas=jxt.createRegistry();this.stanzas.use(require("jxt-xmpp-types"));this.stanzas.use(require("./stanza/message"));this.stanzas.use(require("./stanza/presence"));this.stanzas.use(require("./stanza/iq"));this.stanzas.use(require("./stanza/error"));this.stanzas.use(require("./stanza/streamError"));this.use(require("./plugins/features"));this.use(require("./plugins/sasl"));this.use(require("./plugins/smacks"));this.use(require("./plugins/bind"));this.use(require("./plugins/session"));this.sm=new StreamManagement(this);this.transports={};this.use(require("./plugins/websocket"));this.use(require("./plugins/oldwebsocket"));this.use(require("./plugins/bosh"));this.on("stream:data",function(data){var json=data.toJSON();if(data._name==="iq"){json._xmlChildCount=0;each(data.xml.childNodes,function(child){if(child.nodeType===1){json._xmlChildCount+=1}})}self.emit(data._eventname||data._name,json);if(data._name==="message"||data._name==="presence"||data._name==="iq"){self.sm.handle(json);self.emit("stanza",json)}else if(data._name==="smAck"){return self.sm.process(json)}else if(data._name==="smRequest"){return self.sm.ack()}if(json.id){self.emit("id:"+json.id,json);self.emit(data._name+":id:"+json.id,json)}});this.on("disconnected",function(){if(self.transport){self.transport.off("*");delete self.transport}self.releaseGroup("connection")});this.on("iq",function(iq){var iqType=iq.type;var xmlChildCount=iq._xmlChildCount;delete iq._xmlChildCount;var exts=Object.keys(iq);if(iq.type==="get"||iq.type==="set"){if(xmlChildCount!==1){return self.sendIq(iq.errorReply({error:{type:"modify",condition:"bad-request"}}))}if(!exts.length){return self.sendIq(iq.errorReply({error:{type:"cancel",condition:"feature-not-implemented"}}))}var iqEvent="iq:"+iqType+":"+exts[0];if(self.callbacks[iqEvent]){self.emit(iqEvent,iq)}else{self.sendIq(iq.errorReply({error:{type:"cancel",condition:"feature-not-implemented"}}))}}});this.on("message",function(msg){if(Object.keys(msg.$body||{}).length){if(msg.type==="chat"||msg.type==="normal"){self.emit("chat",msg)}else if(msg.type==="groupchat"){self.emit("groupchat",msg)}}if(msg.type==="error"){self.emit("message:error",msg)}});this.on("presence",function(pres){var presType=pres.type||"available";if(presType==="error"){presType="presence:error"}self.emit(presType,pres)})}util.inherits(Client,WildEmitter);Object.defineProperty(Client.prototype,"stream",{get:function(){return this.transport?this.transport.stream:undefined}});Client.prototype._initConfig=function(opts){var self=this;var currConfig=this.config||{};this.config=extend({useStreamManagement:true,transports:["websocket","bosh"],sasl:["external","scram-sha-1","digest-md5","plain","anonymous"]},currConfig,opts);if(!isArray(this.config.sasl)){this.config.sasl=[this.config.sasl]}this.SASLFactory=new SASLFactory;this.config.sasl.forEach(function(mech){if(typeof mech==="string"){var existingMech=SASL_MECHS[mech.toLowerCase()];if(existingMech){self.SASLFactory.use(existingMech)}}else{self.SASLFactory.use(mech)}});this.config.jid=new JID(this.config.jid);if(!this.config.server){this.config.server=this.config.jid.domain}if(this.config.password){this.config.credentials=this.config.credentials||{};this.config.credentials.password=this.config.password;delete this.config.password}if(this.config.transport){this.config.transports=[this.config.transport]}if(!isArray(this.config.transports)){this.config.transports=[this.config.transports]}};Client.prototype.use=function(pluginInit){pluginInit(this,this.stanzas,this.config)};Client.prototype.nextId=function(){return uuid.v4()};Client.prototype.discoverBindings=function(server,cb){getHostMeta(server,function(err,data){if(err){return cb(err,[])}var results={websocket:[],bosh:[]};var links=data.links||[];links.forEach(function(link){if(link.href&&link.rel==="urn:xmpp:alt-connections:websocket"){results.websocket.push(link.href)}if(link.href&&link.rel==="urn:xmpp:altconnect:websocket"){results.websocket.push(link.href)}if(link.href&&link.rel==="urn:xmpp:alt-connections:xbosh"){results.bosh.push(link.href)}if(link.href&&link.rel==="urn:xmpp:altconnect:bosh"){results.bosh.push(link.href)}});cb(false,results)})};Client.prototype._getConfiguredCredentials=function(){var creds=this.config.credentials||{};var requestedJID=new JID(this.config.jid);var username=creds.username||requestedJID.local;var server=creds.server||requestedJID.domain;var defaultCreds={username:username,password:this.config.password,server:server,host:server,realm:server,serviceType:"xmpp",serviceName:server};var result=extend(defaultCreds,creds);return result};Client.prototype.getCredentials=function(cb){return cb(null,this._getConfiguredCredentials())};Client.prototype.connect=function(opts,transInfo){var self=this;this._initConfig(opts);if(transInfo&&transInfo.name&&transInfo.url){var trans=self.transport=new self.transports[transInfo.name](self.sm,self.stanzas);trans.on("*",function(event,data){self.emit(event,data)});return trans.connect(self.config)}if(!transInfo&&self.config.transports.length===1){transInfo={};transInfo.name=self.config.transports[0];if(transInfo.name==="websocket"||transInfo.name==="old-websocket"){transInfo.url=self.config.wsURL}if(transInfo.name==="bosh"){transInfo.url=self.config.boshURL}if(transInfo.name&&transInfo.url){return self.connect(null,transInfo)}}return self.discoverBindings(self.config.server,function(err,endpoints){if(err){console.error("Could not find https://"+self.config.server+"/.well-known/host-meta file to discover connection endpoints for the requested transports.");return self.disconnect()}for(var t=0,tlen=self.config.transports.length;t<tlen;t++){var transport=self.config.transports[t];console.log("Checking for %s endpoints",transport);for(var i=0,len=(endpoints[transport]||[]).length;i<len;i++){var uri=endpoints[transport][i];if(uri.indexOf("wss://")===0||uri.indexOf("https://")===0){if(transport==="websocket"){self.config.wsURL=uri}else{self.config.boshURL=uri}console.log("Using %s endpoint: %s",transport,uri);return self.connect(null,{name:transport,url:uri})}else{console.warn("Discovered unencrypted %s endpoint (%s). Ignoring",transport,uri)}}}console.error("No endpoints found for the requested transports.");return self.disconnect()})};Client.prototype.disconnect=function(){if(this.sessionStarted){this.releaseGroup("session");if(!this.sm.started){this.emit("session:end")}}this.sessionStarted=false;this.releaseGroup("connection");if(this.transport){this.transport.disconnect()}else{this.emit("disconnected")}};Client.prototype.send=function(data){this.sm.track(data);if(this.transport){this.transport.send(data)}};Client.prototype.sendMessage=function(data){data=data||{};if(!data.id){data.id=this.nextId()}var Message=this.stanzas.getMessage();var msg=new Message(data);this.emit("message:sent",msg.toJSON());this.send(msg);return data.id};Client.prototype.sendPresence=function(data){data=data||{};if(!data.id){data.id=this.nextId()}var Presence=this.stanzas.getPresence();this.send(new Presence(data));return data.id};Client.prototype.sendIq=function(data,cb){var result,respEvent,allowed,dest;var self=this;data=data||{};if(!data.id){data.id=this.nextId()}var Iq=this.stanzas.getIq();var iq=!data.toJSON?new Iq(data):data;if(data.type==="error"||data.type==="result"){this.send(iq);return}dest=new JID(data.to);allowed={};allowed[""]=true;allowed[dest.full]=true;allowed[dest.bare]=true;allowed[dest.domain]=true;allowed[self.jid.bare]=true;allowed[self.jid.domain]=true;respEvent="iq:id:"+data.id;result=new BPromise(function(resolve,reject){var handler=function(res){if(!allowed[res.from.full]){return}if(res.type!=="result"&&res.type!=="error"){return}self.off(respEvent,handler);if(!res.error){resolve(res)}else{reject(res)}};self.on(respEvent,"session",handler)});this.send(iq);return result.timeout(self.config.timeout*1e3||15e3).catch(BPromise.TimeoutError,function(){throw{id:data.id,type:"error",error:{condition:"timeout"}}}).nodeify(cb)};Client.prototype.sendStreamError=function(data){data=data||{};var StreamError=this.stanzas.getStreamError();var error=new StreamError(data);this.emit("stream:error",error.toJSON());this.send(error);this.disconnect()};module.exports=Client},{"./plugins/bind":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/bind.js","./plugins/bosh":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/bosh.js","./plugins/features":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/features.js","./plugins/oldwebsocket":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/oldwebsocket.js","./plugins/sasl":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/sasl.js","./plugins/session":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/session.js","./plugins/smacks":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/smacks.js","./plugins/websocket":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/websocket.js","./sm":"/Users/spaksa/stanza/node_modules/stanza.io/lib/sm.js","./stanza/error":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/error.js","./stanza/iq":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/iq.js","./stanza/message":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/message.js","./stanza/presence":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/presence.js","./stanza/streamError":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/streamError.js","alt-sasl-digest-md5":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/index.js",bluebird:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/bluebird/js/browser/bluebird.js",hostmeta:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/hostmeta/index.js",jxt:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/index.js","jxt-xmpp-types":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt-xmpp-types/index.js","lodash.assign":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/index.js","lodash.foreach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js","sasl-anonymous":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-anonymous/main.js","sasl-external":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-external/main.js","sasl-plain":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-plain/main.js","sasl-scram-sha-1":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/index.js",saslmechanisms:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/saslmechanisms/main.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js",uuid:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/uuid/uuid.js",wildemitter:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/wildemitter/wildemitter.js","xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/attention.js":[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("urn:xmpp:attention:0");client.getAttention=function(jid,opts){opts=opts||{};opts.to=jid;opts.type="headline";opts.attention=true;client.sendMessage(opts)};client.on("message",function(msg){if(msg.attention){client.emit("attention",msg)}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/avatar.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/avatar"));client.disco.addFeature("urn:xmpp:avatar:metadata+notify");client.on("pubsub:event",function(msg){if(!msg.event.updated){return}if(msg.event.updated.node!=="urn:xmpp:avatar:metadata"){return}client.emit("avatar",{jid:msg.from,source:"pubsub",avatars:msg.event.updated.published[0].avatars})});client.on("presence",function(pres){if(pres.avatarId){client.emit("avatar",{jid:pres.from,source:"vcard",avatars:[{id:pres.avatarId}]})}});client.publishAvatar=function(id,data,cb){return this.publish("","urn:xmpp:avatar:data",{id:id,avatarData:data},cb)};client.useAvatars=function(info,cb){return this.publish("","urn:xmpp:avatar:metadata",{id:"current",avatars:info},cb)};client.getAvatar=function(jid,id,cb){return this.getItem(jid,"urn:xmpp:avatar:data",id,cb)}}},{"../stanza/avatar":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/avatar.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/bind.js":[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;module.exports=function(client,stanzas,config){stanzas.use(require("../stanza/bind"));client.registerFeature("bind",300,function(features,cb){var self=this;self.sendIq({type:"set",bind:{resource:config.resource}},function(err,resp){if(err){self.emit("session:error",err);return cb("disconnect","JID binding failed")}self.features.negotiated.bind=true;self.jid=new JID(resp.bind.jid);self.emit("session:bound",self.jid);var canStartSession=!features.session||features.session&&features.session.optional;if(!self.sessionStarted&&canStartSession){self.sessionStarted=true;self.emit("session:started",self.jid)}return cb()})});client.on("disconnected",function(){client.sessionStarted=false;client.features.negotiated.bind=false})}},{"../stanza/bind":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/bind.js","xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/blocking.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/blocking"));client.disco.addFeature("urn:xmpp:blocking");client.block=function(jid,cb){return client.sendIq({type:"set",block:{jids:[jid]}},cb)};client.unblock=function(jid,cb){return client.sendIq({type:"set",unblock:{jids:[jid]}},cb)};client.getBlocked=function(cb){return client.sendIq({type:"get",blockList:true},cb)};client.on("iq:set:block",function(iq){client.emit("block",{jids:iq.block.jids||[]});client.sendIq(iq.resultReply())});client.on("iq:set:unblock",function(iq){client.emit("unblock",{jids:iq.unblock.jids||[]});client.sendIq(iq.resultReply())})}},{"../stanza/blocking":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/blocking.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/bob.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/bob"));client.disco.addFeature("urn:xmpp:bob");client.getBits=function(jid,cid,cb){return client.sendIq({to:jid,type:"get",bob:{cid:cid}},cb)}}},{"../stanza/bob":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/bob.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/bookmarks.js":[function(require,module,exports){"use strict";var extend=require("lodash.assign");var filter=require("lodash.filter");var JID=require("xmpp-jid").JID;module.exports=function(client,stanzas){stanzas.use(require("../stanza/bookmarks"));client.getBookmarks=function(cb){return this.getPrivateData({bookmarks:true},cb)};client.setBookmarks=function(opts,cb){return this.setPrivateData({bookmarks:opts},cb)};client.addBookmark=function(bookmark,cb){bookmark.jid=new JID(bookmark.jid);return this.getBookmarks().then(function(res){var bookmarks=res.privateStorage.bookmarks.conferences||[];var existing=filter(bookmarks,function(bm){return bm.jid.bare===bookmark.jid.bare});if(existing.length){extend(existing[0],bookmark)}else{bookmarks.push(bookmark)}return client.setBookmarks({conferences:bookmarks})}).nodeify(cb)};client.removeBookmark=function(jid,cb){jid=new JID(jid);return this.getBookmarks().then(function(res){var bookmarks=res.privateStorage.bookmarks.conferences||[];bookmarks=filter(bookmarks,function(bm){return jid.bare!==bm.jid.bare});return client.setBookmarks({conferences:bookmarks})}).nodeify(cb)}}},{"../stanza/bookmarks":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/bookmarks.js","lodash.assign":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/index.js","lodash.filter":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/index.js","xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/bosh.js":[function(require,module,exports){"use strict";var BOSHConnection=require("../transports/bosh");module.exports=function(client,stanzas){stanzas.use(require("../stanza/bosh"));client.transports.bosh=BOSHConnection}},{"../stanza/bosh":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/bosh.js","../transports/bosh":"/Users/spaksa/stanza/node_modules/stanza.io/lib/transports/bosh.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/carbons.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/carbons"));client.disco.addFeature("urn:xmpp:carbons:2");client.enableCarbons=function(cb){return this.sendIq({type:"set",enableCarbons:true},cb)};client.disableCarbons=function(cb){return this.sendIq({type:"set",disableCarbons:true},cb)};client.on("message",function(msg){if(msg.carbonSent){return client.emit("carbon:sent",msg)}if(msg.carbonReceived){return client.emit("carbon:received",msg)}});client.on("carbon:*",function(name,carbon){var dir=name.split(":")[1];if(carbon.from.bare!==client.jid.bare){return}var msg,delay;if(dir==="received"){msg=carbon.carbonReceived.forwarded.message;delay=carbon.carbonReceived.forwarded.delay}else{msg=carbon.carbonSent.forwarded.message;delay=carbon.carbonSent.forwarded.delay}if(!msg.delay){if(delay){msg.delay.stamp=delay.stamp}else{msg.delay={stamp:new Date(Date.now())}}}msg.carbon=true;if(msg.from.bare===client.jid.bare){client.emit("message:sent",msg)}else{client.emit("message",msg)}})}},{"../stanza/carbons":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/carbons.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/chatstates.js":[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("http://jabber.org/protocol/chatstates");client.on("message",function(msg){if(msg.chatState){client.emit("chat:state",{to:msg.to,from:msg.from,chatState:msg.chatState});client.emit("chatState",{to:msg.to,from:msg.from,chatState:msg.chatState})}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/command.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/commands";module.exports=function(client,stanzas){stanzas.use(require("../stanza/command"));client.disco.addFeature(NS);client.disco.addItem({name:"Ad-Hoc Commands",node:NS});client.getCommands=function(jid,cb){return client.getDiscoItems(jid,NS,cb)}}},{"../stanza/command":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/command.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/correction.js":[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("urn:xmpp:message-correct:0");client.on("message",function(msg){if(msg.replace){client.emit("replace",msg);client.emit("replace:"+msg.id,msg)}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/csi.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/csi"));var Active=stanzas.getDefinition("active","urn:xmpp:csi");var Inactive=stanzas.getDefinition("inactive","urn:xmpp:csi");client.registerFeature("clientStateIndication",400,function(features,cb){this.features.negotiated.clientStateIndication=true;cb()});client.markActive=function(){if(this.features.negotiated.clientStateIndication){this.send(new Active)}};client.markInactive=function(){if(this.features.negotiated.clientStateIndication){this.send(new Inactive)}}}},{"../stanza/csi":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/csi.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/dataforms.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/dataforms"));client.disco.addFeature("jabber:x:data");client.disco.addFeature("urn:xmpp:media-element");client.disco.addFeature("http://jabber.org/protocol/xdata-validate");client.disco.addFeature("http://jabber.org/protocol/xdata-layout");client.on("message",function(msg){if(msg.form){client.emit("dataform",msg)}})}},{"../stanza/dataforms":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/dataforms.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/delayed.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/delayed"));client.disco.addFeature("urn:xmpp:delay")}},{"../stanza/delayed":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/delayed.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/disco.js":[function(require,module,exports){(function(Buffer){"use strict";var each=require("lodash.foreach");var unique=require("lodash.uniq");var JID=require("xmpp-jid").JID;var hashes=require("iana-hashes");function generateVerString(info,hash){var S="";var features=info.features.sort();var identities=[];var formTypes={};var formOrder=[];each(info.identities,function(identity){identities.push([identity.category||"",identity.type||"",identity.lang||"",identity.name||""].join("/"))});identities.sort();var idLen=identities.length;var featureLen=features.length;identities=unique(identities,true);features=unique(features,true);if(featureLen!==features.length||idLen!==identities.length){return false}S+=identities.join("<")+"<";S+=features.join("<")+"<";var illFormed=false;each(info.extensions,function(ext){var fields=ext.fields;for(var i=0,len=fields.length;i<len;i++){if(fields[i].name==="FORM_TYPE"&&fields[i].type==="hidden"){var name=fields[i].value;if(formTypes[name]){illFormed=true;return}formTypes[name]=ext;formOrder.push(name);return}}});if(illFormed){return false}formOrder.sort();each(formOrder,function(name){var ext=formTypes[name];var fields={};var fieldOrder=[];S+="<"+name;each(ext.fields,function(field){var fieldName=field.name;if(fieldName!=="FORM_TYPE"){var values=field.value||"";if(typeof values!=="object"){values=values.split("\n")}fields[fieldName]=values.sort();fieldOrder.push(fieldName)}});fieldOrder.sort();each(fieldOrder,function(fieldName){S+="<"+fieldName;each(fields[fieldName],function(val){S+="<"+val})})});var ver=hashes.createHash(hash).update(new Buffer(S,"utf8")).digest("base64");var padding=4-ver.length%4;if(padding===4){padding=0}for(var i=0;i<padding;i++){ver+="="}return ver}function verifyVerString(info,hash,check){var computed=generateVerString(info,hash);return computed&&computed===check}function Disco(){this.features={};this.identities={};this.extensions={};this.items={};this.caps={}}Disco.prototype={constructor:{value:Disco},addFeature:function(feature,node){node=node||"";if(!this.features[node]){this.features[node]=[]}this.features[node].push(feature)},addIdentity:function(identity,node){node=node||"";if(!this.identities[node]){this.identities[node]=[]}this.identities[node].push(identity)},addItem:function(item,node){node=node||"";if(!this.items[node]){this.items[node]=[]}this.items[node].push(item)},addExtension:function(form,node){node=node||"";if(!this.extensions[node]){this.extensions[node]=[]}this.extensions[node].push(form)}};module.exports=function(client,stanzas){stanzas.use(require("../stanza/disco"));stanzas.use(require("../stanza/caps"));stanzas.use(require("../stanza/rsm"));client.disco=new Disco(client);client.disco.addFeature("http://jabber.org/protocol/disco#info");client.disco.addFeature("http://jabber.org/protocol/disco#items");client.disco.addIdentity({category:"client",type:"web"});client.registerFeature("caps",100,function(features,cb){this.emit("disco:caps",{from:new JID(client.jid.domain||client.config.server),caps:features.caps});this.features.negotiated.caps=true;cb()});client.getDiscoInfo=function(jid,node,cb){return this.sendIq({to:jid,type:"get",discoInfo:{node:node}},cb)};client.getDiscoItems=function(jid,node,cb){return this.sendIq({to:jid,type:"get",discoItems:{node:node}},cb)};client.updateCaps=function(){var node=this.config.capsNode||"https://stanza.io";var data=JSON.parse(JSON.stringify({identities:this.disco.identities[""],features:this.disco.features[""],extensions:this.disco.extensions[""]}));var ver=generateVerString(data,"sha-1");this.disco.caps={node:node,hash:"sha-1",ver:ver};node=node+"#"+ver;this.disco.features[node]=data.features;this.disco.identities[node]=data.identities;this.disco.extensions[node]=data.extensions;return client.getCurrentCaps()};client.getCurrentCaps=function(){var caps=client.disco.caps;if(!caps.ver){return{ver:null,discoInfo:null}}var node=caps.node+"#"+caps.ver;return{ver:caps.ver,discoInfo:{identities:client.disco.identities[node],features:client.disco.features[node],extensions:client.disco.extensions[node]}}};client.on("presence",function(pres){if(pres.caps){client.emit("disco:caps",pres)}});client.on("iq:get:discoInfo",function(iq){var node=iq.discoInfo.node||"";var reportedNode=iq.discoInfo.node||"";if(node===client.disco.caps.node+"#"+client.disco.caps.ver){reportedNode=node;node=""}client.sendIq(iq.resultReply({discoInfo:{node:reportedNode,identities:client.disco.identities[node]||[],features:client.disco.features[node]||[],extensions:client.disco.extensions[node]||[]}}))});client.on("iq:get:discoItems",function(iq){var node=iq.discoItems.node;client.sendIq(iq.resultReply({discoItems:{node:node,items:client.disco.items[node]||[]}}))});client.verifyVerString=verifyVerString;client.generateVerString=generateVerString;client.updateCaps()}}).call(this,require("buffer").Buffer)},{"../stanza/caps":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/caps.js","../stanza/disco":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/disco.js","../stanza/rsm":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/rsm.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js","iana-hashes":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/index.js","lodash.foreach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/index.js","lodash.uniq":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/index.js","xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/escaping.js":[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("jid\\20escaping")}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/extdisco.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/extdisco"));client.disco.addFeature("urn:xmpp:extdisco:1");client.getServices=function(jid,type,cb){return this.sendIq({type:"get",to:jid,services:{type:type}},cb)};client.getServiceCredentials=function(jid,host,cb){return this.sendIq({type:"get",to:jid,credentials:{service:{host:host}}},cb)}}},{"../stanza/extdisco":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/extdisco.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/features.js":[function(require,module,exports){"use strict";var async=require("async");module.exports=function(client,stanzas){stanzas.use(require("../stanza/streamFeatures"));client.features={negotiated:{},order:[],handlers:{}};client.registerFeature=function(name,priority,handler){this.features.order.push({priority:priority,name:name});this.features.order.sort(function(a,b){if(a.priority<b.priority){return-1}if(a.priority>b.priority){return 1}return 0});this.features.handlers[name]=handler.bind(client)};client.on("streamFeatures",function(features){var series=[];var negotiated=client.features.negotiated;var handlers=client.features.handlers;client.features.order.forEach(function(feature){var name=feature.name;if(features[name]&&handlers[name]&&!negotiated[name]){series.push(function(cb){if(!negotiated[name]){handlers[name](features,cb)}else{cb()}})}});async.series(series,function(cmd,msg){if(cmd==="restart"){client.transport.restart()}else if(cmd==="disconnect"){client.emit("stream:error",{condition:"policy-violation",text:"Failed to negotiate stream features: "+msg});client.disconnect()}})})}},{"../stanza/streamFeatures":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/streamFeatures.js",async:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/async/lib/async.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/forwarding.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/forwarded"));client.disco.addFeature("urn:xmpp:forward:0")}},{"../stanza/forwarded":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/forwarded.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/geoloc.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/geoloc"));client.disco.addFeature("http://jabber.org/protocol/geoloc");client.disco.addFeature("http://jabber.org/protocol/geoloc+notify");client.on("pubsub:event",function(msg){if(!msg.event.updated){return}if(msg.event.updated.node!=="http://jabber.org/protocol/geoloc"){return}client.emit("geoloc",{jid:msg.from,geoloc:msg.event.updated.published[0].geoloc})});client.publishGeoLoc=function(data,cb){return this.publish("","http://jabber.org/protocol/geoloc",{
geoloc:data},cb)}}},{"../stanza/geoloc":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/geoloc.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/hashes.js":[function(require,module,exports){"use strict";var hashes=require("iana-hashes");module.exports=function(client,stanzas){stanzas.use(require("../stanza/hash"));client.disco.addFeature("urn:xmpp:hashes:1");var names=hashes.getHashes();names.forEach(function(name){client.disco.addFeature("urn:xmpp:hash-function-text-names:"+name)})}},{"../stanza/hash":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/hash.js","iana-hashes":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/idle.js":[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("urn:xmpp:idle:1")}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/index-browser.js":[function(require,module,exports){"use strict";module.exports=function(client){client.use(require("./disco"));client.use(require("./attention"));client.use(require("./avatar"));client.use(require("./blocking"));client.use(require("./bob"));client.use(require("./bookmarks"));client.use(require("./carbons"));client.use(require("./chatstates"));client.use(require("./command"));client.use(require("./correction"));client.use(require("./csi"));client.use(require("./dataforms"));client.use(require("./delayed"));client.use(require("./escaping"));client.use(require("./extdisco"));client.use(require("./forwarding"));client.use(require("./geoloc"));client.use(require("./hashes"));client.use(require("./idle"));client.use(require("./invisible"));client.use(require("./jidprep"));client.use(require("./jingle"));client.use(require("./json"));client.use(require("./keepalive"));client.use(require("./logging"));client.use(require("./mam"));client.use(require("./muc"));client.use(require("./mood"));client.use(require("./nick"));client.use(require("./oob"));client.use(require("./ping"));client.use(require("./private"));client.use(require("./psa"));client.use(require("./pubsub"));client.use(require("./reach"));client.use(require("./receipts"));client.use(require("./register"));client.use(require("./roster"));client.use(require("./rtt"));client.use(require("./shim"));client.use(require("./time"));client.use(require("./vcard"));client.use(require("./version"))}},{"./attention":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/attention.js","./avatar":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/avatar.js","./blocking":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/blocking.js","./bob":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/bob.js","./bookmarks":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/bookmarks.js","./carbons":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/carbons.js","./chatstates":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/chatstates.js","./command":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/command.js","./correction":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/correction.js","./csi":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/csi.js","./dataforms":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/dataforms.js","./delayed":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/delayed.js","./disco":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/disco.js","./escaping":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/escaping.js","./extdisco":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/extdisco.js","./forwarding":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/forwarding.js","./geoloc":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/geoloc.js","./hashes":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/hashes.js","./idle":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/idle.js","./invisible":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/invisible.js","./jidprep":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/jidprep.js","./jingle":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/jingle.js","./json":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/json.js","./keepalive":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/keepalive.js","./logging":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/logging.js","./mam":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/mam.js","./mood":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/mood.js","./muc":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/muc.js","./nick":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/nick.js","./oob":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/oob.js","./ping":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/ping.js","./private":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/private.js","./psa":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/psa.js","./pubsub":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/pubsub.js","./reach":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/reach.js","./receipts":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/receipts.js","./register":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/register.js","./roster":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/roster.js","./rtt":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/rtt.js","./shim":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/shim.js","./time":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/time.js","./vcard":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/vcard.js","./version":"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/version.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/invisible.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/visibility"));client.goInvisible=function(cb){return this.sendIq({type:"set",invisible:true},cb)};client.goVisible=function(cb){return this.sendIq({type:"set",visible:true},cb)}}},{"../stanza/visibility":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/visibility.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/jidprep.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/jidprep"));client.prepJID=function(jid,cb){return client.sendIq({to:client.jid.domain,type:"get",jidPrep:jid},cb)}}},{"../stanza/jidprep":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/jidprep.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/jingle.js":[function(require,module,exports){"use strict";var Jingle=require("jingle");module.exports=function(client,stanzas){stanzas.use(require("../stanza/jingle"));stanzas.use(require("../stanza/rtp"));stanzas.use(require("../stanza/iceUdp"));stanzas.use(require("../stanza/file"));var jingle=client.jingle=new Jingle;jingle.capabilities.forEach(function(cap){client.disco.addFeature(cap)});var mappedEvents=["outgoing","incoming","accepted","terminated","ringing","mute","unmute","hold","resumed"];mappedEvents.forEach(function(event){jingle.on(event,function(session,arg1){client.emit("jingle:"+event,session,arg1)})});jingle.on("createdSession",function(session){client.emit("jingle:created",session)});jingle.on("peerStreamAdded",function(session,stream){client.emit("jingle:remotestream:added",session,stream)});jingle.on("peerStreamRemoved",function(session,stream){client.emit("jingle:remotestream:removed",session,stream)});jingle.on("send",function(data){client.sendIq(data,function(err){if(err){client.emit("jingle:error",err)}})});client.on("session:bound",function(jid){jingle.jid=jid;jingle.selfID=jid.full});client.on("iq:set:jingle",function(data){jingle.process(data)});client.on("unavailable",function(pres){var peer=pres.from.full;jingle.endPeerSessions(peer,true)});client.discoverICEServers=function(cb){return this.getServices(client.config.server).then(function(res){var services=res.services.services;var discovered=[];for(var i=0;i<services.length;i++){var service=services[i];var ice={};if(service.type==="stun"||service.type==="stuns"){ice.url=service.type+":"+service.host;if(service.port){ice.url+=":"+service.port}discovered.push(ice);client.jingle.addICEServer(ice)}else if(service.type==="turn"||service.type==="turns"){ice.url=service.type+":"+service.host;if(service.port){ice.url+=":"+service.port}if(service.transport&&service.transport!=="udp"){ice.url+="?transport="+service.transport}if(service.username){ice.username=service.username}if(service.password){ice.credential=service.password}discovered.push(ice);client.jingle.addICEServer(ice)}}return discovered}).nodeify(cb)}}},{"../stanza/file":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/file.js","../stanza/iceUdp":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/iceUdp.js","../stanza/jingle":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/jingle.js","../stanza/rtp":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/rtp.js",jingle:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/json.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/json"));client.disco.addFeature("urn:xmpp:json:0")}},{"../stanza/json":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/json.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/keepalive.js":[function(require,module,exports){"use strict";var BPromise=require("bluebird");function checkConnection(client,timeout){return new BPromise(function(resolve,reject){if(client.sm.started){client.once("stream:management:ack",resolve);client.sm.request()}else{client.ping().then(resolve).catch(function(err){if(err.error&&err.error.condition!=="timeout"){resolve()}else{reject()}})}}).timeout(timeout*1e3||15e3)}module.exports=function(client){client.enableKeepAlive=function(opts){opts=opts||{};opts.interval=opts.interval||300;opts.timeout=opts.timeout||15;function keepalive(){if(client.sessionStarted){checkConnection(client,opts.timeout).catch(function(){client.sendStreamError({condition:"connection-timeout"})})}}client._keepAliveInterval=setInterval(keepalive,opts.interval*1e3)};client.disableKeepAlive=function(){if(client._keepAliveInterval){clearInterval(client._keepAliveInterval);delete client._keepAliveInterval}};client.on("disconnected",function(){client.disableKeepAlive()})}},{bluebird:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/bluebird/js/browser/bluebird.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/logging.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/logging"));client.disco.addFeature("","urn:xmpp:eventlog");client.sendLog=function(jid,logData){client.sendMessage({to:jid,type:"normal",log:logData})}}},{"../stanza/logging":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/logging.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/mam.js":[function(require,module,exports){"use strict";var BPromise=require("bluebird");var JID=require("xmpp-jid").JID;module.exports=function(client,stanzas){stanzas.use(require("../stanza/mam"));client.disco.addFeature("urn:xmpp:mam:0");client.getHistorySearchForm=function(jid,cb){return client.sendIq({to:jid,type:"get",mam:true},cb)};client.searchHistory=function(opts,cb){var self=this;var queryid=this.nextId();opts=opts||{};opts.queryid=queryid;var to=opts.jid||opts.to||"";delete opts.jid;delete opts.to;if(!opts.form){opts.form={}}opts.form.type="submit";var fields=opts.form.fields=opts.form.fields||[];var defaultFields=["FORM_TYPE","with","start","end"];defaultFields.forEach(function(name){if(opts[name]||name==="FORM_TYPE"){var val=opts[name];var isDate=name==="start"||name==="end";if(isDate&&typeof val!=="string"){val=val.toISOString()}if(name==="FORM_TYPE"){val="urn:xmpp:mam:0"}var existing=false;for(var i=0,len=fields.length;i<len;i++){if(fields[i].name===name){continue}}if(!existing){fields.push({name:name,value:val})}delete opts[name]}});var dest=new JID(to||client.jid.bare);var allowed={};allowed[""]=true;allowed[dest.full]=true;allowed[dest.bare]=true;allowed[dest.domain]=true;allowed[client.jid.bare]=true;allowed[client.jid.domain]=true;var results=[];this.on("mam:item:"+queryid,"session",function(msg){if(!allowed[msg.from.full]){return}results.push(msg.mamItem)});var collectResults=new BPromise(function(resolve){self.once("mam:result:"+queryid,"session",function(msg){if(!allowed[msg.from.full]){return}msg.mamResult.items=results;resolve(msg)})});var mamQuery=this.sendIq({type:"set",to:to,id:queryid,mam:opts});return BPromise.all([mamQuery,collectResults]).spread(function(iqRes,mamRes){return mamRes}).timeout(self.config.timeout*1e3||15e3).catch(BPromise.TimeoutError,function(){throw{id:queryid,type:"error",error:{condition:"timeout"}}}).finally(function(){self.off("mam:item:"+queryid);self.off("mam:result:"+queryid)}).nodeify(cb)};client.getHistoryPreferences=function(cb){return this.sendIq({type:"get",mamPrefs:true},cb)};client.setHistoryPreferences=function(opts,cb){return this.sendIq({type:"set",mamPrefs:opts},cb)};client.on("message",function(msg){if(msg.mamItem){client.emit("mam:item:"+msg.mamItem.queryid,msg)}if(msg.mamResult){client.emit("mam:result:"+msg.mamResult.queryid,msg)}})}},{"../stanza/mam":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/mam.js",bluebird:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/bluebird/js/browser/bluebird.js","xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/mood.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/mood";module.exports=function(client,stanzas){stanzas.use(require("../stanza/mood"));client.disco.addFeature(NS);client.disco.addFeature(NS+"+notify");client.on("pubsub:event",function(msg){if(!msg.event.updated){return}if(msg.event.updated.node!==NS){return}client.emit("mood",{jid:msg.from,mood:msg.event.updated.published[0].mood})});client.publishMood=function(mood,text,cb){return this.publish("",NS,{mood:{value:mood,text:text}},cb)}}},{"../stanza/mood":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/mood.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/muc.js":[function(require,module,exports){"use strict";var each=require("lodash.foreach");var JID=require("xmpp-jid").JID;module.exports=function(client,stanzas){stanzas.use(require("../stanza/muc"));stanzas.use(require("../stanza/hats"));client.disco.addFeature("http://jabber.org/protocol/muc");client.disco.addFeature("jabber:x:conference");client.disco.addFeature("urn:xmpp:hats:0");client.joinedRooms={};function rejoinRooms(){each(client.joinedRooms,function(nick,room){client.joinedRooms[room]=false;client.joinRoom(room,nick)})}client.on("session:started",rejoinRooms);client.on("stream:management:resumed",rejoinRooms);client.on("message",function(msg){if(msg.muc){if(msg.muc.invite){client.emit("muc:invite",{from:msg.muc.invite.from,room:msg.from,reason:msg.muc.invite.reason,password:msg.muc.password,thread:msg.muc.invite.thread,type:"mediated"})}if(msg.muc.destroyed){client.emit("muc:destroyed",{room:msg.from,newRoom:msg.muc.destroyed.jid,reason:msg.muc.destroyed.reason,password:msg.muc.destroyed.password})}if(msg.muc.decline){client.emit("muc:declined",{room:msg.from,from:msg.muc.decline.from,reason:msg.muc.decline.reason})}}else if(msg.mucInvite){client.emit("muc:invite",{from:msg.from,room:msg.mucInvite.jid,reason:msg.mucInvite.reason,password:msg.mucInvite.password,thread:msg.mucInvite.thread,type:"direct"})}if(msg.type==="groupchat"&&msg.subject){client.emit("muc:subject",msg)}});client.on("presence",function(pres){if(pres.joinMuc&&pres.type==="error"){client.emit("muc:error",pres)}else if(pres.muc){var isSelf=pres.muc.codes&&pres.muc.codes.indexOf("110")>=0;if(pres.type==="error"){client.emit("muc:error",pres)}else if(pres.type==="unavailable"){client.emit("muc:unavailable",pres);if(isSelf){client.emit("muc:leave",pres);delete client.joinedRooms[pres.from.bare]}}else{client.emit("muc:available",pres);if(isSelf&&!client.joinedRooms[pres.from.bare]){client.emit("muc:join",pres);client.joinedRooms[pres.from.bare]=pres.from.resource}}}});client.joinRoom=function(room,nick,opts){opts=opts||{};opts.to=room+"/"+nick;opts.caps=this.disco.caps;opts.joinMuc=opts.joinMuc||{};this.sendPresence(opts)};client.leaveRoom=function(room,nick,opts){opts=opts||{};opts.to=room+"/"+nick;opts.type="unavailable";this.sendPresence(opts)};client.ban=function(room,jid,reason,cb){client.setRoomAffiliation(room,jid,"outcast",reason,cb)};client.kick=function(room,nick,reason,cb){client.setRoomRole(room,nick,"none",reason,cb)};client.invite=function(room,opts){client.sendMessage({to:room,muc:{invites:opts}})};client.directInvite=function(room,opts){opts.jid=room;client.sendMessage({to:opts.to,mucInvite:opts})};client.declineInvite=function(room,sender,reason){client.sendMessage({to:room,muc:{decline:{to:sender,reason:reason}}})};client.changeNick=function(room,nick){client.sendPresence({to:new JID(room).bare+"/"+nick})};client.setSubject=function(room,subject){client.sendMessage({to:room,type:"groupchat",subject:subject})};client.discoverReservedNick=function(room,cb){client.getDiscoInfo(room,"x-roomuser-item",function(err,res){if(err){return cb(err)}var ident=res.discoInfo.identities[0]||{};cb(null,ident.name)})};client.requestRoomVoice=function(room){client.sendMessage({to:room,form:{fields:[{name:"FORM_TYPE",value:"http://jabber.org/protocol/muc#request"},{name:"muc#role",type:"text-single",value:"participant"}]}})};client.setRoomAffiliation=function(room,jid,affiliation,reason,cb){return this.sendIq({type:"set",to:room,mucAdmin:{jid:jid,affiliation:affiliation,reason:reason}},cb)};client.setRoomRole=function(room,nick,role,reason,cb){return this.sendIq({type:"set",to:room,mucAdmin:{nick:nick,role:role,reason:reason}},cb)};client.getRoomMembers=function(room,opts,cb){return this.sendIq({type:"get",to:room,mucAdmin:opts},cb)};client.getRoomConfig=function(jid,cb){return this.sendIq({to:jid,type:"get",mucOwner:true},cb)};client.configureRoom=function(jid,form,cb){if(!form.type){form.type="submit"}return this.sendIq({to:jid,type:"set",mucOwner:{form:form}},cb)};client.destroyRoom=function(jid,opts,cb){return this.sendIq({to:jid,type:"set",mucOwner:{destroy:opts}},cb)};client.getUniqueRoomName=function(jid,cb){return this.sendIq({type:"get",to:jid,mucUnique:true},cb)}}},{"../stanza/hats":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/hats.js","../stanza/muc":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/muc.js","lodash.foreach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/index.js","xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/nick.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/nick";module.exports=function(client,stanzas){stanzas.use(require("../stanza/nick"));client.disco.addFeature(NS);client.disco.addFeature(NS+"+notify");client.on("pubsub:event",function(msg){if(!msg.event.updated){return}if(msg.event.updated.node!==NS){return}client.emit("nick",{jid:msg.from,nick:msg.event.updated.published[0].nick})});client.publishNick=function(nick,cb){return this.publish("",NS,{nick:nick},cb)}}},{"../stanza/nick":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/nick.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/oldwebsocket.js":[function(require,module,exports){"use strict";var OldWSConnection=require("../transports/old-websocket");module.exports=function(client,stanzas){stanzas.use(require("../stanza/stream"));client.transports["old-websocket"]=OldWSConnection}},{"../stanza/stream":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/stream.js","../transports/old-websocket":"/Users/spaksa/stanza/node_modules/stanza.io/lib/transports/old-websocket.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/oob.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/oob"));client.disco.addFeature("jabber:x:oob")}},{"../stanza/oob":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/oob.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/ping.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/ping"));client.disco.addFeature("urn:xmpp:ping");client.on("iq:get:ping",function(iq){client.sendIq(iq.resultReply())});client.ping=function(jid,cb){return this.sendIq({to:jid,type:"get",ping:true},cb)}}},{"../stanza/ping":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/ping.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/private.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/private"));client.getPrivateData=function(opts,cb){return this.sendIq({type:"get",privateStorage:opts},cb)};client.setPrivateData=function(opts,cb){return this.sendIq({type:"set",privateStorage:opts},cb)}}},{"../stanza/private":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/private.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/psa.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/psa"));client.disco.addFeature("urn:xmpp:psa")}},{"../stanza/psa":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/psa.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/pubsub.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/pubsub"));stanzas.use(require("../stanza/pubsubOwner"));stanzas.use(require("../stanza/pubsubEvents"));stanzas.use(require("../stanza/pubsubError"));client.on("message",function(msg){if(msg.event){client.emit("pubsub:event",msg);client.emit("pubsubEvent",msg);if(msg.event.updated){var published=msg.event.updated.published;var retracted=msg.event.updated.retracted;if(published&&published.length){client.emit("pubsub:published",msg)}if(retracted&&retracted.length){client.emit("pubsub:retracted",msg)}}if(msg.event.purged){client.emit("pubsub:purged",msg)}if(msg.event.deleted){client.emit("pubsub:deleted",msg)}if(msg.event.subscriptionChanged){client.emit("pubsub:subscription",msg)}if(msg.event.configurationChanged){client.emit("pubsub:config",msg)}}if(msg.pubsub&&msg.pubsub.affiliations){client.emit("pubsub:affiliation",msg)}});client.subscribeToNode=function(jid,opts,cb){if(typeof opts==="string"){opts={node:opts}}opts.jid=opts.jid||client.jid;return this.sendIq({type:"set",to:jid,pubsub:{subscribe:opts}},cb)};client.unsubscribeFromNode=function(jid,opts,cb){if(typeof opts==="string"){opts={node:opts}}opts.jid=opts.jid||client.jid.bare;return this.sendIq({type:"set",to:jid,pubsub:{unsubscribe:opts}},cb)};client.publish=function(jid,node,item,cb){return this.sendIq({type:"set",to:jid,pubsub:{publish:{node:node,item:item}}},cb)};client.getItem=function(jid,node,id,cb){return this.sendIq({type:"get",to:jid,pubsub:{retrieve:{node:node,item:id}}},cb)};client.getItems=function(jid,node,opts,cb){opts=opts||{};opts.node=node;return this.sendIq({type:"get",to:jid,pubsub:{retrieve:{node:node,max:opts.max},rsm:opts.rsm}},cb)};client.retract=function(jid,node,id,notify,cb){return this.sendIq({type:"set",to:jid,pubsub:{retract:{node:node,notify:notify,id:id}}},cb)};client.purgeNode=function(jid,node,cb){return this.sendIq({type:"set",to:jid,pubsubOwner:{purge:node}},cb)};client.deleteNode=function(jid,node,cb){return this.sendIq({type:"set",to:jid,pubsubOwner:{del:node}},cb)};client.createNode=function(jid,node,config,cb){var cmd={type:"set",to:jid,pubsubOwner:{create:node}};if(config){cmd.pubsubOwner.config={form:config}}return this.sendIq(cmd,cb)};client.getSubscriptions=function(jid,opts,cb){opts=opts||{};return this.sendIq({type:"get",to:jid,pubsub:{subscriptions:opts}},cb)};client.getAffiliations=function(jid,opts,cb){opts=opts||{};return this.sendIq({type:"get",to:jid,pubsub:{affiliations:opts}},cb)};client.getNodeSubscribers=function(jid,node,opts,cb){opts=opts||{};opts.node=node;return this.sendIq({type:"get",to:jid,pubsubOwner:{subscriptions:opts}},cb)};client.updateNodeSubscriptions=function(jid,node,delta,cb){return this.sendIq({type:"set",to:jid,pubsubOwner:{subscriptions:{node:node,list:delta}}},cb)};client.getNodeAffiliations=function(jid,node,opts,cb){opts=opts||{};opts.node=node;return this.sendIq({type:"get",to:jid,pubsubOwner:{affiliations:opts}},cb)};client.updateNodeAffiliations=function(jid,node,delta,cb){return this.sendIq({type:"set",to:jid,pubsubOwner:{affiliations:{node:node,list:delta}}},cb)}}},{"../stanza/pubsub":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/pubsub.js","../stanza/pubsubError":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/pubsubError.js","../stanza/pubsubEvents":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/pubsubEvents.js","../stanza/pubsubOwner":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/pubsubOwner.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/reach.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/reach"));client.disco.addFeature("urn:xmpp:reach:0");client.disco.addFeature("urn:xmpp:reach:0+notify");client.on("pubsub:event",function(msg){if(!msg.event.updated){return}if(msg.event.updated.node!=="urn:xmpp:reach:0"){return}client.emit("reachability",{jid:msg.from,addresses:msg.event.updated.published[0].reach})});client.on("presence",function(pres){if(!pres.reach||!pres.reach.length){return}client.emit("reachability",{jid:pres.from,addresses:pres.reach})});client.publishReachability=function(data,cb){return this.publish("","urn:xmpp:reach:0",{reach:data},cb)}}},{"../stanza/reach":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/reach.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/receipts.js":[function(require,module,exports){"use strict";module.exports=function(client){client.disco.addFeature("urn:xmpp:receipts");client.on("message",function(msg){var ackTypes={normal:true,chat:true,headline:true};if(ackTypes[msg.type]&&msg.requestReceipt&&!msg.receipt){client.sendMessage({to:msg.from,type:msg.type,receipt:msg.id,id:msg.id})}if(msg.receipt){client.emit("receipt",msg);client.emit("receipt:"+msg.receipt)}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/register.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/register"));client.getAccountInfo=function(jid,cb){return this.sendIq({type:"get",to:jid,register:true},cb)};client.updateAccount=function(jid,data,cb){return this.sendIq({type:"set",to:jid,register:data},cb)};client.deleteAccount=function(jid,cb){return this.sendIq({type:"set",to:jid,register:{remove:true}},cb)}}},{"../stanza/register":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/register.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/roster.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/roster"));client.on("iq:set:roster",function(iq){var allowed={};allowed[""]=true;allowed[client.jid.bare]=true;allowed[client.jid.domain]=true;if(!allowed[iq.from.full]){return client.sendIq(iq.errorReply({error:{type:"cancel",condition:"service-unavailable"}}))}client.emit("roster:update",iq);client.sendIq({id:iq.id,type:"result"})});client.getRoster=function(cb){var self=this;cb=cb||function(){};return client.sendIq({type:"get",roster:{ver:self.config.rosterVer}}).then(function(resp){if(resp.roster){var ver=resp.roster.ver;if(ver){self.config.rosterVer=ver;self.emit("roster:ver",ver)}}return resp}).nodeify(cb)};client.updateRosterItem=function(item,cb){return client.sendIq({type:"set",roster:{items:[item]}},cb)};client.removeRosterItem=function(jid,cb){return client.updateRosterItem({jid:jid,subscription:"remove"},cb)};client.subscribe=function(jid){client.sendPresence({type:"subscribe",to:jid})};client.unsubscribe=function(jid){client.sendPresence({type:"unsubscribe",to:jid})};client.acceptSubscription=function(jid){client.sendPresence({type:"subscribed",to:jid})};client.denySubscription=function(jid){client.sendPresence({type:"unsubscribed",to:jid})}}},{"../stanza/roster":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/roster.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/rtt.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/rtt"));client.disco.addFeature("urn:xmpp:rtt:0");client.on("message",function(msg){if(msg.rtt){client.emit("rtt",msg);client.emit("rtt:"+msg.rtt.event,msg)}})}},{"../stanza/rtt":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/rtt.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/sasl.js":[function(require,module,exports){(function(Buffer){"use strict";var NS="urn:ietf:params:xml:ns:xmpp-sasl";module.exports=function(client,stanzas){stanzas.use(require("../stanza/sasl"));var Auth=stanzas.getDefinition("auth",NS);var Response=stanzas.getDefinition("response",NS);var Abort=stanzas.getDefinition("abort",NS);client.registerFeature("sasl",100,function(features,cb){var self=this;var mech=self.SASLFactory.create(features.sasl.mechanisms);if(!mech){self.releaseGroup("sasl");self.emit("auth:failed");return cb("disconnect","authentication failed")}self.on("sasl:success","sasl",function(){self.features.negotiated.sasl=true;self.releaseGroup("sasl");self.emit("auth:success",self.config.credentials);cb("restart")});self.on("sasl:challenge","sasl",function(challenge){mech.challenge(new Buffer(challenge.value,"base64").toString());return self.getCredentials(function(err,credentials){if(err){return self.send(new Abort)}self.send(new Response({value:new Buffer(mech.response(credentials)).toString("base64")}));if(mech.cache){Object.keys(mech.cache).forEach(function(key){if(!mech.cache[key]){return}self.config.credentials[key]=new Buffer(mech.cache[key])});self.emit("credentials:update",self.config.credentials)}})});self.on("sasl:failure","sasl",function(){self.releaseGroup("sasl");self.emit("auth:failed");cb("disconnect","authentication failed")});self.on("sasl:abort","sasl",function(){self.releaseGroup("sasl");self.emit("auth:failed");cb("disconnect","authentication failed")});var auth={mechanism:mech.name};if(mech.clientFirst){return self.getCredentials(function(err,credentials){if(err){return self.send(new Abort)}auth.value=new Buffer(mech.response(credentials)).toString("base64");self.send(new Auth(auth))})}self.send(new Auth(auth))});client.on("disconnected",function(){client.features.negotiated.sasl=false})}}).call(this,require("buffer").Buffer)},{"../stanza/sasl":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/sasl.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/session.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/session"));client.registerFeature("session",1e3,function(features,cb){var self=this;if(features.session.optional||self.sessionStarted){self.features.negotiated.session=true;return cb()}self.sendIq({type:"set",session:{}},function(err){if(err){return cb("disconnect","session request failed");
}self.features.negotiated.session=true;if(!self.sessionStarted){self.sessionStarted=true;self.emit("session:started",self.jid)}cb()})});client.on("disconnected",function(){client.sessionStarted=false;client.features.negotiated.session=false})}},{"../stanza/session":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/session.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/shim.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/shim";module.exports=function(client,stanzas){stanzas.use(require("../stanza/shim"));client.disco.addFeature(NS);client.disco.addFeature(NS+"#SubID",NS)}},{"../stanza/shim":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/shim.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/smacks.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas,config){stanzas.use(require("../stanza/sm"));var smacks=function(features,cb){var self=this;if(!config.useStreamManagement){return cb()}self.on("stream:management:enabled","sm",function(enabled){self.sm.enabled(enabled);self.features.negotiated.streamManagement=true;self.releaseGroup("sm");cb()});self.on("stream:management:resumed","sm",function(resumed){self.sm.resumed(resumed);self.features.negotiated.streamManagement=true;self.features.negotiated.bind=true;self.sessionStarted=true;self.releaseGroup("sm");cb("break")});self.on("stream:management:failed","sm",function(){self.sm.failed();self.emit("session:end");self.releaseGroup("session");self.releaseGroup("sm");cb()});if(!self.sm.id){if(self.features.negotiated.bind){self.sm.enable()}else{cb()}}else if(self.sm.id&&self.sm.allowResume){self.sm.resume()}else{cb()}};client.on("disconnected",function(){client.features.negotiated.streamManagement=false});client.registerFeature("streamManagement",200,smacks);client.registerFeature("streamManagement",500,smacks)}},{"../stanza/sm":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/sm.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/time.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/time"));client.disco.addFeature("urn:xmpp:time");client.getTime=function(jid,cb){return this.sendIq({to:jid,type:"get",time:true},cb)};client.on("iq:get:time",function(iq){var time=new Date;client.sendIq(iq.resultReply({time:{utc:time,tzo:time.getTimezoneOffset()}}))})}},{"../stanza/time":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/time.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/vcard.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/vcard"));client.disco.addFeature("vcard-temp");client.getVCard=function(jid,cb){return this.sendIq({to:jid,type:"get",vCardTemp:true},cb)};client.publishVCard=function(vcard,cb){return this.sendIq({type:"set",vCardTemp:vcard},cb)}}},{"../stanza/vcard":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/vcard.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/version.js":[function(require,module,exports){"use strict";module.exports=function(client,stanzas){stanzas.use(require("../stanza/version"));client.disco.addFeature("jabber:iq:version");client.on("iq:get:version",function(iq){client.sendIq(iq.resultReply({version:client.config.softwareVersion||{name:"stanza.io"}}))});client.getSoftwareVersion=function(jid,cb){return this.sendIq({to:jid,type:"get",version:true},cb)}}},{"../stanza/version":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/version.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/plugins/websocket.js":[function(require,module,exports){"use strict";var WSConnection=require("../transports/websocket");module.exports=function(client,stanzas){stanzas.use(require("../stanza/framing"));client.transports.websocket=WSConnection}},{"../stanza/framing":"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/framing.js","../transports/websocket":"/Users/spaksa/stanza/node_modules/stanza.io/lib/transports/websocket.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/sm.js":[function(require,module,exports){"use strict";var MAX_SEQ=Math.pow(2,32);function mod(v,n){return(v%n+n)%n}function StreamManagement(client){this.client=client;this.id=false;this.allowResume=true;this.started=false;this.inboundStarted=false;this.outboundStarted=false;this.lastAck=0;this.handled=0;this.windowSize=1;this.unacked=[];this.pendingAck=false;var NS="urn:xmpp:sm:3";this.stanzas={Enable:client.stanzas.getDefinition("enable",NS),Resume:client.stanzas.getDefinition("resume",NS),Ack:client.stanzas.getDefinition("a",NS),Request:client.stanzas.getDefinition("r",NS)}}StreamManagement.prototype={constructor:{value:StreamManagement},enable:function(){var enable=new this.stanzas.Enable;enable.resume=this.allowResume;this.client.send(enable);this.handled=0;this.outboundStarted=true},resume:function(){var resume=new this.stanzas.Resume({h:this.handled,previd:this.id});this.client.send(resume);this.outboundStarted=true},enabled:function(resp){this.id=resp.id;this.handled=0;this.inboundStarted=true},resumed:function(resp){this.id=resp.previd;if(resp.h){this.process(resp,true)}this.inboundStarted=true},failed:function(){this.inboundStarted=false;this.outboundStarted=false;this.id=false;this.lastAck=0;this.handled=0;this.unacked=[]},ack:function(){this.client.send(new this.stanzas.Ack({h:this.handled}))},request:function(){this.pendingAck=true;this.client.send(new this.stanzas.Request)},process:function(ack,resend){var self=this;var numAcked=mod(ack.h-this.lastAck,MAX_SEQ);this.pendingAck=false;for(var i=0;i<numAcked&&this.unacked.length>0;i++){this.client.emit("stanza:acked",this.unacked.shift())}this.lastAck=ack.h;if(resend){var resendUnacked=this.unacked;this.unacked=[];resendUnacked.forEach(function(stanza){self.client.send(stanza)})}if(this.needAck()){this.request()}},track:function(stanza){var name=stanza._name;var acceptable={message:true,presence:true,iq:true};if(this.outboundStarted&&acceptable[name]){this.unacked.push(stanza);if(this.needAck()){this.request()}}},handle:function(){if(this.inboundStarted){this.handled=mod(this.handled+1,MAX_SEQ)}},needAck:function(){return!this.pendingAck&&this.unacked.length>=this.windowSize}};Object.defineProperties(StreamManagement.prototype,{started:{get:function(){return this.outboundStarted&&this.inboundStarted},set:function(value){if(!value){this.outboundStarted=false;this.inboundStarted=false}}}});module.exports=StreamManagement},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/avatar.js":[function(require,module,exports){"use strict";var each=require("lodash.foreach");module.exports=function(stanza){var types=stanza.utils;var Avatar=stanza.define({name:"avatar",namespace:"urn:xmpp:avatar:metadata",element:"info",fields:{id:types.attribute("id"),bytes:types.attribute("bytes"),height:types.attribute("height"),width:types.attribute("width"),type:types.attribute("type","image/png"),url:types.attribute("url")}});var avatars={get:function(){var metadata=types.find(this.xml,"urn:xmpp:avatar:metadata","metadata");var results=[];if(metadata.length){var avatars=types.find(metadata[0],"urn:xmpp:avatar:metadata","info");each(avatars,function(info){results.push(new Avatar({},info))})}return results},set:function(value){var metadata=types.findOrCreate(this.xml,"urn:xmpp:avatar:metadata","metadata");types.setAttribute(metadata,"xmlns","urn:xmpp:avatar:metadata");each(value,function(info){var avatar=new Avatar(info);metadata.appendChild(avatar.xml)})}};stanza.withPubsubItem(function(Item){stanza.add(Item,"avatars",avatars);stanza.add(Item,"avatarData",types.textSub("urn:xmpp:avatar:data","data"))})}},{"lodash.foreach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/bind.js":[function(require,module,exports){"use strict";var NS="urn:ietf:params:xml:ns:xmpp-bind";module.exports=function(stanza){var types=stanza.utils;var Bind=stanza.define({name:"bind",namespace:NS,element:"bind",fields:{resource:types.textSub(NS,"resource"),jid:types.jidSub(NS,"jid")}});stanza.withIq(function(Iq){stanza.extend(Iq,Bind)});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,Bind)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/blocking.js":[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;var NS="urn:xmpp:blocking";module.exports=function(stanza){var types=stanza.utils;var jids={get:function(){var result=[];var items=types.find(this.xml,NS,"item");if(!items.length){return result}items.forEach(function(item){result.push(new JID(types.getAttribute(item,"jid","")))});return result},set:function(values){var self=this;values.forEach(function(value){var item=types.createElement(NS,"item",NS);types.setAttribute(item,"jid",value.toString());self.xml.appendChild(item)})}};var Block=stanza.define({name:"block",namespace:NS,element:"block",fields:{jids:jids}});var Unblock=stanza.define({name:"unblock",namespace:NS,element:"unblock",fields:{jids:jids}});var BlockList=stanza.define({name:"blockList",namespace:NS,element:"blocklist",fields:{jids:jids}});stanza.withIq(function(Iq){stanza.extend(Iq,Block);stanza.extend(Iq,Unblock);stanza.extend(Iq,BlockList)})}},{"xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/bob.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:bob";module.exports=function(stanza){var types=stanza.utils;var BOB=stanza.define({name:"bob",namespace:NS,element:"data",fields:{cid:types.attribute("cid"),maxAge:types.numberAttribute("max-age"),type:types.attribute("type"),data:types.text()}});stanza.withIq(function(Iq){stanza.extend(Iq,BOB)});stanza.withMessage(function(Message){stanza.extend(Message,BOB)});stanza.withPresence(function(Presence){stanza.extend(Presence,BOB)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/bookmarks.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;var Conference=stanza.define({name:"_conference",namespace:"storage:bookmarks",element:"conference",fields:{name:types.attribute("name"),autoJoin:types.boolAttribute("autojoin"),jid:types.jidAttribute("jid"),nick:types.textSub("storage:bookmarks","nick")}});var Bookmarks=stanza.define({name:"bookmarks",namespace:"storage:bookmarks",element:"storage"});stanza.extend(Bookmarks,Conference,"conferences");stanza.withDefinition("query","jabber:iq:private",function(PrivateStorage){stanza.extend(PrivateStorage,Bookmarks)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/bosh.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/httpbind";var XMPP_NS="urn:xmpp:xbosh";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"bosh",namespace:NS,element:"body",prefixes:{xmpp:XMPP_NS},fields:{accept:types.attribute("accept"),ack:types.numberAttribute("ack"),authid:types.attribute("authid"),charsets:types.attribute("charsets"),condition:types.attribute("condition"),content:types.attribute("content"),from:types.jidAttribute("from",true),hold:types.numberAttribute("hold"),inactivity:types.numberAttribute("inactivity"),key:types.attribute("key"),maxpause:types.numberAttribute("maxpause"),newKey:types.attribute("newkey"),pause:types.numberAttribute("pause"),polling:types.numberAttribute("polling"),resport:types.numberAttribute("report"),requests:types.numberAttribute("requests"),rid:types.numberAttribute("rid"),sid:types.attribute("sid"),stream:types.attribute("stream"),time:types.attribute("time"),to:types.jidAttribute("to",true),type:types.attribute("type"),ver:types.attribute("ver"),wait:types.numberAttribute("wait"),uri:types.textSub(NS,"uri"),lang:types.langAttribute(),version:types.attribute("xmpp:version","1.0"),restart:types.attribute("xmpp:restart"),restartLogic:types.boolAttribute("xmpp:restartLogic"),payload:{get:function(){var results=[];for(var i=0,len=this.xml.childNodes.length;i<len;i++){var obj=stanza.build(this.xml.childNodes[i]);if(obj!==undefined){results.push(obj)}}return results},set:function(values){var self=this;values.forEach(function(types){self.xml.appendChild(types.xml)})}}}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/caps.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;var Caps=stanza.define({name:"caps",namespace:"http://jabber.org/protocol/caps",element:"c",fields:{ver:types.attribute("ver"),node:types.attribute("node"),hash:types.attribute("hash"),ext:types.attribute("ext")}});stanza.withPresence(function(Presence){stanza.extend(Presence,Caps)});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,Caps)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/carbons.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var Sent=stanza.define({name:"carbonSent",eventName:"carbon:sent",namespace:"urn:xmpp:carbons:2",element:"sent"});var Received=stanza.define({name:"carbonReceived",eventName:"carbon:received",namespace:"urn:xmpp:carbons:2",element:"received"});var Private=stanza.define({name:"carbonPrivate",eventName:"carbon:private",namespace:"urn:xmpp:carbons:2",element:"private"});var Enable=stanza.define({name:"enableCarbons",namespace:"urn:xmpp:carbons:2",element:"enable"});var Disable=stanza.define({name:"disableCarbons",namespace:"urn:xmpp:carbons:2",element:"disable"});stanza.withDefinition("forwarded","urn:xmpp:forward:0",function(Forwarded){stanza.extend(Sent,Forwarded);stanza.extend(Received,Forwarded)});stanza.withMessage(function(Message){stanza.extend(Message,Sent);stanza.extend(Message,Received);stanza.extend(Message,Private)});stanza.withIq(function(Iq){stanza.extend(Iq,Enable);stanza.extend(Iq,Disable)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/command.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/commands";var ACTIONS=["next","prev","complete","cancel"];var CONDITIONS=["bad-action","bad-locale","bad-payload","bad-sessionid","malformed-action","session-expired"];module.exports=function(stanza){var types=stanza.utils;var Command=stanza.define({name:"command",namespace:NS,element:"command",fields:{action:types.attribute("action"),node:types.attribute("node"),sessionid:types.attribute("sessionid"),status:types.attribute("status"),execute:types.subAttribute(NS,"actions","execute"),actions:{get:function(){var result=[];var actionSet=types.find(this.xml,NS,"actions");if(!actionSet.length){return[]}ACTIONS.forEach(function(action){var existing=types.find(actionSet[0],NS,action);if(existing.length){result.push(action)}});return result},set:function(values){var actionSet=types.findOrCreate(this.xml,NS,"actions");for(var i=0,len=actionSet.childNodes.length;i<len;i++){actionSet.removeChild(actionSet.childNodes[i])}values.forEach(function(value){actionSet.appendChild(types.createElement(NS,value.toLowerCase(),NS))})}}}});var Note=stanza.define({name:"_commandNote",namespace:NS,element:"note",fields:{type:types.attribute("type"),value:types.text()}});stanza.extend(Command,Note,"notes");stanza.withStanzaError(function(ErrorStanza){stanza.add(ErrorStanza,"adhocCommandCondition",types.enumSub(NS,CONDITIONS))});stanza.withDataForm(function(DataForm){stanza.extend(Command,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,Command)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/csi.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:csi";module.exports=function(stanza){var CSIFeature=stanza.define({name:"clientStateIndication",namespace:NS,element:"csi"});stanza.define({name:"csiActive",eventName:"csi:active",namespace:NS,element:"active",topLevel:true});stanza.define({name:"csiInactive",eventName:"csi:inactive",namespace:NS,element:"inactive",topLevel:true});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,CSIFeature)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/dataforms.js":[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;var FORM_NS="jabber:x:data";var MEDIA_NS="urn:xmpp:media-element";var VALIDATE_NS="http://jabber.org/protocol/xdata-validate";var LAYOUT_NS="http://jabber.org/protocol/xdata-layout";var SINGLE_FIELDS=["text-single","text-private","list-single","jid-single"];module.exports=function(stanza){var types=stanza.utils;var Field=stanza.define({name:"_field",namespace:FORM_NS,element:"field",init:function(data){this._type=(data||{}).type||this.type},fields:{type:{get:function(){return types.getAttribute(this.xml,"type","text-single")},set:function(value){this._type=value;types.setAttribute(this.xml,"type",value)}},name:types.attribute("var"),desc:types.textSub(FORM_NS,"desc"),required:types.boolSub(FORM_NS,"required"),label:types.attribute("label"),value:{get:function(){var vals=types.getMultiSubText(this.xml,FORM_NS,"value");if(this._type==="boolean"){return vals[0]==="1"||vals[0]==="true"}if(vals.length>1){if(this._type==="text-multi"){return vals.join("\n")}if(this._type==="jid-multi"){return vals.map(function(jid){return new JID(jid)})}return vals}if(SINGLE_FIELDS.indexOf(this._type)>=0){if(this._type==="jid-single"){return new JID(vals[0])}return vals[0]}return vals},set:function(value){if(this._type==="boolean"||value===true||value===false){var truthy=value===true||value==="true"||value==="1";var sub=types.createElement(FORM_NS,"value",FORM_NS);sub.textContent=truthy?"1":"0";this.xml.appendChild(sub)}else{if(this._type==="text-multi"&&typeof value==="string"){value=value.split("\n")}types.setMultiSubText(this.xml,FORM_NS,"value",value,function(val){var sub=types.createElement(FORM_NS,"value",FORM_NS);sub.textContent=val;this.xml.appendChild(sub)}.bind(this))}}}}});var Option=stanza.define({name:"_formoption",namespace:FORM_NS,element:"option",fields:{label:types.attribute("label"),value:types.textSub(FORM_NS,"value")}});var Item=stanza.define({name:"_formitem",namespace:FORM_NS,element:"item"});var Media=stanza.define({name:"media",element:"media",namespace:MEDIA_NS,fields:{height:types.numberAttribute("height"),width:types.numberAttribute("width")}});var MediaURI=stanza.define({name:"_mediaURI",element:"uri",namespace:MEDIA_NS,fields:{uri:types.text(),type:types.attribute("type")}});var Validation=stanza.define({name:"validation",element:"validate",namespace:VALIDATE_NS,fields:{dataType:types.attribute("datatype"),basic:types.boolSub(VALIDATE_NS,"basic"),open:types.boolSub(VALIDATE_NS,"open"),regex:types.textSub(VALIDATE_NS,"regex")}});var Range=stanza.define({name:"range",element:"range",namespace:VALIDATE_NS,fields:{min:types.attribute("min"),max:types.attribute("max")}});var ListRange=stanza.define({name:"select",element:"list-range",namespace:VALIDATE_NS,fields:{min:types.numberAttribute("min"),max:types.numberAttribute("max")}});var layoutContents={get:function(){var result=[];for(var i=0,len=this.xml.childNodes.length;i<len;i++){var child=this.xml.childNodes[i];if(child.namespaceURI!==LAYOUT_NS){continue}switch(child.localName){case"text":result.push({text:child.textContent});break;case"fieldref":result.push({field:child.getAttribute("var")});break;case"reportedref":result.push({reported:true});break;case"section":result.push({section:new Section(null,child,this).toJSON()});break}}return result},set:function(values){for(var i=0,len=values.length;i<len;i++){var value=values[i];if(value.text){var text=stanza.createElement(LAYOUT_NS,"text",LAYOUT_NS);text.textContent=value.text;this.xml.appendChild(text)}if(value.field){var field=stanza.createElement(LAYOUT_NS,"fieldref",LAYOUT_NS);field.setAttribute("var",value.field);this.xml.appendChild(field)}if(value.reported){this.xml.appendChild(stanza.createElement(LAYOUT_NS,"reportedref",LAYOUT_NS))}if(value.section){var sectionXML=stanza.createElement(LAYOUT_NS,"section",LAYOUT_NS);this.xml.appendChild(sectionXML);var section=new Section(null,sectionXML);section.label=value.section.label;section.contents=value.section.contents}}}};var Section=stanza.define({name:"_section",element:"section",namespace:LAYOUT_NS,fields:{label:types.attribute("label"),contents:layoutContents}});var Page=stanza.define({name:"_page",element:"page",namespace:LAYOUT_NS,fields:{label:types.attribute("label"),contents:layoutContents}});var DataForm=stanza.define({name:"form",namespace:FORM_NS,element:"x",init:function(){if(!this.reportedFields.length){return}var fieldTypes={};this.reportedFields.forEach(function(reported){fieldTypes[reported.name]=reported.type});this.items.forEach(function(item){item.fields.forEach(function(field){field.type=field._type=fieldTypes[field.name]})})},fields:{title:types.textSub(FORM_NS,"title"),instructions:types.multiTextSub(FORM_NS,"instructions"),type:types.attribute("type","form"),reportedFields:types.subMultiExtension(FORM_NS,"reported",Field)}});stanza.extend(DataForm,Field,"fields");stanza.extend(DataForm,Item,"items");stanza.extend(DataForm,Page,"layout");stanza.extend(Field,Media);stanza.extend(Field,Validation);stanza.extend(Field,Option,"options");stanza.extend(Item,Field,"fields");stanza.extend(Media,MediaURI,"uris");stanza.extend(Validation,Range);stanza.extend(Validation,ListRange);stanza.withMessage(function(Message){stanza.extend(Message,DataForm)})}},{"xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/delayed.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;var DelayedDelivery=stanza.define({name:"delay",namespace:"urn:xmpp:delay",element:"delay",fields:{from:types.jidAttribute("from"),stamp:types.dateAttribute("stamp"),reason:types.text()}});stanza.withMessage(function(Message){stanza.extend(Message,DelayedDelivery)});stanza.withPresence(function(Presence){stanza.extend(Presence,DelayedDelivery)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/disco.js":[function(require,module,exports){"use strict";var NSInfo="http://jabber.org/protocol/disco#info";var NSItems="http://jabber.org/protocol/disco#items";module.exports=function(stanza){var types=stanza.utils;var DiscoInfo=stanza.define({name:"discoInfo",namespace:NSInfo,element:"query",fields:{node:types.attribute("node"),features:types.multiSubAttribute(NSInfo,"feature","var")}});var DiscoIdentity=stanza.define({name:"_discoIdentity",namespace:NSInfo,element:"identity",fields:{category:types.attribute("category"),type:types.attribute("type"),name:types.attribute("name"),lang:types.langAttribute()}});var DiscoItems=stanza.define({name:"discoItems",namespace:NSItems,element:"query",fields:{node:types.attribute("node")}});var DiscoItem=stanza.define({name:"_discoItem",namespace:NSItems,element:"item",fields:{jid:types.jidAttribute("jid"),node:types.attribute("node"),name:types.attribute("name")}});stanza.extend(DiscoItems,DiscoItem,"items");stanza.extend(DiscoInfo,DiscoIdentity,"identities");stanza.withIq(function(Iq){stanza.extend(Iq,DiscoInfo);stanza.extend(Iq,DiscoItems)});stanza.withDataForm(function(DataForm){stanza.extend(DiscoInfo,DataForm,"extensions")});stanza.withDefinition("set","http://jabber.org/protocol/rsm",function(RSM){stanza.extend(DiscoItems,RSM)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/error.js":[function(require,module,exports){"use strict";var ERR_NS="urn:ietf:params:xml:ns:xmpp-stanzas";var CONDITIONS=["bad-request","conflict","feature-not-implemented","forbidden","gone","internal-server-error","item-not-found","jid-malformed","not-acceptable","not-allowed","not-authorized","payment-required","recipient-unavailable","redirect","registration-required","remote-server-not-found","remote-server-timeout","resource-constraint","service-unavailable","subscription-required","undefined-condition","unexpected-request"];module.exports=function(stanza){var types=stanza.utils;var ErrorStanza=stanza.define({name:"error",namespace:"jabber:client",element:"error",fields:{lang:{get:function(){return(this.parent||{}).lang||""}},condition:types.enumSub(ERR_NS,CONDITIONS),gone:{get:function(){return types.getSubText(this.xml,ERR_NS,"gone")},set:function(value){this.condition="gone";types.setSubText(this.xml,ERR_NS,"gone",value)}},redirect:{get:function(){return types.getSubText(this.xml,ERR_NS,"redirect")},set:function(value){this.condition="redirect";types.setSubText(this.xml,ERR_NS,"redirect",value)}},code:types.attribute("code"),type:types.attribute("type"),by:types.jidAttribute("by"),$text:{get:function(){return types.getSubLangText(this.xml,ERR_NS,"text",this.lang)}},text:{get:function(){var text=this.$text;return text[this.lang]||""},set:function(value){types.setSubLangText(this.xml,ERR_NS,"text",value,this.lang)}}}});stanza.withMessage(function(Message){stanza.extend(Message,ErrorStanza)});stanza.withPresence(function(Presence){stanza.extend(Presence,ErrorStanza)});stanza.withIq(function(Iq){stanza.extend(Iq,ErrorStanza)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/extdisco.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:extdisco:1";module.exports=function(stanza){var types=stanza.utils;var Services=exports.Services=stanza.define({name:"services",namespace:NS,element:"services",fields:{type:types.attribute("type")}});var Credentials=exports.Credentials=stanza.define({name:"credentials",namespace:NS,element:"credentials"});var Service=stanza.define({name:"service",namespace:NS,element:"service",fields:{host:types.attribute("host"),port:types.attribute("port"),transport:types.attribute("transport"),type:types.attribute("type"),username:types.attribute("username"),password:types.attribute("password")}});stanza.extend(Services,Service,"services");stanza.extend(Credentials,Service);stanza.withDataForm(function(DataForm){stanza.extend(Service,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,Services);stanza.extend(Iq,Credentials)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/file.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:jingle:apps:file-transfer:3";var TB_NS="urn:xmpp:thumbs:0";module.exports=function(stanza){var types=stanza.utils;var File=stanza.define({name:"_file",namespace:NS,element:"file",fields:{name:types.textSub(NS,"name"),desc:types.textSub(NS,"desc"),size:types.numberSub(NS,"size"),date:types.dateSub(NS,"date")}});var Range=stanza.define({name:"range",namespace:NS,element:"range",fields:{offset:types.numberAttribute("offset")}});var Thumbnail=stanza.define({name:"thumbnail",namespace:TB_NS,element:"thumbnail",fields:{cid:types.attribute("cid"),mimeType:types.attribute("mime-type"),width:types.numberAttribute("width"),height:types.numberAttribute("height")}});var FileTransfer=stanza.define({name:"_filetransfer",namespace:NS,element:"description",tags:["jingle-description"],fields:{descType:{value:"filetransfer"},offer:types.subExtension("offer",NS,"offer",File),request:types.subExtension("request",NS,"request",File)}});stanza.extend(File,Range);stanza.extend(File,Thumbnail);stanza.withDefinition("hash","urn:xmpp:hashes:1",function(Hash){stanza.extend(File,Hash,"hashes")});stanza.withDefinition("content","urn:xmpp:jingle:1",function(Content){stanza.extend(Content,FileTransfer)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/forwarded.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var Forwarded=stanza.define({name:"forwarded",eventName:"forward",namespace:"urn:xmpp:forward:0",element:"forwarded"});stanza.withMessage(function(Message){stanza.extend(Message,Forwarded);stanza.extend(Forwarded,Message)});stanza.withPresence(function(Presence){stanza.extend(Forwarded,Presence)});stanza.withIq(function(Iq){stanza.extend(Forwarded,Iq)});stanza.withDefinition("delay","urn:xmpp:delay",function(Delayed){stanza.extend(Forwarded,Delayed)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/framing.js":[function(require,module,exports){"use strict";var NS="urn:ietf:params:xml:ns:xmpp-framing";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"openStream",namespace:NS,element:"open",topLevel:true,fields:{lang:types.langAttribute(),id:types.attribute("id"),version:types.attribute("version","1.0"),to:types.jidAttribute("to",true),from:types.jidAttribute("from",true)}});stanza.define({name:"closeStream",namespace:NS,element:"close",topLevel:true,fields:{seeOtherURI:types.attribute("see-other-uri")}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/geoloc.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/geoloc";module.exports=function(stanza){var types=stanza.utils;var GeoLoc=stanza.define({name:"geoloc",namespace:NS,element:"geoloc",fields:{accuracy:types.numberSub(NS,"accuracy",true),altitude:types.numberSub(NS,"alt",true),area:types.textSub(NS,"area"),heading:types.numberSub(NS,"bearing",true),bearing:types.numberSub(NS,"bearing",true),building:types.textSub(NS,"building"),country:types.textSub(NS,"country"),countrycode:types.textSub(NS,"countrycode"),datum:types.textSub(NS,"datum"),description:types.textSub(NS,"description"),error:types.numberSub(NS,"error",true),floor:types.textSub(NS,"floor"),latitude:types.numberSub(NS,"lat",true),locality:types.textSub(NS,"locality"),longitude:types.numberSub(NS,"lon",true),postalcode:types.textSub(NS,"postalcode"),region:types.textSub(NS,"region"),room:types.textSub(NS,"room"),speed:types.numberSub(NS,"speed",true),street:types.textSub(NS,"street"),text:types.textSub(NS,"text"),timestamp:types.dateSub(NS,"timestamp"),tzo:types.tzoSub(NS,"tzo"),uri:types.textSub(NS,"uri")}});stanza.withPubsubItem(function(Item){stanza.extend(Item,GeoLoc)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/hash.js":[function(require,module,exports){"use strict";module.exports=function(stanza){stanza.define({name:"hash",namespace:"urn:xmpp:hashes:1",element:"hash",fields:{algo:stanza.utils.attribute("algo"),value:stanza.utils.text()}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/hats.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:hats:0";module.exports=function(stanza){var types=stanza.utils;var Hat=stanza.define({name:"_hat",namespace:NS,element:"hat",fields:{lang:types.langAttribute(),name:types.attribute("name"),displayName:types.attribute("displayName")}});stanza.withPresence(function(Presence){stanza.add(Presence,"hats",types.subMultiExtension(NS,"hats",Hat))})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/iceUdp.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:jingle:transports:ice-udp:1";module.exports=function(stanza){var types=stanza.utils;var ICE=stanza.define({name:"_iceUdp",namespace:NS,element:"transport",tags:["jingle-transport"],fields:{transType:{value:"iceUdp"},pwd:types.attribute("pwd"),ufrag:types.attribute("ufrag")}});var RemoteCandidate=stanza.define({name:"remoteCandidate",namespace:NS,element:"remote-candidate",fields:{component:types.attribute("component"),ip:types.attribute("ip"),port:types.attribute("port")}});var Candidate=stanza.define({name:"_iceUdpCandidate",namespace:NS,element:"candidate",fields:{component:types.attribute("component"),foundation:types.attribute("foundation"),generation:types.attribute("generation"),id:types.attribute("id"),ip:types.attribute("ip"),network:types.attribute("network"),port:types.attribute("port"),priority:types.attribute("priority"),protocol:types.attribute("protocol"),relAddr:types.attribute("rel-addr"),relPort:types.attribute("rel-port"),tcpType:types.attribute("tcptype"),type:types.attribute("type")}});var Fingerprint=stanza.define({name:"_iceFingerprint",namespace:"urn:xmpp:jingle:apps:dtls:0",
element:"fingerprint",fields:{hash:types.attribute("hash"),setup:types.attribute("setup"),value:types.text(),required:types.boolAttribute("required")}});var SctpMap=stanza.define({name:"_sctpMap",namespace:"urn:xmpp:jingle:transports:dtls-sctp:1",element:"sctpmap",fields:{number:types.attribute("number"),protocol:types.attribute("protocol"),streams:types.attribute("streams")}});stanza.extend(ICE,Candidate,"candidates");stanza.extend(ICE,RemoteCandidate);stanza.extend(ICE,Fingerprint,"fingerprints");stanza.extend(ICE,SctpMap,"sctp");stanza.withDefinition("content","urn:xmpp:jingle:1",function(Content){stanza.extend(Content,ICE)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/iq.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;var Iq=stanza.define({name:"iq",namespace:"jabber:client",element:"iq",topLevel:true,fields:{lang:types.langAttribute(),id:types.attribute("id"),to:types.jidAttribute("to",true),from:types.jidAttribute("from",true),type:types.attribute("type")}});var toJSON=Iq.prototype.toJSON;Iq.prototype.toJSON=function(){var result=toJSON.call(this);result.resultReply=this.resultReply;result.errorReply=this.errorReply;return result};Iq.prototype.resultReply=function(data){data=data||{};data.to=this.from;data.id=this.id;data.type="result";return new Iq(data)};Iq.prototype.errorReply=function(data){data=data||{};data.to=this.from;data.id=this.id;data.type="error";return new Iq(data)}}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/jidprep.js":[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;var NS="urn:xmpp:jidprep:0";module.exports=function(stanza){var types=stanza.utils;stanza.withIq(function(Iq){stanza.add(Iq,"jidPrep",{get:function(){var data=types.getSubText(this.xml,NS,"jid");if(data){var jid=new JID(data);jid.prepped=true;return jid}},set:function(value){types.setSubText(this.xml,NS,"jid",(value||"").toString())}})})}},{"xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/jingle.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:jingle:1";var ERRNS="urn:xmpp:jingle:errors:1";var CONDITIONS=["out-of-order","tie-break","unknown-session","unsupported-info"];var REASONS=["alternative-session","busy","cancel","connectivity-error","decline","expired","failed-application","failed-transport","general-error","gone","incompatible-parameters","media-error","security-error","success","timeout","unsupported-applications","unsupported-transports"];module.exports=function(stanza){var types=stanza.utils;var Jingle=stanza.define({name:"jingle",namespace:NS,element:"jingle",fields:{action:types.attribute("action"),initiator:types.attribute("initiator"),responder:types.attribute("responder"),sid:types.attribute("sid")}});var Content=stanza.define({name:"_jingleContent",namespace:NS,element:"content",fields:{creator:types.attribute("creator"),disposition:types.attribute("disposition","session"),name:types.attribute("name"),senders:types.attribute("senders","both"),description:{get:function(){var opts=stanza.tagged("jingle-description").map(function(Description){return Description.prototype._name});for(var i=0,len=opts.length;i<len;i++){if(this._extensions[opts[i]]){return this._extensions[opts[i]]}}},set:function(value){var ext="_"+value.descType;this[ext]=value}},transport:{get:function(){var opts=stanza.tagged("jingle-transport").map(function(Transport){return Transport.prototype._name});for(var i=0,len=opts.length;i<len;i++){if(this._extensions[opts[i]]){return this._extensions[opts[i]]}}},set:function(value){var ext="_"+value.transType;this[ext]=value}}}});var Reason=stanza.define({name:"reason",namespace:NS,element:"reason",fields:{condition:types.enumSub(NS,REASONS),alternativeSession:{get:function(){return types.getSubText(this.xml,NS,"alternative-session")},set:function(value){this.condition="alternative-session";types.setSubText(this.xml,NS,"alternative-session",value)}},text:types.textSub(NS,"text")}});stanza.extend(Jingle,Content,"contents");stanza.extend(Jingle,Reason);stanza.withStanzaError(function(ErrorStanza){stanza.add(ErrorStanza,"jingleCondition",types.enumSub(ERRNS,CONDITIONS))});stanza.withIq(function(Iq){stanza.extend(Iq,Jingle)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/json.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;var JSONExtension={get:function(){var data=types.getSubText(this.xml,"urn:xmpp:json:0","json");if(data){return JSON.parse(data)}},set:function(value){value=JSON.stringify(value);if(value){types.setSubText(this.xml,"urn:xmpp:json:0","json",value)}}};stanza.withMessage(function(Message){stanza.add(Message,"json",JSONExtension)});stanza.withPubsubItem(function(Item){stanza.add(Item,"json",JSONExtension)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/logging.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:eventlog";module.exports=function(stanza){var types=stanza.utils;var Log=stanza.define({name:"log",namespace:NS,element:"log",fields:{id:types.attribute("id"),timestamp:types.dateAttribute("timestamp"),type:types.attribute("type"),level:types.attribute("level"),object:types.attribute("object"),subject:types.attribute("subject"),facility:types.attribute("facility"),module:types.attribute("module"),message:types.textSub(NS,"message"),stackTrace:types.textSub(NS,"stackTrace")}});var Tag=stanza.define({name:"_logtag",namespace:NS,element:"tag",fields:{name:types.attribute("name"),value:types.attribute("value"),type:types.attribute("type")}});stanza.extend(Log,Tag,"tags");stanza.withMessage(function(Message){stanza.extend(Message,Log)});stanza.withPubsubItem(function(Item){stanza.extend(Item,Log)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/mam.js":[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;var NS="urn:xmpp:mam:0";module.exports=function(stanza){var types=stanza.utils;var MAMQuery=stanza.define({name:"mam",namespace:NS,element:"query",fields:{queryid:types.attribute("queryid")}});var Result=stanza.define({name:"mamItem",namespace:NS,element:"result",fields:{queryid:types.attribute("queryid"),id:types.attribute("id")}});var Fin=stanza.define({name:"mamResult",namespace:NS,element:"fin",fields:{queryid:types.attribute("queryid"),complete:types.boolAttribute("complete"),stable:types.boolAttribute("stable")}});var Prefs=stanza.define({name:"mamPrefs",namespace:NS,element:"prefs",fields:{defaultCondition:types.attribute("default"),always:{get:function(){var results=[];var container=types.find(this.xml,NS,"always");if(container.length===0){return results}container=container[0];var jids=types.getMultiSubText(container,NS,"jid");jids.forEach(function(jid){results.push(new JID(jid.textContent))});return results},set:function(value){if(value.length>0){var container=types.find(this.xml,NS,"always");types.setMultiSubText(container,NS,"jid",value)}}},never:{get:function(){var results=[];var container=types.find(this.xml,NS,"always");if(container.length===0){return results}container=container[0];var jids=types.getMultiSubText(container,NS,"jid");jids.forEach(function(jid){results.push(new JID(jid.textContent))});return results},set:function(value){if(value.length>0){var container=types.find(this.xml,NS,"never");types.setMultiSubText(container,NS,"jid",value)}}}}});stanza.withDefinition("forwarded","urn:xmpp:forward:0",function(Forwarded){stanza.extend(Result,Forwarded)});stanza.withDefinition("set","http://jabber.org/protocol/rsm",function(RSM){stanza.extend(MAMQuery,RSM);stanza.extend(Fin,RSM)});stanza.withDataForm(function(DataForm){stanza.extend(MAMQuery,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,MAMQuery);stanza.extend(Iq,Prefs)});stanza.withMessage(function(Message){stanza.extend(Message,Result);stanza.extend(Message,Fin)})}},{"xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/message.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"message",namespace:"jabber:client",element:"message",topLevel:true,fields:{lang:types.langAttribute(),id:types.attribute("id"),to:types.jidAttribute("to",true),from:types.jidAttribute("from",true),type:types.attribute("type","normal"),thread:types.textSub("jabber:client","thread"),parentThread:types.subAttribute("jabber:client","thread","parent"),subject:types.textSub("jabber:client","subject"),$body:{get:function(){return types.getSubLangText(this.xml,this._NS,"body",this.lang)}},body:{get:function(){var bodies=this.$body;return bodies[this.lang]||""},set:function(value){types.setSubLangText(this.xml,this._NS,"body",value,this.lang)}},attention:types.boolSub("urn:xmpp:attention:0","attention"),chatState:types.enumSub("http://jabber.org/protocol/chatstates",["active","composing","paused","inactive","gone"]),replace:types.subAttribute("urn:xmpp:message-correct:0","replace","id"),requestReceipt:types.boolSub("urn:xmpp:receipts","request"),receipt:types.subAttribute("urn:xmpp:receipts","received","id")}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/mood.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/mood";var MOODS=["afraid","amazed","amorous","angry","annoyed","anxious","aroused","ashamed","bored","brave","calm","cautious","cold","confident","confused","contemplative","contented","cranky","crazy","creative","curious","dejected","depressed","disappointed","disgusted","dismayed","distracted","embarrassed","envious","excited","flirtatious","frustrated","grateful","grieving","grumpy","guilty","happy","hopeful","hot","humbled","humiliated","hungry","hurt","impressed","in_awe","in_love","indignant","interested","intoxicated","invincible","jealous","lonely","lucky","mean","moody","nervous","neutral","offended","outraged","playful","proud","relaxed","relieved","remorseful","restless","sad","sarcastic","serious","shocked","shy","sick","sleepy","spontaneous","stressed","strong","surprised","thankful","thirsty","tired","undefined","weak","worried"];module.exports=function(stanza){var Mood=stanza.define({name:"mood",namespace:NS,element:"mood",fields:{text:stanza.utils.textSub(NS,"text"),value:stanza.utils.enumSub(NS,MOODS)}});stanza.withPubsubItem(function(Item){stanza.extend(Item,Mood)});stanza.withMessage(function(Message){stanza.extend(Message,Mood)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/muc.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/muc";var USER_NS=NS+"#user";var ADMIN_NS=NS+"#admin";var OWNER_NS=NS+"#owner";var UNIQ_NS=NS+"#unique";var proxy=function(child,field){return{get:function(){if(this._extensions[child]){return this[child][field]}},set:function(value){this[child][field]=value}}};module.exports=function(stanza){var types=stanza.utils;var UserItem=stanza.define({name:"_mucUserItem",namespace:USER_NS,element:"item",fields:{affiliation:types.attribute("affiliation"),nick:types.attribute("nick"),jid:types.jidAttribute("jid"),role:types.attribute("role"),reason:types.textSub(USER_NS,"reason")}});var UserActor=stanza.define({name:"_mucUserActor",namespace:USER_NS,element:"actor",fields:{nick:types.attribute("nick"),jid:types.jidAttribute("jid")}});var Destroyed=stanza.define({name:"destroyed",namespace:USER_NS,element:"destroy",fields:{jid:types.jidAttribute("jid"),reason:types.textSub(USER_NS,"reason")}});var Invite=stanza.define({name:"invite",namespace:USER_NS,element:"invite",fields:{to:types.jidAttribute("to"),from:types.jidAttribute("from"),reason:types.textSub(USER_NS,"reason"),thread:types.subAttribute(USER_NS,"continue","thread"),continue:types.boolSub(USER_NS,"continue")}});var Decline=stanza.define({name:"decline",namespace:USER_NS,element:"decline",fields:{to:types.jidAttribute("to"),from:types.jidAttribute("from"),reason:types.textSub(USER_NS,"reason")}});var AdminItem=stanza.define({name:"_mucAdminItem",namespace:ADMIN_NS,element:"item",fields:{affiliation:types.attribute("affiliation"),nick:types.attribute("nick"),jid:types.jidAttribute("jid"),role:types.attribute("role"),reason:types.textSub(ADMIN_NS,"reason")}});var AdminActor=stanza.define({name:"actor",namespace:USER_NS,element:"actor",fields:{nick:types.attribute("nick"),jid:types.jidAttribute("jid")}});var Destroy=stanza.define({name:"destroy",namespace:OWNER_NS,element:"destroy",fields:{jid:types.jidAttribute("jid"),password:types.textSub(OWNER_NS,"password"),reason:types.textSub(OWNER_NS,"reason")}});var MUC=stanza.define({name:"muc",namespace:USER_NS,element:"x",fields:{affiliation:proxy("_mucUserItem","affiliation"),nick:proxy("_mucUserItem","nick"),jid:proxy("_mucUserItem","jid"),role:proxy("_mucUserItem","role"),actor:proxy("_mucUserItem","_mucUserActor"),reason:proxy("_mucUserItem","reason"),password:types.textSub(USER_NS,"password"),codes:{get:function(){return types.getMultiSubText(this.xml,USER_NS,"status",function(sub){return types.getAttribute(sub,"code")})},set:function(value){var self=this;types.setMultiSubText(this.xml,USER_NS,"status",value,function(val){var child=types.createElement(USER_NS,"status",USER_NS);types.setAttribute(child,"code",val);self.xml.appendChild(child)})}}}});var MUCAdmin=stanza.define({name:"mucAdmin",namespace:ADMIN_NS,element:"query",fields:{affiliation:proxy("_mucAdminItem","affiliation"),nick:proxy("_mucAdminItem","nick"),jid:proxy("_mucAdminItem","jid"),role:proxy("_mucAdminItem","role"),actor:proxy("_mucAdminItem","_mucAdminActor"),reason:proxy("_mucAdminItem","reason")}});var MUCOwner=stanza.define({name:"mucOwner",namespace:OWNER_NS,element:"query"});var MUCJoin=stanza.define({name:"joinMuc",namespace:NS,element:"x",fields:{password:types.textSub(NS,"password"),history:{get:function(){var result={};var hist=types.find(this.xml,this._NS,"history");if(!hist.length){return{}}hist=hist[0];var maxchars=hist.getAttribute("maxchars")||"";var maxstanzas=hist.getAttribute("maxstanzas")||"";var seconds=hist.getAttribute("seconds")||"";var since=hist.getAttribute("since")||"";if(maxchars){result.maxchars=parseInt(maxchars,10)}if(maxstanzas){result.maxstanzas=parseInt(maxstanzas,10)}if(seconds){result.seconds=parseInt(seconds,10)}if(since){result.since=new Date(since)}},set:function(opts){var existing=types.find(this.xml,this._NS,"history");if(existing.length){for(var i=0;i<existing.length;i++){this.xml.removeChild(existing[i])}}var hist=types.createElement(this._NS,"history",this._NS);this.xml.appendChild(hist);if(opts.maxchars){hist.setAttribute(""+opts.maxchars)}if(opts.maxstanzas){hist.setAttribute(""+opts.maxstanzas)}if(opts.seconds){hist.setAttribute(""+opts.seconds)}if(opts.since){hist.setAttribute(opts.since.toISOString())}}}}});var DirectInvite=stanza.define({name:"mucInvite",namespace:"jabber:x:conference",element:"x",fields:{jid:types.jidAttribute("jid"),password:types.attribute("password"),reason:types.attribute("reason"),thread:types.attribute("thread"),continue:types.boolAttribute("continue")}});stanza.extend(UserItem,UserActor);stanza.extend(MUC,UserItem);stanza.extend(MUC,Invite,"invites");stanza.extend(MUC,Decline);stanza.extend(MUC,Destroyed);stanza.extend(AdminItem,AdminActor);stanza.extend(MUCAdmin,AdminItem,"items");stanza.extend(MUCOwner,Destroy);stanza.withDataForm(function(DataForm){stanza.extend(MUCOwner,DataForm)});stanza.withIq(function(Iq){stanza.add(Iq,"mucUnique",types.textSub(UNIQ_NS,"unique"));stanza.extend(Iq,MUCAdmin);stanza.extend(Iq,MUCOwner)});stanza.withPresence(function(Presence){stanza.extend(Presence,MUC);stanza.extend(Presence,MUCJoin)});stanza.withMessage(function(Message){stanza.extend(Message,MUC);stanza.extend(Message,DirectInvite)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/nick.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var nick=stanza.utils.textSub("http://jabber.org/protocol/nick","nick");stanza.withPubsubItem(function(Item){stanza.add(Item,"nick",nick)});stanza.withPresence(function(Presence){stanza.add(Presence,"nick",nick)});stanza.withMessage(function(Message){stanza.add(Message,"nick",nick)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/oob.js":[function(require,module,exports){"use strict";var NS="jabber:x:oob";module.exports=function(stanza){var OOB=stanza.define({name:"oob",element:"x",namespace:NS,fields:{url:stanza.utils.textSub(NS,"url"),desc:stanza.utils.textSub(NS,"desc")}});stanza.withMessage(function(Message){stanza.extend(Message,OOB,"oobURIs")})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/ping.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:ping";module.exports=function(stanza){var Ping=stanza.define({name:"ping",namespace:NS,element:"ping"});stanza.withIq(function(Iq){stanza.extend(Iq,Ping)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/presence.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"presence",namespace:"jabber:client",element:"presence",topLevel:true,fields:{lang:types.langAttribute(),id:types.attribute("id"),to:types.jidAttribute("to",true),from:types.jidAttribute("from",true),priority:types.numberSub("jabber:client","priority",false,0),show:types.textSub("jabber:client","show"),type:{get:function(){return types.getAttribute(this.xml,"type","available")},set:function(value){if(value==="available"){value=false}types.setAttribute(this.xml,"type",value)}},$status:{get:function(){return types.getSubLangText(this.xml,this._NS,"status",this.lang)}},status:{get:function(){var statuses=this.$status;return statuses[this.lang]||""},set:function(value){types.setSubLangText(this.xml,this._NS,"status",value,this.lang)}},idleSince:types.dateSubAttribute("urn:xmpp:idle:1","idle","since"),decloak:types.subAttribute("urn:xmpp:decloak:0","decloak","reason"),avatarId:{get:function(){var NS="vcard-temp:x:update";var update=types.find(this.xml,NS,"x");if(!update.length){return""}return types.getSubText(update[0],NS,"photo")},set:function(value){var NS="vcard-temp:x:update";var update=types.findOrCreate(this.xml,NS,"x");if(value===""){types.setBoolSub(update,NS,"photo",true)}else if(value===true){return}else if(value){types.setSubText(update,NS,"photo",value)}else{this.xml.removeChild(update)}}}}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/private.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var PrivateStorage=stanza.define({name:"privateStorage",namespace:"jabber:iq:private",element:"query"});stanza.withIq(function(Iq){stanza.extend(Iq,PrivateStorage)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/psa.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:psa";var CONDITIONS=["server-unavailable","connection-paused"];module.exports=function(stanza){var types=stanza.utils;var PSA=stanza.define({name:"state",namespace:NS,element:"state-annotation",fields:{from:types.jidAttribute("from"),condition:types.enumSub(NS,CONDITIONS),description:types.textSub(NS,"description")}});stanza.withPresence(function(Presence){stanza.extend(Presence,PSA)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/pubsub.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/pubsub";module.exports=function(stanza){var types=stanza.utils;var Pubsub=stanza.define({name:"pubsub",namespace:"http://jabber.org/protocol/pubsub",element:"pubsub",fields:{publishOptions:{get:function(){var DataForm=stanza.getDefinition("x","jabber:x:data");var conf=types.find(this.xml,this._NS,"publish-options");if(conf.length&&conf[0].childNodes.length){return new DataForm({},conf[0].childNodes[0])}},set:function(value){var DataForm=stanza.getDefinition("x","jabber:x:data");var conf=types.findOrCreate(this.xml,this._NS,"publish-options");if(value){var form=new DataForm(value);conf.appendChild(form.xml)}}}}});var Subscribe=stanza.define({name:"subscribe",namespace:NS,element:"subscribe",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid")}});var Subscription=stanza.define({name:"subscription",namespace:NS,element:"subscription",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid"),subid:types.attribute("subid"),type:types.attribute("subscription"),configurable:types.boolSub("subscribe-options"),configurationRequired:{get:function(){var options=types.find(this.xml,NS,"subscribe-options");if(options.length){return types.getBoolSub(options[0],NS,"required")}return false}}}});var Subscriptions=stanza.define({name:"subscriptions",namespace:NS,element:"subscriptions",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid")}});var Affiliation=stanza.define({name:"affiliation",namespace:NS,element:"affiliation",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid"),type:types.attribute("affiliation")}});var Affiliations=stanza.define({name:"affiliations",namespace:NS,element:"affiliations",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid")}});var SubscriptionOptions=stanza.define({name:"subscriptionOptions",namespace:NS,element:"options",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid"),subid:types.attribute("subid")}});var Unsubscribe=stanza.define({name:"unsubscribe",namespace:NS,element:"unsubscribe",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid")}});var Publish=stanza.define({name:"publish",namespace:NS,element:"publish",fields:{node:types.attribute("node")}});var Retract=stanza.define({name:"retract",namespace:NS,element:"retract",fields:{node:types.attribute("node"),notify:types.boolAttribute("notify"),id:types.subAttribute(NS,"item","id")}});var Retrieve=stanza.define({name:"retrieve",namespace:NS,element:"items",fields:{node:types.attribute("node"),max:types.attribute("max_items")}});var Item=stanza.define({name:"item",namespace:NS,element:"item",fields:{id:types.attribute("id")}});stanza.extend(Pubsub,Subscribe);stanza.extend(Pubsub,Unsubscribe);stanza.extend(Pubsub,Publish);stanza.extend(Pubsub,Retract);stanza.extend(Pubsub,Retrieve);stanza.extend(Pubsub,Subscription);stanza.extend(Pubsub,SubscriptionOptions);stanza.extend(Pubsub,Subscriptions);stanza.extend(Pubsub,Affiliations);stanza.extend(Publish,Item,"items");stanza.extend(Retrieve,Item,"items");stanza.extend(Subscriptions,Subscription,"list");stanza.extend(Affiliations,Affiliation,"list");stanza.withDataForm(function(DataForm){stanza.extend(SubscriptionOptions,DataForm);stanza.extend(Item,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,Pubsub)});stanza.withDefinition("set","http://jabber.org/protocol/rsm",function(RSM){stanza.extend(Pubsub,RSM)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/pubsubError.js":[function(require,module,exports){"use strict";var ERRNS="http://jabber.org/protocol/pubsub#errors";var CONDITIONS=["closed-node","configuration-required","invalid-jid","invalid-options","invalid-payload","invalid-subid","item-forbidden","item-required","jid-required","max-items-exceeded","max-nodes-exceeded","nodeid-required","not-in-roster-group","not-subscribed","payload-too-big","payload-required","pending-subscription","presence-subscription-required","subid-required","too-many-subscriptions","unsupported","unsupported-access-model"];module.exports=function(stanza){stanza.withStanzaError(function(ErrorStanza){stanza.add(ErrorStanza,"pubsubCondition",stanza.utils.enumSub(ERRNS,CONDITIONS))})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/pubsubEvents.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/pubsub#event";module.exports=function(stanza){var types=stanza.utils;var Event=stanza.define({name:"event",namespace:NS,element:"event"});var EventPurge=stanza.define({name:"purged",namespace:NS,element:"purge",fields:{node:types.attribute("node")}});var EventDelete=stanza.define({name:"deleted",namespace:NS,element:"delete",fields:{node:types.attribute("node"),redirect:types.subAttribute(NS,"redirect","uri")}});var EventSubscription=stanza.define({name:"subscriptionChanged",namespace:NS,element:"subscription",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid"),type:types.attribute("subscription"),subid:types.attribute("subid"),expiry:{get:function(){var text=types.getAttribute(this.xml,"expiry");if(text==="presence"){return text}else if(text){return new Date(text)}},set:function(value){if(!value){return}if(typeof value!=="string"){value=value.toISOString()}types.setAttribute(this.xml,"expiry",value)}}}});var EventConfiguration=stanza.define({name:"configurationChanged",namespace:NS,element:"configuration",fields:{node:types.attribute("node")}});var EventItems=stanza.define({name:"updated",namespace:NS,element:"items",fields:{node:types.attribute("node"),retracted:{get:function(){var results=[];var retracted=types.find(this.xml,this._NS,"retract");retracted.forEach(function(xml){results.push(xml.getAttribute("id"))});return results},set:function(value){var self=this;value.forEach(function(id){var retracted=types.createElement(self._NS,"retract",self._NS);retracted.setAttribute("id",id);this.xml.appendChild(retracted)})}}}});var EventItem=stanza.define({name:"_eventItem",namespace:NS,element:"item",fields:{id:types.attribute("id"),node:types.attribute("node"),publisher:types.jidAttribute("publisher")}});stanza.extend(EventItems,EventItem,"published");stanza.extend(Event,EventItems);stanza.extend(Event,EventSubscription);stanza.extend(Event,EventConfiguration);stanza.extend(Event,EventDelete);stanza.extend(Event,EventPurge);stanza.withMessage(function(Message){stanza.extend(Message,Event)});stanza.withDataForm(function(DataForm){stanza.extend(EventConfiguration,DataForm)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/pubsubOwner.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/pubsub#owner";module.exports=function(stanza){var types=stanza.utils;var PubsubOwner=stanza.define({name:"pubsubOwner",namespace:NS,element:"pubsub",fields:{create:types.subAttribute(NS,"create","node"),purge:types.subAttribute(NS,"purge","node"),del:types.subAttribute(NS,"delete","node"),redirect:{get:function(){var del=types.find(this.xml,this._NS,"delete");if(del.length){return types.getSubAttribute(del[0],this._NS,"redirect","uri")}return""},set:function(value){var del=types.findOrCreate(this.xml,this._NS,"delete");types.setSubAttribute(del,this._NS,"redirect","uri",value)}}}});var Subscription=stanza.define({name:"subscription",namespace:NS,element:"subscription",fields:{node:types.attribute("node"),jid:types.jidAttribute("jid"),subid:types.attribute("subid"),type:types.attribute("subscription"),configurable:types.boolSub("subscribe-options"),configurationRequired:{get:function(){var options=types.find(this.xml,NS,"subscribe-options");if(options.length){return types.getBoolSub(options[0],NS,"required")}return false}}}});var Subscriptions=stanza.define({name:"subscriptions",namespace:NS,element:"subscriptions",fields:{node:types.attribute("node")}});var Affiliation=stanza.define({name:"affiliation",namespace:NS,element:"affiliation",fields:{node:types.attribute("node"),type:types.attribute("affiliation")}});var Affiliations=stanza.define({name:"affiliations",namespace:NS,element:"affiliations",fields:{node:types.attribute("node")}});var Configure=stanza.define({name:"config",namespace:NS,element:"configure",fields:{node:types.attribute("node")}});stanza.extend(PubsubOwner,Configure);stanza.extend(PubsubOwner,Subscriptions);stanza.extend(PubsubOwner,Affiliations);stanza.extend(Subscriptions,Subscription,"list");stanza.extend(Affiliations,Affiliation,"list");stanza.withDataForm(function(DataForm){stanza.extend(Configure,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,PubsubOwner)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/reach.js":[function(require,module,exports){"use strict";var each=require("lodash.foreach");var NS="urn:xmpp:reach:0";module.exports=function(stanza){var types=stanza.utils;var ReachURI=stanza.define({name:"_reachAddr",namespace:NS,element:"addr",fields:{uri:types.attribute("uri"),$desc:{get:function(){return types.getSubLangText(this.xml,NS,"desc",this.lang)}},desc:{get:function(){var descs=this.$desc;return descs[this.lang]||""},set:function(value){types.setSubLangText(this.xml,NS,"desc",value,this.lang)}}}});var reachability={get:function(){var reach=types.find(this.xml,NS,"reach");var results=[];if(reach.length){var addrs=types.find(reach[0],NS,"addr");each(addrs,function(addr){results.push(new ReachURI({},addr))})}return results},set:function(value){var reach=types.findOrCreate(this.xml,NS,"reach");types.setAttribute(reach,"xmlns",NS);each(value,function(info){var addr=new ReachURI(info);reach.appendChild(addr.xml)})}};stanza.withPubsubItem(function(Item){stanza.add(Item,"reach",reachability)});stanza.withPresence(function(Presence){stanza.add(Presence,"reach",reachability)})}},{"lodash.foreach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/register.js":[function(require,module,exports){"use strict";var NS="jabber:iq:register";module.exports=function(stanza){var types=stanza.utils;var Register=stanza.define({name:"register",namespace:NS,element:"query",fields:{instructions:types.textSub(NS,"instructions"),registered:types.boolSub(NS,"registered"),remove:types.boolSub(NS,"remove"),username:types.textSub(NS,"username"),nick:types.textSub(NS,"nick"),password:types.textSub(NS,"password"),name:types.textSub(NS,"name"),first:types.textSub(NS,"first"),last:types.textSub(NS,"last"),email:types.textSub(NS,"email"),address:types.textSub(NS,"address"),city:types.textSub(NS,"city"),state:types.textSub(NS,"state"),zip:types.textSub(NS,"zip"),phone:types.textSub(NS,"phone"),url:types.textSub(NS,"url"),date:types.textSub(NS,"date"),misc:types.textSub(NS,"misc"),text:types.textSub(NS,"text"),key:types.textSub(NS,"key")}});stanza.withDefinition("x","jabber:x:oob",function(OOB){stanza.extend(Register,OOB)});stanza.withDataForm(function(DataForm){stanza.extend(Register,DataForm)});stanza.withIq(function(Iq){stanza.extend(Iq,Register)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/roster.js":[function(require,module,exports){"use strict";var NS="jabber:iq:roster";module.exports=function(stanza){var types=stanza.utils;var Roster=stanza.define({name:"roster",namespace:NS,element:"query",fields:{ver:{get:function(){return types.getAttribute(this.xml,"ver")},set:function(value){var force=value==="";types.setAttribute(this.xml,"ver",value,force)}}}});var RosterItem=stanza.define({name:"_rosterItem",namespace:NS,element:"item",fields:{jid:types.jidAttribute("jid",true),name:types.attribute("name"),subscription:types.attribute("subscription","none"),subscriptionRequested:{get:function(){var ask=types.getAttribute(this.xml,"ask");return ask==="subscribe"}},preApproved:types.boolAttribute(NS,"approved"),groups:types.multiTextSub(NS,"group")}});stanza.extend(Roster,RosterItem,"items");stanza.withIq(function(Iq){stanza.extend(Iq,Roster)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/rsm.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/rsm";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"rsm",namespace:NS,element:"set",fields:{after:types.textSub(NS,"after"),before:{get:function(){return types.getSubText(this.xml,this._NS,"before")},set:function(value){if(value===true){types.findOrCreate(this.xml,this._NS,"before")}else{types.setSubText(this.xml,this._NS,"before",value)}}},count:types.numberSub(NS,"count",false,0),first:types.textSub(NS,"first"),
firstIndex:types.subAttribute(NS,"first","index"),index:types.textSub(NS,"index"),last:types.textSub(NS,"last"),max:types.textSub(NS,"max")}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/rtp.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:jingle:apps:rtp:1";var FBNS="urn:xmpp:jingle:apps:rtp:rtcp-fb:0";var HDRNS="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0";var INFONS="urn:xmpp:jingle:apps:rtp:info:1";var SSMANS="urn:xmpp:jingle:apps:rtp:ssma:0";var GROUPNS="urn:xmpp:jingle:apps:grouping:0";module.exports=function(stanza){var types=stanza.utils;var Feedback={get:function(){var existing=types.find(this.xml,FBNS,"rtcp-fb");var result=[];existing.forEach(function(xml){result.push({type:types.getAttribute(xml,"type"),subtype:types.getAttribute(xml,"subtype")})});existing=types.find(this.xml,FBNS,"rtcp-fb-trr-int");existing.forEach(function(xml){result.push({type:types.getAttribute(xml,"type"),value:types.getAttribute(xml,"value")})});return result},set:function(values){var self=this;var existing=types.find(this.xml,FBNS,"rtcp-fb");existing.forEach(function(item){self.xml.removeChild(item)});existing=types.find(this.xml,FBNS,"rtcp-fb-trr-int");existing.forEach(function(item){self.xml.removeChild(item)});values.forEach(function(value){var fb;if(value.type==="trr-int"){fb=types.createElement(FBNS,"rtcp-fb-trr-int",NS);types.setAttribute(fb,"type",value.type);types.setAttribute(fb,"value",value.value)}else{fb=types.createElement(FBNS,"rtcp-fb",NS);types.setAttribute(fb,"type",value.type);types.setAttribute(fb,"subtype",value.subtype)}self.xml.appendChild(fb)})}};var Bandwidth=stanza.define({name:"bandwidth",namespace:NS,element:"bandwidth",fields:{type:types.attribute("type"),bandwidth:types.text()}});var RTP=stanza.define({name:"_rtp",namespace:NS,element:"description",tags:["jingle-description"],fields:{descType:{value:"rtp"},media:types.attribute("media"),ssrc:types.attribute("ssrc"),mux:types.boolSub(NS,"rtcp-mux"),encryption:{get:function(){var enc=types.find(this.xml,NS,"encryption");if(!enc.length){return[]}enc=enc[0];var self=this;var data=types.find(enc,NS,"crypto");var results=[];data.forEach(function(xml){results.push(new Crypto({},xml,self).toJSON())});return results},set:function(values){var enc=types.find(this.xml,NS,"encryption");if(enc.length){this.xml.removeChild(enc)}if(!values.length){return}types.setBoolSubAttribute(this.xml,NS,"encryption","required",true);enc=types.find(this.xml,NS,"encryption")[0];var self=this;values.forEach(function(value){var content=new Crypto(value,null,self);enc.appendChild(content.xml)})}},feedback:Feedback,headerExtensions:{get:function(){var existing=types.find(this.xml,HDRNS,"rtp-hdrext");var result=[];existing.forEach(function(xml){result.push({id:types.getAttribute(xml,"id"),uri:types.getAttribute(xml,"uri"),senders:types.getAttribute(xml,"senders")})});return result},set:function(values){var self=this;var existing=types.find(this.xml,HDRNS,"rtp-hdrext");existing.forEach(function(item){self.xml.removeChild(item)});values.forEach(function(value){var hdr=types.createElement(HDRNS,"rtp-hdrext",NS);types.setAttribute(hdr,"id",value.id);types.setAttribute(hdr,"uri",value.uri);types.setAttribute(hdr,"senders",value.senders);self.xml.appendChild(hdr)})}}}});var PayloadType=stanza.define({name:"_payloadType",namespace:NS,element:"payload-type",fields:{channels:types.attribute("channels"),clockrate:types.attribute("clockrate"),id:types.attribute("id"),maxptime:types.attribute("maxptime"),name:types.attribute("name"),ptime:types.attribute("ptime"),feedback:Feedback,parameters:{get:function(){var result=[];var params=types.find(this.xml,NS,"parameter");params.forEach(function(param){result.push({key:types.getAttribute(param,"name"),value:types.getAttribute(param,"value")})});return result},set:function(values){var self=this;values.forEach(function(value){var param=types.createElement(NS,"parameter");types.setAttribute(param,"name",value.key);types.setAttribute(param,"value",value.value);self.xml.appendChild(param)})}}}});var Crypto=stanza.define({name:"crypto",namespace:NS,element:"crypto",fields:{cipherSuite:types.attribute("crypto-suite"),keyParams:types.attribute("key-params"),sessionParams:types.attribute("session-params"),tag:types.attribute("tag")}});var ContentGroup=stanza.define({name:"_group",namespace:GROUPNS,element:"group",fields:{semantics:types.attribute("semantics"),contents:types.multiSubAttribute(GROUPNS,"content","name")}});var SourceGroup=stanza.define({name:"_sourceGroup",namespace:SSMANS,element:"ssrc-group",fields:{semantics:types.attribute("semantics"),sources:types.multiSubAttribute(SSMANS,"source","ssrc")}});var Source=stanza.define({name:"_source",namespace:SSMANS,element:"source",fields:{ssrc:types.attribute("ssrc"),parameters:{get:function(){var result=[];var params=types.find(this.xml,SSMANS,"parameter");params.forEach(function(param){result.push({key:types.getAttribute(param,"name"),value:types.getAttribute(param,"value")})});return result},set:function(values){var self=this;values.forEach(function(value){var param=types.createElement(SSMANS,"parameter");types.setAttribute(param,"name",value.key);types.setAttribute(param,"value",value.value);self.xml.appendChild(param)})}}}});var Mute=stanza.define({name:"mute",namespace:INFONS,element:"mute",fields:{creator:types.attribute("creator"),name:types.attribute("name")}});var Unmute=stanza.define({name:"unmute",namespace:INFONS,element:"unmute",fields:{creator:types.attribute("creator"),name:types.attribute("name")}});stanza.extend(RTP,Bandwidth);stanza.extend(RTP,PayloadType,"payloads");stanza.extend(RTP,Source,"sources");stanza.extend(RTP,SourceGroup,"sourceGroups");stanza.withDefinition("content","urn:xmpp:jingle:1",function(Content){stanza.extend(Content,RTP)});stanza.withDefinition("jingle","urn:xmpp:jingle:1",function(Jingle){stanza.extend(Jingle,Mute);stanza.extend(Jingle,Unmute);stanza.extend(Jingle,ContentGroup,"groups");stanza.add(Jingle,"ringing",types.boolSub(INFONS,"ringing"));stanza.add(Jingle,"hold",types.boolSub(INFONS,"hold"));stanza.add(Jingle,"active",types.boolSub(INFONS,"active"))})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/rtt.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:rtt:0";var typemap={insert:"t",erase:"e",wait:"w"};var actionmap={t:"insert",e:"erase",w:"wait"};module.exports=function(stanza){var types=stanza.utils;var RTT=stanza.define({name:"rtt",namespace:NS,element:"rtt",fields:{id:types.attribute("id"),event:types.attribute("event","edit"),seq:types.numberAttribute("seq"),actions:{get:function(){var results=[];for(var i=0,len=this.xml.childNodes.length;i<len;i++){var child=this.xml.childNodes[i];var name=child.localName;var action={};if(child.namespaceURI!==NS){continue}if(actionmap[name]){action.type=actionmap[name]}else{continue}var pos=types.getAttribute(child,"p");if(pos){action.pos=parseInt(pos,10)}var n=types.getAttribute(child,"n");if(n){action.num=parseInt(n,10)}var t=types.getText(child);if(t&&name==="t"){action.text=t}results.push(action)}return results},set:function(actions){var self=this;for(var i=0,len=this.xml.childNodes.length;i<len;i++){this.xml.removeChild(this.xml.childNodes[i])}actions.forEach(function(action){if(!typemap[action.type]){return}var child=types.createElement(NS,typemap[action.type],NS);if(action.pos!==undefined){types.setAttribute(child,"p",action.pos.toString())}if(action.num){types.setAttribute(child,"n",action.num.toString())}if(action.text){types.setText(child,action.text)}self.xml.appendChild(child)})}}}});stanza.withMessage(function(Message){stanza.extend(Message,RTT)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/sasl.js":[function(require,module,exports){"use strict";var NS="urn:ietf:params:xml:ns:xmpp-sasl";var CONDITIONS=["aborted","account-disabled","credentials-expired","encryption-required","incorrect-encoding","invalid-authzid","invalid-mechanism","malformed-request","mechanism-too-weak","not-authorized","temporary-auth-failure"];module.exports=function(stanza){var types=stanza.utils;var Mechanisms=stanza.define({name:"sasl",namespace:NS,element:"mechanisms",fields:{mechanisms:types.multiTextSub(NS,"mechanism")}});stanza.define({name:"saslAuth",eventName:"sasl:auth",namespace:NS,element:"auth",topLevel:true,fields:{value:types.text(),mechanism:types.attribute("mechanism")}});stanza.define({name:"saslChallenge",eventName:"sasl:challenge",namespace:NS,element:"challenge",topLevel:true,fields:{value:types.text()}});stanza.define({name:"saslResponse",eventName:"sasl:response",namespace:NS,element:"response",topLevel:true,fields:{value:types.text()}});stanza.define({name:"saslAbort",eventName:"sasl:abort",namespace:NS,element:"abort",topLevel:true});stanza.define({name:"saslSuccess",eventName:"sasl:success",namespace:NS,element:"success",topLevel:true,fields:{value:types.text()}});stanza.define({name:"saslFailure",eventName:"sasl:failure",namespace:NS,element:"failure",topLevel:true,fields:{lang:{get:function(){return this._lang||""},set:function(value){this._lang=value}},condition:types.enumSub(NS,CONDITIONS),$text:{get:function(){return types.getSubLangText(this.xml,NS,"text",this.lang)}},text:{get:function(){var text=this.$text;return text[this.lang]||""},set:function(value){types.setSubLangText(this.xml,NS,"text",value,this.lang)}}}});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,Mechanisms)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/session.js":[function(require,module,exports){"use strict";var NS="urn:ietf:params:xml:ns:xmpp-session";module.exports=function(stanza){var types=stanza.utils;var Session=stanza.define({name:"session",namespace:NS,element:"session",fields:{required:types.boolSub(NS,"required"),optional:types.boolSub(NS,"optional")}});stanza.withIq(function(Iq){stanza.extend(Iq,Session)});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,Session)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/shim.js":[function(require,module,exports){"use strict";var NS="http://jabber.org/protocol/shim";module.exports=function(stanza){var types=stanza.utils;var SHIM={get:function(){var headerSet=types.find(this.xml,NS,"headers");if(headerSet.length){return types.getMultiSubText(headerSet[0],NS,"header",function(header){var name=types.getAttribute(header,"name");if(name){return{name:name,value:types.getText(header)}}})}return[]},set:function(values){var headerSet=types.findOrCreate(this.xml,NS,"headers");stanza.setMultiSubText(headerSet,NS,"header",values,function(val){var header=types.createElement(NS,"header",NS);types.setAttribute(header,"name",val.name);types.setText(header,val.value);headerSet.appendChild(header)})}};stanza.withMessage(function(Message){stanza.add(Message,"headers",SHIM)});stanza.withPresence(function(Presence){stanza.add(Presence,"headers",SHIM)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/sm.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:sm:3";module.exports=function(stanza){var types=stanza.utils;var SMFeature=stanza.define({name:"streamManagement",namespace:NS,element:"sm"});stanza.define({name:"smEnable",eventName:"stream:management:enable",namespace:NS,element:"enable",topLevel:true,fields:{resume:types.boolAttribute("resume")}});stanza.define({name:"smEnabled",eventName:"stream:management:enabled",namespace:NS,element:"enabled",topLevel:true,fields:{id:types.attribute("id"),resume:types.boolAttribute("resume")}});stanza.define({name:"smResume",eventName:"stream:management:resume",namespace:NS,element:"resume",topLevel:true,fields:{h:types.numberAttribute("h",false,0),previd:types.attribute("previd")}});stanza.define({name:"smResumed",eventName:"stream:management:resumed",namespace:NS,element:"resumed",topLevel:true,fields:{h:types.numberAttribute("h",false,0),previd:types.attribute("previd")}});stanza.define({name:"smFailed",eventName:"stream:management:failed",namespace:NS,element:"failed",topLevel:true});stanza.define({name:"smAck",eventName:"stream:management:ack",namespace:NS,element:"a",topLevel:true,fields:{h:types.numberAttribute("h",false,0)}});stanza.define({name:"smRequest",eventName:"stream:management:request",namespace:NS,element:"r",topLevel:true});stanza.withStreamFeatures(function(StreamFeatures){stanza.extend(StreamFeatures,SMFeature)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/stream.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"stream",namespace:"http://etherx.jabber.org/streams",element:"stream",fields:{lang:types.langAttribute(),id:types.attribute("id"),version:types.attribute("version","1.0"),to:types.jidAttribute("to",true),from:types.jidAttribute("from",true)}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/streamError.js":[function(require,module,exports){"use strict";var ERR_NS="urn:ietf:params:xml:ns:xmpp-streams";var CONDITIONS=["bad-format","bad-namespace-prefix","conflict","connection-timeout","host-gone","host-unknown","improper-addressing","internal-server-error","invalid-from","invalid-namespace","invalid-xml","not-authorized","not-well-formed","policy-violation","remote-connection-failed","reset","resource-constraint","restricted-xml","see-other-host","system-shutdown","undefined-condition","unsupported-encoding","unsupported-feature","unsupported-stanza-type","unsupported-version"];module.exports=function(stanza){var types=stanza.utils;stanza.define({name:"streamError",namespace:"http://etherx.jabber.org/streams",element:"error",topLevel:true,fields:{lang:{get:function(){return this._lang||""},set:function(value){this._lang=value}},condition:types.enumSub(ERR_NS,CONDITIONS),seeOtherHost:{get:function(){return types.getSubText(this.xml,ERR_NS,"see-other-host")},set:function(value){this.condition="see-other-host";types.setSubText(this.xml,ERR_NS,"see-other-host",value)}},$text:{get:function(){return types.getSubLangText(this.xml,ERR_NS,"text",this.lang)}},text:{get:function(){var text=this.$text;return text[this.lang]||""},set:function(value){types.setSubLangText(this.xml,ERR_NS,"text",value,this.lang)}}}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/streamFeatures.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var StreamFeatures=stanza.define({name:"streamFeatures",namespace:"http://etherx.jabber.org/streams",element:"features",topLevel:true});var RosterVerFeature=stanza.define({name:"rosterVersioning",namespace:"urn:xmpp:features:rosterver",element:"ver"});var SubscriptionPreApprovalFeature=stanza.define({name:"subscriptionPreApproval",namespace:"urn:xmpp:features:pre-approval",element:"sub"});stanza.extend(StreamFeatures,RosterVerFeature);stanza.extend(StreamFeatures,SubscriptionPreApprovalFeature)}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/time.js":[function(require,module,exports){"use strict";module.exports=function(stanza){var EntityTime=stanza.define({name:"time",namespace:"urn:xmpp:time",element:"time",fields:{utc:stanza.utils.dateSub("urn:xmpp:time","utc"),tzo:stanza.utils.tzoSub("urn:xmpp:time","tzo",0)}});stanza.withIq(function(Iq){stanza.extend(Iq,EntityTime)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/vcard.js":[function(require,module,exports){"use strict";var NS="vcard-temp";module.exports=function(stanza){var types=stanza.utils;var VCardTemp=stanza.define({name:"vCardTemp",namespace:NS,element:"vCard",fields:{role:types.textSub(NS,"ROLE"),website:types.textSub(NS,"URL"),title:types.textSub(NS,"TITLE"),description:types.textSub(NS,"DESC"),fullName:types.textSub(NS,"FN"),birthday:types.dateSub(NS,"BDAY"),nicknames:types.multiTextSub(NS,"NICKNAME"),jids:types.multiTextSub(NS,"JABBERID")}});var Email=stanza.define({name:"_email",namespace:NS,element:"EMAIL",fields:{email:types.textSub(NS,"USERID"),home:types.boolSub(NS,"HOME"),work:types.boolSub(NS,"WORK"),preferred:types.boolSub(NS,"PREF")}});var PhoneNumber=stanza.define({name:"_tel",namespace:NS,element:"TEL",fields:{number:types.textSub(NS,"NUMBER"),home:types.boolSub(NS,"HOME"),work:types.boolSub(NS,"WORK"),mobile:types.boolSub(NS,"CELL"),preferred:types.boolSub(NS,"PREF")}});var Address=stanza.define({name:"_address",namespace:NS,element:"ADR",fields:{street:types.textSub(NS,"STREET"),street2:types.textSub(NS,"EXTADD"),country:types.textSub(NS,"CTRY"),city:types.textSub(NS,"LOCALITY"),region:types.textSub(NS,"REGION"),postalCode:types.textSub(NS,"PCODE"),pobox:types.textSub(NS,"POBOX"),home:types.boolSub(NS,"HOME"),work:types.boolSub(NS,"WORK"),preferred:types.boolSub(NS,"PREF")}});var Organization=stanza.define({name:"organization",namespace:NS,element:"ORG",fields:{name:types.textSub(NS,"ORGNAME"),unit:types.textSub(NS,"ORGUNIT")}});var Name=stanza.define({name:"name",namespace:NS,element:"N",fields:{family:types.textSub(NS,"FAMILY"),given:types.textSub(NS,"GIVEN"),middle:types.textSub(NS,"MIDDLE"),prefix:types.textSub(NS,"PREFIX"),suffix:types.textSub(NS,"SUFFIX")}});var Photo=stanza.define({name:"photo",namespace:NS,element:"PHOTO",fields:{type:types.textSub(NS,"TYPE"),data:types.textSub(NS,"BINVAL"),url:types.textSub(NS,"EXTVAL")}});stanza.extend(VCardTemp,Email,"emails");stanza.extend(VCardTemp,Address,"addresses");stanza.extend(VCardTemp,PhoneNumber,"phoneNumbers");stanza.extend(VCardTemp,Organization);stanza.extend(VCardTemp,Name);stanza.extend(VCardTemp,Photo);stanza.withIq(function(Iq){stanza.extend(Iq,VCardTemp)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/version.js":[function(require,module,exports){"use strict";var NS="jabber:iq:version";module.exports=function(stanza){var types=stanza.utils;var Version=stanza.define({name:"version",namespace:NS,element:"query",fields:{name:types.textSub(NS,"name"),version:types.textSub(NS,"version"),os:types.textSub(NS,"os")}});stanza.withIq(function(Iq){stanza.extend(Iq,Version)})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/stanza/visibility.js":[function(require,module,exports){"use strict";var NS="urn:xmpp:invisible:0";module.exports=function(stanza){stanza.withIq(function(Iq){stanza.add(Iq,"visible",stanza.utils.boolSub(NS,"visible"));stanza.add(Iq,"invisible",stanza.utils.boolSub(NS,"invisible"))})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/transports/bosh.js":[function(require,module,exports){(function(process,Buffer){"use strict";var extend=require("lodash.assign");var filter=require("lodash.filter");var util=require("util");var BPromise=require("bluebird");var request=BPromise.promisify(require("request"));var WildEmitter=require("wildemitter");function ConnectionError(){}util.inherits(ConnectionError,Error);function retryRequest(opts,timeout,allowedRetries,retries){retries=retries||0;var req=request(opts).cancellable().timeout((timeout||20)*1e3);return req.spread(function(req,body){if(req.statusCode<200||req.statusCode>=400){throw new ConnectionError("HTTP Status Error")}return body}).catch(BPromise.TimeoutError,function(){throw new ConnectionError("Dead Connection, exceeded timeout limit")}).catch(function(){if(retries<allowedRetries){return BPromise.delay(100).then(function(){return retryRequest(opts,timeout,allowedRetries,retries+1)})}else{throw new ConnectionError("Dead Connection, exceeded retry limit")}})}function BOSHConnection(sm,stanzas){var self=this;WildEmitter.call(this);self.sm=sm;self.stanzas={BOSH:stanzas.getDefinition("body","http://jabber.org/protocol/httpbind"),StreamError:stanzas.getStreamError()};self.sendQueue=[];self.requests=[];self.maxRequests=2;self.sid="";self.on("raw:incoming",function(data){data=data.trim();if(data===""){return}var bosh,err;try{bosh=stanzas.parse(data,self.stanzas.BOSH)}catch(e){err=new self.stanzas.StreamError({condition:"invalid-xml"});self.emit("stream:error",err,e);self.send(err);return self.disconnect()}if(!self.hasStream){self.hasStream=true;self.stream={id:bosh.sid,lang:bosh.lang||"en",version:bosh.version||"1.0",to:bosh.to,from:bosh.from};self.sid=bosh.sid;self.maxRequests=bosh.requests}var payload=bosh.payload;payload.forEach(function(stanzaObj){if(!stanzaObj.lang){stanzaObj.lang=self.stream.lang}self.emit("stream:data",stanzaObj)});if(bosh.type==="terminate"){self.rid=undefined;self.sid=undefined;self.emit("bosh:terminate",bosh);self.emit("stream:end");self.emit("disconnected",self)}})}util.inherits(BOSHConnection,WildEmitter);BOSHConnection.prototype.connect=function(opts){var self=this;self.config=extend({rid:Math.ceil(Math.random()*9999999999),wait:30,maxRetries:5},opts);self.hasStream=false;self.sm.started=false;self.url=opts.boshURL;self.sid=self.config.sid;self.rid=self.config.rid;self.requests=[];self.rid++;self.request(new self.stanzas.BOSH({version:self.config.version||"1.0",to:self.config.server,lang:self.config.lang||"en",wait:self.config.wait,ver:"1.6",hold:1}))};BOSHConnection.prototype.disconnect=function(){if(this.hasStream){this.rid++;this.request(new this.stanzas.BOSH({type:"terminate"}))}else{this.requests.forEach(function(ticket){ticket.request.cancel()});this.stream=undefined;this.sid=undefined;this.rid=undefined;this.emit("disconnected",this)}};BOSHConnection.prototype.restart=function(){var self=this;self.rid++;self.request(new self.stanzas.BOSH({to:self.config.server,lang:self.config.lang||"en",restart:"true"}))};BOSHConnection.prototype.send=function(data){var self=this;if(self.hasStream){self.sendQueue.push(data);process.nextTick(self.longPoll.bind(self))}};BOSHConnection.prototype.longPoll=function(){var canReceive=this.requests.length===0;var canSend=this.sendQueue.length>0&&this.requests.length<this.maxRequests;if(!this.sid||!canReceive&&!canSend){return}var stanzas=this.sendQueue;this.sendQueue=[];this.rid++;this.request(new this.stanzas.BOSH({payload:stanzas}))};BOSHConnection.prototype.request=function(bosh){var self=this;var ticket={id:self.rid,request:null};bosh.rid=self.rid;bosh.sid=self.sid;var body=new Buffer(bosh.toString(),"utf8").toString();self.emit("raw:outgoing",body);self.requests.push(ticket);var req=retryRequest({uri:self.url,body:body,method:"POST",strictSSL:true},self.config.wait*1.5,this.config.maxRetries);ticket.request=req;return req.then(function(body){self.emit("raw:incoming",new Buffer(body,"utf8").toString())}).catch(ConnectionError,function(err){self.hasStream=false;var serr=new self.stanzas.StreamError({condition:"connection-timeout"});self.emit("stream:error",serr,err);self.disconnect()}).catch(BPromise.CancellationError,function(){return}).finally(function(){self.requests=filter(self.requests,function(item){return item.id!==ticket.id});if(bosh.type!=="terminate"){process.nextTick(function(){process.nextTick(self.longPoll.bind(self))})}})};module.exports=BOSHConnection}).call(this,require("_process"),require("buffer").Buffer)},{_process:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/process/browser.js",bluebird:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/bluebird/js/browser/bluebird.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js","lodash.assign":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/index.js","lodash.filter":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/index.js",request:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/index.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js",wildemitter:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/wildemitter/wildemitter.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/transports/old-websocket.js":[function(require,module,exports){"use strict";var each=require("lodash.foreach");var WSConnection=require("./websocket");var util=require("util");function OldWSConnection(sm,stanzas){WSConnection.call(this,sm,stanzas);var self=this;function wrap(data){return[self.streamStart,data,self.streamEnd].join("")}self.on("connected",function(){self.streamStart='<stream:stream xmlns:stream="http://etherx.jabber.org/streams">';self.streamEnd="</stream:stream>"});self.off("raw:incoming");self.on("raw:incoming",function(data){var streamData,ended,err;data=data.trim();data=data.replace(/^(\s*<\?.*\?>\s*)*/,"");if(data===""){return}if(data.match(self.streamEnd)){return self.disconnect()}else if(self.hasStream){try{streamData=stanzas.parse(wrap(data))}catch(e){err=new this.stanzas.StreamError({condition:"invalid-xml"});self.emit("stream:error",err,e);self.send(err);return self.disconnect()}}else{var parts=data.match(/^<(\S+:)?(\S+) /);self.streamStart=data;self.streamEnd="</"+(parts[1]||"")+parts[2]+">";ended=false;try{streamData=stanzas.parse(data+self.streamEnd)}catch(e){try{streamData=stanzas.parse(data);ended=true}catch(e2){err=new this.stanzas.StreamError({condition:"invalid-xml"});self.emit("stream:error",err,e2);self.send(err);return self.disconnect()}}self.hasStream=true;self.stream=streamData;self.emit("stream:start",streamData)}each(streamData._extensions,function(stanzaObj){if(!stanzaObj.lang&&self.stream){stanzaObj.lang=self.stream.lang}self.emit("stream:data",stanzaObj)});if(ended){self.emit("stream:end")}})}util.inherits(OldWSConnection,WSConnection);OldWSConnection.prototype.startHeader=function(){return["<stream:stream",'xmlns:stream="http://etherx.jabber.org/streams"','xmlns="jabber:client"','version="'+(this.config.version||"1.0")+'"','xml:lang="'+(this.config.lang||"en")+'"','to="'+this.config.server+'">'].join(" ")};OldWSConnection.prototype.closeHeader=function(){return"</stream:stream>"};module.exports=OldWSConnection},{"./websocket":"/Users/spaksa/stanza/node_modules/stanza.io/lib/transports/websocket.js","lodash.foreach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/index.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/lib/transports/websocket.js":[function(require,module,exports){(function(Buffer){"use strict";var util=require("util");var WildEmitter=require("wildemitter");var async=require("async");var WS=require("faye-websocket")&&require("faye-websocket").Client?require("faye-websocket").Client:window.WebSocket;var WS_OPEN=1;function WSConnection(sm,stanzas){var self=this;WildEmitter.call(this);self.sm=sm;self.closing=false;self.stanzas={Open:stanzas.getDefinition("open","urn:ietf:params:xml:ns:xmpp-framing",true),Close:stanzas.getDefinition("close","urn:ietf:params:xml:ns:xmpp-framing",true),StreamError:stanzas.getStreamError()};self.sendQueue=async.queue(function(data,cb){if(self.conn){if(typeof data!=="string"){data=data.toString()}data=new Buffer(data,"utf8").toString();self.emit("raw:outgoing",data);if(self.conn.readyState===WS_OPEN){self.conn.send(data)}}cb()},1);self.on("connected",function(){self.send(self.startHeader())});self.on("raw:incoming",function(data){var stanzaObj,err;data=data.trim();if(data===""){return}try{stanzaObj=stanzas.parse(data)}catch(e){err=new this.stanzas.StreamError({condition:"invalid-xml"});self.emit("stream:error",err,e);self.send(err);return self.disconnect()}if(stanzaObj._name==="openStream"){self.hasStream=true;self.stream=stanzaObj;return self.emit("stream:start",stanzaObj.toJSON())}if(stanzaObj._name==="closeStream"){self.emit("stream:end");return self.disconnect()}if(!stanzaObj.lang&&self.stream){stanzaObj.lang=self.stream.lang}self.emit("stream:data",stanzaObj)})}util.inherits(WSConnection,WildEmitter);WSConnection.prototype.connect=function(opts){var self=this;self.config=opts;self.hasStream=false;self.closing=false;self.conn=new WS(opts.wsURL,"xmpp");self.conn.onerror=function(e){e.preventDefault();self.emit("disconnected",self)};self.conn.onclose=function(){self.emit("disconnected",self)};self.conn.onopen=function(){self.sm.started=false;self.emit("connected",self)};self.conn.onmessage=function(wsMsg){self.emit("raw:incoming",new Buffer(wsMsg.data,"utf8").toString())}};WSConnection.prototype.startHeader=function(){return new this.stanzas.Open({version:this.config.version||"1.0",lang:this.config.lang||"en",to:this.config.server})};WSConnection.prototype.closeHeader=function(){return new this.stanzas.Close};WSConnection.prototype.disconnect=function(){if(this.conn&&!this.closing){this.closing=true;this.send(this.closeHeader())}else{this.hasStream=false;this.stream=undefined;if(this.conn.readyState===WS_OPEN){this.conn.close()}this.conn=undefined}};WSConnection.prototype.restart=function(){var self=this;self.hasStream=false;self.send(this.startHeader())};WSConnection.prototype.send=function(data){this.sendQueue.push(data)};module.exports=WSConnection}).call(this,require("buffer").Buffer)},{async:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/async/lib/async.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js","faye-websocket":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/browser-resolve/empty.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js",wildemitter:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/wildemitter/wildemitter.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/index.js":[function(require,module,exports){var randomBytes=require("randombytes");var createHash=require("create-hash");function parse(chal){var dtives={};var tokens=chal.split(/,(?=(?:[^"]|"[^"]*")*$)/);for(var i=0,len=tokens.length;i<len;i++){var dtiv=/(\w+)=["]?([^"]+)["]?$/.exec(tokens[i]);if(dtiv){dtives[dtiv[1]]=dtiv[2]}}return dtives}function genNonce(){return randomBytes(16).toString("hex")}function Mechanism(options){options=options||{};this._genNonce=options.genNonce||genNonce}Mechanism.Mechanism=Mechanism;Mechanism.prototype.name="DIGEST-MD5";Mechanism.prototype.clientFirst=false;Mechanism.prototype.response=function(cred){if(this._completed){return undefined}var uri=cred.serviceType+"/"+cred.host;if(cred.serviceName&&cred.host!==cred.serviceName){uri+="/"+cred.serviceName}var realm=cred.realm||this._realm||"";var cnonce=this._genNonce();var nc="00000001";var qop="auth";var str="";str+='username="'+cred.username+'"';if(realm){str+=',realm="'+realm+'"'}str+=',nonce="'+this._nonce+'"';str+=',cnonce="'+cnonce+'"';str+=",nc="+nc;str+=",qop="+qop;str+=',digest-uri="'+uri+'"';var base=createHash("md5").update(cred.username).update(":").update(realm).update(":").update(cred.password).digest();var ha1=createHash("md5").update(base).update(":").update(this._nonce).update(":").update(cnonce);if(cred.authzid){ha1.update(":").update(cred.authzid)}ha1=ha1.digest("hex");var ha2=createHash("md5").update("AUTHENTICATE:").update(uri);if(qop==="auth-int"||qop==="auth-conf"){ha2.update(":00000000000000000000000000000000")}ha2=ha2.digest("hex");var digest=createHash("md5").update(ha1).update(":").update(this._nonce).update(":").update(nc).update(":").update(cnonce).update(":").update(qop).update(":").update(ha2).digest("hex");str+=",response="+digest;if(this._charset==="utf-8"){str+=",charset=utf-8"}if(cred.authzid){str+='authzid="'+cred.authzid+'"'}return str};Mechanism.prototype.challenge=function(chal){var dtives=parse(chal);this._completed=!!dtives.rspauth;this._realm=dtives.realm;this._nonce=dtives.nonce;this._qop=(dtives.qop||"auth").split(",");this._stale=dtives.stale;this._maxbuf=parseInt(dtives.maxbuf)||65536;this._charset=dtives.charset;this._algo=dtives.algorithm;this._cipher=dtives.cipher;if(this._cipher){this._cipher.split(",")}return this};module.exports=Mechanism},{"create-hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/browser.js",randombytes:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/randombytes/browser.js"
}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/browser.js":[function(require,module,exports){(function(Buffer){"use strict";var inherits=require("inherits");var md5=require("./md5");var rmd160=require("ripemd160");var sha=require("sha.js");var Transform=require("stream").Transform;function HashNoConstructor(hash){Transform.call(this);this._hash=hash;this.buffers=[]}inherits(HashNoConstructor,Transform);HashNoConstructor.prototype._transform=function(data,_,next){this.buffers.push(data);next()};HashNoConstructor.prototype._flush=function(next){this.push(this.digest());next()};HashNoConstructor.prototype.update=function(data,enc){if(typeof data==="string"){data=new Buffer(data,enc)}this.buffers.push(data);return this};HashNoConstructor.prototype.digest=function(enc){var buf=Buffer.concat(this.buffers);var r=this._hash(buf);this.buffers=null;return enc?r.toString(enc):r};function Hash(hash){Transform.call(this);this._hash=hash}inherits(Hash,Transform);Hash.prototype._transform=function(data,enc,next){if(enc)data=new Buffer(data,enc);this._hash.update(data);next()};Hash.prototype._flush=function(next){this.push(this._hash.digest());this._hash=null;next()};Hash.prototype.update=function(data,enc){if(typeof data==="string"){data=new Buffer(data,enc)}this._hash.update(data);return this};Hash.prototype.digest=function(enc){var outData=this._hash.digest();return enc?outData.toString(enc):outData};module.exports=function createHash(alg){if("md5"===alg)return new HashNoConstructor(md5);if("rmd160"===alg)return new HashNoConstructor(rmd160);return new Hash(sha(alg))}}).call(this,require("buffer").Buffer)},{"./md5":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/md5.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js",ripemd160:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/ripemd160/lib/ripemd160.js","sha.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/index.js",stream:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/stream-browserify/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/helpers.js":[function(require,module,exports){(function(Buffer){"use strict";var intSize=4;var zeroBuffer=new Buffer(intSize);zeroBuffer.fill(0);var chrsz=8;function toArray(buf,bigEndian){if(buf.length%intSize!==0){var len=buf.length+(intSize-buf.length%intSize);buf=Buffer.concat([buf,zeroBuffer],len)}var arr=[];var fn=bigEndian?buf.readInt32BE:buf.readInt32LE;for(var i=0;i<buf.length;i+=intSize){arr.push(fn.call(buf,i))}return arr}function toBuffer(arr,size,bigEndian){var buf=new Buffer(size);var fn=bigEndian?buf.writeInt32BE:buf.writeInt32LE;for(var i=0;i<arr.length;i++){fn.call(buf,arr[i],i*4,true)}return buf}function hash(buf,fn,hashSize,bigEndian){if(!Buffer.isBuffer(buf))buf=new Buffer(buf);var arr=fn(toArray(buf,bigEndian),buf.length*chrsz);return toBuffer(arr,hashSize,bigEndian)}exports.hash=hash}).call(this,require("buffer").Buffer)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/md5.js":[function(require,module,exports){"use strict";var helpers=require("./helpers");function core_md5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}module.exports=function md5(buf){return helpers.hash(buf,core_md5,16)}},{"./helpers":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/helpers.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js":[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/ripemd160/lib/ripemd160.js":[function(require,module,exports){(function(Buffer){var zl=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13];var zr=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11];var sl=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6];var sr=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];var hl=[0,1518500249,1859775393,2400959708,2840853838];var hr=[1352829926,1548603684,1836072691,2053994217,0];function bytesToWords(bytes){var words=[];for(var i=0,b=0;i<bytes.length;i++,b+=8){words[b>>>5]|=bytes[i]<<24-b%32}return words}function wordsToBytes(words){var bytes=[];for(var b=0;b<words.length*32;b+=8){bytes.push(words[b>>>5]>>>24-b%32&255)}return bytes}function processBlock(H,M,offset){for(var i=0;i<16;i++){var offset_i=offset+i;var M_offset_i=M[offset_i];M[offset_i]=(M_offset_i<<8|M_offset_i>>>24)&16711935|(M_offset_i<<24|M_offset_i>>>8)&4278255360}var al,bl,cl,dl,el;var ar,br,cr,dr,er;ar=al=H[0];br=bl=H[1];cr=cl=H[2];dr=dl=H[3];er=el=H[4];var t;for(i=0;i<80;i+=1){t=al+M[offset+zl[i]]|0;if(i<16){t+=f1(bl,cl,dl)+hl[0]}else if(i<32){t+=f2(bl,cl,dl)+hl[1]}else if(i<48){t+=f3(bl,cl,dl)+hl[2]}else if(i<64){t+=f4(bl,cl,dl)+hl[3]}else{t+=f5(bl,cl,dl)+hl[4]}t=t|0;t=rotl(t,sl[i]);t=t+el|0;al=el;el=dl;dl=rotl(cl,10);cl=bl;bl=t;t=ar+M[offset+zr[i]]|0;if(i<16){t+=f5(br,cr,dr)+hr[0]}else if(i<32){t+=f4(br,cr,dr)+hr[1]}else if(i<48){t+=f3(br,cr,dr)+hr[2]}else if(i<64){t+=f2(br,cr,dr)+hr[3]}else{t+=f1(br,cr,dr)+hr[4]}t=t|0;t=rotl(t,sr[i]);t=t+er|0;ar=er;er=dr;dr=rotl(cr,10);cr=br;br=t}t=H[1]+cl+dr|0;H[1]=H[2]+dl+er|0;H[2]=H[3]+el+ar|0;H[3]=H[4]+al+br|0;H[4]=H[0]+bl+cr|0;H[0]=t}function f1(x,y,z){return x^y^z}function f2(x,y,z){return x&y|~x&z}function f3(x,y,z){return(x|~y)^z}function f4(x,y,z){return x&z|y&~z}function f5(x,y,z){return x^(y|~z)}function rotl(x,n){return x<<n|x>>>32-n}function ripemd160(message){var H=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof message==="string"){message=new Buffer(message,"utf8")}var m=bytesToWords(message);var nBitsLeft=message.length*8;var nBitsTotal=message.length*8;m[nBitsLeft>>>5]|=128<<24-nBitsLeft%32;m[(nBitsLeft+64>>>9<<4)+14]=(nBitsTotal<<8|nBitsTotal>>>24)&16711935|(nBitsTotal<<24|nBitsTotal>>>8)&4278255360;for(var i=0;i<m.length;i+=16){processBlock(H,m,i)}for(i=0;i<5;i++){var H_i=H[i];H[i]=(H_i<<8|H_i>>>24)&16711935|(H_i<<24|H_i>>>8)&4278255360}var digestbytes=wordsToBytes(H);return new Buffer(digestbytes)}module.exports=ripemd160}).call(this,require("buffer").Buffer)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/hash.js":[function(require,module,exports){(function(Buffer){function Hash(blockSize,finalSize){this._block=new Buffer(blockSize);this._finalSize=finalSize;this._blockSize=blockSize;this._len=0;this._s=0}Hash.prototype.update=function(data,enc){if(typeof data==="string"){enc=enc||"utf8";data=new Buffer(data,enc)}var l=this._len+=data.length;var s=this._s||0;var f=0;var buffer=this._block;while(s<l){var t=Math.min(data.length,f+this._blockSize-s%this._blockSize);var ch=t-f;for(var i=0;i<ch;i++){buffer[s%this._blockSize+i]=data[i+f]}s+=ch;f+=ch;if(s%this._blockSize===0){this._update(buffer)}}this._s=s;return this};Hash.prototype.digest=function(enc){var l=this._len*8;this._block[this._len%this._blockSize]=128;this._block.fill(0,this._len%this._blockSize+1);if(l%(this._blockSize*8)>=this._finalSize*8){this._update(this._block);this._block.fill(0)}this._block.writeInt32BE(l,this._blockSize-4);var hash=this._update(this._block)||this._hash();return enc?hash.toString(enc):hash};Hash.prototype._update=function(){throw new Error("_update must be implemented by subclass")};module.exports=Hash}).call(this,require("buffer").Buffer)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/index.js":[function(require,module,exports){var exports=module.exports=function SHA(algorithm){algorithm=algorithm.toLowerCase();var Algorithm=exports[algorithm];if(!Algorithm)throw new Error(algorithm+" is not supported (we accept pull requests)");return new Algorithm};exports.sha=require("./sha");exports.sha1=require("./sha1");exports.sha224=require("./sha224");exports.sha256=require("./sha256");exports.sha384=require("./sha384");exports.sha512=require("./sha512")},{"./sha":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha.js","./sha1":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha1.js","./sha224":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha224.js","./sha256":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha256.js","./sha384":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha384.js","./sha512":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha512.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha.js":[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var W=new Array(80);function Sha(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha,Hash);Sha.prototype.init=function(){this._a=1732584193|0;this._b=4023233417|0;this._c=2562383102|0;this._d=271733878|0;this._e=3285377520|0;return this};function rol(num,cnt){return num<<cnt|num>>>32-cnt}Sha.prototype._update=function(M){var W=this._w;var a=this._a;var b=this._b;var c=this._c;var d=this._d;var e=this._e;var j=0,k;function calcW(){return W[j-3]^W[j-8]^W[j-14]^W[j-16]}function loop(w,f){W[j]=w;var t=rol(a,5)+f+e+w+k;e=d;d=c;c=rol(b,30);b=a;a=t;j++}k=1518500249;while(j<16)loop(M.readInt32BE(j*4),b&c|~b&d);while(j<20)loop(calcW(),b&c|~b&d);k=1859775393;while(j<40)loop(calcW(),b^c^d);k=-1894007588;while(j<60)loop(calcW(),b&c|b&d|c&d);k=-899497514;while(j<80)loop(calcW(),b^c^d);this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0};Sha.prototype._hash=function(){var H=new Buffer(20);H.writeInt32BE(this._a|0,0);H.writeInt32BE(this._b|0,4);H.writeInt32BE(this._c|0,8);H.writeInt32BE(this._d|0,12);H.writeInt32BE(this._e|0,16);return H};module.exports=Sha}).call(this,require("buffer").Buffer)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha1.js":[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var W=new Array(80);function Sha1(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha1,Hash);Sha1.prototype.init=function(){this._a=1732584193|0;this._b=4023233417|0;this._c=2562383102|0;this._d=271733878|0;this._e=3285377520|0;return this};function rol(num,cnt){return num<<cnt|num>>>32-cnt}Sha1.prototype._update=function(M){var W=this._w;var a=this._a;var b=this._b;var c=this._c;var d=this._d;var e=this._e;var j=0,k;function calcW(){return rol(W[j-3]^W[j-8]^W[j-14]^W[j-16],1)}function loop(w,f){W[j]=w;var t=rol(a,5)+f+e+w+k;e=d;d=c;c=rol(b,30);b=a;a=t;j++}k=1518500249;while(j<16)loop(M.readInt32BE(j*4),b&c|~b&d);while(j<20)loop(calcW(),b&c|~b&d);k=1859775393;while(j<40)loop(calcW(),b^c^d);k=-1894007588;while(j<60)loop(calcW(),b&c|b&d|c&d);k=-899497514;while(j<80)loop(calcW(),b^c^d);this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0};Sha1.prototype._hash=function(){var H=new Buffer(20);H.writeInt32BE(this._a|0,0);H.writeInt32BE(this._b|0,4);H.writeInt32BE(this._c|0,8);H.writeInt32BE(this._d|0,12);H.writeInt32BE(this._e|0,16);return H};module.exports=Sha1}).call(this,require("buffer").Buffer)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha224.js":[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Sha256=require("./sha256");var Hash=require("./hash");var W=new Array(64);function Sha224(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha224,Sha256);Sha224.prototype.init=function(){this._a=3238371032|0;this._b=914150663|0;this._c=812702999|0;this._d=4144912697|0;this._e=4290775857|0;this._f=1750603025|0;this._g=1694076839|0;this._h=3204075428|0;return this};Sha224.prototype._hash=function(){var H=new Buffer(28);H.writeInt32BE(this._a,0);H.writeInt32BE(this._b,4);H.writeInt32BE(this._c,8);H.writeInt32BE(this._d,12);H.writeInt32BE(this._e,16);H.writeInt32BE(this._f,20);H.writeInt32BE(this._g,24);return H};module.exports=Sha224}).call(this,require("buffer").Buffer)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/hash.js","./sha256":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha256.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha256.js":[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];var W=new Array(64);function Sha256(){this.init();this._w=W;Hash.call(this,64,56)}inherits(Sha256,Hash);Sha256.prototype.init=function(){this._a=1779033703|0;this._b=3144134277|0;this._c=1013904242|0;this._d=2773480762|0;this._e=1359893119|0;this._f=2600822924|0;this._g=528734635|0;this._h=1541459225|0;return this};function S(X,n){return X>>>n|X<<32-n}function R(X,n){return X>>>n}function Ch(x,y,z){return x&y^~x&z}function Maj(x,y,z){return x&y^x&z^y&z}function Sigma0256(x){return S(x,2)^S(x,13)^S(x,22)}function Sigma1256(x){return S(x,6)^S(x,11)^S(x,25)}function Gamma0256(x){return S(x,7)^S(x,18)^R(x,3)}function Gamma1256(x){return S(x,17)^S(x,19)^R(x,10)}Sha256.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;var f=this._f|0;var g=this._g|0;var h=this._h|0;var j=0;function calcW(){return Gamma1256(W[j-2])+W[j-7]+Gamma0256(W[j-15])+W[j-16]}function loop(w){W[j]=w;var T1=h+Sigma1256(e)+Ch(e,f,g)+K[j]+w;var T2=Sigma0256(a)+Maj(a,b,c);h=g;g=f;f=e;e=d+T1;d=c;c=b;b=a;a=T1+T2;j++}while(j<16)loop(M.readInt32BE(j*4));while(j<64)loop(calcW());this._a=a+this._a|0;this._b=b+this._b|0;this._c=c+this._c|0;this._d=d+this._d|0;this._e=e+this._e|0;this._f=f+this._f|0;this._g=g+this._g|0;this._h=h+this._h|0};Sha256.prototype._hash=function(){var H=new Buffer(32);H.writeInt32BE(this._a,0);H.writeInt32BE(this._b,4);H.writeInt32BE(this._c,8);H.writeInt32BE(this._d,12);H.writeInt32BE(this._e,16);H.writeInt32BE(this._f,20);H.writeInt32BE(this._g,24);H.writeInt32BE(this._h,28);return H};module.exports=Sha256}).call(this,require("buffer").Buffer)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha384.js":[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var SHA512=require("./sha512");var Hash=require("./hash");var W=new Array(160);function Sha384(){this.init();this._w=W;Hash.call(this,128,112)}inherits(Sha384,SHA512);Sha384.prototype.init=function(){this._a=3418070365|0;this._b=1654270250|0;this._c=2438529370|0;this._d=355462360|0;this._e=1731405415|0;this._f=2394180231|0;this._g=3675008525|0;this._h=1203062813|0;this._al=3238371032|0;this._bl=914150663|0;this._cl=812702999|0;this._dl=4144912697|0;this._el=4290775857|0;this._fl=1750603025|0;this._gl=1694076839|0;this._hl=3204075428|0;return this};Sha384.prototype._hash=function(){var H=new Buffer(48);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset);H.writeInt32BE(l,offset+4)}writeInt64BE(this._a,this._al,0);writeInt64BE(this._b,this._bl,8);writeInt64BE(this._c,this._cl,16);writeInt64BE(this._d,this._dl,24);writeInt64BE(this._e,this._el,32);writeInt64BE(this._f,this._fl,40);return H};module.exports=Sha384}).call(this,require("buffer").Buffer)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/hash.js","./sha512":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha512.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha512.js":[function(require,module,exports){(function(Buffer){var inherits=require("inherits");var Hash=require("./hash");var K=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];var W=new Array(160);function Sha512(){this.init();this._w=W;Hash.call(this,128,112)}inherits(Sha512,Hash);Sha512.prototype.init=function(){this._a=1779033703|0;this._b=3144134277|0;this._c=1013904242|0;this._d=2773480762|0;this._e=1359893119|0;this._f=2600822924|0;this._g=528734635|0;this._h=1541459225|0;this._al=4089235720|0;this._bl=2227873595|0;this._cl=4271175723|0;this._dl=1595750129|0;this._el=2917565137|0;this._fl=725511199|0;this._gl=4215389547|0;this._hl=327033209|0;return this};function S(X,Xl,n){return X>>>n|Xl<<32-n}function Ch(x,y,z){return x&y^~x&z}function Maj(x,y,z){return x&y^x&z^y&z}Sha512.prototype._update=function(M){var W=this._w;var a=this._a|0;var b=this._b|0;var c=this._c|0;var d=this._d|0;var e=this._e|0;var f=this._f|0;var g=this._g|0;var h=this._h|0;var al=this._al|0;var bl=this._bl|0;var cl=this._cl|0;var dl=this._dl|0;var el=this._el|0;var fl=this._fl|0;var gl=this._gl|0;var hl=this._hl|0;var i=0,j=0;var Wi,Wil;function calcW(){var x=W[j-15*2];var xl=W[j-15*2+1];var gamma0=S(x,xl,1)^S(x,xl,8)^x>>>7;var gamma0l=S(xl,x,1)^S(xl,x,8)^S(xl,x,7);x=W[j-2*2];xl=W[j-2*2+1];var gamma1=S(x,xl,19)^S(xl,x,29)^x>>>6;var gamma1l=S(xl,x,19)^S(x,xl,29)^S(xl,x,6);var Wi7=W[j-7*2];var Wi7l=W[j-7*2+1];var Wi16=W[j-16*2];var Wi16l=W[j-16*2+1];Wil=gamma0l+Wi7l;Wi=gamma0+Wi7+(Wil>>>0<gamma0l>>>0?1:0);Wil=Wil+gamma1l;Wi=Wi+gamma1+(Wil>>>0<gamma1l>>>0?1:0);Wil=Wil+Wi16l;Wi=Wi+Wi16+(Wil>>>0<Wi16l>>>0?1:0)}function loop(){W[j]=Wi;W[j+1]=Wil;var maj=Maj(a,b,c);var majl=Maj(al,bl,cl);var sigma0h=S(a,al,28)^S(al,a,2)^S(al,a,7);var sigma0l=S(al,a,28)^S(a,al,2)^S(a,al,7);var sigma1h=S(e,el,14)^S(e,el,18)^S(el,e,9);var sigma1l=S(el,e,14)^S(el,e,18)^S(e,el,9);var Ki=K[j];var Kil=K[j+1];var ch=Ch(e,f,g);var chl=Ch(el,fl,gl);var t1l=hl+sigma1l;var t1=h+sigma1h+(t1l>>>0<hl>>>0?1:0);t1l=t1l+chl;t1=t1+ch+(t1l>>>0<chl>>>0?1:0);t1l=t1l+Kil;t1=t1+Ki+(t1l>>>0<Kil>>>0?1:0);t1l=t1l+Wil;t1=t1+Wi+(t1l>>>0<Wil>>>0?1:0);var t2l=sigma0l+majl;var t2=sigma0h+maj+(t2l>>>0<sigma0l>>>0?1:0);h=g;hl=gl;g=f;gl=fl;f=e;fl=el;el=dl+t1l|0;e=d+t1+(el>>>0<dl>>>0?1:0)|0;d=c;dl=cl;c=b;cl=bl;b=a;bl=al;al=t1l+t2l|0;a=t1+t2+(al>>>0<t1l>>>0?1:0)|0;i++;j+=2}while(i<16){Wi=M.readInt32BE(j*4);Wil=M.readInt32BE(j*4+4);loop()}while(i<80){calcW();loop()}this._al=this._al+al|0;this._bl=this._bl+bl|0;this._cl=this._cl+cl|0;this._dl=this._dl+dl|0;this._el=this._el+el|0;this._fl=this._fl+fl|0;this._gl=this._gl+gl|0;this._hl=this._hl+hl|0;this._a=this._a+a+(this._al>>>0<al>>>0?1:0)|0;this._b=this._b+b+(this._bl>>>0<bl>>>0?1:0)|0;this._c=this._c+c+(this._cl>>>0<cl>>>0?1:0)|0;this._d=this._d+d+(this._dl>>>0<dl>>>0?1:0)|0;this._e=this._e+e+(this._el>>>0<el>>>0?1:0)|0;this._f=this._f+f+(this._fl>>>0<fl>>>0?1:0)|0;this._g=this._g+g+(this._gl>>>0<gl>>>0?1:0)|0;this._h=this._h+h+(this._hl>>>0<hl>>>0?1:0)|0};Sha512.prototype._hash=function(){var H=new Buffer(64);function writeInt64BE(h,l,offset){H.writeInt32BE(h,offset);H.writeInt32BE(l,offset+4)}writeInt64BE(this._a,this._al,0);writeInt64BE(this._b,this._bl,8);writeInt64BE(this._c,this._cl,16);writeInt64BE(this._d,this._dl,24);writeInt64BE(this._e,this._el,32);writeInt64BE(this._f,this._fl,40);writeInt64BE(this._g,this._gl,48);writeInt64BE(this._h,this._hl,56);return H};module.exports=Sha512}).call(this,require("buffer").Buffer)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/randombytes/browser.js":[function(require,module,exports){(function(process,global,Buffer){"use strict";var crypto=global.crypto||global.msCrypto;if(crypto&&crypto.getRandomValues){module.exports=randomBytes}else{module.exports=oldBrowser}function randomBytes(size,cb){var bytes=new Buffer(size);crypto.getRandomValues(bytes);if(typeof cb==="function"){return process.nextTick(function(){cb(null,bytes)})}return bytes}function oldBrowser(){throw new Error("secure random number generation not supported by this browser\n"+"use chrome, FireFox or Internet Explorer 11")}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{},require("buffer").Buffer)},{_process:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/process/browser.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/async/lib/async.js":[function(require,module,exports){(function(process){(function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){var called=false;return function(){if(called)throw new Error("Callback was already called.");called=true;fn.apply(root,arguments)}}var _toString=Object.prototype.toString;var _isArray=Array.isArray||function(obj){return _toString.call(obj)==="[object Array]"};var _each=function(arr,iterator){for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr)}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator)}var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a))});return results};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo)}_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo};var _keys=function(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){async.nextTick=function(fn){setImmediate(fn)};async.setImmediate=async.nextTick}else{async.nextTick=function(fn){setTimeout(fn,0)};async.setImmediate=async.nextTick}}else{async.nextTick=process.nextTick;if(typeof setImmediate!=="undefined"){async.setImmediate=function(fn){setImmediate(fn);
}}else{async.setImmediate=async.nextTick}}async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;_each(arr,function(x){iterator(x,only_once(done))});function done(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}}}};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;var iterate=function(){iterator(arr[completed],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}else{iterate()}}})};iterate()};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback()}var completed=0;var started=0;var running=0;(function replenish(){if(completed>=arr.length){return callback()}while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;running-=1;if(completed>=arr.length){callback()}else{replenish()}}})}})()}};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}};var _asyncMap=function(eachfn,arr,iterator,callback){arr=_map(arr,function(x,i){return{index:i,value:x}});if(!callback){eachfn(arr,function(x,callback){iterator(x.value,function(err){callback(err)})})}else{var results=[];eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err)})},function(err){callback(err,results)})}};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){}}else{callback()}})},function(err){main_callback()})};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){}}callback()})},function(err){main_callback(false)})};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){}}callback()})},function(err){main_callback(true)})};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))}})};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);var remainingTasks=keys.length;if(!remainingTasks){return callback()}var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn)};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return}}};var taskComplete=function(){remainingTasks--;_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(!remainingTasks){var theCallback=callback;callback=function(){};theCallback(null,results)}});_each(keys,function(k){var task=_isArray(tasks[k])?tasks[k]:[tasks[k]];var taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}if(err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]});safeResults[k]=args;callback(err,safeResults);callback=function(){}}else{results[k]=args;async.setImmediate(taskComplete)}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)};if(ready()){task[task.length-1](taskCallback,results)}else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results)}};addListener(listener)}})};async.retry=function(times,task,callback){var DEFAULT_TIMES=5;var attempts=[];if(typeof times==="function"){callback=task;task=times;times=DEFAULT_TIMES}times=parseInt(times,10)||DEFAULT_TIMES;var wrappedTask=function(wrappedCallback,wrappedResults){var retryAttempt=function(task,finalAttempt){return function(seriesCallback){task(function(err,result){seriesCallback(!err||finalAttempt,{err:err,result:result})},wrappedResults)}};while(times){attempts.push(retryAttempt(task,!(times-=1)))}async.series(attempts,function(done,data){data=data[data.length-1];(wrappedCallback||callback)(data.err,data.result)})};return callback?wrappedTask():wrappedTask};async.waterfall=function(tasks,callback){callback=callback||function(){};if(!_isArray(tasks)){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length){return callback()}var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(_isArray(tasks)){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)};async.series=function(tasks,callback){callback=callback||function(){};if(_isArray(tasks)){async.mapSeries(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()};fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn};return makeCallback(0)};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){iterator(function(err){if(err){return callback(err)}async.whilst(test,iterator,callback)})}else{callback()}};async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(test.apply(null,args)){async.doWhilst(iterator,test,callback)}else{callback()}})};async.until=function(test,iterator,callback){if(!test()){iterator(function(err){if(err){return callback(err)}async.until(test,iterator,callback)})}else{callback()}};async.doUntil=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(!test.apply(null,args)){async.doUntil(iterator,test,callback)}else{callback()}})};async.queue=function(worker,concurrency){if(concurrency===undefined){concurrency=1}function _insert(q,data,pos,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,callback:typeof callback==="function"?callback:null};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,started:false,paused:false,push:function(data,callback){_insert(q,data,false,callback)},kill:function(){q.drain=null;q.tasks=[]},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){if(!q.paused&&workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}workers+=1;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments)}if(q.drain&&q.tasks.length+workers===0){q.drain()}q.process()};var cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers},idle:function(){return q.tasks.length+workers===0},pause:function(){if(q.paused===true){return}q.paused=true},resume:function(){if(q.paused===false){return}q.paused=false;for(var w=1;w<=q.concurrency;w++){async.setImmediate(q.process)}}};return q};async.priorityQueue=function(worker,concurrency){function _compareTasks(a,b){return a.priority-b.priority}function _binarySearch(sequence,item,compare){var beg=-1,end=sequence.length-1;while(beg<end){var mid=beg+(end-beg+1>>>1);if(compare(item,sequence[mid])>=0){beg=mid}else{end=mid-1}}return beg}function _insert(q,data,priority,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,priority:priority,callback:typeof callback==="function"?callback:null};q.tasks.splice(_binarySearch(q.tasks,item,_compareTasks)+1,0,item);if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var q=async.queue(worker,concurrency);q.push=function(data,priority,callback){_insert(q,data,priority,callback)};delete q.unshift;return q};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,drained:true,push:function(data,callback){if(!_isArray(data)){data=[data]}_each(data,function(task){tasks.push({data:task,callback:typeof callback==="function"?callback:null});cargo.drained=false;if(cargo.saturated&&tasks.length===payload){cargo.saturated()}});async.setImmediate(cargo.process)},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain&&!cargo.drained)cargo.drain();cargo.drained=true;return}var ts=typeof payload==="number"?tasks.splice(0,payload):tasks.splice(0,tasks.length);var ds=_map(ts,function(task){return task.data});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args)}});process()})},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(err){if(console.error){console.error(err)}}else if(console[name]){_each(args,function(x){console[name](x)})}}}]))}};async.log=_console_fn("log");async.dir=_console_fn("dir");async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){async.nextTick(function(){callback.apply(null,memo[key])})}else if(key in queues){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.map(counter,iterator,callback)};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.mapSeries(counter,iterator,callback)};async.seq=function(){var fns=arguments;return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};async.compose=function(){return async.seq.apply(null,Array.prototype.reverse.call(arguments))};var _applyEach=function(eachfn,fns){var go=function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}else{return go}};async.applyEach=doParallel(_applyEach);async.applyEachSeries=doSeries(_applyEach);async.forever=function(fn,callback){function next(err){if(err){if(callback){return callback(err)}throw err}fn(next)}next()};if(typeof module!=="undefined"&&module.exports){module.exports=async}else if(typeof define!=="undefined"&&define.amd){define([],function(){return async})}else{root.async=async}})()}).call(this,require("_process"))},{_process:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/process/browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/bluebird/js/browser/bluebird.js":[function(require,module,exports){(function(process,global){!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Promise=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof _dereq_=="function"&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof _dereq_=="function"&&_dereq_;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var SomePromiseArray=Promise._SomePromiseArray;function any(promises){var ret=new SomePromiseArray(promises);var promise=ret.promise();ret.setHowMany(1);ret.setUnwrap();ret.init();return promise}Promise.any=function(promises){return any(promises)};Promise.prototype.any=function(){return any(this)}}},{}],2:[function(_dereq_,module,exports){"use strict";var firstLineError;try{throw new Error}catch(e){firstLineError=e}var schedule=_dereq_("./schedule.js");var Queue=_dereq_("./queue.js");var util=_dereq_("./util.js");function Async(){this._isTickUsed=false;this._lateQueue=new Queue(16);this._normalQueue=new Queue(16);this._trampolineEnabled=true;var self=this;this.drainQueues=function(){self._drainQueues()};this._schedule=schedule.isStatic?schedule(this.drainQueues):schedule}Async.prototype.disableTrampolineIfNecessary=function(){if(util.hasDevTools){this._trampolineEnabled=false}};Async.prototype.enableTrampoline=function(){if(!this._trampolineEnabled){this._trampolineEnabled=true;this._schedule=function(fn){setTimeout(fn,0)}}};Async.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0};Async.prototype.throwLater=function(fn,arg){if(arguments.length===1){arg=fn;fn=function(){throw arg}}if(typeof setTimeout!=="undefined"){setTimeout(function(){fn(arg)},0)}else try{this._schedule(function(){fn(arg)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}};function AsyncInvokeLater(fn,receiver,arg){this._lateQueue.push(fn,receiver,arg);this._queueTick()}function AsyncInvoke(fn,receiver,arg){this._normalQueue.push(fn,receiver,arg);this._queueTick()}function AsyncSettlePromises(promise){this._normalQueue._pushOne(promise);this._queueTick()}if(!util.hasDevTools){Async.prototype.invokeLater=AsyncInvokeLater;Async.prototype.invoke=AsyncInvoke;Async.prototype.settlePromises=AsyncSettlePromises}else{if(schedule.isStatic){schedule=function(fn){setTimeout(fn,0)}}Async.prototype.invokeLater=function(fn,receiver,arg){if(this._trampolineEnabled){AsyncInvokeLater.call(this,fn,receiver,arg)}else{this._schedule(function(){setTimeout(function(){fn.call(receiver,arg)},100)})}};Async.prototype.invoke=function(fn,receiver,arg){if(this._trampolineEnabled){AsyncInvoke.call(this,fn,receiver,arg)}else{this._schedule(function(){fn.call(receiver,arg)})}};Async.prototype.settlePromises=function(promise){if(this._trampolineEnabled){AsyncSettlePromises.call(this,promise)}else{this._schedule(function(){promise._settlePromises()})}}}Async.prototype.invokeFirst=function(fn,receiver,arg){this._normalQueue.unshift(fn,receiver,arg);this._queueTick()};Async.prototype._drainQueue=function(queue){while(queue.length()>0){var fn=queue.shift();if(typeof fn!=="function"){fn._settlePromises();continue}var receiver=queue.shift();var arg=queue.shift();fn.call(receiver,arg)}};Async.prototype._drainQueues=function(){this._drainQueue(this._normalQueue);this._reset();this._drainQueue(this._lateQueue)};Async.prototype._queueTick=function(){if(!this._isTickUsed){this._isTickUsed=true;this._schedule(this.drainQueues)}};Async.prototype._reset=function(){this._isTickUsed=false};module.exports=new Async;module.exports.firstLineError=firstLineError},{"./queue.js":28,"./schedule.js":31,"./util.js":38}],3:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise){var rejectThis=function(_,e){this._reject(e)};var targetRejected=function(e,context){context.promiseRejectionQueued=true;context.bindingPromise._then(rejectThis,rejectThis,null,this,e)};var bindingResolved=function(thisArg,context){this._setBoundTo(thisArg);if(this._isPending()){this._resolveCallback(context.target)}};var bindingRejected=function(e,context){if(!context.promiseRejectionQueued)this._reject(e)};Promise.prototype.bind=function(thisArg){var maybePromise=tryConvertToPromise(thisArg);var ret=new Promise(INTERNAL);ret._propagateFrom(this,1);var target=this._target();if(maybePromise instanceof Promise){var context={promiseRejectionQueued:false,promise:ret,target:target,bindingPromise:maybePromise};target._then(INTERNAL,targetRejected,ret._progress,ret,context);maybePromise._then(bindingResolved,bindingRejected,ret._progress,ret,context)}else{ret._setBoundTo(thisArg);ret._resolveCallback(target)}return ret};Promise.prototype._setBoundTo=function(obj){if(obj!==undefined){this._bitField=this._bitField|131072;this._boundTo=obj}else{this._bitField=this._bitField&~131072}};Promise.prototype._isBound=function(){return(this._bitField&131072)===131072};Promise.bind=function(thisArg,value){var maybePromise=tryConvertToPromise(thisArg);var ret=new Promise(INTERNAL);if(maybePromise instanceof Promise){maybePromise._then(function(thisArg){ret._setBoundTo(thisArg);ret._resolveCallback(value)},ret._reject,ret._progress,ret,null)}else{ret._setBoundTo(thisArg);ret._resolveCallback(value)}return ret}}},{}],4:[function(_dereq_,module,exports){"use strict";var old;if(typeof Promise!=="undefined")old=Promise;function noConflict(){try{if(Promise===bluebird)Promise=old}catch(e){}return bluebird}var bluebird=_dereq_("./promise.js")();bluebird.noConflict=noConflict;module.exports=bluebird},{"./promise.js":23}],5:[function(_dereq_,module,exports){"use strict";var cr=Object.create;if(cr){var callerCache=cr(null);var getterCache=cr(null);callerCache[" size"]=getterCache[" size"]=0}module.exports=function(Promise){var util=_dereq_("./util.js");var canEvaluate=util.canEvaluate;var isIdentifier=util.isIdentifier;var getMethodCaller;var getGetter;if(!true){var makeMethodCaller=function(methodName){return new Function("ensureMethod","                                    \n        return function(obj) {                                               \n            'use strict'                                                     \n            var len = this.length;                                           \n            ensureMethod(obj, 'methodName');                                 \n            switch(len) {                                                    \n                case 1: return obj.methodName(this[0]);                      \n                case 2: return obj.methodName(this[0], this[1]);             \n                case 3: return obj.methodName(this[0], this[1], this[2]);    \n                case 0: return obj.methodName();                             \n                default:                                                     \n                    return obj.methodName.apply(obj, this);                  \n            }                                                                \n        };                                                                   \n        ".replace(/methodName/g,methodName))(ensureMethod)};var makeGetter=function(propertyName){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",propertyName))};var getCompiled=function(name,compiler,cache){var ret=cache[name];if(typeof ret!=="function"){if(!isIdentifier(name)){return null}ret=compiler(name);cache[name]=ret;cache[" size"]++;if(cache[" size"]>512){var keys=Object.keys(cache);for(var i=0;i<256;++i)delete cache[keys[i]];cache[" size"]=keys.length-256}}return ret};getMethodCaller=function(name){return getCompiled(name,makeMethodCaller,callerCache)};getGetter=function(name){return getCompiled(name,makeGetter,getterCache)}}function ensureMethod(obj,methodName){var fn;if(obj!=null)fn=obj[methodName];if(typeof fn!=="function"){var message="Object "+util.classString(obj)+" has no method '"+util.toString(methodName)+"'";throw new Promise.TypeError(message)}return fn}function caller(obj){var methodName=this.pop();var fn=ensureMethod(obj,methodName);return fn.apply(obj,this)}Promise.prototype.call=function(methodName){var $_len=arguments.length;var args=new Array($_len-1);for(var $_i=1;$_i<$_len;++$_i){args[$_i-1]=arguments[$_i]}if(!true){if(canEvaluate){var maybeCaller=getMethodCaller(methodName);if(maybeCaller!==null){return this._then(maybeCaller,undefined,undefined,args,undefined)}}}args.push(methodName);return this._then(caller,undefined,undefined,args,undefined)};function namedGetter(obj){return obj[this]}function indexedGetter(obj){var index=+this;if(index<0)index=Math.max(0,index+obj.length);return obj[index]}Promise.prototype.get=function(propertyName){var isIndex=typeof propertyName==="number";var getter;if(!isIndex){if(canEvaluate){var maybeGetter=getGetter(propertyName);getter=maybeGetter!==null?maybeGetter:namedGetter}else{getter=namedGetter}}else{getter=indexedGetter}return this._then(getter,undefined,undefined,propertyName,undefined)}}},{"./util.js":38}],6:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var errors=_dereq_("./errors.js");var async=_dereq_("./async.js");var CancellationError=errors.CancellationError;Promise.prototype._cancel=function(reason){if(!this.isCancellable())return this;var parent;var promiseToReject=this;while((parent=promiseToReject._cancellationParent)!==undefined&&parent.isCancellable()){promiseToReject=parent}this._unsetCancellable();promiseToReject._target()._rejectCallback(reason,false,true)};Promise.prototype.cancel=function(reason){if(!this.isCancellable())return this;if(reason===undefined)reason=new CancellationError;async.invokeLater(this._cancel,this,reason);return this};Promise.prototype.cancellable=function(){if(this._cancellable())return this;async.enableTrampoline();this._setCancellable();this._cancellationParent=undefined;return this};Promise.prototype.uncancellable=function(){var ret=this.then();ret._unsetCancellable();return ret};Promise.prototype.fork=function(didFulfill,didReject,didProgress){var ret=this._then(didFulfill,didReject,didProgress,undefined,undefined);ret._setCancellable();ret._cancellationParent=undefined;return ret}}},{"./async.js":2,"./errors.js":13}],7:[function(_dereq_,module,exports){"use strict";module.exports=function(){var async=_dereq_("./async.js");var util=_dereq_("./util.js");var bluebirdFramePattern=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo|instrumented)/;var stackFramePattern=null;var formatStack=null;var indentStackFrames=false;var warn;function CapturedTrace(parent){this._parent=parent;var length=this._length=1+(parent===undefined?0:parent._length);captureStackTrace(this,CapturedTrace);if(length>32)this.uncycle()}util.inherits(CapturedTrace,Error);CapturedTrace.prototype.uncycle=function(){var length=this._length;if(length<2)return;var nodes=[];var stackToIndex={};for(var i=0,node=this;node!==undefined;++i){nodes.push(node);node=node._parent}length=this._length=i;for(var i=length-1;i>=0;--i){var stack=nodes[i].stack;if(stackToIndex[stack]===undefined){stackToIndex[stack]=i}}for(var i=0;i<length;++i){var currentStack=nodes[i].stack;var index=stackToIndex[currentStack];if(index!==undefined&&index!==i){if(index>0){nodes[index-1]._parent=undefined;nodes[index-1]._length=1}nodes[i]._parent=undefined;nodes[i]._length=1;var cycleEdgeNode=i>0?nodes[i-1]:this;if(index<length-1){cycleEdgeNode._parent=nodes[index+1];cycleEdgeNode._parent.uncycle();cycleEdgeNode._length=cycleEdgeNode._parent._length+1}else{cycleEdgeNode._parent=undefined;cycleEdgeNode._length=1}var currentChildLength=cycleEdgeNode._length+1;for(var j=i-2;j>=0;--j){nodes[j]._length=currentChildLength;currentChildLength++}return}}};CapturedTrace.prototype.parent=function(){return this._parent};CapturedTrace.prototype.hasParent=function(){return this._parent!==undefined};CapturedTrace.prototype.attachExtraTrace=function(error){if(error.__stackCleaned__)return;this.uncycle();var parsed=CapturedTrace.parseStackAndMessage(error);var message=parsed.message;var stacks=[parsed.stack];var trace=this;while(trace!==undefined){stacks.push(cleanStack(trace.stack.split("\n")));trace=trace._parent}removeCommonRoots(stacks);removeDuplicateOrEmptyJumps(stacks);util.notEnumerableProp(error,"stack",reconstructStack(message,stacks));util.notEnumerableProp(error,"__stackCleaned__",true)};function reconstructStack(message,stacks){for(var i=0;i<stacks.length-1;++i){stacks[i].push("From previous event:");stacks[i]=stacks[i].join("\n")}if(i<stacks.length){stacks[i]=stacks[i].join("\n")}return message+"\n"+stacks.join("\n")}function removeDuplicateOrEmptyJumps(stacks){for(var i=0;i<stacks.length;++i){if(stacks[i].length===0||i+1<stacks.length&&stacks[i][0]===stacks[i+1][0]){stacks.splice(i,1);i--}}}function removeCommonRoots(stacks){var current=stacks[0];for(var i=1;i<stacks.length;++i){var prev=stacks[i];var currentLastIndex=current.length-1;var currentLastLine=current[currentLastIndex];var commonRootMeetPoint=-1;for(var j=prev.length-1;j>=0;--j){if(prev[j]===currentLastLine){commonRootMeetPoint=j;break}}for(var j=commonRootMeetPoint;j>=0;--j){var line=prev[j];if(current[currentLastIndex]===line){current.pop();currentLastIndex--}else{break}}current=prev}}function cleanStack(stack){var ret=[];for(var i=0;i<stack.length;++i){var line=stack[i];var isTraceLine=stackFramePattern.test(line)||"    (No stack trace)"===line;var isInternalFrame=isTraceLine&&shouldIgnore(line);if(isTraceLine&&!isInternalFrame){if(indentStackFrames&&line.charAt(0)!==" "){line="    "+line}ret.push(line)}}return ret}function stackFramesAsArray(error){var stack=error.stack.replace(/\s+$/g,"").split("\n");for(var i=0;i<stack.length;++i){var line=stack[i];if("    (No stack trace)"===line||stackFramePattern.test(line)){break}}if(i>0){stack=stack.slice(i)}return stack}CapturedTrace.parseStackAndMessage=function(error){var stack=error.stack;var message=error.toString();stack=typeof stack==="string"&&stack.length>0?stackFramesAsArray(error):["    (No stack trace)"];return{message:message,stack:cleanStack(stack)}};CapturedTrace.formatAndLogError=function(error,title){if(typeof console!=="undefined"){var message;if(typeof error==="object"||typeof error==="function"){var stack=error.stack;message=title+formatStack(stack,error)}else{message=title+String(error)}if(typeof warn==="function"){warn(message)}else if(typeof console.log==="function"||typeof console.log==="object"){console.log(message)}}};CapturedTrace.unhandledRejection=function(reason){CapturedTrace.formatAndLogError(reason,"^--- With additional stack trace: ")};CapturedTrace.isSupported=function(){return typeof captureStackTrace==="function"};CapturedTrace.fireRejectionEvent=function(name,localHandler,reason,promise){var localEventFired=false;try{if(typeof localHandler==="function"){localEventFired=true;if(name==="rejectionHandled"){localHandler(promise);
}else{localHandler(reason,promise)}}}catch(e){async.throwLater(e)}var globalEventFired=false;try{globalEventFired=fireGlobalEvent(name,reason,promise)}catch(e){globalEventFired=true;async.throwLater(e)}var domEventFired=false;if(fireDomEvent){try{domEventFired=fireDomEvent(name.toLowerCase(),{reason:reason,promise:promise})}catch(e){domEventFired=true;async.throwLater(e)}}if(!globalEventFired&&!localEventFired&&!domEventFired&&name==="unhandledRejection"){CapturedTrace.formatAndLogError(reason,"Unhandled rejection ")}};function formatNonError(obj){var str;if(typeof obj==="function"){str="[function "+(obj.name||"anonymous")+"]"}else{str=obj.toString();var ruselessToString=/\[object [a-zA-Z0-9$_]+\]/;if(ruselessToString.test(str)){try{var newStr=JSON.stringify(obj);str=newStr}catch(e){}}if(str.length===0){str="(empty array)"}}return"(<"+snip(str)+">, no stack trace)"}function snip(str){var maxChars=41;if(str.length<maxChars){return str}return str.substr(0,maxChars-3)+"..."}var shouldIgnore=function(){return false};var parseLineInfoRegex=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function parseLineInfo(line){var matches=line.match(parseLineInfoRegex);if(matches){return{fileName:matches[1],line:parseInt(matches[2],10)}}}CapturedTrace.setBounds=function(firstLineError,lastLineError){if(!CapturedTrace.isSupported())return;var firstStackLines=firstLineError.stack.split("\n");var lastStackLines=lastLineError.stack.split("\n");var firstIndex=-1;var lastIndex=-1;var firstFileName;var lastFileName;for(var i=0;i<firstStackLines.length;++i){var result=parseLineInfo(firstStackLines[i]);if(result){firstFileName=result.fileName;firstIndex=result.line;break}}for(var i=0;i<lastStackLines.length;++i){var result=parseLineInfo(lastStackLines[i]);if(result){lastFileName=result.fileName;lastIndex=result.line;break}}if(firstIndex<0||lastIndex<0||!firstFileName||!lastFileName||firstFileName!==lastFileName||firstIndex>=lastIndex){return}shouldIgnore=function(line){if(bluebirdFramePattern.test(line))return true;var info=parseLineInfo(line);if(info){if(info.fileName===firstFileName&&(firstIndex<=info.line&&info.line<=lastIndex)){return true}}return false}};var captureStackTrace=function stackDetection(){var v8stackFramePattern=/^\s*at\s*/;var v8stackFormatter=function(stack,error){if(typeof stack==="string")return stack;if(error.name!==undefined&&error.message!==undefined){return error.toString()}return formatNonError(error)};if(typeof Error.stackTraceLimit==="number"&&typeof Error.captureStackTrace==="function"){Error.stackTraceLimit=Error.stackTraceLimit+6;stackFramePattern=v8stackFramePattern;formatStack=v8stackFormatter;var captureStackTrace=Error.captureStackTrace;shouldIgnore=function(line){return bluebirdFramePattern.test(line)};return function(receiver,ignoreUntil){Error.stackTraceLimit=Error.stackTraceLimit+6;captureStackTrace(receiver,ignoreUntil);Error.stackTraceLimit=Error.stackTraceLimit-6}}var err=new Error;if(typeof err.stack==="string"&&err.stack.split("\n")[0].indexOf("stackDetection@")>=0){stackFramePattern=/@/;formatStack=v8stackFormatter;indentStackFrames=true;return function captureStackTrace(o){o.stack=(new Error).stack}}var hasStackAfterThrow;try{throw new Error}catch(e){hasStackAfterThrow="stack"in e}if(!("stack"in err)&&hasStackAfterThrow){stackFramePattern=v8stackFramePattern;formatStack=v8stackFormatter;return function captureStackTrace(o){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error}catch(e){o.stack=e.stack}Error.stackTraceLimit=Error.stackTraceLimit-6}}formatStack=function(stack,error){if(typeof stack==="string")return stack;if((typeof error==="object"||typeof error==="function")&&error.name!==undefined&&error.message!==undefined){return error.toString()}return formatNonError(error)};return null}([]);var fireDomEvent;var fireGlobalEvent=function(){if(util.isNode){return function(name,reason,promise){if(name==="rejectionHandled"){return process.emit(name,promise)}else{return process.emit(name,reason,promise)}}}else{var customEventWorks=false;var anyEventWorks=true;try{var ev=new self.CustomEvent("test");customEventWorks=ev instanceof CustomEvent}catch(e){}if(!customEventWorks){try{var event=document.createEvent("CustomEvent");event.initCustomEvent("testingtheevent",false,true,{});self.dispatchEvent(event)}catch(e){anyEventWorks=false}}if(anyEventWorks){fireDomEvent=function(type,detail){var event;if(customEventWorks){event=new self.CustomEvent(type,{detail:detail,bubbles:false,cancelable:true})}else if(self.dispatchEvent){event=document.createEvent("CustomEvent");event.initCustomEvent(type,false,true,detail)}return event?!self.dispatchEvent(event):false}}var toWindowMethodNameMap={};toWindowMethodNameMap["unhandledRejection"]=("on"+"unhandledRejection").toLowerCase();toWindowMethodNameMap["rejectionHandled"]=("on"+"rejectionHandled").toLowerCase();return function(name,reason,promise){var methodName=toWindowMethodNameMap[name];var method=self[methodName];if(!method)return false;if(name==="rejectionHandled"){method.call(self,promise)}else{method.call(self,reason,promise)}return true}}}();if(typeof console!=="undefined"&&typeof console.warn!=="undefined"){warn=function(message){console.warn(message)};if(util.isNode&&process.stderr.isTTY){warn=function(message){process.stderr.write("[31m"+message+"[39m\n")}}else if(!util.isNode&&typeof(new Error).stack==="string"){warn=function(message){console.warn("%c"+message,"color: red")}}}return CapturedTrace}},{"./async.js":2,"./util.js":38}],8:[function(_dereq_,module,exports){"use strict";module.exports=function(NEXT_FILTER){var util=_dereq_("./util.js");var errors=_dereq_("./errors.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;var keys=_dereq_("./es5.js").keys;var TypeError=errors.TypeError;function CatchFilter(instances,callback,promise){this._instances=instances;this._callback=callback;this._promise=promise}function safePredicate(predicate,e){var safeObject={};var retfilter=tryCatch(predicate).call(safeObject,e);if(retfilter===errorObj)return retfilter;var safeKeys=keys(safeObject);if(safeKeys.length){errorObj.e=new TypeError("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n");return errorObj}return retfilter}CatchFilter.prototype.doFilter=function(e){var cb=this._callback;var promise=this._promise;var boundTo=promise._boundTo;for(var i=0,len=this._instances.length;i<len;++i){var item=this._instances[i];var itemIsErrorType=item===Error||item!=null&&item.prototype instanceof Error;if(itemIsErrorType&&e instanceof item){var ret=tryCatch(cb).call(boundTo,e);if(ret===errorObj){NEXT_FILTER.e=ret.e;return NEXT_FILTER}return ret}else if(typeof item==="function"&&!itemIsErrorType){var shouldHandle=safePredicate(item,e);if(shouldHandle===errorObj){e=errorObj.e;break}else if(shouldHandle){var ret=tryCatch(cb).call(boundTo,e);if(ret===errorObj){NEXT_FILTER.e=ret.e;return NEXT_FILTER}return ret}}}NEXT_FILTER.e=e;return NEXT_FILTER};return CatchFilter}},{"./errors.js":13,"./es5.js":14,"./util.js":38}],9:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,CapturedTrace,isDebugging){var contextStack=[];function Context(){this._trace=new CapturedTrace(peekContext())}Context.prototype._pushContext=function(){if(!isDebugging())return;if(this._trace!==undefined){contextStack.push(this._trace)}};Context.prototype._popContext=function(){if(!isDebugging())return;if(this._trace!==undefined){contextStack.pop()}};function createContext(){if(isDebugging())return new Context}function peekContext(){var lastIndex=contextStack.length-1;if(lastIndex>=0){return contextStack[lastIndex]}return undefined}Promise.prototype._peekContext=peekContext;Promise.prototype._pushContext=Context.prototype._pushContext;Promise.prototype._popContext=Context.prototype._popContext;return createContext}},{}],10:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,CapturedTrace){var getDomain=Promise._getDomain;var async=_dereq_("./async.js");var Warning=_dereq_("./errors.js").Warning;var util=_dereq_("./util.js");var canAttachTrace=util.canAttachTrace;var unhandledRejectionHandled;var possiblyUnhandledRejection;var debugging=false||util.isNode&&(!!process.env["BLUEBIRD_DEBUG"]||process.env["NODE_ENV"]==="development");if(debugging){async.disableTrampolineIfNecessary()}Promise.prototype._ignoreRejections=function(){this._unsetRejectionIsUnhandled();this._bitField=this._bitField|16777216};Promise.prototype._ensurePossibleRejectionHandled=function(){if((this._bitField&16777216)!==0)return;this._setRejectionIsUnhandled();async.invokeLater(this._notifyUnhandledRejection,this,undefined)};Promise.prototype._notifyUnhandledRejectionIsHandled=function(){CapturedTrace.fireRejectionEvent("rejectionHandled",unhandledRejectionHandled,undefined,this)};Promise.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var reason=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified();CapturedTrace.fireRejectionEvent("unhandledRejection",possiblyUnhandledRejection,reason,this)}};Promise.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=this._bitField|524288};Promise.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=this._bitField&~524288};Promise.prototype._isUnhandledRejectionNotified=function(){return(this._bitField&524288)>0};Promise.prototype._setRejectionIsUnhandled=function(){this._bitField=this._bitField|2097152};Promise.prototype._unsetRejectionIsUnhandled=function(){this._bitField=this._bitField&~2097152;if(this._isUnhandledRejectionNotified()){this._unsetUnhandledRejectionIsNotified();this._notifyUnhandledRejectionIsHandled()}};Promise.prototype._isRejectionUnhandled=function(){return(this._bitField&2097152)>0};Promise.prototype._setCarriedStackTrace=function(capturedTrace){this._bitField=this._bitField|1048576;this._fulfillmentHandler0=capturedTrace};Promise.prototype._isCarryingStackTrace=function(){return(this._bitField&1048576)>0};Promise.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:undefined};Promise.prototype._captureStackTrace=function(){if(debugging){this._trace=new CapturedTrace(this._peekContext())}return this};Promise.prototype._attachExtraTrace=function(error,ignoreSelf){if(debugging&&canAttachTrace(error)){var trace=this._trace;if(trace!==undefined){if(ignoreSelf)trace=trace._parent}if(trace!==undefined){trace.attachExtraTrace(error)}else if(!error.__stackCleaned__){var parsed=CapturedTrace.parseStackAndMessage(error);util.notEnumerableProp(error,"stack",parsed.message+"\n"+parsed.stack.join("\n"));util.notEnumerableProp(error,"__stackCleaned__",true)}}};Promise.prototype._warn=function(message){var warning=new Warning(message);var ctx=this._peekContext();if(ctx){ctx.attachExtraTrace(warning)}else{var parsed=CapturedTrace.parseStackAndMessage(warning);warning.stack=parsed.message+"\n"+parsed.stack.join("\n")}CapturedTrace.formatAndLogError(warning,"")};Promise.onPossiblyUnhandledRejection=function(fn){var domain=getDomain();possiblyUnhandledRejection=typeof fn==="function"?domain===null?fn:domain.bind(fn):undefined};Promise.onUnhandledRejectionHandled=function(fn){var domain=getDomain();unhandledRejectionHandled=typeof fn==="function"?domain===null?fn:domain.bind(fn):undefined};Promise.longStackTraces=function(){if(async.haveItemsQueued()&&debugging===false){throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n")}debugging=CapturedTrace.isSupported();if(debugging){async.disableTrampolineIfNecessary()}};Promise.hasLongStackTraces=function(){return debugging&&CapturedTrace.isSupported()};if(!CapturedTrace.isSupported()){Promise.longStackTraces=function(){};debugging=false}return function(){return debugging}}},{"./async.js":2,"./errors.js":13,"./util.js":38}],11:[function(_dereq_,module,exports){"use strict";var util=_dereq_("./util.js");var isPrimitive=util.isPrimitive;module.exports=function(Promise){var returner=function(){return this};var thrower=function(){throw this};var returnUndefined=function(){};var throwUndefined=function(){throw undefined};var wrapper=function(value,action){if(action===1){return function(){throw value}}else if(action===2){return function(){return value}}};Promise.prototype["return"]=Promise.prototype.thenReturn=function(value){if(value===undefined)return this.then(returnUndefined);if(isPrimitive(value)){return this._then(wrapper(value,2),undefined,undefined,undefined,undefined)}return this._then(returner,undefined,undefined,value,undefined)};Promise.prototype["throw"]=Promise.prototype.thenThrow=function(reason){if(reason===undefined)return this.then(throwUndefined);if(isPrimitive(reason)){return this._then(wrapper(reason,1),undefined,undefined,undefined,undefined)}return this._then(thrower,undefined,undefined,reason,undefined)}}},{"./util.js":38}],12:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseReduce=Promise.reduce;Promise.prototype.each=function(fn){return PromiseReduce(this,fn,null,INTERNAL)};Promise.each=function(promises,fn){return PromiseReduce(promises,fn,null,INTERNAL)}}},{}],13:[function(_dereq_,module,exports){"use strict";var es5=_dereq_("./es5.js");var Objectfreeze=es5.freeze;var util=_dereq_("./util.js");var inherits=util.inherits;var notEnumerableProp=util.notEnumerableProp;function subError(nameProperty,defaultMessage){function SubError(message){if(!(this instanceof SubError))return new SubError(message);notEnumerableProp(this,"message",typeof message==="string"?message:defaultMessage);notEnumerableProp(this,"name",nameProperty);if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}else{Error.call(this)}}inherits(SubError,Error);return SubError}var _TypeError,_RangeError;var Warning=subError("Warning","warning");var CancellationError=subError("CancellationError","cancellation error");var TimeoutError=subError("TimeoutError","timeout error");var AggregateError=subError("AggregateError","aggregate error");try{_TypeError=TypeError;_RangeError=RangeError}catch(e){_TypeError=subError("TypeError","type error");_RangeError=subError("RangeError","range error")}var methods=("join pop push shift unshift slice filter forEach some "+"every map indexOf lastIndexOf reduce reduceRight sort reverse").split(" ");for(var i=0;i<methods.length;++i){if(typeof Array.prototype[methods[i]]==="function"){AggregateError.prototype[methods[i]]=Array.prototype[methods[i]]}}es5.defineProperty(AggregateError.prototype,"length",{value:0,configurable:false,writable:true,enumerable:true});AggregateError.prototype["isOperational"]=true;var level=0;AggregateError.prototype.toString=function(){var indent=Array(level*4+1).join(" ");var ret="\n"+indent+"AggregateError of:"+"\n";level++;indent=Array(level*4+1).join(" ");for(var i=0;i<this.length;++i){var str=this[i]===this?"[Circular AggregateError]":this[i]+"";var lines=str.split("\n");for(var j=0;j<lines.length;++j){lines[j]=indent+lines[j]}str=lines.join("\n");ret+=str+"\n"}level--;return ret};function OperationalError(message){if(!(this instanceof OperationalError))return new OperationalError(message);notEnumerableProp(this,"name","OperationalError");notEnumerableProp(this,"message",message);this.cause=message;this["isOperational"]=true;if(message instanceof Error){notEnumerableProp(this,"message",message.message);notEnumerableProp(this,"stack",message.stack)}else if(Error.captureStackTrace){Error.captureStackTrace(this,this.constructor)}}inherits(OperationalError,Error);var errorTypes=Error["__BluebirdErrorTypes__"];if(!errorTypes){errorTypes=Objectfreeze({CancellationError:CancellationError,TimeoutError:TimeoutError,OperationalError:OperationalError,RejectionError:OperationalError,AggregateError:AggregateError});notEnumerableProp(Error,"__BluebirdErrorTypes__",errorTypes)}module.exports={Error:Error,TypeError:_TypeError,RangeError:_RangeError,CancellationError:errorTypes.CancellationError,OperationalError:errorTypes.OperationalError,TimeoutError:errorTypes.TimeoutError,AggregateError:errorTypes.AggregateError,Warning:Warning}},{"./es5.js":14,"./util.js":38}],14:[function(_dereq_,module,exports){var isES5=function(){"use strict";return this===undefined}();if(isES5){module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:isES5,propertyIsWritable:function(obj,prop){var descriptor=Object.getOwnPropertyDescriptor(obj,prop);return!!(!descriptor||descriptor.writable||descriptor.set)}}}else{var has={}.hasOwnProperty;var str={}.toString;var proto={}.constructor.prototype;var ObjectKeys=function(o){var ret=[];for(var key in o){if(has.call(o,key)){ret.push(key)}}return ret};var ObjectGetDescriptor=function(o,key){return{value:o[key]}};var ObjectDefineProperty=function(o,key,desc){o[key]=desc.value;return o};var ObjectFreeze=function(obj){return obj};var ObjectGetPrototypeOf=function(obj){try{return Object(obj).constructor.prototype}catch(e){return proto}};var ArrayIsArray=function(obj){try{return str.call(obj)==="[object Array]"}catch(e){return false}};module.exports={isArray:ArrayIsArray,keys:ObjectKeys,names:ObjectKeys,defineProperty:ObjectDefineProperty,getDescriptor:ObjectGetDescriptor,freeze:ObjectFreeze,getPrototypeOf:ObjectGetPrototypeOf,isES5:isES5,propertyIsWritable:function(){return true}}}},{}],15:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseMap=Promise.map;Promise.prototype.filter=function(fn,options){return PromiseMap(this,fn,options,INTERNAL)};Promise.filter=function(promises,fn,options){return PromiseMap(promises,fn,options,INTERNAL)}}},{}],16:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,NEXT_FILTER,tryConvertToPromise){var util=_dereq_("./util.js");var isPrimitive=util.isPrimitive;var thrower=util.thrower;function returnThis(){return this}function throwThis(){throw this}function return$(r){return function(){return r}}function throw$(r){return function(){throw r}}function promisedFinally(ret,reasonOrValue,isFulfilled){var then;if(isPrimitive(reasonOrValue)){then=isFulfilled?return$(reasonOrValue):throw$(reasonOrValue)}else{then=isFulfilled?returnThis:throwThis}return ret._then(then,thrower,undefined,reasonOrValue,undefined)}function finallyHandler(reasonOrValue){var promise=this.promise;var handler=this.handler;var ret=promise._isBound()?handler.call(promise._boundTo):handler();if(ret!==undefined){var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();return promisedFinally(maybePromise,reasonOrValue,promise.isFulfilled())}}if(promise.isRejected()){NEXT_FILTER.e=reasonOrValue;return NEXT_FILTER}else{return reasonOrValue}}function tapHandler(value){var promise=this.promise;var handler=this.handler;var ret=promise._isBound()?handler.call(promise._boundTo,value):handler(value);if(ret!==undefined){var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();return promisedFinally(maybePromise,value,true)}}return value}Promise.prototype._passThroughHandler=function(handler,isFinally){if(typeof handler!=="function")return this.then();var promiseAndHandler={promise:this,handler:handler};return this._then(isFinally?finallyHandler:tapHandler,isFinally?finallyHandler:undefined,undefined,promiseAndHandler,undefined)};Promise.prototype.lastly=Promise.prototype["finally"]=function(handler){return this._passThroughHandler(handler,true)};Promise.prototype.tap=function(handler){return this._passThroughHandler(handler,false)}}},{"./util.js":38}],17:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,INTERNAL,tryConvertToPromise){var errors=_dereq_("./errors.js");var TypeError=errors.TypeError;var util=_dereq_("./util.js");var errorObj=util.errorObj;var tryCatch=util.tryCatch;var yieldHandlers=[];function promiseFromYieldHandler(value,yieldHandlers,traceParent){for(var i=0;i<yieldHandlers.length;++i){traceParent._pushContext();var result=tryCatch(yieldHandlers[i])(value);traceParent._popContext();if(result===errorObj){traceParent._pushContext();var ret=Promise.reject(errorObj.e);traceParent._popContext();return ret}var maybePromise=tryConvertToPromise(result,traceParent);if(maybePromise instanceof Promise)return maybePromise}return null}function PromiseSpawn(generatorFunction,receiver,yieldHandler,stack){var promise=this._promise=new Promise(INTERNAL);promise._captureStackTrace();this._stack=stack;this._generatorFunction=generatorFunction;this._receiver=receiver;this._generator=undefined;this._yieldHandlers=typeof yieldHandler==="function"?[yieldHandler].concat(yieldHandlers):yieldHandlers}PromiseSpawn.prototype.promise=function(){return this._promise};PromiseSpawn.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver);this._receiver=this._generatorFunction=undefined;this._next(undefined)};PromiseSpawn.prototype._continue=function(result){if(result===errorObj){return this._promise._rejectCallback(result.e,false,true)}var value=result.value;if(result.done===true){this._promise._resolveCallback(value)}else{var maybePromise=tryConvertToPromise(value,this._promise);if(!(maybePromise instanceof Promise)){maybePromise=promiseFromYieldHandler(maybePromise,this._yieldHandlers,this._promise);if(maybePromise===null){this._throw(new TypeError("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",value)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));return}}maybePromise._then(this._next,this._throw,undefined,this,null)}};PromiseSpawn.prototype._throw=function(reason){this._promise._attachExtraTrace(reason);this._promise._pushContext();var result=tryCatch(this._generator["throw"]).call(this._generator,reason);this._promise._popContext();this._continue(result)};PromiseSpawn.prototype._next=function(value){this._promise._pushContext();var result=tryCatch(this._generator.next).call(this._generator,value);this._promise._popContext();this._continue(result)};Promise.coroutine=function(generatorFunction,options){if(typeof generatorFunction!=="function"){throw new TypeError("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n")}var yieldHandler=Object(options).yieldHandler;var PromiseSpawn$=PromiseSpawn;var stack=(new Error).stack;return function(){var generator=generatorFunction.apply(this,arguments);var spawn=new PromiseSpawn$(undefined,undefined,yieldHandler,stack);spawn._generator=generator;spawn._next(undefined);return spawn.promise()}};Promise.coroutine.addYieldHandler=function(fn){if(typeof fn!=="function")throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");yieldHandlers.push(fn)};Promise.spawn=function(generatorFunction){if(typeof generatorFunction!=="function"){return apiRejection("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n")}var spawn=new PromiseSpawn(generatorFunction,this);var ret=spawn.promise();spawn._run(Promise.spawn);return ret}}},{"./errors.js":13,"./util.js":38}],18:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,INTERNAL){var util=_dereq_("./util.js");var canEvaluate=util.canEvaluate;var tryCatch=util.tryCatch;var errorObj=util.errorObj;var reject;if(!true){if(canEvaluate){var thenCallback=function(i){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,i))};var caller=function(count){var values=[];for(var i=1;i<=count;++i)values.push("holder.p"+i);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,values.join(", ")))};var thenCallbacks=[];var callers=[undefined];for(var i=1;i<=5;++i){thenCallbacks.push(thenCallback(i));callers.push(caller(i))}var Holder=function(total,fn){this.p1=this.p2=this.p3=this.p4=this.p5=null;this.fn=fn;this.total=total;this.now=0};Holder.prototype.callers=callers;Holder.prototype.checkFulfillment=function(promise){var now=this.now;now++;var total=this.total;if(now>=total){var handler=this.callers[total];promise._pushContext();var ret=tryCatch(handler)(this);promise._popContext();if(ret===errorObj){promise._rejectCallback(ret.e,false,true)}else{promise._resolveCallback(ret)}}else{this.now=now}};var reject=function(reason){this._reject(reason)}}}Promise.join=function(){var last=arguments.length-1;var fn;if(last>0&&typeof arguments[last]==="function"){fn=arguments[last];if(!true){if(last<6&&canEvaluate){var ret=new Promise(INTERNAL);ret._captureStackTrace();var holder=new Holder(last,fn);var callbacks=thenCallbacks;for(var i=0;i<last;++i){var maybePromise=tryConvertToPromise(arguments[i],ret);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();if(maybePromise._isPending()){maybePromise._then(callbacks[i],reject,undefined,ret,holder)}else if(maybePromise._isFulfilled()){callbacks[i].call(ret,maybePromise._value(),holder)}else{ret._reject(maybePromise._reason())}}else{callbacks[i].call(ret,maybePromise,holder)}}return ret}}}var $_len=arguments.length;var args=new Array($_len);for(var $_i=0;$_i<$_len;++$_i){args[$_i]=arguments[$_i]}if(fn)args.pop();var ret=new PromiseArray(args).promise();return fn!==undefined?ret.spread(fn):ret}}},{"./util.js":38}],19:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL){var async=_dereq_("./async.js");var util=_dereq_("./util.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;var PENDING={};var EMPTY_ARRAY=[];function MappingPromiseArray(promises,fn,limit,_filter){this.constructor$(promises);this._promise._captureStackTrace();this._callback=fn;this._preservedValues=_filter===INTERNAL?new Array(this.length()):null;this._limit=limit;this._inFlight=0;this._queue=limit>=1?[]:EMPTY_ARRAY;async.invoke(init,this,undefined)}util.inherits(MappingPromiseArray,PromiseArray);function init(){this._init$(undefined,-2)}MappingPromiseArray.prototype._init=function(){};MappingPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values;var length=this.length();var preservedValues=this._preservedValues;var limit=this._limit;if(values[index]===PENDING){values[index]=value;if(limit>=1){this._inFlight--;this._drainQueue();if(this._isResolved())return}}else{if(limit>=1&&this._inFlight>=limit){values[index]=value;this._queue.push(index);return}if(preservedValues!==null)preservedValues[index]=value;var callback=this._callback;var receiver=this._promise._boundTo;this._promise._pushContext();var ret=tryCatch(callback).call(receiver,value,index,length);this._promise._popContext();if(ret===errorObj)return this._reject(ret.e);var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();if(maybePromise._isPending()){if(limit>=1)this._inFlight++;values[index]=PENDING;return maybePromise._proxyPromiseArray(this,index)}else if(maybePromise._isFulfilled()){ret=maybePromise._value()}else{return this._reject(maybePromise._reason())}}values[index]=ret}var totalResolved=++this._totalResolved;if(totalResolved>=length){if(preservedValues!==null){this._filter(values,preservedValues)}else{this._resolve(values)}}};MappingPromiseArray.prototype._drainQueue=function(){var queue=this._queue;var limit=this._limit;var values=this._values;while(queue.length>0&&this._inFlight<limit){if(this._isResolved())return;var index=queue.pop();this._promiseFulfilled(values[index],index)}};MappingPromiseArray.prototype._filter=function(booleans,values){var len=values.length;var ret=new Array(len);var j=0;for(var i=0;i<len;++i){if(booleans[i])ret[j++]=values[i]}ret.length=j;this._resolve(ret)};MappingPromiseArray.prototype.preservedValues=function(){return this._preservedValues};function map(promises,fn,options,_filter){var limit=typeof options==="object"&&options!==null?options.concurrency:0;limit=typeof limit==="number"&&isFinite(limit)&&limit>=1?limit:0;return new MappingPromiseArray(promises,fn,limit,_filter)}Promise.prototype.map=function(fn,options){if(typeof fn!=="function")return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return map(this,fn,options,null).promise()};Promise.map=function(promises,fn,options,_filter){if(typeof fn!=="function")return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return map(promises,fn,options,_filter).promise()}}},{"./async.js":2,"./util.js":38}],20:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){var util=_dereq_("./util.js");var tryCatch=util.tryCatch;Promise.method=function(fn){if(typeof fn!=="function"){throw new Promise.TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n")}return function(){var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._pushContext();var value=tryCatch(fn).apply(this,arguments);ret._popContext();ret._resolveFromSyncValue(value);return ret}};Promise.attempt=Promise["try"]=function(fn,args,ctx){if(typeof fn!=="function"){return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n")}var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._pushContext();var value=util.isArray(args)?tryCatch(fn).apply(ctx,args):tryCatch(fn).call(ctx,args);ret._popContext();ret._resolveFromSyncValue(value);return ret};Promise.prototype._resolveFromSyncValue=function(value){if(value===util.errorObj){this._rejectCallback(value.e,false,true)}else{this._resolveCallback(value,true)}}}},{"./util.js":38}],21:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var util=_dereq_("./util.js");var async=_dereq_("./async.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;function spreadAdapter(val,nodeback){var promise=this;if(!util.isArray(val))return successAdapter.call(promise,val,nodeback);var ret=tryCatch(nodeback).apply(promise._boundTo,[null].concat(val));if(ret===errorObj){async.throwLater(ret.e)}}function successAdapter(val,nodeback){var promise=this;var receiver=promise._boundTo;var ret=val===undefined?tryCatch(nodeback).call(receiver,null):tryCatch(nodeback).call(receiver,null,val);if(ret===errorObj){async.throwLater(ret.e)}}function errorAdapter(reason,nodeback){var promise=this;if(!reason){var target=promise._target();var newReason=target._getCarriedStackTrace();newReason.cause=reason;reason=newReason}var ret=tryCatch(nodeback).call(promise._boundTo,reason);if(ret===errorObj){async.throwLater(ret.e)}}Promise.prototype.asCallback=Promise.prototype.nodeify=function(nodeback,options){if(typeof nodeback=="function"){var adapter=successAdapter;if(options!==undefined&&Object(options).spread){adapter=spreadAdapter}this._then(adapter,errorAdapter,undefined,this,nodeback)}return this}}},{"./async.js":2,"./util.js":38}],22:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray){var util=_dereq_("./util.js");var async=_dereq_("./async.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;Promise.prototype.progressed=function(handler){return this._then(undefined,undefined,handler,undefined,undefined)};Promise.prototype._progress=function(progressValue){
if(this._isFollowingOrFulfilledOrRejected())return;this._target()._progressUnchecked(progressValue)};Promise.prototype._progressHandlerAt=function(index){return index===0?this._progressHandler0:this[(index<<2)+index-5+2]};Promise.prototype._doProgressWith=function(progression){var progressValue=progression.value;var handler=progression.handler;var promise=progression.promise;var receiver=progression.receiver;var ret=tryCatch(handler).call(receiver,progressValue);if(ret===errorObj){if(ret.e!=null&&ret.e.name!=="StopProgressPropagation"){var trace=util.canAttachTrace(ret.e)?ret.e:new Error(util.toString(ret.e));promise._attachExtraTrace(trace);promise._progress(ret.e)}}else if(ret instanceof Promise){ret._then(promise._progress,null,null,promise,undefined)}else{promise._progress(ret)}};Promise.prototype._progressUnchecked=function(progressValue){var len=this._length();var progress=this._progress;for(var i=0;i<len;i++){var handler=this._progressHandlerAt(i);var promise=this._promiseAt(i);if(!(promise instanceof Promise)){var receiver=this._receiverAt(i);if(typeof handler==="function"){handler.call(receiver,progressValue,promise)}else if(receiver instanceof PromiseArray&&!receiver._isResolved()){receiver._promiseProgressed(progressValue,promise)}continue}if(typeof handler==="function"){async.invoke(this._doProgressWith,this,{handler:handler,promise:promise,receiver:this._receiverAt(i),value:progressValue})}else{async.invoke(progress,promise,progressValue)}}}}},{"./async.js":2,"./util.js":38}],23:[function(_dereq_,module,exports){"use strict";module.exports=function(){var makeSelfResolutionError=function(){return new TypeError("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")};var reflect=function(){return new Promise.PromiseInspection(this._target())};var apiRejection=function(msg){return Promise.reject(new TypeError(msg))};var util=_dereq_("./util.js");var getDomain;if(util.isNode){getDomain=function(){var ret=process.domain;if(ret===undefined)ret=null;return ret}}else{getDomain=function(){return null}}util.notEnumerableProp(Promise,"_getDomain",getDomain);var async=_dereq_("./async.js");var errors=_dereq_("./errors.js");var TypeError=Promise.TypeError=errors.TypeError;Promise.RangeError=errors.RangeError;Promise.CancellationError=errors.CancellationError;Promise.TimeoutError=errors.TimeoutError;Promise.OperationalError=errors.OperationalError;Promise.RejectionError=errors.OperationalError;Promise.AggregateError=errors.AggregateError;var INTERNAL=function(){};var APPLY={};var NEXT_FILTER={e:null};var tryConvertToPromise=_dereq_("./thenables.js")(Promise,INTERNAL);var PromiseArray=_dereq_("./promise_array.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection);var CapturedTrace=_dereq_("./captured_trace.js")();var isDebugging=_dereq_("./debuggability.js")(Promise,CapturedTrace);var createContext=_dereq_("./context.js")(Promise,CapturedTrace,isDebugging);var CatchFilter=_dereq_("./catch_filter.js")(NEXT_FILTER);var PromiseResolver=_dereq_("./promise_resolver.js");var nodebackForPromise=PromiseResolver._nodebackForPromise;var errorObj=util.errorObj;var tryCatch=util.tryCatch;function Promise(resolver){if(typeof resolver!=="function"){throw new TypeError("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n")}if(this.constructor!==Promise){throw new TypeError("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n")}this._bitField=0;this._fulfillmentHandler0=undefined;this._rejectionHandler0=undefined;this._progressHandler0=undefined;this._promise0=undefined;this._receiver0=undefined;this._settledValue=undefined;if(resolver!==INTERNAL)this._resolveFromResolver(resolver)}Promise.prototype.toString=function(){return"[object Promise]"};Promise.prototype.caught=Promise.prototype["catch"]=function(fn){var len=arguments.length;if(len>1){var catchInstances=new Array(len-1),j=0,i;for(i=0;i<len-1;++i){var item=arguments[i];if(typeof item==="function"){catchInstances[j++]=item}else{return Promise.reject(new TypeError("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"))}}catchInstances.length=j;fn=arguments[i];var catchFilter=new CatchFilter(catchInstances,fn,this);return this._then(undefined,catchFilter.doFilter,undefined,catchFilter,undefined)}return this._then(undefined,fn,undefined,undefined,undefined)};Promise.prototype.reflect=function(){return this._then(reflect,reflect,undefined,this,undefined)};Promise.prototype.then=function(didFulfill,didReject,didProgress){if(isDebugging()&&arguments.length>0&&typeof didFulfill!=="function"&&typeof didReject!=="function"){var msg=".then() only accepts functions but was passed: "+util.classString(didFulfill);if(arguments.length>1){msg+=", "+util.classString(didReject)}this._warn(msg)}return this._then(didFulfill,didReject,didProgress,undefined,undefined)};Promise.prototype.done=function(didFulfill,didReject,didProgress){var promise=this._then(didFulfill,didReject,didProgress,undefined,undefined);promise._setIsFinal()};Promise.prototype.spread=function(didFulfill,didReject){return this.all()._then(didFulfill,didReject,undefined,APPLY,undefined)};Promise.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()};Promise.prototype.toJSON=function(){var ret={isFulfilled:false,isRejected:false,fulfillmentValue:undefined,rejectionReason:undefined};if(this.isFulfilled()){ret.fulfillmentValue=this.value();ret.isFulfilled=true}else if(this.isRejected()){ret.rejectionReason=this.reason();ret.isRejected=true}return ret};Promise.prototype.all=function(){return new PromiseArray(this).promise()};Promise.prototype.error=function(fn){return this.caught(util.originatesFromRejection,fn)};Promise.is=function(val){return val instanceof Promise};Promise.fromNode=function(fn){var ret=new Promise(INTERNAL);var result=tryCatch(fn)(nodebackForPromise(ret));if(result===errorObj){ret._rejectCallback(result.e,true,true)}return ret};Promise.all=function(promises){return new PromiseArray(promises).promise()};Promise.defer=Promise.pending=function(){var promise=new Promise(INTERNAL);return new PromiseResolver(promise)};Promise.cast=function(obj){var ret=tryConvertToPromise(obj);if(!(ret instanceof Promise)){var val=ret;ret=new Promise(INTERNAL);ret._fulfillUnchecked(val)}return ret};Promise.resolve=Promise.fulfilled=Promise.cast;Promise.reject=Promise.rejected=function(reason){var ret=new Promise(INTERNAL);ret._captureStackTrace();ret._rejectCallback(reason,true);return ret};Promise.setScheduler=function(fn){if(typeof fn!=="function")throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var prev=async._schedule;async._schedule=fn;return prev};Promise.prototype._then=function(didFulfill,didReject,didProgress,receiver,internalData){var haveInternalData=internalData!==undefined;var ret=haveInternalData?internalData:new Promise(INTERNAL);if(!haveInternalData){ret._propagateFrom(this,4|1);ret._captureStackTrace()}var target=this._target();if(target!==this){if(receiver===undefined)receiver=this._boundTo;if(!haveInternalData)ret._setIsMigrated()}var callbackIndex=target._addCallbacks(didFulfill,didReject,didProgress,ret,receiver,getDomain());if(target._isResolved()&&!target._isSettlePromisesQueued()){async.invoke(target._settlePromiseAtPostResolution,target,callbackIndex)}return ret};Promise.prototype._settlePromiseAtPostResolution=function(index){if(this._isRejectionUnhandled())this._unsetRejectionIsUnhandled();this._settlePromiseAt(index)};Promise.prototype._length=function(){return this._bitField&131071};Promise.prototype._isFollowingOrFulfilledOrRejected=function(){return(this._bitField&939524096)>0};Promise.prototype._isFollowing=function(){return(this._bitField&536870912)===536870912};Promise.prototype._setLength=function(len){this._bitField=this._bitField&-131072|len&131071};Promise.prototype._setFulfilled=function(){this._bitField=this._bitField|268435456};Promise.prototype._setRejected=function(){this._bitField=this._bitField|134217728};Promise.prototype._setFollowing=function(){this._bitField=this._bitField|536870912};Promise.prototype._setIsFinal=function(){this._bitField=this._bitField|33554432};Promise.prototype._isFinal=function(){return(this._bitField&33554432)>0};Promise.prototype._cancellable=function(){return(this._bitField&67108864)>0};Promise.prototype._setCancellable=function(){this._bitField=this._bitField|67108864};Promise.prototype._unsetCancellable=function(){this._bitField=this._bitField&~67108864};Promise.prototype._setIsMigrated=function(){this._bitField=this._bitField|4194304};Promise.prototype._unsetIsMigrated=function(){this._bitField=this._bitField&~4194304};Promise.prototype._isMigrated=function(){return(this._bitField&4194304)>0};Promise.prototype._receiverAt=function(index){var ret=index===0?this._receiver0:this[index*5-5+4];if(ret===undefined&&this._isBound()){return this._boundTo}return ret};Promise.prototype._promiseAt=function(index){return index===0?this._promise0:this[index*5-5+3]};Promise.prototype._fulfillmentHandlerAt=function(index){return index===0?this._fulfillmentHandler0:this[index*5-5+0]};Promise.prototype._rejectionHandlerAt=function(index){return index===0?this._rejectionHandler0:this[index*5-5+1]};Promise.prototype._migrateCallbacks=function(follower,index){var fulfill=follower._fulfillmentHandlerAt(index);var reject=follower._rejectionHandlerAt(index);var progress=follower._progressHandlerAt(index);var promise=follower._promiseAt(index);var receiver=follower._receiverAt(index);if(promise instanceof Promise)promise._setIsMigrated();this._addCallbacks(fulfill,reject,progress,promise,receiver,null)};Promise.prototype._addCallbacks=function(fulfill,reject,progress,promise,receiver,domain){var index=this._length();if(index>=131071-5){index=0;this._setLength(0)}if(index===0){this._promise0=promise;if(receiver!==undefined)this._receiver0=receiver;if(typeof fulfill==="function"&&!this._isCarryingStackTrace()){this._fulfillmentHandler0=domain===null?fulfill:domain.bind(fulfill)}if(typeof reject==="function"){this._rejectionHandler0=domain===null?reject:domain.bind(reject)}if(typeof progress==="function"){this._progressHandler0=domain===null?progress:domain.bind(progress)}}else{var base=index*5-5;this[base+3]=promise;this[base+4]=receiver;if(typeof fulfill==="function"){this[base+0]=domain===null?fulfill:domain.bind(fulfill)}if(typeof reject==="function"){this[base+1]=domain===null?reject:domain.bind(reject)}if(typeof progress==="function"){this[base+2]=domain===null?progress:domain.bind(progress)}}this._setLength(index+1);return index};Promise.prototype._setProxyHandlers=function(receiver,promiseSlotValue){var index=this._length();if(index>=131071-5){index=0;this._setLength(0)}if(index===0){this._promise0=promiseSlotValue;this._receiver0=receiver}else{var base=index*5-5;this[base+3]=promiseSlotValue;this[base+4]=receiver}this._setLength(index+1)};Promise.prototype._proxyPromiseArray=function(promiseArray,index){this._setProxyHandlers(promiseArray,index)};Promise.prototype._resolveCallback=function(value,shouldBind){if(this._isFollowingOrFulfilledOrRejected())return;if(value===this)return this._rejectCallback(makeSelfResolutionError(),false,true);var maybePromise=tryConvertToPromise(value,this);if(!(maybePromise instanceof Promise))return this._fulfill(value);var propagationFlags=1|(shouldBind?4:0);this._propagateFrom(maybePromise,propagationFlags);var promise=maybePromise._target();if(promise._isPending()){var len=this._length();for(var i=0;i<len;++i){promise._migrateCallbacks(this,i)}this._setFollowing();this._setLength(0);this._setFollowee(promise)}else if(promise._isFulfilled()){this._fulfillUnchecked(promise._value())}else{this._rejectUnchecked(promise._reason(),promise._getCarriedStackTrace())}};Promise.prototype._rejectCallback=function(reason,synchronous,shouldNotMarkOriginatingFromRejection){if(!shouldNotMarkOriginatingFromRejection){util.markAsOriginatingFromRejection(reason)}var trace=util.ensureErrorObject(reason);var hasStack=trace===reason;this._attachExtraTrace(trace,synchronous?hasStack:false);this._reject(reason,hasStack?undefined:trace)};Promise.prototype._resolveFromResolver=function(resolver){var promise=this;this._captureStackTrace();this._pushContext();var synchronous=true;var r=tryCatch(resolver)(function(value){if(promise===null)return;promise._resolveCallback(value);promise=null},function(reason){if(promise===null)return;promise._rejectCallback(reason,synchronous);promise=null});synchronous=false;this._popContext();if(r!==undefined&&r===errorObj&&promise!==null){promise._rejectCallback(r.e,true,true);promise=null}};Promise.prototype._settlePromiseFromHandler=function(handler,receiver,value,promise){if(promise._isRejected())return;promise._pushContext();var x;if(receiver===APPLY&&!this._isRejected()){x=tryCatch(handler).apply(this._boundTo,value)}else{x=tryCatch(handler).call(receiver,value)}promise._popContext();if(x===errorObj||x===promise||x===NEXT_FILTER){var err=x===promise?makeSelfResolutionError():x.e;promise._rejectCallback(err,false,true)}else{promise._resolveCallback(x)}};Promise.prototype._target=function(){var ret=this;while(ret._isFollowing())ret=ret._followee();return ret};Promise.prototype._followee=function(){return this._rejectionHandler0};Promise.prototype._setFollowee=function(promise){this._rejectionHandler0=promise};Promise.prototype._cleanValues=function(){if(this._cancellable()){this._cancellationParent=undefined}};Promise.prototype._propagateFrom=function(parent,flags){if((flags&1)>0&&parent._cancellable()){this._setCancellable();this._cancellationParent=parent}if((flags&4)>0&&parent._isBound()){this._setBoundTo(parent._boundTo)}};Promise.prototype._fulfill=function(value){if(this._isFollowingOrFulfilledOrRejected())return;this._fulfillUnchecked(value)};Promise.prototype._reject=function(reason,carriedStackTrace){if(this._isFollowingOrFulfilledOrRejected())return;this._rejectUnchecked(reason,carriedStackTrace)};Promise.prototype._settlePromiseAt=function(index){var promise=this._promiseAt(index);var isPromise=promise instanceof Promise;if(isPromise&&promise._isMigrated()){promise._unsetIsMigrated();return async.invoke(this._settlePromiseAt,this,index)}var handler=this._isFulfilled()?this._fulfillmentHandlerAt(index):this._rejectionHandlerAt(index);var carriedStackTrace=this._isCarryingStackTrace()?this._getCarriedStackTrace():undefined;var value=this._settledValue;var receiver=this._receiverAt(index);this._clearCallbackDataAtIndex(index);if(typeof handler==="function"){if(!isPromise){handler.call(receiver,value,promise)}else{this._settlePromiseFromHandler(handler,receiver,value,promise)}}else if(receiver instanceof PromiseArray){if(!receiver._isResolved()){if(this._isFulfilled()){receiver._promiseFulfilled(value,promise)}else{receiver._promiseRejected(value,promise)}}}else if(isPromise){if(this._isFulfilled()){promise._fulfill(value)}else{promise._reject(value,carriedStackTrace)}}if(index>=4&&(index&31)===4)async.invokeLater(this._setLength,this,0)};Promise.prototype._clearCallbackDataAtIndex=function(index){if(index===0){if(!this._isCarryingStackTrace()){this._fulfillmentHandler0=undefined}this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=undefined}else{var base=index*5-5;this[base+3]=this[base+4]=this[base+0]=this[base+1]=this[base+2]=undefined}};Promise.prototype._isSettlePromisesQueued=function(){return(this._bitField&-1073741824)===-1073741824};Promise.prototype._setSettlePromisesQueued=function(){this._bitField=this._bitField|-1073741824};Promise.prototype._unsetSettlePromisesQueued=function(){this._bitField=this._bitField&~-1073741824};Promise.prototype._queueSettlePromises=function(){async.settlePromises(this);this._setSettlePromisesQueued()};Promise.prototype._fulfillUnchecked=function(value){if(value===this){var err=makeSelfResolutionError();this._attachExtraTrace(err);return this._rejectUnchecked(err,undefined)}this._setFulfilled();this._settledValue=value;this._cleanValues();if(this._length()>0){this._queueSettlePromises()}};Promise.prototype._rejectUncheckedCheckError=function(reason){var trace=util.ensureErrorObject(reason);this._rejectUnchecked(reason,trace===reason?undefined:trace)};Promise.prototype._rejectUnchecked=function(reason,trace){if(reason===this){var err=makeSelfResolutionError();this._attachExtraTrace(err);return this._rejectUnchecked(err)}this._setRejected();this._settledValue=reason;this._cleanValues();if(this._isFinal()){async.throwLater(function(e){if("stack"in e){async.invokeFirst(CapturedTrace.unhandledRejection,undefined,e)}throw e},trace===undefined?reason:trace);return}if(trace!==undefined&&trace!==reason){this._setCarriedStackTrace(trace)}if(this._length()>0){this._queueSettlePromises()}else{this._ensurePossibleRejectionHandled()}};Promise.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();var len=this._length();for(var i=0;i<len;i++){this._settlePromiseAt(i)}};util.notEnumerableProp(Promise,"_makeSelfResolutionError",makeSelfResolutionError);_dereq_("./progress.js")(Promise,PromiseArray);_dereq_("./method.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection);_dereq_("./bind.js")(Promise,INTERNAL,tryConvertToPromise);_dereq_("./finally.js")(Promise,NEXT_FILTER,tryConvertToPromise);_dereq_("./direct_resolve.js")(Promise);_dereq_("./synchronous_inspection.js")(Promise);_dereq_("./join.js")(Promise,PromiseArray,tryConvertToPromise,INTERNAL);Promise.Promise=Promise;_dereq_("./map.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL);_dereq_("./cancel.js")(Promise);_dereq_("./using.js")(Promise,apiRejection,tryConvertToPromise,createContext);_dereq_("./generators.js")(Promise,apiRejection,INTERNAL,tryConvertToPromise);_dereq_("./nodeify.js")(Promise);_dereq_("./call_get.js")(Promise);_dereq_("./props.js")(Promise,PromiseArray,tryConvertToPromise,apiRejection);_dereq_("./race.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection);_dereq_("./reduce.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL);_dereq_("./settle.js")(Promise,PromiseArray);_dereq_("./some.js")(Promise,PromiseArray,apiRejection);_dereq_("./promisify.js")(Promise,INTERNAL);_dereq_("./any.js")(Promise);_dereq_("./each.js")(Promise,INTERNAL);_dereq_("./timers.js")(Promise,INTERNAL);_dereq_("./filter.js")(Promise,INTERNAL);util.toFastProperties(Promise);util.toFastProperties(Promise.prototype);function fillTypes(value){var p=new Promise(INTERNAL);p._fulfillmentHandler0=value;p._rejectionHandler0=value;p._progressHandler0=value;p._promise0=value;p._receiver0=value;p._settledValue=value}fillTypes({a:1});fillTypes({b:2});fillTypes({c:3});fillTypes(1);fillTypes(function(){});fillTypes(undefined);fillTypes(false);fillTypes(new Promise(INTERNAL));CapturedTrace.setBounds(async.firstLineError,util.lastLineError);return Promise}},{"./any.js":1,"./async.js":2,"./bind.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./context.js":9,"./debuggability.js":10,"./direct_resolve.js":11,"./each.js":12,"./errors.js":13,"./filter.js":15,"./finally.js":16,"./generators.js":17,"./join.js":18,"./map.js":19,"./method.js":20,"./nodeify.js":21,"./progress.js":22,"./promise_array.js":24,"./promise_resolver.js":25,"./promisify.js":26,"./props.js":27,"./race.js":29,"./reduce.js":30,"./settle.js":32,"./some.js":33,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./using.js":37,"./util.js":38}],24:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){var util=_dereq_("./util.js");var isArray=util.isArray;function toResolutionValue(val){switch(val){case-2:return[];case-3:return{}}}function PromiseArray(values){var promise=this._promise=new Promise(INTERNAL);var parent;if(values instanceof Promise){parent=values;promise._propagateFrom(parent,1|4)}this._values=values;this._length=0;this._totalResolved=0;this._init(undefined,-2)}PromiseArray.prototype.length=function(){return this._length};PromiseArray.prototype.promise=function(){return this._promise};PromiseArray.prototype._init=function init(_,resolveValueIfEmpty){var values=tryConvertToPromise(this._values,this._promise);if(values instanceof Promise){values=values._target();this._values=values;if(values._isFulfilled()){values=values._value();if(!isArray(values)){var err=new Promise.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");this.__hardReject__(err);return}}else if(values._isPending()){values._then(init,this._reject,undefined,this,resolveValueIfEmpty);return}else{this._reject(values._reason());return}}else if(!isArray(values)){this._promise._reject(apiRejection("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n")._reason());return}if(values.length===0){if(resolveValueIfEmpty===-5){this._resolveEmptyArray()}else{this._resolve(toResolutionValue(resolveValueIfEmpty))}return}var len=this.getActualLength(values.length);this._length=len;this._values=this.shouldCopyValues()?new Array(len):this._values;var promise=this._promise;for(var i=0;i<len;++i){var isResolved=this._isResolved();var maybePromise=tryConvertToPromise(values[i],promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();if(isResolved){maybePromise._ignoreRejections()}else if(maybePromise._isPending()){maybePromise._proxyPromiseArray(this,i)}else if(maybePromise._isFulfilled()){this._promiseFulfilled(maybePromise._value(),i)}else{this._promiseRejected(maybePromise._reason(),i)}}else if(!isResolved){this._promiseFulfilled(maybePromise,i)}}};PromiseArray.prototype._isResolved=function(){return this._values===null};PromiseArray.prototype._resolve=function(value){this._values=null;this._promise._fulfill(value)};PromiseArray.prototype.__hardReject__=PromiseArray.prototype._reject=function(reason){this._values=null;this._promise._rejectCallback(reason,false,true)};PromiseArray.prototype._promiseProgressed=function(progressValue,index){this._promise._progress({index:index,value:progressValue})};PromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){this._resolve(this._values)}};PromiseArray.prototype._promiseRejected=function(reason,index){this._totalResolved++;this._reject(reason)};PromiseArray.prototype.shouldCopyValues=function(){return true};PromiseArray.prototype.getActualLength=function(len){return len};return PromiseArray}},{"./util.js":38}],25:[function(_dereq_,module,exports){"use strict";var util=_dereq_("./util.js");var maybeWrapAsError=util.maybeWrapAsError;var errors=_dereq_("./errors.js");var TimeoutError=errors.TimeoutError;var OperationalError=errors.OperationalError;var haveGetters=util.haveGetters;var es5=_dereq_("./es5.js");function isUntypedError(obj){return obj instanceof Error&&es5.getPrototypeOf(obj)===Error.prototype}var rErrorKey=/^(?:name|message|stack|cause)$/;function wrapAsOperationalError(obj){var ret;if(isUntypedError(obj)){ret=new OperationalError(obj);ret.name=obj.name;ret.message=obj.message;ret.stack=obj.stack;var keys=es5.keys(obj);for(var i=0;i<keys.length;++i){var key=keys[i];if(!rErrorKey.test(key)){ret[key]=obj[key]}}return ret}util.markAsOriginatingFromRejection(obj);return obj}function nodebackForPromise(promise){return function(err,value){if(promise===null)return;if(err){var wrapped=wrapAsOperationalError(maybeWrapAsError(err));promise._attachExtraTrace(wrapped);promise._reject(wrapped)}else if(arguments.length>2){var $_len=arguments.length;var args=new Array($_len-1);for(var $_i=1;$_i<$_len;++$_i){args[$_i-1]=arguments[$_i]}promise._fulfill(args)}else{promise._fulfill(value)}promise=null}}var PromiseResolver;if(!haveGetters){PromiseResolver=function(promise){this.promise=promise;this.asCallback=nodebackForPromise(promise);this.callback=this.asCallback}}else{PromiseResolver=function(promise){this.promise=promise}}if(haveGetters){var prop={get:function(){return nodebackForPromise(this.promise)}};es5.defineProperty(PromiseResolver.prototype,"asCallback",prop);es5.defineProperty(PromiseResolver.prototype,"callback",prop)}PromiseResolver._nodebackForPromise=nodebackForPromise;PromiseResolver.prototype.toString=function(){return"[object PromiseResolver]"};PromiseResolver.prototype.resolve=PromiseResolver.prototype.fulfill=function(value){if(!(this instanceof PromiseResolver)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n")}this.promise._resolveCallback(value)};PromiseResolver.prototype.reject=function(reason){if(!(this instanceof PromiseResolver)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n")}this.promise._rejectCallback(reason)};PromiseResolver.prototype.progress=function(value){if(!(this instanceof PromiseResolver)){throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n")}this.promise._progress(value)};PromiseResolver.prototype.cancel=function(err){this.promise.cancel(err)};PromiseResolver.prototype.timeout=function(){this.reject(new TimeoutError("timeout"))};PromiseResolver.prototype.isResolved=function(){return this.promise.isResolved()};PromiseResolver.prototype.toJSON=function(){return this.promise.toJSON()};module.exports=PromiseResolver},{"./errors.js":13,"./es5.js":14,"./util.js":38}],26:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var THIS={};var util=_dereq_("./util.js");var nodebackForPromise=_dereq_("./promise_resolver.js")._nodebackForPromise;var withAppended=util.withAppended;var maybeWrapAsError=util.maybeWrapAsError;var canEvaluate=util.canEvaluate;var TypeError=_dereq_("./errors").TypeError;var defaultSuffix="Async";var defaultPromisified={__isPromisified__:true};var noCopyPropsPattern=/^(?:length|name|arguments|caller|callee|prototype|__isPromisified__)$/;var defaultFilter=function(name){return util.isIdentifier(name)&&name.charAt(0)!=="_"&&name!=="constructor"};function propsFilter(key){return!noCopyPropsPattern.test(key)}function isPromisified(fn){try{return fn.__isPromisified__===true}catch(e){return false}}function hasPromisified(obj,key,suffix){var val=util.getDataPropertyOrDefault(obj,key+suffix,defaultPromisified);return val?isPromisified(val):false}function checkValid(ret,suffix,suffixRegexp){for(var i=0;i<ret.length;i+=2){var key=ret[i];if(suffixRegexp.test(key)){var keyWithoutAsyncSuffix=key.replace(suffixRegexp,"");for(var j=0;j<ret.length;j+=2){if(ret[j]===keyWithoutAsyncSuffix){throw new TypeError("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",suffix))}}}}}function promisifiableMethods(obj,suffix,suffixRegexp,filter){var keys=util.inheritedDataKeys(obj);var ret=[];for(var i=0;i<keys.length;++i){var key=keys[i];var value=obj[key];var passesDefaultFilter=filter===defaultFilter?true:defaultFilter(key,value,obj);if(typeof value==="function"&&!util.isNativeFunctionMethod(value)&&!isPromisified(value)&&!hasPromisified(obj,key,suffix)&&filter(key,value,obj,passesDefaultFilter)){ret.push(key,value)}}checkValid(ret,suffix,suffixRegexp);return ret}var escapeIdentRegex=function(str){return str.replace(/([$])/,"\\$")};var makeNodePromisifiedEval;if(!true){var switchCaseArgumentOrder=function(likelyArgumentCount){var ret=[likelyArgumentCount];var min=Math.max(0,likelyArgumentCount-1-3);for(var i=likelyArgumentCount-1;i>=min;--i){ret.push(i)}for(var i=likelyArgumentCount+1;i<=3;++i){ret.push(i)}return ret};var argumentSequence=function(argumentCount){return util.filledRange(argumentCount,"_arg","")};var parameterDeclaration=function(parameterCount){return util.filledRange(Math.max(parameterCount,3),"_arg","")};var parameterCount=function(fn){if(typeof fn.length==="number"){return Math.max(Math.min(fn.length,1023+1),0)}return 0};makeNodePromisifiedEval=function(callback,receiver,originalName,fn){var newParameterCount=Math.max(0,parameterCount(fn)-1);var argumentOrder=switchCaseArgumentOrder(newParameterCount);var shouldProxyThis=typeof callback==="string"||receiver===THIS;function generateCallForArgumentCount(count){var args=argumentSequence(count).join(", ");var comma=count>0?", ":"";var ret;if(shouldProxyThis){ret="ret = callback.call(this, {{args}}, nodeback); break;\n"}else{ret=receiver===undefined?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n"}return ret.replace("{{args}}",args).replace(", ",comma)}function generateArgumentSwitchCase(){var ret="";for(var i=0;i<argumentOrder.length;++i){ret+="case "+argumentOrder[i]+":"+generateCallForArgumentCount(argumentOrder[i])}ret+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = nodeback;                                              \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",shouldProxyThis?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n");return ret}var getFunctionCode=typeof callback==="string"?"this != null ? this['"+callback+"'] : fn":"fn";return new Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL","'use strict';                            \n        var ret = function (Parameters) {                                    \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            var nodeback = nodebackForPromise(promise);                      \n            var ret;                                                         \n            var callback = tryCatch([GetFunctionCode]);                      \n            switch(len) {                                                    \n                [CodeForSwitchCase]                                          \n            }                                                                \n            if (ret === errorObj) {                                          \n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        notEnumerableProp(ret, '__isPromisified__', true);                   \n        return ret;                                                          \n        ".replace("Parameters",parameterDeclaration(newParameterCount)).replace("[CodeForSwitchCase]",generateArgumentSwitchCase()).replace("[GetFunctionCode]",getFunctionCode))(Promise,fn,receiver,withAppended,maybeWrapAsError,nodebackForPromise,util.tryCatch,util.errorObj,util.notEnumerableProp,INTERNAL);
}}function makeNodePromisifiedClosure(callback,receiver,_,fn){var defaultThis=function(){return this}();var method=callback;if(typeof method==="string"){callback=fn}function promisified(){var _receiver=receiver;if(receiver===THIS)_receiver=this;var promise=new Promise(INTERNAL);promise._captureStackTrace();var cb=typeof method==="string"&&this!==defaultThis?this[method]:callback;var fn=nodebackForPromise(promise);try{cb.apply(_receiver,withAppended(arguments,fn))}catch(e){promise._rejectCallback(maybeWrapAsError(e),true,true)}return promise}util.notEnumerableProp(promisified,"__isPromisified__",true);return promisified}var makeNodePromisified=canEvaluate?makeNodePromisifiedEval:makeNodePromisifiedClosure;function promisifyAll(obj,suffix,filter,promisifier){var suffixRegexp=new RegExp(escapeIdentRegex(suffix)+"$");var methods=promisifiableMethods(obj,suffix,suffixRegexp,filter);for(var i=0,len=methods.length;i<len;i+=2){var key=methods[i];var fn=methods[i+1];var promisifiedKey=key+suffix;obj[promisifiedKey]=promisifier===makeNodePromisified?makeNodePromisified(key,THIS,key,fn,suffix):promisifier(fn,function(){return makeNodePromisified(key,THIS,key,fn,suffix)})}util.toFastProperties(obj);return obj}function promisify(callback,receiver){return makeNodePromisified(callback,receiver,undefined,callback)}Promise.promisify=function(fn,receiver){if(typeof fn!=="function"){throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n")}if(isPromisified(fn)){return fn}var ret=promisify(fn,arguments.length<2?THIS:receiver);util.copyDescriptors(fn,ret,propsFilter);return ret};Promise.promisifyAll=function(target,options){if(typeof target!=="function"&&typeof target!=="object"){throw new TypeError("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n")}options=Object(options);var suffix=options.suffix;if(typeof suffix!=="string")suffix=defaultSuffix;var filter=options.filter;if(typeof filter!=="function")filter=defaultFilter;var promisifier=options.promisifier;if(typeof promisifier!=="function")promisifier=makeNodePromisified;if(!util.isIdentifier(suffix)){throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n")}var keys=util.inheritedDataKeys(target);for(var i=0;i<keys.length;++i){var value=target[keys[i]];if(keys[i]!=="constructor"&&util.isClass(value)){promisifyAll(value.prototype,suffix,filter,promisifier);promisifyAll(value,suffix,filter,promisifier)}}return promisifyAll(target,suffix,filter,promisifier)}}},{"./errors":13,"./promise_resolver.js":25,"./util.js":38}],27:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,apiRejection){var util=_dereq_("./util.js");var isObject=util.isObject;var es5=_dereq_("./es5.js");function PropertiesPromiseArray(obj){var keys=es5.keys(obj);var len=keys.length;var values=new Array(len*2);for(var i=0;i<len;++i){var key=keys[i];values[i]=obj[key];values[i+len]=key}this.constructor$(values)}util.inherits(PropertiesPromiseArray,PromiseArray);PropertiesPromiseArray.prototype._init=function(){this._init$(undefined,-3)};PropertiesPromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){var val={};var keyOffset=this.length();for(var i=0,len=this.length();i<len;++i){val[this._values[i+keyOffset]]=this._values[i]}this._resolve(val)}};PropertiesPromiseArray.prototype._promiseProgressed=function(value,index){this._promise._progress({key:this._values[index+this.length()],value:value})};PropertiesPromiseArray.prototype.shouldCopyValues=function(){return false};PropertiesPromiseArray.prototype.getActualLength=function(len){return len>>1};function props(promises){var ret;var castValue=tryConvertToPromise(promises);if(!isObject(castValue)){return apiRejection("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}else if(castValue instanceof Promise){ret=castValue._then(Promise.props,undefined,undefined,undefined,undefined)}else{ret=new PropertiesPromiseArray(castValue).promise()}if(castValue instanceof Promise){ret._propagateFrom(castValue,4)}return ret}Promise.prototype.props=function(){return props(this)};Promise.props=function(promises){return props(promises)}}},{"./es5.js":14,"./util.js":38}],28:[function(_dereq_,module,exports){"use strict";function arrayMove(src,srcIndex,dst,dstIndex,len){for(var j=0;j<len;++j){dst[j+dstIndex]=src[j+srcIndex];src[j+srcIndex]=void 0}}function Queue(capacity){this._capacity=capacity;this._length=0;this._front=0}Queue.prototype._willBeOverCapacity=function(size){return this._capacity<size};Queue.prototype._pushOne=function(arg){var length=this.length();this._checkCapacity(length+1);var i=this._front+length&this._capacity-1;this[i]=arg;this._length=length+1};Queue.prototype._unshiftOne=function(value){var capacity=this._capacity;this._checkCapacity(this.length()+1);var front=this._front;var i=(front-1&capacity-1^capacity)-capacity;this[i]=value;this._front=i;this._length=this.length()+1};Queue.prototype.unshift=function(fn,receiver,arg){this._unshiftOne(arg);this._unshiftOne(receiver);this._unshiftOne(fn)};Queue.prototype.push=function(fn,receiver,arg){var length=this.length()+3;if(this._willBeOverCapacity(length)){this._pushOne(fn);this._pushOne(receiver);this._pushOne(arg);return}var j=this._front+length-3;this._checkCapacity(length);var wrapMask=this._capacity-1;this[j+0&wrapMask]=fn;this[j+1&wrapMask]=receiver;this[j+2&wrapMask]=arg;this._length=length};Queue.prototype.shift=function(){var front=this._front,ret=this[front];this[front]=undefined;this._front=front+1&this._capacity-1;this._length--;return ret};Queue.prototype.length=function(){return this._length};Queue.prototype._checkCapacity=function(size){if(this._capacity<size){this._resizeTo(this._capacity<<1)}};Queue.prototype._resizeTo=function(capacity){var oldCapacity=this._capacity;this._capacity=capacity;var front=this._front;var length=this._length;var moveItemsCount=front+length&oldCapacity-1;arrayMove(this,0,this,oldCapacity,moveItemsCount)};module.exports=Queue},{}],29:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){var isArray=_dereq_("./util.js").isArray;var raceLater=function(promise){return promise.then(function(array){return race(array,promise)})};function race(promises,parent){var maybePromise=tryConvertToPromise(promises);if(maybePromise instanceof Promise){return raceLater(maybePromise)}else if(!isArray(promises)){return apiRejection("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n")}var ret=new Promise(INTERNAL);if(parent!==undefined){ret._propagateFrom(parent,4|1)}var fulfill=ret._fulfill;var reject=ret._reject;for(var i=0,len=promises.length;i<len;++i){var val=promises[i];if(val===undefined&&!(i in promises)){continue}Promise.cast(val)._then(fulfill,reject,undefined,ret,null)}return ret}Promise.race=function(promises){return race(promises,undefined)};Promise.prototype.race=function(){return race(this,undefined)}}},{"./util.js":38}],30:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL){var async=_dereq_("./async.js");var util=_dereq_("./util.js");var tryCatch=util.tryCatch;var errorObj=util.errorObj;function ReductionPromiseArray(promises,fn,accum,_each){this.constructor$(promises);this._promise._captureStackTrace();this._preservedValues=_each===INTERNAL?[]:null;this._zerothIsAccum=accum===undefined;this._gotAccum=false;this._reducingIndex=this._zerothIsAccum?1:0;this._valuesPhase=undefined;var maybePromise=tryConvertToPromise(accum,this._promise);var rejected=false;var isPromise=maybePromise instanceof Promise;if(isPromise){maybePromise=maybePromise._target();if(maybePromise._isPending()){maybePromise._proxyPromiseArray(this,-1)}else if(maybePromise._isFulfilled()){accum=maybePromise._value();this._gotAccum=true}else{this._reject(maybePromise._reason());rejected=true}}if(!(isPromise||this._zerothIsAccum))this._gotAccum=true;this._callback=fn;this._accum=accum;if(!rejected)async.invoke(init,this,undefined)}function init(){this._init$(undefined,-5)}util.inherits(ReductionPromiseArray,PromiseArray);ReductionPromiseArray.prototype._init=function(){};ReductionPromiseArray.prototype._resolveEmptyArray=function(){if(this._gotAccum||this._zerothIsAccum){this._resolve(this._preservedValues!==null?[]:this._accum)}};ReductionPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values;values[index]=value;var length=this.length();var preservedValues=this._preservedValues;var isEach=preservedValues!==null;var gotAccum=this._gotAccum;var valuesPhase=this._valuesPhase;var valuesPhaseIndex;if(!valuesPhase){valuesPhase=this._valuesPhase=new Array(length);for(valuesPhaseIndex=0;valuesPhaseIndex<length;++valuesPhaseIndex){valuesPhase[valuesPhaseIndex]=0}}valuesPhaseIndex=valuesPhase[index];if(index===0&&this._zerothIsAccum){this._accum=value;this._gotAccum=gotAccum=true;valuesPhase[index]=valuesPhaseIndex===0?1:2}else if(index===-1){this._accum=value;this._gotAccum=gotAccum=true}else{if(valuesPhaseIndex===0){valuesPhase[index]=1}else{valuesPhase[index]=2;this._accum=value}}if(!gotAccum)return;var callback=this._callback;var receiver=this._promise._boundTo;var ret;for(var i=this._reducingIndex;i<length;++i){valuesPhaseIndex=valuesPhase[i];if(valuesPhaseIndex===2){this._reducingIndex=i+1;continue}if(valuesPhaseIndex!==1)return;value=values[i];this._promise._pushContext();if(isEach){preservedValues.push(value);ret=tryCatch(callback).call(receiver,value,i,length)}else{ret=tryCatch(callback).call(receiver,this._accum,value,i,length)}this._promise._popContext();if(ret===errorObj)return this._reject(ret.e);var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){maybePromise=maybePromise._target();if(maybePromise._isPending()){valuesPhase[i]=4;return maybePromise._proxyPromiseArray(this,i)}else if(maybePromise._isFulfilled()){ret=maybePromise._value()}else{return this._reject(maybePromise._reason())}}this._reducingIndex=i+1;this._accum=ret}this._resolve(isEach?preservedValues:this._accum)};function reduce(promises,fn,initialValue,_each){if(typeof fn!=="function")return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var array=new ReductionPromiseArray(promises,fn,initialValue,_each);return array.promise()}Promise.prototype.reduce=function(fn,initialValue){return reduce(this,fn,initialValue,null)};Promise.reduce=function(promises,fn,initialValue,_each){return reduce(promises,fn,initialValue,_each)}}},{"./async.js":2,"./util.js":38}],31:[function(_dereq_,module,exports){"use strict";var schedule;var util=_dereq_("./util");var noAsyncScheduler=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")};if(util.isNode&&typeof MutationObserver==="undefined"){var GlobalSetImmediate=global.setImmediate;var ProcessNextTick=process.nextTick;schedule=util.isRecentNode?function(fn){GlobalSetImmediate.call(global,fn)}:function(fn){ProcessNextTick.call(process,fn)}}else if(typeof MutationObserver!=="undefined"&&!(typeof window!=="undefined"&&window.navigator&&window.navigator.standalone)){schedule=function(fn){var div=document.createElement("div");var observer=new MutationObserver(fn);observer.observe(div,{attributes:true});return function(){div.classList.toggle("foo")}};schedule.isStatic=true}else if(typeof setImmediate!=="undefined"){schedule=function(fn){setImmediate(fn)}}else if(typeof setTimeout!=="undefined"){schedule=function(fn){setTimeout(fn,0)}}else{schedule=noAsyncScheduler}module.exports=schedule},{"./util":38}],32:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray){var PromiseInspection=Promise.PromiseInspection;var util=_dereq_("./util.js");function SettledPromiseArray(values){this.constructor$(values)}util.inherits(SettledPromiseArray,PromiseArray);SettledPromiseArray.prototype._promiseResolved=function(index,inspection){this._values[index]=inspection;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){this._resolve(this._values)}};SettledPromiseArray.prototype._promiseFulfilled=function(value,index){var ret=new PromiseInspection;ret._bitField=268435456;ret._settledValue=value;this._promiseResolved(index,ret)};SettledPromiseArray.prototype._promiseRejected=function(reason,index){var ret=new PromiseInspection;ret._bitField=134217728;ret._settledValue=reason;this._promiseResolved(index,ret)};Promise.settle=function(promises){return new SettledPromiseArray(promises).promise()};Promise.prototype.settle=function(){return new SettledPromiseArray(this).promise()}}},{"./util.js":38}],33:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection){var util=_dereq_("./util.js");var RangeError=_dereq_("./errors.js").RangeError;var AggregateError=_dereq_("./errors.js").AggregateError;var isArray=util.isArray;function SomePromiseArray(values){this.constructor$(values);this._howMany=0;this._unwrap=false;this._initialized=false}util.inherits(SomePromiseArray,PromiseArray);SomePromiseArray.prototype._init=function(){if(!this._initialized){return}if(this._howMany===0){this._resolve([]);return}this._init$(undefined,-5);var isArrayResolved=isArray(this._values);if(!this._isResolved()&&isArrayResolved&&this._howMany>this._canPossiblyFulfill()){this._reject(this._getRangeError(this.length()))}};SomePromiseArray.prototype.init=function(){this._initialized=true;this._init()};SomePromiseArray.prototype.setUnwrap=function(){this._unwrap=true};SomePromiseArray.prototype.howMany=function(){return this._howMany};SomePromiseArray.prototype.setHowMany=function(count){this._howMany=count};SomePromiseArray.prototype._promiseFulfilled=function(value){this._addFulfilled(value);if(this._fulfilled()===this.howMany()){this._values.length=this.howMany();if(this.howMany()===1&&this._unwrap){this._resolve(this._values[0])}else{this._resolve(this._values)}}};SomePromiseArray.prototype._promiseRejected=function(reason){this._addRejected(reason);if(this.howMany()>this._canPossiblyFulfill()){var e=new AggregateError;for(var i=this.length();i<this._values.length;++i){e.push(this._values[i])}this._reject(e)}};SomePromiseArray.prototype._fulfilled=function(){return this._totalResolved};SomePromiseArray.prototype._rejected=function(){return this._values.length-this.length()};SomePromiseArray.prototype._addRejected=function(reason){this._values.push(reason)};SomePromiseArray.prototype._addFulfilled=function(value){this._values[this._totalResolved++]=value};SomePromiseArray.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()};SomePromiseArray.prototype._getRangeError=function(count){var message="Input array must contain at least "+this._howMany+" items but contains only "+count+" items";return new RangeError(message)};SomePromiseArray.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))};function some(promises,howMany){if((howMany|0)!==howMany||howMany<0){return apiRejection("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n")}var ret=new SomePromiseArray(promises);var promise=ret.promise();ret.setHowMany(howMany);ret.init();return promise}Promise.some=function(promises,howMany){return some(promises,howMany)};Promise.prototype.some=function(howMany){return some(this,howMany)};Promise._SomePromiseArray=SomePromiseArray}},{"./errors.js":13,"./util.js":38}],34:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function PromiseInspection(promise){if(promise!==undefined){promise=promise._target();this._bitField=promise._bitField;this._settledValue=promise._settledValue}else{this._bitField=0;this._settledValue=undefined}}PromiseInspection.prototype.value=function(){if(!this.isFulfilled()){throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n")}return this._settledValue};PromiseInspection.prototype.error=PromiseInspection.prototype.reason=function(){if(!this.isRejected()){throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n")}return this._settledValue};PromiseInspection.prototype.isFulfilled=Promise.prototype._isFulfilled=function(){return(this._bitField&268435456)>0};PromiseInspection.prototype.isRejected=Promise.prototype._isRejected=function(){return(this._bitField&134217728)>0};PromiseInspection.prototype.isPending=Promise.prototype._isPending=function(){return(this._bitField&402653184)===0};PromiseInspection.prototype.isResolved=Promise.prototype._isResolved=function(){return(this._bitField&402653184)>0};Promise.prototype.isPending=function(){return this._target()._isPending()};Promise.prototype.isRejected=function(){return this._target()._isRejected()};Promise.prototype.isFulfilled=function(){return this._target()._isFulfilled()};Promise.prototype.isResolved=function(){return this._target()._isResolved()};Promise.prototype._value=function(){return this._settledValue};Promise.prototype._reason=function(){this._unsetRejectionIsUnhandled();return this._settledValue};Promise.prototype.value=function(){var target=this._target();if(!target.isFulfilled()){throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n")}return target._settledValue};Promise.prototype.reason=function(){var target=this._target();if(!target.isRejected()){throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n")}target._unsetRejectionIsUnhandled();return target._settledValue};Promise.PromiseInspection=PromiseInspection}},{}],35:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var util=_dereq_("./util.js");var errorObj=util.errorObj;var isObject=util.isObject;function tryConvertToPromise(obj,context){if(isObject(obj)){if(obj instanceof Promise){return obj}else if(isAnyBluebirdPromise(obj)){var ret=new Promise(INTERNAL);obj._then(ret._fulfillUnchecked,ret._rejectUncheckedCheckError,ret._progressUnchecked,ret,null);return ret}var then=util.tryCatch(getThen)(obj);if(then===errorObj){if(context)context._pushContext();var ret=Promise.reject(then.e);if(context)context._popContext();return ret}else if(typeof then==="function"){return doThenable(obj,then,context)}}return obj}function getThen(obj){return obj.then}var hasProp={}.hasOwnProperty;function isAnyBluebirdPromise(obj){return hasProp.call(obj,"_promise0")}function doThenable(x,then,context){var promise=new Promise(INTERNAL);var ret=promise;if(context)context._pushContext();promise._captureStackTrace();if(context)context._popContext();var synchronous=true;var result=util.tryCatch(then).call(x,resolveFromThenable,rejectFromThenable,progressFromThenable);synchronous=false;if(promise&&result===errorObj){promise._rejectCallback(result.e,true,true);promise=null}function resolveFromThenable(value){if(!promise)return;promise._resolveCallback(value);promise=null}function rejectFromThenable(reason){if(!promise)return;promise._rejectCallback(reason,synchronous,true);promise=null}function progressFromThenable(value){if(!promise)return;if(typeof promise._progress==="function"){promise._progress(value)}}return ret}return tryConvertToPromise}},{"./util.js":38}],36:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var util=_dereq_("./util.js");var TimeoutError=Promise.TimeoutError;var afterTimeout=function(promise,message){if(!promise.isPending())return;if(typeof message!=="string"){message="operation timed out"}var err=new TimeoutError(message);util.markAsOriginatingFromRejection(err);promise._attachExtraTrace(err);promise._cancel(err)};var afterValue=function(value){return delay(+this).thenReturn(value)};var delay=Promise.delay=function(value,ms){if(ms===undefined){ms=value;value=undefined;var ret=new Promise(INTERNAL);setTimeout(function(){ret._fulfill()},ms);return ret}ms=+ms;return Promise.resolve(value)._then(afterValue,null,null,ms,undefined)};Promise.prototype.delay=function(ms){return delay(this,ms)};function successClear(value){var handle=this;if(handle instanceof Number)handle=+handle;clearTimeout(handle);return value}function failureClear(reason){var handle=this;if(handle instanceof Number)handle=+handle;clearTimeout(handle);throw reason}Promise.prototype.timeout=function(ms,message){ms=+ms;var ret=this.then().cancellable();ret._cancellationParent=this;var handle=setTimeout(function timeoutTimeout(){afterTimeout(ret,message)},ms);return ret._then(successClear,failureClear,undefined,handle,undefined)}}},{"./util.js":38}],37:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,tryConvertToPromise,createContext){var TypeError=_dereq_("./errors.js").TypeError;var inherits=_dereq_("./util.js").inherits;var PromiseInspection=Promise.PromiseInspection;function inspectionMapper(inspections){var len=inspections.length;for(var i=0;i<len;++i){var inspection=inspections[i];if(inspection.isRejected()){return Promise.reject(inspection.error())}inspections[i]=inspection._settledValue}return inspections}function thrower(e){setTimeout(function(){throw e},0)}function castPreservingDisposable(thenable){var maybePromise=tryConvertToPromise(thenable);if(maybePromise!==thenable&&typeof thenable._isDisposable==="function"&&typeof thenable._getDisposer==="function"&&thenable._isDisposable()){maybePromise._setDisposable(thenable._getDisposer())}return maybePromise}function dispose(resources,inspection){var i=0;var len=resources.length;var ret=Promise.defer();function iterator(){if(i>=len)return ret.resolve();var maybePromise=castPreservingDisposable(resources[i++]);if(maybePromise instanceof Promise&&maybePromise._isDisposable()){try{maybePromise=tryConvertToPromise(maybePromise._getDisposer().tryDispose(inspection),resources.promise)}catch(e){return thrower(e)}if(maybePromise instanceof Promise){return maybePromise._then(iterator,thrower,null,null,null)}}iterator()}iterator();return ret.promise}function disposerSuccess(value){var inspection=new PromiseInspection;inspection._settledValue=value;inspection._bitField=268435456;return dispose(this,inspection).thenReturn(value)}function disposerFail(reason){var inspection=new PromiseInspection;inspection._settledValue=reason;inspection._bitField=134217728;return dispose(this,inspection).thenThrow(reason)}function Disposer(data,promise,context){this._data=data;this._promise=promise;this._context=context}Disposer.prototype.data=function(){return this._data};Disposer.prototype.promise=function(){return this._promise};Disposer.prototype.resource=function(){if(this.promise().isFulfilled()){return this.promise().value()}return null};Disposer.prototype.tryDispose=function(inspection){var resource=this.resource();var context=this._context;if(context!==undefined)context._pushContext();var ret=resource!==null?this.doDispose(resource,inspection):null;if(context!==undefined)context._popContext();this._promise._unsetDisposable();this._data=null;return ret};Disposer.isDisposer=function(d){return d!=null&&typeof d.resource==="function"&&typeof d.tryDispose==="function"};function FunctionDisposer(fn,promise,context){this.constructor$(fn,promise,context)}inherits(FunctionDisposer,Disposer);FunctionDisposer.prototype.doDispose=function(resource,inspection){var fn=this.data();return fn.call(resource,resource,inspection)};function maybeUnwrapDisposer(value){if(Disposer.isDisposer(value)){this.resources[this.index]._setDisposable(value);return value.promise()}return value}Promise.using=function(){var len=arguments.length;if(len<2)return apiRejection("you must pass at least 2 arguments to Promise.using");var fn=arguments[len-1];if(typeof fn!=="function")return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");len--;var resources=new Array(len);for(var i=0;i<len;++i){var resource=arguments[i];if(Disposer.isDisposer(resource)){var disposer=resource;resource=resource.promise();resource._setDisposable(disposer)}else{var maybePromise=tryConvertToPromise(resource);if(maybePromise instanceof Promise){resource=maybePromise._then(maybeUnwrapDisposer,null,null,{resources:resources,index:i},undefined)}}resources[i]=resource}var promise=Promise.settle(resources).then(inspectionMapper).then(function(vals){promise._pushContext();var ret;try{ret=fn.apply(undefined,vals)}finally{promise._popContext()}return ret})._then(disposerSuccess,disposerFail,undefined,resources,undefined);resources.promise=promise;return promise};Promise.prototype._setDisposable=function(disposer){this._bitField=this._bitField|262144;this._disposer=disposer};Promise.prototype._isDisposable=function(){return(this._bitField&262144)>0};Promise.prototype._getDisposer=function(){return this._disposer};Promise.prototype._unsetDisposable=function(){this._bitField=this._bitField&~262144;this._disposer=undefined};Promise.prototype.disposer=function(fn){if(typeof fn==="function"){return new FunctionDisposer(fn,this,createContext())}throw new TypeError}}},{"./errors.js":13,"./util.js":38}],38:[function(_dereq_,module,exports){"use strict";var es5=_dereq_("./es5.js");var canEvaluate=typeof navigator=="undefined";var haveGetters=function(){try{var o={};es5.defineProperty(o,"f",{get:function(){return 3}});return o.f===3}catch(e){return false}}();var errorObj={e:{}};var tryCatchTarget;function tryCatcher(){try{return tryCatchTarget.apply(this,arguments)}catch(e){errorObj.e=e;return errorObj}}function tryCatch(fn){tryCatchTarget=fn;return tryCatcher}var inherits=function(Child,Parent){var hasProp={}.hasOwnProperty;function T(){this.constructor=Child;this.constructor$=Parent;for(var propertyName in Parent.prototype){if(hasProp.call(Parent.prototype,propertyName)&&propertyName.charAt(propertyName.length-1)!=="$"){this[propertyName+"$"]=Parent.prototype[propertyName]}}}T.prototype=Parent.prototype;Child.prototype=new T;return Child.prototype};function isPrimitive(val){return val==null||val===true||val===false||typeof val==="string"||typeof val==="number"}function isObject(value){return!isPrimitive(value)}function maybeWrapAsError(maybeError){if(!isPrimitive(maybeError))return maybeError;return new Error(safeToString(maybeError))}function withAppended(target,appendee){var len=target.length;var ret=new Array(len+1);var i;for(i=0;i<len;++i){ret[i]=target[i]}ret[i]=appendee;return ret}function getDataPropertyOrDefault(obj,key,defaultValue){if(es5.isES5){var desc=Object.getOwnPropertyDescriptor(obj,key);if(desc!=null){return desc.get==null&&desc.set==null?desc.value:defaultValue}}else{return{}.hasOwnProperty.call(obj,key)?obj[key]:undefined}}function notEnumerableProp(obj,name,value){if(isPrimitive(obj))return obj;var descriptor={value:value,configurable:true,enumerable:false,writable:true};es5.defineProperty(obj,name,descriptor);return obj}function thrower(r){throw r}var inheritedDataKeys=function(){if(es5.isES5){var oProto=Object.prototype;var getKeys=Object.getOwnPropertyNames;return function(obj){var ret=[];var visitedKeys=Object.create(null);while(obj!=null&&obj!==oProto){var keys;try{keys=getKeys(obj)}catch(e){return ret}for(var i=0;i<keys.length;++i){var key=keys[i];if(visitedKeys[key])continue;visitedKeys[key]=true;var desc=Object.getOwnPropertyDescriptor(obj,key);if(desc!=null&&desc.get==null&&desc.set==null){ret.push(key)}}obj=es5.getPrototypeOf(obj)}return ret}}else{return function(obj){var ret=[];for(var key in obj){ret.push(key)}return ret}}}();var thisAssignmentPattern=/this\s*\.\s*\S+\s*=/;function isClass(fn){try{if(typeof fn==="function"){var keys=es5.names(fn.prototype);if(es5.isES5&&keys.length>1||keys.length>0&&!(keys.length===1&&keys[0]==="constructor")||thisAssignmentPattern.test(fn+"")){return true}}return false}catch(e){return false}}function toFastProperties(obj){function f(){}f.prototype=obj;var l=8;while(l--)new f;return obj;eval(obj)}var rident=/^[a-z$_][a-z$_0-9]*$/i;function isIdentifier(str){return rident.test(str)}function filledRange(count,prefix,suffix){var ret=new Array(count);for(var i=0;i<count;++i){ret[i]=prefix+i+suffix}return ret}function safeToString(obj){try{return obj+""}catch(e){return"[no string representation]"}}function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isOperational",true)}catch(ignore){}}function originatesFromRejection(e){if(e==null)return false;return e instanceof Error["__BluebirdErrorTypes__"].OperationalError||e["isOperational"]===true}function canAttachTrace(obj){return obj instanceof Error&&es5.propertyIsWritable(obj,"stack")}var ensureErrorObject=function(){if(!("stack"in new Error)){return function(value){if(canAttachTrace(value))return value;try{throw new Error(safeToString(value))}catch(err){return err}}}else{return function(value){if(canAttachTrace(value))return value;return new Error(safeToString(value))}}}();function classString(obj){return{}.toString.call(obj)}function copyDescriptors(from,to,filter){var keys=es5.names(from);for(var i=0;i<keys.length;++i){var key=keys[i];if(filter(key)){es5.defineProperty(to,key,es5.getDescriptor(from,key))}}}function isNativeFunctionMethod(fn){return fn===fn.call||fn===fn.toString||fn===fn.bind||fn===fn.apply}var ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,haveGetters:haveGetters,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch:tryCatch,inherits:inherits,withAppended:withAppended,maybeWrapAsError:maybeWrapAsError,toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString,canAttachTrace:canAttachTrace,ensureErrorObject:ensureErrorObject,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,classString:classString,copyDescriptors:copyDescriptors,hasDevTools:typeof chrome!=="undefined"&&chrome&&typeof chrome.loadTimes==="function",isNode:typeof process!=="undefined"&&classString(process).toLowerCase()==="[object process]",isNativeFunctionMethod:isNativeFunctionMethod};ret.isRecentNode=ret.isNode&&function(){var version=process.versions.node.split(".").map(Number);return version[0]===0&&version[1]>10||version[0]>0}();if(ret.isNode)ret.toFastProperties(process);try{throw new Error}catch(e){ret.lastLineError=e}module.exports=ret},{"./es5.js":14}]},{},[4])(4)});if(typeof window!=="undefined"&&window!==null){window.P=window.Promise}else if(typeof self!=="undefined"&&self!==null){self.P=self.Promise}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/process/browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/browser-resolve/empty.js":[function(require,module,exports){},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js":[function(require,module,exports){var base64=require("base64-js");var ieee754=require("ieee754");var isArray=require("is-array");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.poolSize=8192;var rootParent={};Buffer.TYPED_ARRAY_SUPPORT=function(){function Foo(){}try{var buf=new ArrayBuffer(0);var arr=new Uint8Array(buf);arr.foo=function(){return 42};arr.constructor=Foo;return arr.foo()===42&&arr.constructor===Foo&&typeof arr.subarray==="function"&&new Uint8Array(1).subarray(1,1).byteLength===0}catch(e){return false}}();function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Buffer(arg){if(!(this instanceof Buffer)){if(arguments.length>1)return new Buffer(arg,arguments[1]);
return new Buffer(arg)}this.length=0;this.parent=undefined;if(typeof arg==="number"){return fromNumber(this,arg)}if(typeof arg==="string"){return fromString(this,arg,arguments.length>1?arguments[1]:"utf8")}return fromObject(this,arg)}function fromNumber(that,length){that=allocate(that,length<0?0:checked(length)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<length;i++){that[i]=0}}return that}function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding==="")encoding="utf8";var length=byteLength(string,encoding)|0;that=allocate(that,length);that.write(string,encoding);return that}function fromObject(that,object){if(Buffer.isBuffer(object))return fromBuffer(that,object);if(isArray(object))return fromArray(that,object);if(object==null){throw new TypeError("must start with number, buffer, array or string")}if(typeof ArrayBuffer!=="undefined"&&object.buffer instanceof ArrayBuffer){return fromTypedArray(that,object)}if(object.length)return fromArrayLike(that,object);return fromJsonObject(that,object)}function fromBuffer(that,buffer){var length=checked(buffer.length)|0;that=allocate(that,length);buffer.copy(that,0,0,length);return that}function fromArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromTypedArray(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayLike(that,array){var length=checked(array.length)|0;that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromJsonObject(that,object){var array;var length=0;if(object.type==="Buffer"&&isArray(object.data)){array=object.data;length=checked(array.length)|0}that=allocate(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function allocate(that,length){if(Buffer.TYPED_ARRAY_SUPPORT){that=Buffer._augment(new Uint8Array(length))}else{that.length=length;that._isBuffer=true}var fromPool=length!==0&&length<=Buffer.poolSize>>>1;if(fromPool)that.parent=rootParent;return that}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(subject,encoding){if(!(this instanceof SlowBuffer))return new SlowBuffer(subject,encoding);var buf=new Buffer(subject,encoding);delete buf.parent;return buf}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;var i=0;var len=Math.min(x,y);while(i<len){if(a[i]!==b[i])break;++i}if(i!==len){x=a[i];y=b[i]}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list))throw new TypeError("list argument must be an Array of Buffers.");if(list.length===0){return new Buffer(0)}else if(list.length===1){return list[0]}var i;if(length===undefined){length=0;for(i=0;i<list.length;i++){length+=list[i].length}}var buf=new Buffer(length);var pos=0;for(i=0;i<list.length;i++){var item=list[i];item.copy(buf,pos);pos+=item.length}return buf};function byteLength(string,encoding){if(typeof string!=="string")string=""+string;var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"binary":case"raw":case"raws":return len;case"utf8":case"utf-8":return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;Buffer.prototype.length=undefined;Buffer.prototype.parent=undefined;function slowToString(encoding,start,end){var loweredCase=false;start=start|0;end=end===undefined||end===Infinity?this.length:end|0;if(!encoding)encoding="utf8";if(start<0)start=0;if(end>this.length)end=this.length;if(end<=start)return"";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"binary":return binarySlice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return 0;return Buffer.compare(this,b)};Buffer.prototype.indexOf=function indexOf(val,byteOffset){if(byteOffset>2147483647)byteOffset=2147483647;else if(byteOffset<-2147483648)byteOffset=-2147483648;byteOffset>>=0;if(this.length===0)return-1;if(byteOffset>=this.length)return-1;if(byteOffset<0)byteOffset=Math.max(this.length+byteOffset,0);if(typeof val==="string"){if(val.length===0)return-1;return String.prototype.indexOf.call(this,val,byteOffset)}if(Buffer.isBuffer(val)){return arrayIndexOf(this,val,byteOffset)}if(typeof val==="number"){if(Buffer.TYPED_ARRAY_SUPPORT&&Uint8Array.prototype.indexOf==="function"){return Uint8Array.prototype.indexOf.call(this,val,byteOffset)}return arrayIndexOf(this,[val],byteOffset)}function arrayIndexOf(arr,val,byteOffset){var foundIndex=-1;for(var i=0;byteOffset+i<arr.length;i++){if(arr[byteOffset+i]===val[foundIndex===-1?0:i-foundIndex]){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===val.length)return byteOffset+foundIndex}else{foundIndex=-1}}return-1}throw new TypeError("val must be string, number or Buffer")};Buffer.prototype.get=function get(offset){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(offset)};Buffer.prototype.set=function set(v,offset){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(v,offset)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new Error("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;i++){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))throw new Error("Invalid hex string");buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function binaryWrite(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{var swap=encoding;encoding=offset;offset=length|0;length=swap}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"binary":return binaryWrite(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){var res="";var tmp="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){if(buf[i]<=127){res+=decodeUtf8Char(tmp)+String.fromCharCode(buf[i]);tmp=""}else{tmp+="%"+buf[i].toString(16)}}return res+decodeUtf8Char(tmp)}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i]&127)}return ret}function binarySlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;i++){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;i++){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=Buffer._augment(this.subarray(start,end))}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;i++){newBuf[i]=this[i+start]}}if(newBuf.length)newBuf.parent=this.parent||this;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("buffer must be a Buffer instance");if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength),0);var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;i++){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;i++){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=value<0?1:0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=value<0?1:0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(value>max||value<min)throw new RangeError("value is out of bounds");if(offset+ext>buf.length)throw new RangeError("index out of range");if(offset<0)throw new RangeError("index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<len;i++){target[i+targetStart]=this[i+start]}}else{target._set(this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(value,start,end){if(!value)value=0;if(!start)start=0;if(!end)end=this.length;if(end<start)throw new RangeError("end < start");if(end===start)return;if(this.length===0)return;if(start<0||start>=this.length)throw new RangeError("start out of bounds");if(end<0||end>this.length)throw new RangeError("end out of bounds");var i;if(typeof value==="number"){for(i=start;i<end;i++){this[i]=value}}else{var bytes=utf8ToBytes(value.toString());var len=bytes.length;for(i=start;i<end;i++){this[i]=bytes[i%len]}}return this};Buffer.prototype.toArrayBuffer=function toArrayBuffer(){if(typeof Uint8Array!=="undefined"){if(Buffer.TYPED_ARRAY_SUPPORT){return new Buffer(this).buffer}else{var buf=new Uint8Array(this.length);for(var i=0,len=buf.length;i<len;i+=1){buf[i]=this[i]}return buf.buffer}}else{throw new TypeError("Buffer.toArrayBuffer not supported in this browser")}};var BP=Buffer.prototype;Buffer._augment=function _augment(arr){arr.constructor=Buffer;arr._isBuffer=true;arr._set=arr.set;arr.get=BP.get;arr.set=BP.set;arr.write=BP.write;arr.toString=BP.toString;arr.toLocaleString=BP.toString;arr.toJSON=BP.toJSON;arr.equals=BP.equals;arr.compare=BP.compare;arr.indexOf=BP.indexOf;arr.copy=BP.copy;arr.slice=BP.slice;arr.readUIntLE=BP.readUIntLE;arr.readUIntBE=BP.readUIntBE;arr.readUInt8=BP.readUInt8;arr.readUInt16LE=BP.readUInt16LE;arr.readUInt16BE=BP.readUInt16BE;arr.readUInt32LE=BP.readUInt32LE;arr.readUInt32BE=BP.readUInt32BE;arr.readIntLE=BP.readIntLE;arr.readIntBE=BP.readIntBE;arr.readInt8=BP.readInt8;arr.readInt16LE=BP.readInt16LE;arr.readInt16BE=BP.readInt16BE;arr.readInt32LE=BP.readInt32LE;arr.readInt32BE=BP.readInt32BE;arr.readFloatLE=BP.readFloatLE;arr.readFloatBE=BP.readFloatBE;arr.readDoubleLE=BP.readDoubleLE;arr.readDoubleBE=BP.readDoubleBE;arr.writeUInt8=BP.writeUInt8;arr.writeUIntLE=BP.writeUIntLE;arr.writeUIntBE=BP.writeUIntBE;arr.writeUInt16LE=BP.writeUInt16LE;arr.writeUInt16BE=BP.writeUInt16BE;arr.writeUInt32LE=BP.writeUInt32LE;arr.writeUInt32BE=BP.writeUInt32BE;arr.writeIntLE=BP.writeIntLE;arr.writeIntBE=BP.writeIntBE;arr.writeInt8=BP.writeInt8;arr.writeInt16LE=BP.writeInt16LE;arr.writeInt16BE=BP.writeInt16BE;arr.writeInt32LE=BP.writeInt32LE;arr.writeInt32BE=BP.writeInt32BE;arr.writeFloatLE=BP.writeFloatLE;arr.writeFloatBE=BP.writeFloatBE;arr.writeDoubleLE=BP.writeDoubleLE;arr.writeDoubleBE=BP.writeDoubleBE;arr.fill=BP.fill;arr.inspect=BP.inspect;arr.toArrayBuffer=BP.toArrayBuffer;return arr};var INVALID_BASE64_RE=/[^+\/0-9A-z\-]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];var i=0;for(;i<length;i++){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(leadSurrogate){if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}else{codePoint=leadSurrogate-55296<<10|codePoint-56320|65536;leadSurrogate=null}}else{if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}else{leadSurrogate=codePoint;continue}}}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=null}if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<2097152){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;i++){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;i++){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;i++){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function decodeUtf8Char(str){try{return decodeURIComponent(str)}catch(err){return String.fromCharCode(65533)}}},{"base64-js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib/b64.js",ieee754:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/node_modules/ieee754/index.js","is-array":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/node_modules/is-array/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/node_modules/base64-js/lib/b64.js":[function(require,module,exports){var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";(function(exports){"use strict";var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var PLUS="+".charCodeAt(0);var SLASH="/".charCodeAt(0);var NUMBER="0".charCodeAt(0);var LOWER="a".charCodeAt(0);var UPPER="A".charCodeAt(0);var PLUS_URL_SAFE="-".charCodeAt(0);var SLASH_URL_SAFE="_".charCodeAt(0);function decode(elt){var code=elt.charCodeAt(0);if(code===PLUS||code===PLUS_URL_SAFE)return 62;if(code===SLASH||code===SLASH_URL_SAFE)return 63;if(code<NUMBER)return-1;if(code<NUMBER+10)return code-NUMBER+26+26;if(code<UPPER+26)return code-UPPER;if(code<LOWER+26)return code-LOWER+26}function b64ToByteArray(b64){var i,j,l,tmp,placeHolders,arr;if(b64.length%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var len=b64.length;placeHolders="="===b64.charAt(len-2)?2:"="===b64.charAt(len-1)?1:0;arr=new Arr(b64.length*3/4-placeHolders);l=placeHolders>0?b64.length-4:b64.length;var L=0;function push(v){arr[L++]=v}for(i=0,j=0;i<l;i+=4,j+=3){tmp=decode(b64.charAt(i))<<18|decode(b64.charAt(i+1))<<12|decode(b64.charAt(i+2))<<6|decode(b64.charAt(i+3));push((tmp&16711680)>>16);push((tmp&65280)>>8);push(tmp&255)}if(placeHolders===2){tmp=decode(b64.charAt(i))<<2|decode(b64.charAt(i+1))>>4;push(tmp&255)}else if(placeHolders===1){tmp=decode(b64.charAt(i))<<10|decode(b64.charAt(i+1))<<4|decode(b64.charAt(i+2))>>2;push(tmp>>8&255);push(tmp&255)}return arr}function uint8ToBase64(uint8){var i,extraBytes=uint8.length%3,output="",temp,length;function encode(num){return lookup.charAt(num)}function tripletToBase64(num){return encode(num>>18&63)+encode(num>>12&63)+encode(num>>6&63)+encode(num&63)}for(i=0,length=uint8.length-extraBytes;i<length;i+=3){temp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output+=tripletToBase64(temp)}switch(extraBytes){case 1:temp=uint8[uint8.length-1];output+=encode(temp>>2);output+=encode(temp<<4&63);output+="==";break;case 2:temp=(uint8[uint8.length-2]<<8)+uint8[uint8.length-1];output+=encode(temp>>10);output+=encode(temp>>4&63);output+=encode(temp<<2&63);output+="=";break}return output}exports.toByteArray=b64ToByteArray;exports.fromByteArray=uint8ToBase64})(typeof exports==="undefined"?this.base64js={}:exports)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/node_modules/ieee754/index.js":[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/node_modules/is-array/index.js":[function(require,module,exports){var isArray=Array.isArray;var str=Object.prototype.toString;module.exports=isArray||function(val){return!!val&&"[object Array]"==str.call(val)}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/events/events.js":[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;
return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/inherits/inherits_browser.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/isarray/index.js":[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/process/browser.js":[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;function drainQueue(){if(draining){return}draining=true;var currentQueue;var len=queue.length;while(len){currentQueue=queue;queue=[];var i=-1;while(++i<len){currentQueue[i]()}len=queue.length}draining=false}process.nextTick=function(fun){queue.push(fun);if(!draining){setTimeout(drainQueue,0)}};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/punycode/punycode.js":[function(require,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^ -~]/,regexSeparators=/\x2E|\u3002|\uFF0E|\uFF61/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw RangeError(errors[type])}function map(array,fn){var length=array.length;while(length--){array[length]=fn(array[length])}return array}function mapDomain(string,fn){return map(string.split(regexSeparators),fn).join(".")}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(domain){return mapDomain(domain,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(domain){return mapDomain(domain,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}punycode={version:"1.2.4",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define("punycode",function(){return punycode})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}})(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/duplex.js":[function(require,module,exports){module.exports=require("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_duplex.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_duplex.js":[function(require,module,exports){(function(process){module.exports=Duplex;var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};var util=require("core-util-is");util.inherits=require("inherits");var Readable=require("./_stream_readable");var Writable=require("./_stream_writable");util.inherits(Duplex,Readable);forEach(objectKeys(Writable.prototype),function(method){if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]});function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;process.nextTick(this.end.bind(this))}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}}).call(this,require("_process"))},{"./_stream_readable":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_readable.js","./_stream_writable":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_writable.js",_process:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/process/browser.js","core-util-is":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/node_modules/core-util-is/lib/util.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_passthrough.js":[function(require,module,exports){module.exports=PassThrough;var Transform=require("./_stream_transform");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{"./_stream_transform":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_transform.js","core-util-is":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/node_modules/core-util-is/lib/util.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_readable.js":[function(require,module,exports){(function(process){module.exports=Readable;var isArray=require("isarray");var Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;if(!EE.listenerCount)EE.listenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream=require("stream");var util=require("core-util-is");util.inherits=require("inherits");var StringDecoder;var debug=require("util");if(debug&&debug.debuglog){debug=debug.debuglog("stream")}else{debug=function(){}}util.inherits(Readable,Stream);function ReadableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};var hwm=options.highWaterMark;var defaultHwm=options.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=[];this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state=this._readableState;if(util.isString(chunk)&&!state.objectMode){encoding=encoding||state.defaultEncoding;if(encoding!==state.encoding){chunk=new Buffer(chunk,encoding);encoding=""}}return readableAddChunk(this,state,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state=this._readableState;return readableAddChunk(this,state,chunk,"",true)};function readableAddChunk(stream,state,chunk,encoding,addToFront){var er=chunkInvalid(state,chunk);if(er){stream.emit("error",er)}else if(util.isNullOrUndefined(chunk)){state.reading=false;if(!state.ended)onEofChunk(stream,state)}else if(state.objectMode||chunk&&chunk.length>0){if(state.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state.endEmitted&&addToFront){var e=new Error("stream.unshift() after end event");stream.emit("error",e)}else{if(state.decoder&&!addToFront&&!encoding)chunk=state.decoder.write(chunk);if(!addToFront)state.reading=false;if(state.flowing&&state.length===0&&!state.sync){stream.emit("data",chunk);stream.read(0)}else{state.length+=state.objectMode?1:chunk.length;if(addToFront)state.buffer.unshift(chunk);else state.buffer.push(chunk);if(state.needReadable)emitReadable(stream)}maybeReadMore(stream,state)}}else if(!addToFront){state.reading=false}return needMoreData(state)}function needMoreData(state){return!state.ended&&(state.needReadable||state.length<state.highWaterMark||state.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=require("string_decoder/").StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function roundUpToNextPowerOf2(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;for(var p=1;p<32;p<<=1)n|=n>>p;n++}return n}function howMuchToRead(n,state){if(state.length===0&&state.ended)return 0;if(state.objectMode)return n===0?0:1;if(isNaN(n)||util.isNull(n)){if(state.flowing&&state.buffer.length)return state.buffer[0].length;else return state.length}if(n<=0)return 0;if(n>state.highWaterMark)state.highWaterMark=roundUpToNextPowerOf2(n);if(n>state.length){if(!state.ended){state.needReadable=true;return 0}else return state.length}return n}Readable.prototype.read=function(n){debug("read",n);var state=this._readableState;var nOrig=n;if(!util.isNumber(n)||n>0)state.emittedReadable=false;if(n===0&&state.needReadable&&(state.length>=state.highWaterMark||state.ended)){debug("read: emitReadable",state.length,state.ended);if(state.length===0&&state.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state);if(n===0&&state.ended){if(state.length===0)endReadable(this);return null}var doRead=state.needReadable;debug("need readable",doRead);if(state.length===0||state.length-n<state.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state.ended||state.reading){doRead=false;debug("reading or ended",doRead)}if(doRead){debug("do read");state.reading=true;state.sync=true;if(state.length===0)state.needReadable=true;this._read(state.highWaterMark);state.sync=false}if(doRead&&!state.reading)n=howMuchToRead(nOrig,state);var ret;if(n>0)ret=fromList(n,state);else ret=null;if(util.isNull(ret)){state.needReadable=true;n=0}state.length-=n;if(state.length===0&&!state.ended)state.needReadable=true;if(nOrig!==n&&state.ended&&state.length===0)endReadable(this);if(!util.isNull(ret))this.emit("data",ret);return ret};function chunkInvalid(state,chunk){var er=null;if(!util.isBuffer(chunk)&&!util.isString(chunk)&&!util.isNullOrUndefined(chunk)&&!state.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state){if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length){state.buffer.push(chunk);state.length+=state.objectMode?1:chunk.length}}state.ended=true;emitReadable(stream)}function emitReadable(stream){var state=stream._readableState;state.needReadable=false;if(!state.emittedReadable){debug("emitReadable",state.flowing);state.emittedReadable=true;if(state.sync)process.nextTick(function(){emitReadable_(stream)});else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state){if(!state.readingMore){state.readingMore=true;process.nextTick(function(){maybeReadMore_(stream,state)})}}function maybeReadMore_(stream,state){var len=state.length;while(!state.reading&&!state.flowing&&!state.ended&&state.length<state.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state.length)break;else len=state.length}state.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest);break}state.pipesCount+=1;debug("pipe count=%d opts=%j",state.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state.endEmitted)process.nextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);if(state.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}src.on("data",ondata);function ondata(chunk){debug("ondata");var ret=dest.write(chunk);if(false===ret){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EE.listenerCount(dest,"error")===0)dest.emit("error",er)}if(!dest._events||!dest._events.error)dest.on("error",onerror);else if(isArray(dest._events.error))dest._events.error.unshift(onerror);else dest._events.error=[onerror,dest._events.error];function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state=src._readableState;debug("pipeOnDrain",state.awaitDrain);if(state.awaitDrain)state.awaitDrain--;if(state.awaitDrain===0&&EE.listenerCount(src,"data")){state.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state=this._readableState;if(state.pipesCount===0)return this;if(state.pipesCount===1){if(dest&&dest!==state.pipes)return this;if(!dest)dest=state.pipes;state.pipes=null;state.pipesCount=0;state.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state.pipes;var len=state.pipesCount;state.pipes=null;state.pipesCount=0;state.flowing=false;for(var i=0;i<len;i++)dests[i].emit("unpipe",this);return this}var i=indexOf(state.pipes,dest);if(i===-1)return this;state.pipes.splice(i,1);state.pipesCount-=1;if(state.pipesCount===1)state.pipes=state.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn);if(ev==="data"&&false!==this._readableState.flowing){this.resume()}if(ev==="readable"&&this.readable){var state=this._readableState;if(!state.readableListening){state.readableListening=true;state.emittedReadable=false;state.needReadable=true;if(!state.reading){var self=this;process.nextTick(function(){debug("readable nexttick read 0");self.read(0)})}else if(state.length){emitReadable(this,state)}}}return res};Readable.prototype.addListener=Readable.prototype.on;Readable.prototype.resume=function(){var state=this._readableState;if(!state.flowing){debug("resume");state.flowing=true;if(!state.reading){debug("resume read 0");this.read(0)}resume(this,state)}return this};function resume(stream,state){if(!state.resumeScheduled){state.resumeScheduled=true;process.nextTick(function(){resume_(stream,state)})}}function resume_(stream,state){state.resumeScheduled=false;stream.emit("resume");flow(stream);if(state.flowing&&!state.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state=stream._readableState;debug("flow",state.flowing);if(state.flowing){do{var chunk=stream.read()}while(null!==chunk&&state.flowing)}}Readable.prototype.wrap=function(stream){var state=this._readableState;var paused=false;var self=this;stream.on("end",function(){debug("wrapped end");if(state.decoder&&!state.ended){var chunk=state.decoder.end();if(chunk&&chunk.length)self.push(chunk)}self.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state.decoder)chunk=state.decoder.write(chunk);if(!chunk||!state.objectMode&&!chunk.length)return;var ret=self.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i in stream){if(util.isFunction(stream[i])&&util.isUndefined(this[i])){this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev){stream.on(ev,self.emit.bind(self,ev))});self._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self};Readable._fromList=fromList;function fromList(n,state){var list=state.buffer;var length=state.length;var stringMode=!!state.decoder;var objectMode=!!state.objectMode;var ret;if(list.length===0)return null;if(length===0)ret=null;else if(objectMode)ret=list.shift();else if(!n||n>=length){if(stringMode)ret=list.join("");else ret=Buffer.concat(list,length);list.length=0}else{if(n<list[0].length){var buf=list[0];ret=buf.slice(0,n);list[0]=buf.slice(n)}else if(n===list[0].length){ret=list.shift()}else{if(stringMode)ret="";else ret=new Buffer(n);var c=0;for(var i=0,l=list.length;i<l&&c<n;i++){var buf=list[0];var cpy=Math.min(n-c,buf.length);if(stringMode)ret+=buf.slice(0,cpy);else buf.copy(ret,c,0,cpy);if(cpy<buf.length)list[0]=buf.slice(cpy);else list.shift();c+=cpy}}}return ret}function endReadable(stream){var state=stream._readableState;if(state.length>0)throw new Error("endReadable called on non-empty stream");if(!state.endEmitted){state.ended=true;process.nextTick(function(){if(!state.endEmitted&&state.length===0){state.endEmitted=true;stream.readable=false;stream.emit("end")}})}}function forEach(xs,f){for(var i=0,l=xs.length;i<l;i++){f(xs[i],i)}}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x)return i}return-1}}).call(this,require("_process"))},{"./_stream_duplex":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_duplex.js",_process:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/process/browser.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js","core-util-is":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/node_modules/core-util-is/lib/util.js",events:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/events/events.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/inherits/inherits_browser.js",isarray:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/isarray/index.js",stream:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/stream-browserify/index.js","string_decoder/":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/string_decoder/index.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/browser-resolve/empty.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_transform.js":[function(require,module,exports){module.exports=Transform;var Duplex=require("./_stream_duplex");var util=require("core-util-is");util.inherits=require("inherits");util.inherits(Transform,Duplex);function TransformState(options,stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(!util.isNullOrUndefined(data))stream.push(data);if(cb)cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(options,this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;this.once("prefinish",function(){if(util.isFunction(this._flush))this._flush(function(er){done(stream,er)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(!util.isNull(ts.writechunk)&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er){if(er)return stream.emit("error",er);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("calling transform done when ws.length != 0");if(ts.transforming)throw new Error("calling transform done when still transforming");return stream.push(null)}},{"./_stream_duplex":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_duplex.js","core-util-is":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/node_modules/core-util-is/lib/util.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_writable.js":[function(require,module,exports){(function(process){module.exports=Writable;var Buffer=require("buffer").Buffer;Writable.WritableState=WritableState;var util=require("core-util-is");util.inherits=require("inherits");var Stream=require("stream");util.inherits(Writable,Stream);function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb}function WritableState(options,stream){var Duplex=require("./_stream_duplex");options=options||{};var hwm=options.highWaterMark;var defaultHwm=options.objectMode?16:16*1024;
this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.buffer=[];this.pendingcb=0;this.prefinished=false;this.errorEmitted=false}function Writable(options){var Duplex=require("./_stream_duplex");if(!(this instanceof Writable)&&!(this instanceof Duplex))return new Writable(options);this._writableState=new WritableState(options,this);this.writable=true;Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))};function writeAfterEnd(stream,state,cb){var er=new Error("write after end");stream.emit("error",er);process.nextTick(function(){cb(er)})}function validChunk(stream,state,chunk,cb){var valid=true;if(!util.isBuffer(chunk)&&!util.isString(chunk)&&!util.isNullOrUndefined(chunk)&&!state.objectMode){var er=new TypeError("Invalid non-string/buffer chunk");stream.emit("error",er);process.nextTick(function(){cb(er)});valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state=this._writableState;var ret=false;if(util.isFunction(encoding)){cb=encoding;encoding=null}if(util.isBuffer(chunk))encoding="buffer";else if(!encoding)encoding=state.defaultEncoding;if(!util.isFunction(cb))cb=function(){};if(state.ended)writeAfterEnd(this,state,cb);else if(validChunk(this,state,chunk,cb)){state.pendingcb++;ret=writeOrBuffer(this,state,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state=this._writableState;state.corked++};Writable.prototype.uncork=function(){var state=this._writableState;if(state.corked){state.corked--;if(!state.writing&&!state.corked&&!state.finished&&!state.bufferProcessing&&state.buffer.length)clearBuffer(this,state)}};function decodeChunk(state,chunk,encoding){if(!state.objectMode&&state.decodeStrings!==false&&util.isString(chunk)){chunk=new Buffer(chunk,encoding)}return chunk}function writeOrBuffer(stream,state,chunk,encoding,cb){chunk=decodeChunk(state,chunk,encoding);if(util.isBuffer(chunk))encoding="buffer";var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;if(!ret)state.needDrain=true;if(state.writing||state.corked)state.buffer.push(new WriteReq(chunk,encoding,cb));else doWrite(stream,state,false,len,chunk,encoding,cb);return ret}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len;state.writecb=cb;state.writing=true;state.sync=true;if(writev)stream._writev(chunk,state.onwrite);else stream._write(chunk,encoding,state.onwrite);state.sync=false}function onwriteError(stream,state,sync,er,cb){if(sync)process.nextTick(function(){state.pendingcb--;cb(er)});else{state.pendingcb--;cb(er)}stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state){state.writing=false;state.writecb=null;state.length-=state.writelen;state.writelen=0}function onwrite(stream,er){var state=stream._writableState;var sync=state.sync;var cb=state.writecb;onwriteStateUpdate(state);if(er)onwriteError(stream,state,sync,er,cb);else{var finished=needFinish(stream,state);if(!finished&&!state.corked&&!state.bufferProcessing&&state.buffer.length){clearBuffer(stream,state)}if(sync){process.nextTick(function(){afterWrite(stream,state,finished,cb)})}else{afterWrite(stream,state,finished,cb)}}}function afterWrite(stream,state,finished,cb){if(!finished)onwriteDrain(stream,state);state.pendingcb--;cb();finishMaybe(stream,state)}function onwriteDrain(stream,state){if(state.length===0&&state.needDrain){state.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state){state.bufferProcessing=true;if(stream._writev&&state.buffer.length>1){var cbs=[];for(var c=0;c<state.buffer.length;c++)cbs.push(state.buffer[c].callback);state.pendingcb++;doWrite(stream,state,true,state.length,state.buffer,"",function(err){for(var i=0;i<cbs.length;i++){state.pendingcb--;cbs[i](err)}});state.buffer=[]}else{for(var c=0;c<state.buffer.length;c++){var entry=state.buffer[c];var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state.objectMode?1:chunk.length;doWrite(stream,state,false,len,chunk,encoding,cb);if(state.writing){c++;break}}if(c<state.buffer.length)state.buffer=state.buffer.slice(c);else state.buffer.length=0}state.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;if(util.isFunction(chunk)){cb=chunk;chunk=null;encoding=null}else if(util.isFunction(encoding)){cb=encoding;encoding=null}if(!util.isNullOrUndefined(chunk))this.write(chunk,encoding);if(state.corked){state.corked=1;this.uncork()}if(!state.ending&&!state.finished)endWritable(this,state,cb)};function needFinish(stream,state){return state.ending&&state.length===0&&!state.finished&&!state.writing}function prefinish(stream,state){if(!state.prefinished){state.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state){var need=needFinish(stream,state);if(need){if(state.pendingcb===0){prefinish(stream,state);state.finished=true;stream.emit("finish")}else prefinish(stream,state)}return need}function endWritable(stream,state,cb){state.ending=true;finishMaybe(stream,state);if(cb){if(state.finished)process.nextTick(cb);else stream.once("finish",cb)}state.ended=true}}).call(this,require("_process"))},{"./_stream_duplex":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_duplex.js",_process:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/process/browser.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js","core-util-is":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/node_modules/core-util-is/lib/util.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/inherits/inherits_browser.js",stream:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/stream-browserify/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/node_modules/core-util-is/lib/util.js":[function(require,module,exports){(function(Buffer){function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;function isBuffer(arg){return Buffer.isBuffer(arg)}exports.isBuffer=isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(this,require("buffer").Buffer)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/passthrough.js":[function(require,module,exports){module.exports=require("./lib/_stream_passthrough.js")},{"./lib/_stream_passthrough.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_passthrough.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/readable.js":[function(require,module,exports){exports=module.exports=require("./lib/_stream_readable.js");exports.Stream=require("stream");exports.Readable=exports;exports.Writable=require("./lib/_stream_writable.js");exports.Duplex=require("./lib/_stream_duplex.js");exports.Transform=require("./lib/_stream_transform.js");exports.PassThrough=require("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_duplex.js","./lib/_stream_passthrough.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_passthrough.js","./lib/_stream_readable.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_readable.js","./lib/_stream_transform.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_transform.js","./lib/_stream_writable.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_writable.js",stream:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/stream-browserify/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/transform.js":[function(require,module,exports){module.exports=require("./lib/_stream_transform.js")},{"./lib/_stream_transform.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_transform.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/writable.js":[function(require,module,exports){module.exports=require("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/lib/_stream_writable.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/stream-browserify/index.js":[function(require,module,exports){module.exports=Stream;var EE=require("events").EventEmitter;var inherits=require("inherits");inherits(Stream,EE);Stream.Readable=require("readable-stream/readable.js");Stream.Writable=require("readable-stream/writable.js");Stream.Duplex=require("readable-stream/duplex.js");Stream.Transform=require("readable-stream/transform.js");Stream.PassThrough=require("readable-stream/passthrough.js");Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},{events:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/events/events.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/inherits/inherits_browser.js","readable-stream/duplex.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/duplex.js","readable-stream/passthrough.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/passthrough.js","readable-stream/readable.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/readable.js","readable-stream/transform.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/transform.js","readable-stream/writable.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/readable-stream/writable.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/string_decoder/index.js":[function(require,module,exports){var Buffer=require("buffer").Buffer;var isBufferEncoding=Buffer.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i=buffer.length>=3?3:buffer.length;for(;i>0;i--){var c=buffer[buffer.length-i];if(i==1&&c>>5==6){this.charLength=2;break}if(i<=2&&c>>4==14){this.charLength=3;break}if(i<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/support/isBufferBrowser.js":[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js":[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/support/isBufferBrowser.js",_process:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/process/browser.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/hostmeta/index.js":[function(require,module,exports){"use strict";var async=require("async");var request=require("request");var JXT=require("jxt").createRegistry();JXT.use(require("./lib/xrd"));module.exports=function(opts,cb){if(typeof opts==="string"){opts={host:opts}}var config={ssl:true,json:true,xrd:true};for(var prop in opts){config[prop]=opts[prop]}var scheme=config.ssl?"https://":"http://";async.parallel([function(done){request(scheme+config.host+"/.well-known/host-meta.json",function(err,req,body){if(err){return done(null)}var data;try{data=JSON.parse(body)}catch(e){data=null}return done(data)})},function(done){request(scheme+config.host+"/.well-known/host-meta",function(err,req,body){if(err){return done(null)}var xrd=JXT.parse(body);return done(xrd.toJSON())})}],function(result){if(result){cb(null,result)}else{cb("no-host-meta")}})}},{"./lib/xrd":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/hostmeta/lib/xrd.js",async:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/async/lib/async.js",jxt:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/index.js",request:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/hostmeta/lib/xrd.js":[function(require,module,exports){"use strict";var jxt=require("jxt");var NS="http://docs.oasis-open.org/ns/xri/xrd-1.0";module.exports=function(registry){var Properties={get:function(){var results={};var props=jxt.find(this.xml,NS,"Property");for(var i=0,len=props.length;i<len;i++){var property=props[i];var type=jxt.getAttribute(property,"type");results[type]=property.textContent}return results}};var XRD=registry.define({name:"xrd",namespace:NS,element:"XRD",fields:{subject:jxt.subText(NS,"Subject"),expires:jxt.dateSub(NS,"Expires"),aliases:jxt.multiSubText(NS,"Alias"),properties:Properties}});var Link=registry.define({name:"_xrdlink",namespace:NS,element:"Link",fields:{rel:jxt.attribute("rel"),href:jxt.attribute("href"),type:jxt.attribute("type"),template:jxt.attribute("template"),titles:jxt.subLangText(NS,"Title","default"),properties:Properties}});registry.extend(XRD,Link,"links");return XRD}},{jxt:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/index.js":[function(require,module,exports){var createHash=require("create-hash");var createHmac=require("create-hmac");var getHashes=require("./lib/get-hashes");var mapping={md2:"md2",md5:"md5","sha-1":"sha1","sha-224":"sha224","sha-256":"sha256","sha-384":"sha384","sha-512":"sha512"};var names=Object.keys(mapping);exports.getHashes=function(){var result=[];var available=getHashes();for(var i=0,len=names.length;i<len;i++){if(available.indexOf(mapping[names[i]])>=0){result.push(names[i])}}return result};exports.createHash=function(algorithm){algorithm=algorithm.toLowerCase();if(mapping[algorithm]){algorithm=mapping[algorithm]}return createHash(algorithm)};exports.createHmac=function(algorithm,key){algorithm=algorithm.toLowerCase();if(mapping[algorithm]){algorithm=mapping[algorithm]}return createHmac(algorithm,key)}},{"./lib/get-hashes":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/lib/get-hashes-browser.js","create-hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/browser.js","create-hmac":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hmac/browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/lib/get-hashes-browser.js":[function(require,module,exports){module.exports=function(){return["sha1","sha224","sha256","sha384","sha512","md5","rmd160"]}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/browser.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/browser.js"][0].apply(exports,arguments)},{"./md5":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/md5.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/inherits/inherits_browser.js",ripemd160:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/ripemd160/lib/ripemd160.js","sha.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/index.js",stream:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/stream-browserify/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/helpers.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/helpers.js"][0].apply(exports,arguments)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"
}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/md5.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/md5.js"][0].apply(exports,arguments)},{"./helpers":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/helpers.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/inherits/inherits_browser.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/ripemd160/lib/ripemd160.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/ripemd160/lib/ripemd160.js"][0].apply(exports,arguments)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/hash.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/hash.js"][0].apply(exports,arguments)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/index.js"][0].apply(exports,arguments)},{"./sha":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha.js","./sha1":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha1.js","./sha224":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha224.js","./sha256":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha256.js","./sha384":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha384.js","./sha512":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha512.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha1.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha1.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha224.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha224.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/hash.js","./sha256":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha256.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha256.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha256.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha384.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha384.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/hash.js","./sha512":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha512.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/sha512.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha512.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hmac/browser.js":[function(require,module,exports){(function(Buffer){"use strict";var createHash=require("create-hash/browser");var inherits=require("inherits");var Transform=require("stream").Transform;var ZEROS=new Buffer(128);ZEROS.fill(0);function Hmac(alg,key){Transform.call(this);if(typeof key==="string"){key=new Buffer(key)}var blocksize=alg==="sha512"||alg==="sha384"?128:64;this._alg=alg;this._key=key;if(key.length>blocksize){key=createHash(alg).update(key).digest()}else if(key.length<blocksize){key=Buffer.concat([key,ZEROS],blocksize)}var ipad=this._ipad=new Buffer(blocksize);var opad=this._opad=new Buffer(blocksize);for(var i=0;i<blocksize;i++){ipad[i]=key[i]^54;opad[i]=key[i]^92}this._hash=createHash(alg).update(ipad)}inherits(Hmac,Transform);Hmac.prototype.update=function(data,enc){this._hash.update(data,enc);return this};Hmac.prototype._transform=function(data,_,next){this._hash.update(data);next()};Hmac.prototype._flush=function(next){this.push(this.digest());next()};Hmac.prototype.digest=function(enc){var h=this._hash.digest();return createHash(this._alg).update(this._opad).update(h).digest(enc)};module.exports=function createHmac(alg,key){return new Hmac(alg,key)}}).call(this,require("buffer").Buffer)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js","create-hash/browser":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hash/browser.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hmac/node_modules/inherits/inherits_browser.js",stream:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/stream-browserify/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hmac/node_modules/inherits/inherits_browser.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/index.js":[function(require,module,exports){var util=require("util");var intersect=require("intersect");var WildEmitter=require("wildemitter");var webrtc=require("webrtcsupport");var BaseSession=require("jingle-session");var MediaSession=require("jingle-media-session");var FileSession=require("jingle-filetransfer-session");function SessionManager(conf){WildEmitter.call(this);conf=conf||{};this.jid=conf.jid;this.selfID=conf.selfID||this.jid&&this.jid.full||this.jid||"";this.sessions={};this.peers={};this.prepareSession=conf.prepareSession||function(opts){if(opts.descriptionTypes.indexOf("rtp")>=0){return new MediaSession(opts)}if(opts.descriptionTypes.indexOf("filetransfer")>=0){return new FileSession(opts)}};this.performTieBreak=conf.performTieBreak||function(sess,req){var descriptionTypes=req.jingle.contents.map(function(content){if(content.description){return content.description.descType}});var matching=intersect(sess.pendingDescriptionTypes,descriptionTypes);return matching.length>0};this.screenSharingSupport=webrtc.screenSharing;this.capabilities=["urn:xmpp:jingle:1"];if(webrtc.support){this.capabilities=["urn:xmpp:jingle:1","urn:xmpp:jingle:apps:rtp:1","urn:xmpp:jingle:apps:rtp:audio","urn:xmpp:jingle:apps:rtp:video","urn:xmpp:jingle:apps:rtp:rtcb-fb:0","urn:xmpp:jingle:apps:rtp:rtp-hdrext:0","urn:xmpp:jingle:apps:rtp:ssma:0","urn:xmpp:jingle:apps:dtls:0","urn:xmpp:jingle:apps:grouping:0","urn:xmpp:jingle:apps:file-transfer:3","urn:xmpp:jingle:transports:ice-udp:1","urn:xmpp:jingle:transports.dtls-sctp:1","urn:ietf:rfc:3264","urn:ietf:rfc:5576","urn:ietf:rfc:5888"]}this.config={debug:false,peerConnectionConfig:{iceServers:conf.iceServers||[{url:"stun:stun.l.google.com:19302"}]},peerConnectionConstraints:{optional:[{DtlsSrtpKeyAgreement:true},{RtpDataChannels:false}]},media:{audio:true,video:true}};for(var item in conf){this.config[item]=conf[item]}this.iceServers=this.config.peerConnectionConfig.iceServers}util.inherits(SessionManager,WildEmitter);SessionManager.prototype.addICEServer=function(server){if(typeof server==="string"){server={url:server}}this.iceServers.push(server)};SessionManager.prototype.addSession=function(session){var self=this;var sid=session.sid;var peer=session.peerID;this.sessions[sid]=session;if(!this.peers[peer]){this.peers[peer]=[]}this.peers[peer].push(session);session.on("terminated",function(){var peers=self.peers[peer]||[];if(peers.length){peers.splice(peers.indexOf(session),1)}delete self.sessions[sid]});session.on("*",function(name,data,extraData,extraData2){if(name==="send"){var action=data.jingle&&data.jingle.action;if(session.isInitiator&&action==="session-initiate"){self.emit("outgoing",session)}}if(self.config.debug&&(name==="log:debug"||name==="log:error")){console.log("Jingle:",data,extraData,extraData2)}if(name.indexOf("change")===0){return}self.emit(name,data,extraData,extraData2)});this.emit("createdSession",session);return session};SessionManager.prototype.createMediaSession=function(peer,sid,stream){var session=new MediaSession({sid:sid,peer:peer,initiator:true,stream:stream,parent:this,iceServers:this.iceServers,constraints:this.config.peerConnectionConstraints});this.addSession(session);return session};SessionManager.prototype.createFileTransferSession=function(peer,sid){var session=new FileSession({sid:sid,peer:peer,initiator:true,parent:this});this.addSession(session);return session};SessionManager.prototype.endPeerSessions=function(peer,reason,silent){peer=peer.full||peer;var sessions=this.peers[peer]||[];delete this.peers[peer];sessions.forEach(function(session){session.end(reason||"gone",silent)})};SessionManager.prototype.endAllSessions=function(reason,silent){var self=this;Object.keys(this.peers).forEach(function(peer){self.endPeerSessions(peer,reason,silent)})};SessionManager.prototype._createIncomingSession=function(meta,req){var session;if(this.prepareSession){session=this.prepareSession(meta,req)}if(!session){session=new BaseSession(meta)}this.addSession(session);return session};SessionManager.prototype._sendError=function(to,id,data){if(!data.type){data.type="cancel"}this.emit("send",{to:to,id:id,type:"error",error:data})};SessionManager.prototype._log=function(level,message){this.emit("log:"+level,message)};SessionManager.prototype.process=function(req){var self=this;var sid=!!req.jingle?req.jingle.sid:null;var session=this.sessions[sid]||null;var rid=req.id;var sender=req.from.full||req.from;if(req.type==="error"){var isTieBreak=req.error&&req.error.jingleCondition==="tie-break";if(session&&session.pending&&isTieBreak){return session.end("alternative-session",true)}else{if(session){session.pendingAction=false}return this.emit("error",req)}}if(req.type==="result"){if(session){session.pendingAction=false}return}var action=req.jingle.action;var contents=req.jingle.contents||[];var descriptionTypes=contents.map(function(content){if(content.description){return content.description.descType}});var transportTypes=contents.map(function(content){if(content.transport){return content.transport.transType}});if(action!=="session-initiate"){if(!session){this._log("error","Unknown session",sid);return this._sendError(sender,rid,{condition:"item-not-found",jingleCondition:"unknown-session"})}if(session.peerID!==sender||session.ended){this._log("error","Session has ended, or action has wrong sender");return this._sendError(sender,rid,{condition:"item-not-found",jingleCondition:"unknown-session"})}if(action==="session-accept"&&!session.pending){this._log("error","Tried to accept session twice",sid);return this._sendError(sender,rid,{condition:"unexpected-request",jingleCondition:"out-of-order"})}if(action!=="session-terminate"&&action===session.pendingAction){this._log("error","Tie break during pending request");if(session.isInitiator){return this._sendError(sender,rid,{condition:"conflict",jingleCondition:"tie-break"})}}}else if(session){if(session.peerID!==sender){this._log("error","Duplicate sid from new sender");return this._sendError(sender,rid,{condition:"service-unavailable"})}if(session.pending){if(this.selfID>session.peerID&&this.performTieBreak(session,req)){this._log("error","Tie break new session because of duplicate sids");return this._sendError(sender,rid,{condition:"conflict",jingleCondition:"tie-break"})}}else{this._log("error","Someone is doing this wrong");return this._sendError(sender,rid,{condition:"unexpected-request",jingleCondition:"out-of-order"})}}else if(this.peers[sender]&&this.peers[sender].length){for(var i=0,len=this.peers[sender].length;i<len;i++){var sess=this.peers[sender][i];if(sess&&sess.pending&&sess.sid>sid&&this.performTieBreak(sess,req)){this._log("info","Tie break session-initiate");return this._sendError(sender,rid,{condition:"conflict",jingleCondition:"tie-break"})}}}if(action==="session-initiate"){if(!contents.length){return self._sendError(sender,rid,{condition:"bad-request"})}session=this._createIncomingSession({sid:sid,peer:req.from,peerID:sender,initiator:false,parent:this,descriptionTypes:descriptionTypes,transportTypes:transportTypes,iceServers:this.iceServers,constraints:this.config.peerConnectionConstraints},req)}session.process(action,req.jingle,function(err){if(err){self._log("error","Could not process request",req,err);self._sendError(sender,rid,err)}else{self.emit("send",{to:sender,id:rid,type:"result"});if(action==="session-initiate"){self.emit("incoming",session)}}})};module.exports=SessionManager},{intersect:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/intersect/index.js","jingle-filetransfer-session":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/index.js","jingle-media-session":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/index.js","jingle-session":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-session/index.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js",webrtcsupport:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/webrtcsupport/index-browser.js",wildemitter:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/wildemitter/wildemitter.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/extend-object/extend-object.js":[function(require,module,exports){var arr=[];var each=arr.forEach;var slice=arr.slice;module.exports=function(obj){each.call(slice.call(arguments,1),function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/intersect/index.js":[function(require,module,exports){module.exports=intersect;function intersect(a,b){var res=[];for(var i=0;i<a.length;i++){if(indexOf(b,a[i])>-1)res.push(a[i])}return res}intersect.big=function(a,b){var ret=[];var temp={};for(var i=0;i<b.length;i++){temp[b[i]]=true}for(var i=0;i<a.length;i++){if(temp[a[i]])ret.push(a[i])}return ret};function indexOf(arr,el){for(var i=0;i<arr.length;i++){if(arr[i]===el)return i}return-1}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/index.js":[function(require,module,exports){var util=require("util");var extend=require("extend-object");var BaseSession=require("jingle-session");var RTCPeerConnection=require("rtcpeerconnection");var FileTransfer=require("filetransfer");function FileTransferSession(opts){BaseSession.call(this,opts);var self=this;this.pc=new RTCPeerConnection({iceServers:opts.iceServers||[],useJingle:true},opts.constraints||{});this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("iceConnectionStateChange",this.onIceStateChange.bind(this));this.pc.on("addChannel",this.onChannelAdded.bind(this));this.sender=new FileTransfer.Sender;this.sender.on("progress",function(sent,size){self._log("info","Send progress "+sent+"/"+size)});this.sender.on("sentFile",function(meta){self._log("info","Sent file",meta.name);var content=self.pc.localDescription.contents[0];delete content.transport;content.description={descType:"filetransfer",offer:{hash:{algo:meta.algo,value:meta.hash}}};self.send("description-info",{contents:[content]});self.emit("sentFile",self,meta)});this.receiver=new FileTransfer.Receiver;this.receiver.on("progress",function(received,size){self._log("info","Receive progress "+received+"/"+size)});this.receiver.on("receivedFile",function(file){self.receivedFile=file;self.maybeReceivedFile()})}util.inherits(FileTransferSession,BaseSession);FileTransferSession.prototype=extend(FileTransferSession.prototype,{start:function(file){var self=this;this.state="pending";this.pc.isInitiator=true;var sendChannel=this.pc.createDataChannel("filetransfer");sendChannel.onopen=function(){self.sender.send(file,sendChannel)};var constraints={mandatory:{OfferToReceiveAudio:false,OfferToReceiveVideo:false}};this.pc.offer(constraints,function(err,offer){if(err){self._log("error","Could not create WebRTC offer",err);return self.end("failed-application",true)}offer.jingle.contents[0].description={descType:"filetransfer",offer:{date:file.lastModifiedDate,name:file.name,size:file.size,hash:{algo:"sha-1",value:""}}};self.send("session-initiate",offer.jingle)})},accept:function(){var self=this;this._log("info","Accepted incoming session");this.state="active";this.pc.answer(function(err,answer){if(err){self._log("error","Could not create WebRTC answer",err);return self.end("failed-application")}answer.jingle.contents[0].name="data";self.send("session-accept",answer.jingle)})},end:function(reason,silent){this.pc.close();BaseSession.prototype.end.call(this,reason,silent)},maybeReceivedFile:function(){if(!this.receiver.metadata.hash.value){}else if(this.receiver.metadata.hash.value===this.receiver.metadata.actualhash){this._log("info","File hash matches");this.emit("receivedFile",this,this.receivedFile,this.receiver.metadata);this.end("success")}else{this._log("error","File hash does not match");this.end("media-error")}},onIceCandidate:function(candidate){this._log("info","Discovered new ICE candidate",candidate.jingle);candidate.jingle.contents[0].name="data";this.send("transport-info",candidate.jingle)},onIceStateChange:function(){switch(this.pc.iceConnectionState){case"checking":this.connectionState="connecting";break;case"completed":case"connected":this.connectionState="connected";break;case"disconnected":if(this.pc.signalingState==="stable"){this.connectionState="interrupted"}else{this.connectionState="disconnected"}break;case"failed":this.connectionState="failed";this.end("failed-transport");break;case"closed":this.connectionState="disconnected";break}},onChannelAdded:function(channel){this.receiver.receive(null,channel)},onSessionInitiate:function(changes,cb){var self=this;this._log("info","Initiating incoming session");this.state="pending";this.pc.isInitiator=false;var desc=changes.contents[0].description;this.receiver.metadata=desc.offer.toJSON();if(this.receiver.metadata.hash){this.receiver.config.hash=this.receiver.metadata.hash.algo}changes.contents[0].description={descType:"datachannel"};this.pc.handleOffer({type:"offer",jingle:changes},function(err){if(err){self._log("error","Could not create WebRTC answer");return cb({condition:"general-error"})}cb()})},onSessionAccept:function(changes,cb){var self=this;this.state="active";changes.contents[0].description={descType:"datachannel"};this.pc.handleAnswer({type:"answer",jingle:changes},function(err){if(err){self._log("error","Could not process WebRTC answer");return cb({condition:"general-error"})}self.emit("accepted",self);cb()})},onSessionTerminate:function(changes,cb){this._log("info","Terminating session");this.pc.close();BaseSession.prototype.end.call(this,changes.reason,true);cb()},onDescriptionInfo:function(info,cb){var hash=info.contents[0].description.offer.hash;this.receiver.metadata.hash=hash;if(this.receiver.metadata.actualhash){this.maybeReceivedFile()}cb()},onTransportInfo:function(changes,cb){this.pc.processIce(changes,function(){cb()})}});module.exports=FileTransferSession},{"extend-object":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/extend-object/extend-object.js",filetransfer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/filetransfer/filetransfer.js","jingle-session":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-session/index.js",rtcpeerconnection:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/rtcpeerconnection.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/filetransfer/filetransfer.js":[function(require,module,exports){var async=require("async");var WildEmitter=require("wildemitter");var util=require("util");var hashes=require("iana-hashes");function Sender(opts){WildEmitter.call(this);var self=this;var options=opts||{};this.config={chunksize:16384,pacing:10,hash:"sha-1"};var item;for(item in options){this.config[item]=options[item]}this.file=null;this.channel=null;this.hash=null;this.processingQueue=async.queue(function(task,next){if(task.type=="chunk"){var reader=new window.FileReader;reader.onload=function(){return function(e){self.channel.send(e.target.result);if(self.hash){self.hash.update(new Uint8Array(e.target.result))}self.emit("progress",task.start,task.file.size);window.setTimeout(next,self.config.pacing)}}(task.file);var slice=task.file.slice(task.start,task.start+task.size);reader.readAsArrayBuffer(slice)}else if(task.type=="complete"){self.emit("progress",self.file.size,self.file.size);self.emit("sentFile",self.hash?{hash:self.hash.digest("hex"),algo:self.config.hash}:null);next()}})}util.inherits(Sender,WildEmitter);Sender.prototype.send=function(file,channel){this.file=file;if(this.config.hash){this.hash=hashes.createHash(this.config.hash)}this.channel=channel;for(var start=0;start<this.file.size;start+=this.config.chunksize){this.processingQueue.push({type:"chunk",file:file,start:start,size:this.config.chunksize})}this.processingQueue.push({type:"complete"})};function Receiver(opts){WildEmitter.call(this);var options=opts||{};this.config={hash:"sha-1"};var item;for(item in options){this.config[item]=options[item]}this.receiveBuffer=[];this.received=0;this.metadata={};this.channel=null;this.hash=null}util.inherits(Receiver,WildEmitter);Receiver.prototype.receive=function(metadata,channel){var self=this;if(metadata){this.metadata=metadata}if(this.config.hash){this.hash=hashes.createHash(this.config.hash)}this.channel=channel;channel.binaryType="arraybuffer";this.channel.onmessage=function(event){var len=event.data.byteLength;self.received+=len;self.receiveBuffer.push(event.data);if(self.hash){self.hash.update(new Uint8Array(event.data))}self.emit("progress",self.received,self.metadata.size);if(self.received==self.metadata.size){if(self.hash){self.metadata.actualhash=self.hash.digest("hex")}self.emit("receivedFile",new window.Blob(self.receiveBuffer),self.metadata);self.receiveBuffer=[]}else if(self.received>self.metadata.size){console.error("received more than expected, discarding...");self.receiveBuffer=[]}}};module.exports={};module.exports.support=window&&window.File&&window.FileReader&&window.Blob;module.exports.Sender=Sender;module.exports.Receiver=Receiver},{async:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/async/lib/async.js","iana-hashes":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/index.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js",wildemitter:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/wildemitter/wildemitter.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/index.js":[function(require,module,exports){var baseGet=require("lodash._baseget"),toPath=require("lodash._topath"),isArray=require("lodash.isarray"),map=require("lodash.map");var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyDeep(path){var pathKey=path+"";path=toPath(path);return function(object){return baseGet(object,path,pathKey)}}function isKey(value,object){var type=typeof value;if(type=="string"&&reIsPlainProp.test(value)||type=="number"){return true}if(isArray(value)){return false}var result=!reIsDeepProp.test(value);return result||object!=null&&value in toObject(object)}function toObject(value){return isObject(value)?value:Object(value)}function pluck(collection,path){return map(collection,property(path))}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path)}module.exports=pluck},{"lodash._baseget":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash._baseget/index.js","lodash._topath":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash._topath/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js","lodash.map":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash._baseget/index.js":[function(require,module,exports){function baseGet(object,path,pathKey){if(object==null){return}if(pathKey!==undefined&&pathKey in toObject(object)){path=[pathKey]}var index=0,length=path.length;while(object!=null&&index<length){object=object[path[index++]]}return index&&index==length?object:undefined}function toObject(value){return isObject(value)?value:Object(value)}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=baseGet},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash._topath/index.js":[function(require,module,exports){var isArray=require("lodash.isarray");var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g;var reEscapeChar=/\\(\\)?/g;function baseToString(value){return value==null?"":value+""}function toPath(value){if(isArray(value)){return value}var result=[];baseToString(value).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result}module.exports=toPath},{"lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/index.js":[function(require,module,exports){var arrayMap=require("lodash._arraymap"),baseCallback=require("lodash._basecallback"),baseEach=require("lodash._baseeach"),isArray=require("lodash.isarray");var MAX_SAFE_INTEGER=9007199254740991;function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)});return result}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var getLength=baseProperty("length");
function isArrayLike(value){return value!=null&&isLength(getLength(value))}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function map(collection,iteratee,thisArg){var func=isArray(collection)?arrayMap:baseMap;iteratee=baseCallback(iteratee,thisArg,3);return func(collection,iteratee)}module.exports=map},{"lodash._arraymap":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._arraymap/index.js","lodash._basecallback":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/index.js","lodash._baseeach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._baseeach/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._arraymap/index.js":[function(require,module,exports){function arrayMap(array,iteratee){var index=-1,length=array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}module.exports=arrayMap},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/index.js":[function(require,module,exports){var baseIsEqual=require("lodash._baseisequal"),bindCallback=require("lodash._bindcallback"),isArray=require("lodash.isarray"),pairs=require("lodash.pairs");var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g;var reEscapeChar=/\\(\\)?/g;function baseToString(value){return value==null?"":value+""}function baseCallback(func,thisArg,argCount){var type=typeof func;if(type=="function"){return thisArg===undefined?func:bindCallback(func,thisArg,argCount)}if(func==null){return identity}if(type=="object"){return baseMatches(func)}return thisArg===undefined?property(func):baseMatchesProperty(func,thisArg)}function baseGet(object,path,pathKey){if(object==null){return}if(pathKey!==undefined&&pathKey in toObject(object)){path=[pathKey]}var index=0,length=path.length;while(object!=null&&index<length){object=object[path[index++]]}return index&&index==length?object:undefined}function baseIsMatch(object,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=toObject(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var result=customizer?customizer(objValue,srcValue,key):undefined;if(!(result===undefined?baseIsEqual(srcValue,objValue,customizer,true):result)){return false}}}return true}function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){var key=matchData[0][0],value=matchData[0][1];return function(object){if(object==null){return false}return object[key]===value&&(value!==undefined||key in toObject(object))}}return function(object){return baseIsMatch(object,matchData)}}function baseMatchesProperty(path,srcValue){var isArr=isArray(path),isCommon=isKey(path)&&isStrictComparable(srcValue),pathKey=path+"";path=toPath(path);return function(object){if(object==null){return false}var key=pathKey;object=toObject(object);if((isArr||!isCommon)&&!(key in object)){object=path.length==1?object:baseGet(object,baseSlice(path,0,-1));if(object==null){return false}key=last(path);object=toObject(object)}return object[key]===srcValue?srcValue!==undefined||key in object:baseIsEqual(srcValue,object[key],undefined,true)}}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function basePropertyDeep(path){var pathKey=path+"";path=toPath(path);return function(object){return baseGet(object,path,pathKey)}}function baseSlice(array,start,end){var index=-1,length=array.length;start=start==null?0:+start||0;if(start<0){start=-start>length?0:length+start}end=end===undefined||end>length?length:+end||0;if(end<0){end+=length}length=start>end?0:end-start>>>0;start>>>=0;var result=Array(length);while(++index<length){result[index]=array[index+start]}return result}function getMatchData(object){var result=pairs(object),length=result.length;while(length--){result[length][2]=isStrictComparable(result[length][1])}return result}function isKey(value,object){var type=typeof value;if(type=="string"&&reIsPlainProp.test(value)||type=="number"){return true}if(isArray(value)){return false}var result=!reIsDeepProp.test(value);return result||object!=null&&value in toObject(object)}function isStrictComparable(value){return value===value&&!isObject(value)}function toObject(value){return isObject(value)?value:Object(value)}function toPath(value){if(isArray(value)){return value}var result=[];baseToString(value).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)});return result}function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function identity(value){return value}function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path)}module.exports=baseCallback},{"lodash._baseisequal":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/index.js","lodash._bindcallback":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js","lodash.pairs":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash.pairs/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/index.js":[function(require,module,exports){var isArray=require("lodash.isarray"),isTypedArray=require("lodash.istypedarray"),keys=require("lodash.keys");var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",stringTag="[object String]";function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function baseIsEqual(value,other,customizer,isLoose,stackA,stackB){if(value===other){return true}if(value==null||other==null||!isObject(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,customizer,isLoose,stackA,stackB)}function baseIsEqualDeep(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=objToString.call(object);if(objTag==argsTag){objTag=objectTag}else if(objTag!=objectTag){objIsArr=isTypedArray(object)}}if(!othIsArr){othTag=objToString.call(other);if(othTag==argsTag){othTag=objectTag}else if(othTag!=objectTag){othIsArr=isTypedArray(other)}}var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!(objIsArr||objIsObj)){return equalByTag(object,other,objTag)}if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,customizer,isLoose,stackA,stackB)}}if(!isSameTag){return false}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]==object){return stackB[length]==other}}stackA.push(object);stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isLoose,stackA,stackB);stackA.pop();stackB.pop();return result}function equalArrays(array,other,equalFunc,customizer,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isLoose&&othLength>arrLength)){return false}while(++index<arrLength){var arrValue=array[index],othValue=other[index],result=customizer?customizer(isLoose?othValue:arrValue,isLoose?arrValue:othValue,index):undefined;if(result!==undefined){if(result){continue}return false}if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB)})){return false}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB))){return false}}return true}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+""}return false}function equalObjects(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isLoose){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isLoose?key in other:hasOwnProperty.call(other,key))){return false}}var skipCtor=isLoose;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key],result=customizer?customizer(isLoose?othValue:objValue,isLoose?objValue:othValue,key):undefined;if(!(result===undefined?equalFunc(objValue,othValue,customizer,isLoose,stackA,stackB):result)){return false}skipCtor||(skipCtor=key=="constructor")}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){return false}}return true}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=baseIsEqual},{"lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js","lodash.istypedarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.istypedarray/index.js","lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.istypedarray/index.js":[function(require,module,exports){var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var objToString=objectProto.toString;var MAX_SAFE_INTEGER=9007199254740991;function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)]}module.exports=isTypedArray},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js":[function(require,module,exports){function bindCallback(func,thisArg,argCount){if(typeof func!="function"){return identity}if(thisArg===undefined){return func}switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function identity(value){return value}module.exports=bindCallback},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash.pairs/index.js":[function(require,module,exports){var keys=require("lodash.keys");function toObject(value){return isObject(value)?value:Object(value)}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function pairs(object){object=toObject(object);var index=-1,props=keys(object),length=props.length,result=Array(length);while(++index<length){var key=props[index];result[index]=[key,object[key]]}return result}module.exports=pairs},{"lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._baseeach/index.js":[function(require,module,exports){var keys=require("lodash.keys");var MAX_SAFE_INTEGER=9007199254740991;var baseEach=createBaseEach(baseForOwn);var baseFor=createBaseFor();function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}function baseProperty(key){return function(object){return object==null?undefined:object[key]}}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){var length=collection?getLength(collection):0;if(!isLength(length)){return eachFunc(collection,iteratee)}var index=fromRight?length:-1,iterable=toObject(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var iterable=toObject(object),props=keysFunc(object),length=props.length,index=fromRight?length:-1;while(fromRight?index--:++index<length){var key=props[index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}var getLength=baseProperty("length");function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function toObject(value){return isObject(value)?value:Object(value)}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=baseEach},{"lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js":[function(require,module,exports){var getNative=require("lodash._getnative"),isArguments=require("lodash.isarguments"),isArray=require("lodash.isarray");var reIsUint=/^\d+$/;var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var nativeKeys=getNative(Object,"keys");var MAX_SAFE_INTEGER=9007199254740991;function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var getLength=baseProperty("length");function isArrayLike(value){return value!=null&&isLength(getLength(value))}function isIndex(value,length){value=typeof value=="number"||reIsUint.test(value)?+value:-1;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function shimKeys(object){var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length;var allowIndexes=!!length&&isLength(length)&&(isArray(object)||isArguments(object));var index=-1,result=[];while(++index<propsLength){var key=props[index];if(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key)){result.push(key)}}return result}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}var keys=!nativeKeys?shimKeys:function(object){var Ctor=object==null?undefined:object.constructor;if(typeof Ctor=="function"&&Ctor.prototype===object||typeof object!="function"&&isArrayLike(object)){return shimKeys(object)}return isObject(object)?nativeKeys(object):[]};function keysIn(object){if(object==null){return[]}if(!isObject(object)){object=Object(object)}var length=object.length;length=length&&isLength(length)&&(isArray(object)||isArguments(object))&&length||0;var Ctor=object.constructor,index=-1,isProto=typeof Ctor=="function"&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;while(++index<length){result[index]=index+""}for(var key in object){if(!(skipIndexes&&isIndex(key,length))&&!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}module.exports=keys},{"lodash._getnative":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash._getnative/index.js","lodash.isarguments":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash._getnative/index.js":[function(require,module,exports){var funcTag="[object Function]";var reIsHostCtor=/^\[object .+?Constructor\]$/;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}module.exports=getNative},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js":[function(require,module,exports){function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var propertyIsEnumerable=objectProto.propertyIsEnumerable;var MAX_SAFE_INTEGER=9007199254740991;function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var getLength=baseProperty("length");function isArrayLike(value){return value!=null&&isLength(getLength(value))}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isArguments(value){return isObjectLike(value)&&isArrayLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")}module.exports=isArguments},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/index.js":[function(require,module,exports){var toSDP=require("./lib/tosdp");var toJSON=require("./lib/tojson");exports.toIncomingSDPOffer=function(session){return toSDP.toSessionSDP(session,{role:"responder",direction:"incoming"})};exports.toOutgoingSDPOffer=function(session){return toSDP.toSessionSDP(session,{role:"initiator",direction:"outgoing"})};exports.toIncomingSDPAnswer=function(session){return toSDP.toSessionSDP(session,{role:"initiator",direction:"incoming"})};exports.toOutgoingSDPAnswer=function(session){return toSDP.toSessionSDP(session,{role:"responder",direction:"outgoing"})};exports.toIncomingMediaSDPOffer=function(media){return toSDP.toMediaSDP(media,{role:"responder",direction:"incoming"})};exports.toOutgoingMediaSDPOffer=function(media){return toSDP.toMediaSDP(media,{role:"initiator",direction:"outgoing"})};exports.toIncomingMediaSDPAnswer=function(media){return toSDP.toMediaSDP(media,{role:"initiator",direction:"incoming"})};exports.toOutgoingMediaSDPAnswer=function(media){return toSDP.toMediaSDP(media,{role:"responder",direction:"outgoing"})};exports.toCandidateSDP=toSDP.toCandidateSDP;exports.toMediaSDP=toSDP.toMediaSDP;exports.toSessionSDP=toSDP.toSessionSDP;exports.toIncomingJSONOffer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"responder",direction:"incoming",creators:creators})};exports.toOutgoingJSONOffer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"initiator",direction:"outgoing",creators:creators})};exports.toIncomingJSONAnswer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"initiator",direction:"incoming",creators:creators})};exports.toOutgoingJSONAnswer=function(sdp,creators){return toJSON.toSessionJSON(sdp,{role:"responder",direction:"outgoing",creators:creators})};exports.toIncomingMediaJSONOffer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"responder",direction:"incoming",creator:creator})};exports.toOutgoingMediaJSONOffer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"initiator",direction:"outgoing",creator:creator})};exports.toIncomingMediaJSONAnswer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"initiator",direction:"incoming",creator:creator})};exports.toOutgoingMediaJSONAnswer=function(sdp,creator){return toJSON.toMediaJSON(sdp,{role:"responder",direction:"outgoing",creator:creator})};exports.toCandidateJSON=toJSON.toCandidateJSON;exports.toMediaJSON=toJSON.toMediaJSON;exports.toSessionJSON=toJSON.toSessionJSON},{"./lib/tojson":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tojson.js","./lib/tosdp":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tosdp.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/parsers.js":[function(require,module,exports){exports.lines=function(sdp){return sdp.split("\r\n").filter(function(line){return line.length>0})};exports.findLine=function(prefix,mediaLines,sessionLines){var prefixLength=prefix.length;for(var i=0;i<mediaLines.length;i++){if(mediaLines[i].substr(0,prefixLength)===prefix){return mediaLines[i]}}if(!sessionLines){return false}for(var j=0;j<sessionLines.length;j++){if(sessionLines[j].substr(0,prefixLength)===prefix){return sessionLines[j]}}return false};exports.findLines=function(prefix,mediaLines,sessionLines){var results=[];var prefixLength=prefix.length;for(var i=0;i<mediaLines.length;i++){if(mediaLines[i].substr(0,prefixLength)===prefix){results.push(mediaLines[i])}}if(results.length||!sessionLines){return results}for(var j=0;j<sessionLines.length;j++){if(sessionLines[j].substr(0,prefixLength)===prefix){results.push(sessionLines[j])}}return results};exports.mline=function(line){var parts=line.substr(2).split(" ");var parsed={media:parts[0],port:parts[1],proto:parts[2],formats:[]};for(var i=3;i<parts.length;i++){if(parts[i]){parsed.formats.push(parts[i])}}return parsed};exports.rtpmap=function(line){var parts=line.substr(9).split(" ");var parsed={id:parts.shift()};parts=parts[0].split("/");parsed.name=parts[0];parsed.clockrate=parts[1];parsed.channels=parts.length==3?parts[2]:"1";return parsed};exports.sctpmap=function(line){var parts=line.substr(10).split(" ");var parsed={number:parts.shift(),protocol:parts.shift(),streams:parts.shift()};return parsed};exports.fmtp=function(line){var kv,key,value;var parts=line.substr(line.indexOf(" ")+1).split(";");var parsed=[];for(var i=0;i<parts.length;i++){kv=parts[i].split("=");key=kv[0].trim();value=kv[1];if(key&&value){parsed.push({key:key,value:value})}else if(key){parsed.push({key:"",value:key})}}return parsed};exports.crypto=function(line){var parts=line.substr(9).split(" ");var parsed={tag:parts[0],cipherSuite:parts[1],keyParams:parts[2],sessionParams:parts.slice(3).join(" ")};return parsed};exports.fingerprint=function(line){var parts=line.substr(14).split(" ");return{hash:parts[0],value:parts[1]}};exports.extmap=function(line){var parts=line.substr(9).split(" ");var parsed={};var idpart=parts.shift();var sp=idpart.indexOf("/");if(sp>=0){parsed.id=idpart.substr(0,sp);parsed.senders=idpart.substr(sp+1)}else{parsed.id=idpart;parsed.senders="sendrecv"}parsed.uri=parts.shift()||"";return parsed};exports.rtcpfb=function(line){var parts=line.substr(10).split(" ");var parsed={};parsed.id=parts.shift();parsed.type=parts.shift();if(parsed.type==="trr-int"){parsed.value=parts.shift()}else{parsed.subtype=parts.shift()||""}parsed.parameters=parts;return parsed};exports.candidate=function(line){var parts;if(line.indexOf("a=candidate:")===0){parts=line.substring(12).split(" ")}else{parts=line.substring(10).split(" ")}var candidate={foundation:parts[0],component:parts[1],protocol:parts[2].toLowerCase(),priority:parts[3],ip:parts[4],port:parts[5],type:parts[7],generation:"0"};for(var i=8;i<parts.length;i+=2){if(parts[i]==="raddr"){candidate.relAddr=parts[i+1]}else if(parts[i]==="rport"){candidate.relPort=parts[i+1]}else if(parts[i]==="generation"){candidate.generation=parts[i+1]}else if(parts[i]==="tcptype"){candidate.tcpType=parts[i+1]}}candidate.network="1";return candidate};exports.sourceGroups=function(lines){var parsed=[];for(var i=0;i<lines.length;i++){var parts=lines[i].substr(13).split(" ");parsed.push({semantics:parts.shift(),sources:parts})}return parsed};exports.sources=function(lines){var parsed=[];var sources={};for(var i=0;i<lines.length;i++){var parts=lines[i].substr(7).split(" ");var ssrc=parts.shift();if(!sources[ssrc]){var source={ssrc:ssrc,parameters:[]};parsed.push(source);sources[ssrc]=source}parts=parts.join(" ").split(":");var attribute=parts.shift();var value=parts.join(":")||null;sources[ssrc].parameters.push({key:attribute,value:value})}return parsed};exports.groups=function(lines){var parsed=[];var parts;for(var i=0;i<lines.length;i++){parts=lines[i].substr(8).split(" ");parsed.push({semantics:parts.shift(),contents:parts})}return parsed};exports.bandwidth=function(line){var parts=line.substr(2).split(":");var parsed={};parsed.type=parts.shift();parsed.bandwidth=parts.shift();return parsed};exports.msid=function(line){var data=line.substr(7);var parts=data.split(" ");return{msid:data,mslabel:parts[0],label:parts[1]}}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/senders.js":[function(require,module,exports){module.exports={initiator:{incoming:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",sendrecv:"both",inactive:"none"},outgoing:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"}},responder:{incoming:{initiator:"sendonly",responder:"recvonly",both:"sendrecv",none:"inactive",recvonly:"responder",sendonly:"initiator",sendrecv:"both",inactive:"none"},outgoing:{initiator:"recvonly",responder:"sendonly",both:"sendrecv",none:"inactive",recvonly:"initiator",sendonly:"responder",
sendrecv:"both",inactive:"none"}}}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tojson.js":[function(require,module,exports){var SENDERS=require("./senders");var parsers=require("./parsers");var idCounter=Math.random();exports._setIdCounter=function(counter){idCounter=counter};exports.toSessionJSON=function(sdp,opts){var i;var creators=opts.creators||[];var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var media=sdp.split("\r\nm=");for(i=1;i<media.length;i++){media[i]="m="+media[i];if(i!==media.length-1){media[i]+="\r\n"}}var session=media.shift()+"\r\n";var sessionLines=parsers.lines(session);var parsed={};var contents=[];for(i=0;i<media.length;i++){contents.push(exports.toMediaJSON(media[i],session,{role:role,direction:direction,creator:creators[i]||"initiator"}))}parsed.contents=contents;var groupLines=parsers.findLines("a=group:",sessionLines);if(groupLines.length){parsed.groups=parsers.groups(groupLines)}return parsed};exports.toMediaJSON=function(media,session,opts){var creator=opts.creator||"initiator";var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var lines=parsers.lines(media);var sessionLines=parsers.lines(session);var mline=parsers.mline(lines[0]);var content={creator:creator,name:mline.media,description:{descType:"rtp",media:mline.media,payloads:[],encryption:[],feedback:[],headerExtensions:[]},transport:{transType:"iceUdp",candidates:[],fingerprints:[]}};if(mline.media=="application"){content.description={descType:"datachannel"};content.transport.sctp=[]}var desc=content.description;var trans=content.transport;var mid=parsers.findLine("a=mid:",lines);if(mid){content.name=mid.substr(6)}if(parsers.findLine("a=sendrecv",lines,sessionLines)){content.senders="both"}else if(parsers.findLine("a=sendonly",lines,sessionLines)){content.senders=SENDERS[role][direction].sendonly}else if(parsers.findLine("a=recvonly",lines,sessionLines)){content.senders=SENDERS[role][direction].recvonly}else if(parsers.findLine("a=inactive",lines,sessionLines)){content.senders="none"}if(desc.descType=="rtp"){var bandwidth=parsers.findLine("b=",lines);if(bandwidth){desc.bandwidth=parsers.bandwidth(bandwidth)}var ssrc=parsers.findLine("a=ssrc:",lines);if(ssrc){desc.ssrc=ssrc.substr(7).split(" ")[0]}var rtpmapLines=parsers.findLines("a=rtpmap:",lines);rtpmapLines.forEach(function(line){var payload=parsers.rtpmap(line);payload.parameters=[];payload.feedback=[];var fmtpLines=parsers.findLines("a=fmtp:"+payload.id,lines);fmtpLines.forEach(function(line){payload.parameters=parsers.fmtp(line)});var fbLines=parsers.findLines("a=rtcp-fb:"+payload.id,lines);fbLines.forEach(function(line){payload.feedback.push(parsers.rtcpfb(line))});desc.payloads.push(payload)});var cryptoLines=parsers.findLines("a=crypto:",lines,sessionLines);cryptoLines.forEach(function(line){desc.encryption.push(parsers.crypto(line))});if(parsers.findLine("a=rtcp-mux",lines)){desc.mux=true}var fbLines=parsers.findLines("a=rtcp-fb:*",lines);fbLines.forEach(function(line){desc.feedback.push(parsers.rtcpfb(line))});var extLines=parsers.findLines("a=extmap:",lines);extLines.forEach(function(line){var ext=parsers.extmap(line);ext.senders=SENDERS[role][direction][ext.senders];desc.headerExtensions.push(ext)});var ssrcGroupLines=parsers.findLines("a=ssrc-group:",lines);desc.sourceGroups=parsers.sourceGroups(ssrcGroupLines||[]);var ssrcLines=parsers.findLines("a=ssrc:",lines);var sources=desc.sources=parsers.sources(ssrcLines||[]);var msidLine=parsers.findLine("a=msid:",lines);if(msidLine){var msid=parsers.msid(msidLine);["msid","mslabel","label"].forEach(function(key){for(var i=0;i<sources.length;i++){var found=false;for(var j=0;j<sources[i].parameters.length;j++){if(sources[i].parameters[j].key===key){found=true}}if(!found){sources[i].parameters.push({key:key,value:msid[key]})}}})}if(parsers.findLine("a=x-google-flag:conference",lines,sessionLines)){desc.googConferenceFlag=true}}var fingerprintLines=parsers.findLines("a=fingerprint:",lines,sessionLines);var setup=parsers.findLine("a=setup:",lines,sessionLines);fingerprintLines.forEach(function(line){var fp=parsers.fingerprint(line);if(setup){fp.setup=setup.substr(8)}trans.fingerprints.push(fp)});var ufragLine=parsers.findLine("a=ice-ufrag:",lines,sessionLines);var pwdLine=parsers.findLine("a=ice-pwd:",lines,sessionLines);if(ufragLine&&pwdLine){trans.ufrag=ufragLine.substr(12);trans.pwd=pwdLine.substr(10);trans.candidates=[];var candidateLines=parsers.findLines("a=candidate:",lines,sessionLines);candidateLines.forEach(function(line){trans.candidates.push(exports.toCandidateJSON(line))})}if(desc.descType=="datachannel"){var sctpmapLines=parsers.findLines("a=sctpmap:",lines);sctpmapLines.forEach(function(line){var sctp=parsers.sctpmap(line);trans.sctp.push(sctp)})}return content};exports.toCandidateJSON=function(line){var candidate=parsers.candidate(line.split("\r\n")[0]);candidate.id=(idCounter++).toString(36).substr(0,12);return candidate}},{"./parsers":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/parsers.js","./senders":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/senders.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tosdp.js":[function(require,module,exports){var SENDERS=require("./senders");exports.toSessionSDP=function(session,opts){var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var sid=opts.sid||session.sid||Date.now();var time=opts.time||Date.now();var sdp=["v=0","o=- "+sid+" "+time+" IN IP4 0.0.0.0","s=-","t=0 0"];var groups=session.groups||[];groups.forEach(function(group){sdp.push("a=group:"+group.semantics+" "+group.contents.join(" "))});var contents=session.contents||[];contents.forEach(function(content){sdp.push(exports.toMediaSDP(content,opts))});return sdp.join("\r\n")+"\r\n"};exports.toMediaSDP=function(content,opts){var sdp=[];var role=opts.role||"initiator";var direction=opts.direction||"outgoing";var desc=content.description;var transport=content.transport;var payloads=desc.payloads||[];var fingerprints=transport&&transport.fingerprints||[];var mline=[];if(desc.descType=="datachannel"){mline.push("application");mline.push("1");mline.push("DTLS/SCTP");if(transport.sctp){transport.sctp.forEach(function(map){mline.push(map.number)})}}else{mline.push(desc.media);mline.push("1");if(desc.encryption&&desc.encryption.length>0||fingerprints.length>0){mline.push("RTP/SAVPF")}else{mline.push("RTP/AVPF")}payloads.forEach(function(payload){mline.push(payload.id)})}sdp.push("m="+mline.join(" "));sdp.push("c=IN IP4 0.0.0.0");if(desc.bandwidth&&desc.bandwidth.type&&desc.bandwidth.bandwidth){sdp.push("b="+desc.bandwidth.type+":"+desc.bandwidth.bandwidth)}if(desc.descType=="rtp"){sdp.push("a=rtcp:1 IN IP4 0.0.0.0")}if(transport){if(transport.ufrag){sdp.push("a=ice-ufrag:"+transport.ufrag)}if(transport.pwd){sdp.push("a=ice-pwd:"+transport.pwd)}var pushedSetup=false;fingerprints.forEach(function(fingerprint){sdp.push("a=fingerprint:"+fingerprint.hash+" "+fingerprint.value);if(fingerprint.setup&&!pushedSetup){sdp.push("a=setup:"+fingerprint.setup)}});if(transport.sctp){transport.sctp.forEach(function(map){sdp.push("a=sctpmap:"+map.number+" "+map.protocol+" "+map.streams)})}}if(desc.descType=="rtp"){sdp.push("a="+(SENDERS[role][direction][content.senders]||"sendrecv"))}sdp.push("a=mid:"+content.name);if(desc.sources&&desc.sources.length){(desc.sources[0].parameters||[]).forEach(function(param){if(param.key==="msid"){sdp.push("a=msid:"+param.value)}})}if(desc.mux){sdp.push("a=rtcp-mux")}var encryption=desc.encryption||[];encryption.forEach(function(crypto){sdp.push("a=crypto:"+crypto.tag+" "+crypto.cipherSuite+" "+crypto.keyParams+(crypto.sessionParams?" "+crypto.sessionParams:""))});if(desc.googConferenceFlag){sdp.push("a=x-google-flag:conference")}payloads.forEach(function(payload){var rtpmap="a=rtpmap:"+payload.id+" "+payload.name+"/"+payload.clockrate;if(payload.channels&&payload.channels!="1"){rtpmap+="/"+payload.channels}sdp.push(rtpmap);if(payload.parameters&&payload.parameters.length){var fmtp=["a=fmtp:"+payload.id];var parameters=[];payload.parameters.forEach(function(param){parameters.push((param.key?param.key+"=":"")+param.value)});fmtp.push(parameters.join(";"));sdp.push(fmtp.join(" "))}if(payload.feedback){payload.feedback.forEach(function(fb){if(fb.type==="trr-int"){sdp.push("a=rtcp-fb:"+payload.id+" trr-int "+(fb.value?fb.value:"0"))}else{sdp.push("a=rtcp-fb:"+payload.id+" "+fb.type+(fb.subtype?" "+fb.subtype:""))}})}});if(desc.feedback){desc.feedback.forEach(function(fb){if(fb.type==="trr-int"){sdp.push("a=rtcp-fb:* trr-int "+(fb.value?fb.value:"0"))}else{sdp.push("a=rtcp-fb:* "+fb.type+(fb.subtype?" "+fb.subtype:""))}})}var hdrExts=desc.headerExtensions||[];hdrExts.forEach(function(hdr){sdp.push("a=extmap:"+hdr.id+(hdr.senders?"/"+SENDERS[role][direction][hdr.senders]:"")+" "+hdr.uri)});var ssrcGroups=desc.sourceGroups||[];ssrcGroups.forEach(function(ssrcGroup){sdp.push("a=ssrc-group:"+ssrcGroup.semantics+" "+ssrcGroup.sources.join(" "))});var ssrcs=desc.sources||[];ssrcs.forEach(function(ssrc){for(var i=0;i<ssrc.parameters.length;i++){var param=ssrc.parameters[i];sdp.push("a=ssrc:"+(ssrc.ssrc||desc.ssrc)+" "+param.key+(param.value?":"+param.value:""))}});var candidates=transport.candidates||[];candidates.forEach(function(candidate){sdp.push(exports.toCandidateSDP(candidate))});return sdp.join("\r\n")};exports.toCandidateSDP=function(candidate){var sdp=[];sdp.push(candidate.foundation);sdp.push(candidate.component);sdp.push(candidate.protocol.toUpperCase());sdp.push(candidate.priority);sdp.push(candidate.ip);sdp.push(candidate.port);var type=candidate.type;sdp.push("typ");sdp.push(type);if(type==="srflx"||type==="prflx"||type==="relay"){if(candidate.relAddr&&candidate.relPort){sdp.push("raddr");sdp.push(candidate.relAddr);sdp.push("rport");sdp.push(candidate.relPort)}}if(candidate.tcpType&&candidate.protocol.toUpperCase()=="TCP"){sdp.push("tcptype");sdp.push(candidate.tcpType)}sdp.push("generation");sdp.push(candidate.generation||"0");return"a=candidate:"+sdp.join(" ")}},{"./senders":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/senders.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/traceablepeerconnection/index.js":[function(require,module,exports){var util=require("util");var webrtc=require("webrtcsupport");var WildEmitter=require("wildemitter");function dumpSDP(description){return{type:description.type,sdp:description.sdp}}function dumpStream(stream){var info={label:stream.id};if(stream.getAudioTracks().length){info.audio=stream.getAudioTracks().map(function(track){return track.id})}if(stream.getVideoTracks().length){info.video=stream.getVideoTracks().map(function(track){return track.id})}return info}function TraceablePeerConnection(config,constraints){var self=this;WildEmitter.call(this);this.peerconnection=new webrtc.PeerConnection(config,constraints);this.trace=function(what,info){self.emit("PeerConnectionTrace",{time:new Date,type:what,value:info||""})};this.onicecandidate=null;this.peerconnection.onicecandidate=function(event){self.trace("onicecandidate",event.candidate);if(self.onicecandidate!==null){self.onicecandidate(event)}};this.onaddstream=null;this.peerconnection.onaddstream=function(event){self.trace("onaddstream",dumpStream(event.stream));if(self.onaddstream!==null){self.onaddstream(event)}};this.onremovestream=null;this.peerconnection.onremovestream=function(event){self.trace("onremovestream",dumpStream(event.stream));if(self.onremovestream!==null){self.onremovestream(event)}};this.onsignalingstatechange=null;this.peerconnection.onsignalingstatechange=function(event){self.trace("onsignalingstatechange",self.signalingState);if(self.onsignalingstatechange!==null){self.onsignalingstatechange(event)}};this.oniceconnectionstatechange=null;this.peerconnection.oniceconnectionstatechange=function(event){self.trace("oniceconnectionstatechange",self.iceConnectionState);if(self.oniceconnectionstatechange!==null){self.oniceconnectionstatechange(event)}};this.onnegotiationneeded=null;this.peerconnection.onnegotiationneeded=function(event){self.trace("onnegotiationneeded");if(self.onnegotiationneeded!==null){self.onnegotiationneeded(event)}};self.ondatachannel=null;this.peerconnection.ondatachannel=function(event){self.trace("ondatachannel",event);if(self.ondatachannel!==null){self.ondatachannel(event)}};this.getLocalStreams=this.peerconnection.getLocalStreams.bind(this.peerconnection);this.getRemoteStreams=this.peerconnection.getRemoteStreams.bind(this.peerconnection)}util.inherits(TraceablePeerConnection,WildEmitter);Object.defineProperty(TraceablePeerConnection.prototype,"signalingState",{get:function(){return this.peerconnection.signalingState}});Object.defineProperty(TraceablePeerConnection.prototype,"iceConnectionState",{get:function(){return this.peerconnection.iceConnectionState}});Object.defineProperty(TraceablePeerConnection.prototype,"localDescription",{get:function(){return this.peerconnection.localDescription}});Object.defineProperty(TraceablePeerConnection.prototype,"remoteDescription",{get:function(){return this.peerconnection.remoteDescription}});TraceablePeerConnection.prototype.addStream=function(stream){this.trace("addStream",dumpStream(stream));this.peerconnection.addStream(stream)};TraceablePeerConnection.prototype.removeStream=function(stream){this.trace("removeStream",dumpStream(stream));this.peerconnection.removeStream(stream)};TraceablePeerConnection.prototype.createDataChannel=function(label,opts){this.trace("createDataChannel",label,opts);return this.peerconnection.createDataChannel(label,opts)};TraceablePeerConnection.prototype.setLocalDescription=function(description,successCallback,failureCallback){var self=this;this.trace("setLocalDescription",dumpSDP(description));this.peerconnection.setLocalDescription(description,function(){self.trace("setLocalDescriptionOnSuccess");successCallback()},function(err){self.trace("setLocalDescriptionOnFailure",err);failureCallback(err)})};TraceablePeerConnection.prototype.setRemoteDescription=function(description,successCallback,failureCallback){var self=this;this.trace("setRemoteDescription",dumpSDP(description));this.peerconnection.setRemoteDescription(description,function(){self.trace("setRemoteDescriptionOnSuccess");successCallback()},function(err){self.trace("setRemoteDescriptionOnFailure",err);failureCallback(err)})};TraceablePeerConnection.prototype.close=function(){this.trace("stop");if(this.statsinterval!==null){window.clearInterval(this.statsinterval);this.statsinterval=null}if(this.peerconnection.signalingState!="closed"){this.peerconnection.close()}};TraceablePeerConnection.prototype.createOffer=function(successCallback,failureCallback,constraints){var self=this;this.trace("createOffer",constraints);this.peerconnection.createOffer(function(offer){self.trace("createOfferOnSuccess",dumpSDP(offer));successCallback(offer)},function(err){self.trace("createOfferOnFailure",err);failureCallback(err)},constraints)};TraceablePeerConnection.prototype.createAnswer=function(successCallback,failureCallback,constraints){var self=this;this.trace("createAnswer",constraints);this.peerconnection.createAnswer(function(answer){self.trace("createAnswerOnSuccess",dumpSDP(answer));successCallback(answer)},function(err){self.trace("createAnswerOnFailure",err);failureCallback(err)},constraints)};TraceablePeerConnection.prototype.addIceCandidate=function(candidate,successCallback,failureCallback){var self=this;this.trace("addIceCandidate",candidate);this.peerconnection.addIceCandidate(candidate,function(){if(successCallback)successCallback()},function(err){self.trace("addIceCandidateOnFailure",err);if(failureCallback)failureCallback(err)})};TraceablePeerConnection.prototype.getStats=function(callback,errback){if(navigator.mozGetUserMedia){this.peerconnection.getStats(null,callback,errback)}else{this.peerconnection.getStats(callback)}};module.exports=TraceablePeerConnection},{util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js",webrtcsupport:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/webrtcsupport/index-browser.js",wildemitter:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/wildemitter/wildemitter.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/webrtc-adapter-test/adapter.js":[function(require,module,exports){"use strict";var getUserMedia=null;var attachMediaStream=null;var reattachMediaStream=null;var webrtcDetectedBrowser=null;var webrtcDetectedVersion=null;var webrtcMinimumVersion=null;function trace(text){if(text[text.length-1]==="\n"){text=text.substring(0,text.length-1)}if(window.performance){var now=(window.performance.now()/1e3).toFixed(3);console.log(now+": "+text)}else{console.log(text)}}if(typeof window==="undefined"||!window.navigator){console.log("This does not appear to be a browser");webrtcDetectedBrowser="not a browser"}else if(navigator.mozGetUserMedia){console.log("This appears to be Firefox");webrtcDetectedBrowser="firefox";webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10);webrtcMinimumVersion=31;window.RTCPeerConnection=function(pcConfig,pcConstraints){if(webrtcDetectedVersion<38){if(pcConfig&&pcConfig.iceServers){var newIceServers=[];for(var i=0;i<pcConfig.iceServers.length;i++){var server=pcConfig.iceServers[i];if(server.hasOwnProperty("urls")){for(var j=0;j<server.urls.length;j++){var newServer={url:server.urls[j]};if(server.urls[j].indexOf("turn")===0){newServer.username=server.username;newServer.credential=server.credential}newIceServers.push(newServer)}}else{newIceServers.push(pcConfig.iceServers[i])}}pcConfig.iceServers=newIceServers}}return new mozRTCPeerConnection(pcConfig,pcConstraints)};window.RTCSessionDescription=mozRTCSessionDescription;window.RTCIceCandidate=mozRTCIceCandidate;getUserMedia=webrtcDetectedVersion<38?function(c,onSuccess,onError){var constraintsToFF37=function(c){if(typeof c!=="object"||c.require){return c}var require=[];Object.keys(c).forEach(function(key){var r=c[key]=typeof c[key]==="object"?c[key]:{ideal:c[key]};if(r.exact!==undefined){r.min=r.max=r.exact;delete r.exact}if(r.min!==undefined||r.max!==undefined){require.push(key)}if(r.ideal!==undefined){c.advanced=c.advanced||[];var oc={};oc[key]={min:r.ideal,max:r.ideal};c.advanced.push(oc);delete r.ideal;if(!Object.keys(r).length){delete c[key]}}});if(require.length){c.require=require}return c};console.log("spec: "+JSON.stringify(c));c.audio=constraintsToFF37(c.audio);c.video=constraintsToFF37(c.video);console.log("ff37: "+JSON.stringify(c));return navigator.mozGetUserMedia(c,onSuccess,onError)}:navigator.mozGetUserMedia.bind(navigator);navigator.getUserMedia=getUserMedia;if(!navigator.mediaDevices){navigator.mediaDevices={getUserMedia:requestUserMedia,addEventListener:function(){},removeEventListener:function(){}}}navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(resolve){var infos=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];resolve(infos)})};if(webrtcDetectedVersion<41){var orgEnumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return orgEnumerateDevices().catch(function(e){if(e.name==="NotFoundError"){return[]}throw e})}}attachMediaStream=function(element,stream){console.log("Attaching media stream");element.mozSrcObject=stream};reattachMediaStream=function(to,from){console.log("Reattaching media stream");to.mozSrcObject=from.mozSrcObject}}else if(navigator.webkitGetUserMedia){console.log("This appears to be Chrome");webrtcDetectedBrowser="chrome";webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10);webrtcMinimumVersion=38;window.RTCPeerConnection=function(pcConfig,pcConstraints){var pc=new webkitRTCPeerConnection(pcConfig,pcConstraints);var origGetStats=pc.getStats.bind(pc);pc.getStats=function(selector,successCallback,errorCallback){if(typeof selector==="function"){return origGetStats(selector,successCallback)}var fixChromeStats=function(response){var standardReport={};var reports=response.result();reports.forEach(function(report){var standardStats={id:report.id,timestamp:report.timestamp,type:report.type};report.names().forEach(function(name){standardStats[name]=report.stat(name)});standardReport[standardStats.id]=standardStats});return standardReport};var successCallbackWrapper=function(response){successCallback(fixChromeStats(response))};return origGetStats(successCallbackWrapper,selector)};return pc};["createOffer","createAnswer"].forEach(function(method){var nativeMethod=webkitRTCPeerConnection.prototype[method];webkitRTCPeerConnection.prototype[method]=function(){var self=this;if(arguments.length<1||arguments.length===1&&typeof arguments[0]==="object"){var opts=arguments.length===1?arguments[0]:undefined;return new Promise(function(resolve,reject){nativeMethod.apply(self,[resolve,reject,opts])})}else{return nativeMethod.apply(this,arguments)}}});["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(method){var nativeMethod=webkitRTCPeerConnection.prototype[method];webkitRTCPeerConnection.prototype[method]=function(){var args=arguments;var self=this;return new Promise(function(resolve,reject){nativeMethod.apply(self,[args[0],function(){resolve();if(args.length>=2){args[1].apply(null,[])}},function(err){reject(err);if(args.length>=3){args[2].apply(null,[err])}}])})}});getUserMedia=function(c,onSuccess,onError){var constraintsToChrome=function(c){if(typeof c!=="object"||c.mandatory||c.optional){return c}var cc={};Object.keys(c).forEach(function(key){if(key==="require"||key==="advanced"){return}var r=typeof c[key]==="object"?c[key]:{ideal:c[key]};if(r.exact!==undefined&&typeof r.exact==="number"){r.min=r.max=r.exact}var oldname=function(prefix,name){if(prefix){return prefix+name.charAt(0).toUpperCase()+name.slice(1)}return name==="deviceId"?"sourceId":name};if(r.ideal!==undefined){cc.optional=cc.optional||[];var oc={};if(typeof r.ideal==="number"){oc[oldname("min",key)]=r.ideal;cc.optional.push(oc);oc={};oc[oldname("max",key)]=r.ideal;cc.optional.push(oc)}else{oc[oldname("",key)]=r.ideal;cc.optional.push(oc)}}if(r.exact!==undefined&&typeof r.exact!=="number"){cc.mandatory=cc.mandatory||{};cc.mandatory[oldname("",key)]=r.exact}else{["min","max"].forEach(function(mix){if(r[mix]!==undefined){cc.mandatory=cc.mandatory||{};cc.mandatory[oldname(mix,key)]=r[mix]}})}});if(c.advanced){cc.optional=(cc.optional||[]).concat(c.advanced)}return cc};console.log("spec:   "+JSON.stringify(c));c.audio=constraintsToChrome(c.audio);c.video=constraintsToChrome(c.video);console.log("chrome: "+JSON.stringify(c));return navigator.webkitGetUserMedia(c,onSuccess,onError)};navigator.getUserMedia=getUserMedia;attachMediaStream=function(element,stream){if(typeof element.srcObject!=="undefined"){element.srcObject=stream}else if(typeof element.src!=="undefined"){element.src=URL.createObjectURL(stream)}else{console.log("Error attaching stream to element.")}};reattachMediaStream=function(to,from){to.src=from.src};if(!navigator.mediaDevices){navigator.mediaDevices={getUserMedia:requestUserMedia,enumerateDevices:function(){return new Promise(function(resolve){var kinds={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(devices){resolve(devices.map(function(device){return{label:device.label,kind:kinds[device.kind],deviceId:device.id,groupId:""}}))})})}};navigator.mediaDevices.addEventListener=function(){};navigator.mediaDevices.removeEventListener=function(){}}}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)){console.log("This appears to be Edge");webrtcDetectedBrowser="edge";webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)[2],10);webrtcMinimumVersion=12;attachMediaStream=function(element,stream){element.srcObject=stream};reattachMediaStream=function(to,from){to.srcObject=from.srcObject}}else{console.log("Browser does not appear to be WebRTC-capable")}function requestUserMedia(constraints){return new Promise(function(resolve,reject){getUserMedia(constraints,resolve,reject)})}if(typeof module!=="undefined"){var RTCPeerConnection="undefined";if(typeof window!=="undefined"){RTCPeerConnection=window.RTCPeerConnection}module.exports={RTCPeerConnection:RTCPeerConnection,getUserMedia:getUserMedia,attachMediaStream:attachMediaStream,reattachMediaStream:reattachMediaStream,webrtcDetectedBrowser:webrtcDetectedBrowser,webrtcDetectedVersion:webrtcDetectedVersion,webrtcMinimumVersion:webrtcMinimumVersion}}else if(typeof require==="function"&&typeof define==="function"){define([],function(){return{RTCPeerConnection:window.RTCPeerConnection,getUserMedia:getUserMedia,attachMediaStream:attachMediaStream,reattachMediaStream:reattachMediaStream,webrtcDetectedBrowser:webrtcDetectedBrowser,webrtcDetectedVersion:webrtcDetectedVersion,webrtcMinimumVersion:webrtcMinimumVersion}})}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/rtcpeerconnection.js":[function(require,module,exports){var util=require("util");var each=require("lodash.foreach");var pluck=require("lodash.pluck");var webrtc=require("webrtcsupport");var SJJ=require("sdp-jingle-json");var WildEmitter=require("wildemitter");var peerconn=require("traceablepeerconnection");var adapter=require("webrtc-adapter-test");function PeerConnection(config,constraints){var self=this;var item;WildEmitter.call(this);config=config||{};config.iceServers=config.iceServers||[];this.enableChromeNativeSimulcast=false;if(constraints&&constraints.optional&&adapter.webrtcDetectedBrowser==="chrome"&&navigator.appVersion.match(/Chromium\//)===null){constraints.optional.forEach(function(constraint,idx){if(constraint.enableChromeNativeSimulcast){self.enableChromeNativeSimulcast=true}})}this.enableMultiStreamHacks=false;if(constraints&&constraints.optional&&adapter.webrtcDetectedBrowser==="chrome"){constraints.optional.forEach(function(constraint,idx){if(constraint.enableMultiStreamHacks){self.enableMultiStreamHacks=true}})}this.restrictBandwidth=0;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetRestrictBandwidth){self.restrictBandwidth=constraint.andyetRestrictBandwidth}})}this.batchIceCandidates=0;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetBatchIce){self.batchIceCandidates=constraint.andyetBatchIce}})}this.batchedIceCandidates=[];if(constraints&&constraints.optional&&adapter.webrtcDetectedBrowser==="chrome"){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetFasterICE){self.eliminateDuplicateCandidates=constraint.andyetFasterICE}})}if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetDontSignalCandidates){self.dontSignalCandidates=constraint.andyetDontSignalCandidates}})}this.assumeSetLocalSuccess=false;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetAssumeSetLocalSuccess){self.assumeSetLocalSuccess=constraint.andyetAssumeSetLocalSuccess}})}if(adapter.webrtcDetectedBrowser==="firefox"){if(constraints&&constraints.optional){this.wtFirefox=0;constraints.optional.forEach(function(constraint,idx){if(constraint.andyetFirefoxMakesMeSad){self.wtFirefox=constraint.andyetFirefoxMakesMeSad;if(self.wtFirefox>0){self.firefoxcandidatebuffer=[]}}})}}this.pc=new peerconn(config,constraints);this.getLocalStreams=this.pc.getLocalStreams.bind(this.pc);this.getRemoteStreams=this.pc.getRemoteStreams.bind(this.pc);this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=this.pc.removeStream.bind(this.pc);this.pc.on("*",function(){self.emit.apply(self,arguments)});this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:false,ice:{},sid:"",isInitiator:true,sdpSessionID:Date.now(),useJingle:false};for(item in config){this.config[item]=config[item]}if(this.config.debug){this.on("*",function(eventName,event){var logger=config.logger||console;logger.log("PeerConnection event:",arguments)})}this.hadLocalStunCandidate=false;this.hadRemoteStunCandidate=false;this.hadLocalRelayCandidate=false;this.hadRemoteRelayCandidate=false;this.hadLocalIPv6Candidate=false;this.hadRemoteIPv6Candidate=false;this._remoteDataChannels=[];this._localDataChannels=[];this._candidateBuffer=[]}util.inherits(PeerConnection,WildEmitter);Object.defineProperty(PeerConnection.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(PeerConnection.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});PeerConnection.prototype._role=function(){return this.isInitiator?"initiator":"responder"};PeerConnection.prototype.addStream=function(stream){this.localStream=stream;this.pc.addStream(stream)};PeerConnection.prototype._checkLocalCandidate=function(candidate){var cand=SJJ.toCandidateJSON(candidate);if(cand.type=="srflx"){this.hadLocalStunCandidate=true}else if(cand.type=="relay"){this.hadLocalRelayCandidate=true}if(cand.ip.indexOf(":")!=-1){this.hadLocalIPv6Candidate=true}};PeerConnection.prototype._checkRemoteCandidate=function(candidate){var cand=SJJ.toCandidateJSON(candidate);if(cand.type=="srflx"){this.hadRemoteStunCandidate=true}else if(cand.type=="relay"){this.hadRemoteRelayCandidate=true}if(cand.ip.indexOf(":")!=-1){this.hadRemoteIPv6Candidate=true}};PeerConnection.prototype.processIce=function(update,cb){cb=cb||function(){};var self=this;if(this.pc.signalingState==="closed")return cb();if(update.contents||update.jingle&&update.jingle.contents){var contentNames=pluck(this.remoteDescription.contents,"name");var contents=update.contents||update.jingle.contents;contents.forEach(function(content){var transport=content.transport||{};var candidates=transport.candidates||[];var mline=contentNames.indexOf(content.name);var mid=content.name;candidates.forEach(function(candidate){var iceCandidate=SJJ.toCandidateSDP(candidate)+"\r\n";self.pc.addIceCandidate(new RTCIceCandidate({candidate:iceCandidate,sdpMLineIndex:mline,sdpMid:mid}),function(){},function(err){self.emit("error",err)});self._checkRemoteCandidate(iceCandidate)})})}else{if(update.candidate&&update.candidate.candidate.indexOf("a=")!==0){update.candidate.candidate="a="+update.candidate.candidate}if(this.wtFirefox&&this.firefoxcandidatebuffer!==null){if(this.pc.localDescription&&this.pc.localDescription.type==="offer"){this.firefoxcandidatebuffer.push(update.candidate);
return cb()}}self.pc.addIceCandidate(new RTCIceCandidate(update.candidate),function(){},function(err){self.emit("error",err)});self._checkRemoteCandidate(update.candidate.candidate)}cb()};PeerConnection.prototype.offer=function(constraints,cb){var self=this;var hasConstraints=arguments.length===2;var mediaConstraints=hasConstraints&&constraints?constraints:{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}};cb=hasConstraints?cb:constraints;cb=cb||function(){};if(this.pc.signalingState==="closed")return cb("Already closed");this.pc.createOffer(function(offer){var expandedOffer={type:"offer",sdp:offer.sdp};if(self.assumeSetLocalSuccess){self.emit("offer",expandedOffer);cb(null,expandedOffer)}self._candidateBuffer=[];self.pc.setLocalDescription(offer,function(){var jingle;if(self.config.useJingle){jingle=SJJ.toSessionJSON(offer.sdp,{role:self._role(),direction:"outgoing"});jingle.sid=self.config.sid;self.localDescription=jingle;each(jingle.contents,function(content){var transport=content.transport||{};if(transport.ufrag){self.config.ice[content.name]={ufrag:transport.ufrag,pwd:transport.pwd}}});expandedOffer.jingle=jingle}expandedOffer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkLocalCandidate(line)}});if(!self.assumeSetLocalSuccess){self.emit("offer",expandedOffer);cb(null,expandedOffer)}},function(err){self.emit("error",err);cb(err)})},function(err){self.emit("error",err);cb(err)},mediaConstraints)};PeerConnection.prototype.handleOffer=function(offer,cb){cb=cb||function(){};var self=this;offer.type="offer";if(offer.jingle){if(this.enableChromeNativeSimulcast){offer.jingle.contents.forEach(function(content){if(content.name==="video"){content.description.googConferenceFlag=true}})}if(this.enableMultiStreamHacks){offer.jingle.contents.forEach(function(content){if(content.name==="video"){var sources=content.description.sources||[];if(sources.length===0||sources[0].ssrc!=="3735928559"){sources.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]});content.description.sources=sources}}})}if(self.restrictBandwidth>0){if(offer.jingle.contents.length>=2&&offer.jingle.contents[1].name==="video"){var content=offer.jingle.contents[1];var hasBw=content.description&&content.description.bandwidth;if(!hasBw){offer.jingle.contents[1].description.bandwidth={type:"AS",bandwidth:self.restrictBandwidth.toString()};offer.sdp=SJJ.toSessionSDP(offer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"outgoing"})}}}offer.sdp=SJJ.toSessionSDP(offer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"incoming"});self.remoteDescription=offer.jingle}offer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkRemoteCandidate(line)}});self.pc.setRemoteDescription(new RTCSessionDescription(offer),function(){cb()},cb)};PeerConnection.prototype.answerAudioOnly=function(cb){var mediaConstraints={mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:false}};this._answer(mediaConstraints,cb)};PeerConnection.prototype.answerBroadcastOnly=function(cb){var mediaConstraints={mandatory:{OfferToReceiveAudio:false,OfferToReceiveVideo:false}};this._answer(mediaConstraints,cb)};PeerConnection.prototype.answer=function(constraints,cb){var self=this;var hasConstraints=arguments.length===2;var callback=hasConstraints?cb:constraints;var mediaConstraints=hasConstraints&&constraints?constraints:{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}};this._answer(mediaConstraints,callback)};PeerConnection.prototype.handleAnswer=function(answer,cb){cb=cb||function(){};var self=this;if(answer.jingle){answer.sdp=SJJ.toSessionSDP(answer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"incoming"});self.remoteDescription=answer.jingle}answer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkRemoteCandidate(line)}});self.pc.setRemoteDescription(new RTCSessionDescription(answer),function(){if(self.wtFirefox){window.setTimeout(function(){self.firefoxcandidatebuffer.forEach(function(candidate){self.pc.addIceCandidate(new RTCIceCandidate(candidate),function(){},function(err){self.emit("error",err)});self._checkRemoteCandidate(candidate.candidate)});self.firefoxcandidatebuffer=null},self.wtFirefox)}cb(null)},cb)};PeerConnection.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};PeerConnection.prototype._answer=function(constraints,cb){cb=cb||function(){};var self=this;if(!this.pc.remoteDescription){throw new Error("remoteDescription not set")}if(this.pc.signalingState==="closed")return cb("Already closed");self.pc.createAnswer(function(answer){var sim=[];var rtx=[];if(self.enableChromeNativeSimulcast){answer.jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"});if(answer.jingle.contents.length>=2&&answer.jingle.contents[1].name==="video"){var hasSimgroup=false;var groups=answer.jingle.contents[1].description.sourceGroups||[];var hasSim=false;groups.forEach(function(group){if(group.semantics=="SIM")hasSim=true});if(!hasSim&&answer.jingle.contents[1].description.sources.length){var newssrc=JSON.parse(JSON.stringify(answer.jingle.contents[1].description.sources[0]));newssrc.ssrc=""+Math.floor(Math.random()*4294967295);answer.jingle.contents[1].description.sources.push(newssrc);sim.push(answer.jingle.contents[1].description.sources[0].ssrc);sim.push(newssrc.ssrc);groups.push({semantics:"SIM",sources:sim});var rtxssrc=JSON.parse(JSON.stringify(newssrc));rtxssrc.ssrc=""+Math.floor(Math.random()*4294967295);answer.jingle.contents[1].description.sources.push(rtxssrc);groups.push({semantics:"FID",sources:[newssrc.ssrc,rtxssrc.ssrc]});answer.jingle.contents[1].description.sourceGroups=groups;answer.sdp=SJJ.toSessionSDP(answer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"outgoing"})}}}var expandedAnswer={type:"answer",sdp:answer.sdp};if(self.assumeSetLocalSuccess){self.emit("answer",expandedAnswer);cb(null,expandedAnswer)}self._candidateBuffer=[];self.pc.setLocalDescription(answer,function(){if(self.config.useJingle){var jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"});jingle.sid=self.config.sid;self.localDescription=jingle;expandedAnswer.jingle=jingle}if(self.enableChromeNativeSimulcast){if(!expandedAnswer.jingle){expandedAnswer.jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"})}var groups=expandedAnswer.jingle.contents[1].description.sourceGroups||[];expandedAnswer.jingle.contents[1].description.sources.forEach(function(source,idx){source.parameters=source.parameters.map(function(parameter){if(parameter.key==="msid"){parameter.value+="-"+Math.floor(idx/2)}return parameter})});expandedAnswer.sdp=SJJ.toSessionSDP(expandedAnswer.jingle,{sid:self.sdpSessionID,role:self._role(),direction:"outgoing"})}expandedAnswer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkLocalCandidate(line)}});if(!self.assumeSetLocalSuccess){self.emit("answer",expandedAnswer);cb(null,expandedAnswer)}},function(err){self.emit("error",err);cb(err)})},function(err){self.emit("error",err);cb(err)},constraints)};PeerConnection.prototype._onIce=function(event){var self=this;if(event.candidate){if(this.dontSignalCandidates)return;var ice=event.candidate;var expandedCandidate={candidate:{candidate:ice.candidate,sdpMid:ice.sdpMid,sdpMLineIndex:ice.sdpMLineIndex}};this._checkLocalCandidate(ice.candidate);var cand=SJJ.toCandidateJSON(ice.candidate);var already;var idx;if(this.eliminateDuplicateCandidates&&cand.type==="relay"){already=this._candidateBuffer.filter(function(c){return c.type==="relay"}).map(function(c){return c.foundation+":"+c.component});idx=already.indexOf(cand.foundation+":"+cand.component);if(idx>-1&&cand.priority>>24>=already[idx].priority>>24){return}}if(this.config.bundlePolicy==="max-bundle"){already=this._candidateBuffer.filter(function(c){return cand.type===c.type}).map(function(cand){return cand.address+":"+cand.port});idx=already.indexOf(cand.address+":"+cand.port);if(idx>-1)return}if(this.config.rtcpMuxPolicy==="require"&&cand.component==="2"){return}this._candidateBuffer.push(cand);if(self.config.useJingle){if(!ice.sdpMid){if(self.pc.remoteDescription&&self.pc.remoteDescription.type==="offer"){ice.sdpMid=self.remoteDescription.contents[ice.sdpMLineIndex].name}else{ice.sdpMid=self.localDescription.contents[ice.sdpMLineIndex].name}}if(!self.config.ice[ice.sdpMid]){var jingle=SJJ.toSessionJSON(self.pc.localDescription.sdp,{role:self._role(),direction:"outgoing"});each(jingle.contents,function(content){var transport=content.transport||{};if(transport.ufrag){self.config.ice[content.name]={ufrag:transport.ufrag,pwd:transport.pwd}}})}expandedCandidate.jingle={contents:[{name:ice.sdpMid,creator:self._role(),transport:{transType:"iceUdp",ufrag:self.config.ice[ice.sdpMid].ufrag,pwd:self.config.ice[ice.sdpMid].pwd,candidates:[cand]}}]};if(self.batchIceCandidates>0){if(self.batchedIceCandidates.length===0){window.setTimeout(function(){var contents={};self.batchedIceCandidates.forEach(function(content){content=content.contents[0];if(!contents[content.name])contents[content.name]=content;contents[content.name].transport.candidates.push(content.transport.candidates[0])});var newCand={jingle:{contents:[]}};Object.keys(contents).forEach(function(name){newCand.jingle.contents.push(contents[name])});self.batchedIceCandidates=[];self.emit("ice",newCand)},self.batchIceCandidates)}self.batchedIceCandidates.push(expandedCandidate.jingle);return}}this.emit("ice",expandedCandidate)}else{this.emit("endOfCandidates")}};PeerConnection.prototype._onDataChannel=function(event){var channel=event.channel;this._remoteDataChannels.push(channel);this.emit("addChannel",channel)};PeerConnection.prototype.createDataChannel=function(name,opts){var channel=this.pc.createDataChannel(name,opts);this._localDataChannels.push(channel);return channel};PeerConnection.prototype.getStats=function(cb){if(adapter.webrtcDetectedBrowser==="firefox"){this.pc.getStats(function(res){var items=[];for(var result in res){if(typeof res[result]==="object"){items.push(res[result])}}cb(null,items)},cb)}else{this.pc.getStats(function(res){var items=[];res.result().forEach(function(result){var item={};result.names().forEach(function(name){item[name]=result.stat(name)});item.id=result.id;item.type=result.type;item.timestamp=result.timestamp;items.push(item)});cb(null,items)})}};module.exports=PeerConnection},{"lodash.foreach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/index.js","lodash.pluck":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/index.js","sdp-jingle-json":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/index.js",traceablepeerconnection:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/traceablepeerconnection/index.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js","webrtc-adapter-test":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/webrtc-adapter-test/adapter.js",webrtcsupport:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/webrtcsupport/index-browser.js",wildemitter:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/wildemitter/wildemitter.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/index.js":[function(require,module,exports){var util=require("util");var extend=require("extend-object");var BaseSession=require("jingle-session");var RTCPeerConnection=require("rtcpeerconnection");function filterContentSources(content,stream){delete content.transport;delete content.description.payloads;if(content.description.sources){content.description.sources=content.description.sources.filter(function(source){return stream.id===source.parameters[1].value.split(" ")[0]})}}function filterUnusedLabels(content){var sources=content.description.sources||[];sources.forEach(function(source){source.parameters=source.parameters.filter(function(parameter){return!(parameter.key==="mslabel"||parameter.key==="label")})})}function MediaSession(opts){BaseSession.call(this,opts);this.pc=new RTCPeerConnection({iceServers:opts.iceServers||[],useJingle:true},opts.constraints||{});this.pc.on("ice",this.onIceCandidate.bind(this));this.pc.on("iceConnectionStateChange",this.onIceStateChange.bind(this));this.pc.on("addStream",this.onAddStream.bind(this));this.pc.on("removeStream",this.onRemoveStream.bind(this));if(opts.stream){this.addStream(opts.stream)}this._ringing=false}util.inherits(MediaSession,BaseSession);Object.defineProperties(MediaSession.prototype,{ringing:{get:function(){return this._ringing},set:function(value){if(value!==this._ringing){this._ringing=value;this.emit("change:ringing",value)}}},streams:{get:function(){if(this.pc.signalingState!=="closed"){return this.pc.getRemoteStreams()}return[]}}});MediaSession.prototype=extend(MediaSession.prototype,{start:function(constraints,next){var self=this;this.state="pending";next=next||function(){};this.pc.isInitiator=true;this.pc.offer(constraints,function(err,offer){if(err){self._log("error","Could not create WebRTC offer",err);return self.end("failed-application",true)}if(constraints&&constraints.mandatory){offer.jingle.contents.forEach(function(content){var mediaType=content.description.media;if(!content.description||content.description.descType!=="rtp"){return}if(!constraints.mandatory.OfferToReceiveAudio&&mediaType==="audio"){content.senders="initiator"}if(!constraints.mandatory.OfferToReceiveVideo&&mediaType==="video"){content.senders="initiator"}})}offer.jingle.contents.forEach(filterUnusedLabels);self.send("session-initiate",offer.jingle);next()})},accept:function(next){var self=this;next=next||function(){};this._log("info","Accepted incoming session");this.state="active";this.pc.answer(function(err,answer){if(err){self._log("error","Could not create WebRTC answer",err);return self.end("failed-application")}answer.jingle.contents.forEach(filterUnusedLabels);self.send("session-accept",answer.jingle);next()})},end:function(reason,silent){var self=this;this.streams.forEach(function(stream){self.onRemoveStream({stream:stream})});this.pc.close();BaseSession.prototype.end.call(this,reason,silent)},ring:function(){this._log("info","Ringing on incoming session");this.ringing=true;this.send("session-info",{ringing:true})},mute:function(creator,name){this._log("info","Muting",name);this.send("session-info",{mute:{creator:creator,name:name}})},unmute:function(creator,name){this._log("info","Unmuting",name);this.send("session-info",{unmute:{creator:creator,name:name}})},hold:function(){this._log("info","Placing on hold");this.send("session-info",{hold:true})},resume:function(){this._log("info","Resuming from hold");this.send("session-info",{active:true})},addStream:function(stream,renegotiate,cb){var self=this;cb=cb||function(){};this.pc.addStream(stream);if(!renegotiate){return}this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(err){if(err){self._log("error","Could not create offer for adding new stream");return cb(err)}self.pc.answer(function(err,answer){if(err){self._log("error","Could not create answer for adding new stream");return cb(err)}answer.jingle.contents.forEach(function(content){filterContentSources(content,stream)});self.send("source-add",answer.jingle);cb()})})},addStream2:function(stream,cb){this.addStream(stream,true,cb)},removeStream:function(stream,renegotiate,cb){var self=this;cb=cb||function(){};if(!renegotiate){this.pc.removeStream(stream);return}var desc=this.pc.localDescription;desc.contents.forEach(function(content){filterContentSources(content,stream)});this.send("source-remove",desc);this.pc.removeStream(stream);this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(err){if(err){self._log("error","Could not process offer for removing stream");return cb(err)}self.pc.answer(function(err){if(err){self._log("error","Could not process answer for removing stream");return cb(err)}cb()})})},removeStream2:function(stream,cb){this.removeStream(stream,true,cb)},switchStream:function(oldStream,newStream,cb){var self=this;cb=cb||function(){};var desc=this.pc.localDescription;desc.contents.forEach(function(content){delete content.transport;delete content.description.payloads});this.pc.removeStream(oldStream);this.send("source-remove",desc);var audioTracks=oldStream.getAudioTracks();if(audioTracks.length){newStream.addTrack(audioTracks[0])}this.pc.addStream(newStream);this.pc.handleOffer({type:"offer",jingle:this.pc.remoteDescription},function(err){if(err){self._log("error","Could not process offer for switching streams");return cb(err)}self.pc.answer(function(err,answer){if(err){self._log("error","Could not process answer for switching streams");return cb(err)}answer.jingle.contents.forEach(function(content){delete content.transport;delete content.description.payloads});self.send("source-add",answer.jingle);cb()})})},onIceCandidate:function(candidate){this._log("info","Discovered new ICE candidate",candidate.jingle);this.send("transport-info",candidate.jingle)},onIceStateChange:function(){switch(this.pc.iceConnectionState){case"checking":this.connectionState="connecting";break;case"completed":case"connected":this.connectionState="connected";break;case"disconnected":if(this.pc.signalingState==="stable"){this.connectionState="interrupted"}else{this.connectionState="disconnected"}break;case"failed":this.connectionState="failed";this.end("failed-transport");break;case"closed":this.connectionState="disconnected";break}},onAddStream:function(event){this._log("info","Stream added");this.emit("peerStreamAdded",this,event.stream)},onRemoveStream:function(event){this._log("info","Stream removed");this.emit("peerStreamRemoved",this,event.stream)},onSessionInitiate:function(changes,cb){var self=this;this._log("info","Initiating incoming session");this.state="pending";this.pc.isInitiator=false;this.pc.handleOffer({type:"offer",jingle:changes},function(err){if(err){self._log("error","Could not create WebRTC answer");return cb({condition:"general-error"})}cb()})},onSessionAccept:function(changes,cb){var self=this;this.state="active";this.pc.handleAnswer({type:"answer",jingle:changes},function(err){if(err){self._log("error","Could not process WebRTC answer");return cb({condition:"general-error"})}self.emit("accepted",self);cb()})},onSessionTerminate:function(changes,cb){var self=this;this._log("info","Terminating session");this.streams.forEach(function(stream){self.onRemoveStream({stream:stream})});this.pc.close();BaseSession.prototype.end.call(this,changes.reason,true);cb()},onSessionInfo:function(info,cb){if(info.ringing){this._log("info","Outgoing session is ringing");this.ringing=true;this.emit("ringing",this);return cb()}if(info.hold){this._log("info","On hold");this.emit("hold",this);return cb()}if(info.active){this._log("info","Resuming from hold");this.emit("resumed",this);return cb()}if(info.mute){this._log("info","Muting",info.mute);this.emit("mute",this,info.mute);return cb()}if(info.unmute){this._log("info","Unmuting",info.unmute);this.emit("unmute",this,info.unmute);return cb()}cb()},onTransportInfo:function(changes,cb){this.pc.processIce(changes,function(){cb()})},onSourceAdd:function(changes,cb){var self=this;this._log("info","Adding new stream source");var newDesc=this.pc.remoteDescription;this.pc.remoteDescription.contents.forEach(function(content,idx){var desc=content.description;var ssrcs=desc.sources||[];var groups=desc.sourceGroups||[];changes.contents.forEach(function(newContent){if(content.name!==newContent.name){return}var newContentDesc=newContent.description;var newSSRCs=newContentDesc.sources||[];ssrcs=ssrcs.concat(newSSRCs);newDesc.contents[idx].description.sources=JSON.parse(JSON.stringify(ssrcs));var newGroups=newContentDesc.sourceGroups||[];groups=groups.concat(newGroups);newDesc.contents[idx].description.sourceGroups=JSON.parse(JSON.stringify(groups))})});this.pc.handleOffer({type:"offer",jingle:newDesc},function(err){if(err){self._log("error","Error adding new stream source");return cb({condition:"general-error"})}self.pc.answer(function(err){if(err){self._log("error","Error adding new stream source");return cb({condition:"general-error"})}cb()})})},onSourceRemove:function(changes,cb){var self=this;this._log("info","Removing stream source");var newDesc=this.pc.remoteDescription;this.pc.remoteDescription.contents.forEach(function(content,idx){var desc=content.description;var ssrcs=desc.sources||[];var groups=desc.sourceGroups||[];changes.contents.forEach(function(newContent){if(content.name!==newContent.name){return}var newContentDesc=newContent.description;var newSSRCs=newContentDesc.sources||[];var newGroups=newContentDesc.sourceGroups||[];var found,i,j,k;for(i=0;i<newSSRCs.length;i++){found=-1;for(j=0;j<ssrcs.length;j++){if(newSSRCs[i].ssrc===ssrcs[j].ssrc){found=j;break}}if(found>-1){ssrcs.splice(found,1);newDesc.contents[idx].description.sources=JSON.parse(JSON.stringify(ssrcs))}}for(i=0;i<newGroups.length;i++){found=-1;for(j=0;i<groups.length;j++){if(newGroups[i].semantics===groups[j].semantics&&newGroups[i].sources.length===groups[j].sources.length){var same=true;for(k=0;k<newGroups[i].sources.length;k++){if(newGroups[i].sources[k]!==groups[j].sources[k]){same=false;break}}if(same){found=j;break}}}if(found>-1){groups.splice(found,1);newDesc.contents[idx].description.sourceGroups=JSON.parse(JSON.stringify(groups))}}})});this.pc.handleOffer({type:"offer",jingle:newDesc},function(err){if(err){self._log("error","Error removing stream source");return cb({condition:"general-error"})}self.pc.answer(function(err){if(err){self._log("error","Error removing stream source");return cb({condition:"general-error"})}cb()})})}});module.exports=MediaSession},{"extend-object":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/extend-object/extend-object.js","jingle-session":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-session/index.js",rtcpeerconnection:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/rtcpeerconnection.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/index.js"][0].apply(exports,arguments)},{"lodash._baseget":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash._baseget/index.js","lodash._topath":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash._topath/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js","lodash.map":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash._baseget/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash._baseget/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash._topath/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash._topath/index.js"][0].apply(exports,arguments)},{"lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/index.js"][0].apply(exports,arguments)},{"lodash._arraymap":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._arraymap/index.js","lodash._basecallback":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/index.js","lodash._baseeach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._baseeach/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._arraymap/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._arraymap/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/index.js"][0].apply(exports,arguments)},{"lodash._baseisequal":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/index.js","lodash._bindcallback":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js","lodash.pairs":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash.pairs/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/index.js"][0].apply(exports,arguments)},{"lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js","lodash.istypedarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.istypedarray/index.js","lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.istypedarray/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.istypedarray/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash.pairs/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash.pairs/index.js"][0].apply(exports,arguments)},{"lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._baseeach/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._baseeach/index.js"][0].apply(exports,arguments);
},{"lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"][0].apply(exports,arguments)},{"lodash._getnative":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash._getnative/index.js","lodash.isarguments":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash._getnative/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash._getnative/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/index.js"][0].apply(exports,arguments)},{"./lib/tojson":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tojson.js","./lib/tosdp":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tosdp.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/parsers.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/parsers.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/senders.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/senders.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tojson.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tojson.js"][0].apply(exports,arguments)},{"./parsers":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/parsers.js","./senders":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/senders.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tosdp.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/tosdp.js"][0].apply(exports,arguments)},{"./senders":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/lib/senders.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/traceablepeerconnection/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/traceablepeerconnection/index.js"][0].apply(exports,arguments)},{util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js",webrtcsupport:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/webrtcsupport/index-browser.js",wildemitter:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/wildemitter/wildemitter.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/rtcpeerconnection.js":[function(require,module,exports){var util=require("util");var each=require("lodash.foreach");var pluck=require("lodash.pluck");var webrtc=require("webrtcsupport");var SJJ=require("sdp-jingle-json");var WildEmitter=require("wildemitter");var peerconn=require("traceablepeerconnection");function PeerConnection(config,constraints){var self=this;var item;WildEmitter.call(this);config=config||{};config.iceServers=config.iceServers||[];this.enableChromeNativeSimulcast=false;if(constraints&&constraints.optional&&webrtc.prefix==="webkit"&&navigator.appVersion.match(/Chromium\//)===null){constraints.optional.forEach(function(constraint,idx){if(constraint.enableChromeNativeSimulcast){self.enableChromeNativeSimulcast=true}})}this.enableMultiStreamHacks=false;if(constraints&&constraints.optional&&webrtc.prefix==="webkit"){constraints.optional.forEach(function(constraint,idx){if(constraint.enableMultiStreamHacks){self.enableMultiStreamHacks=true}})}this.restrictBandwidth=0;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetRestrictBandwidth){self.restrictBandwidth=constraint.andyetRestrictBandwidth}})}this.batchIceCandidates=0;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetBatchIce){self.batchIceCandidates=constraint.andyetBatchIce}})}this.batchedIceCandidates=[];if(constraints&&constraints.optional&&webrtc.prefix==="webkit"){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetFasterICE){self.eliminateDuplicateCandidates=constraint.andyetFasterICE}})}if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetDontSignalCandidates){self.dontSignalCandidates=constraint.andyetDontSignalCandidates}})}this.assumeSetLocalSuccess=false;if(constraints&&constraints.optional){constraints.optional.forEach(function(constraint,idx){if(constraint.andyetAssumeSetLocalSuccess){self.assumeSetLocalSuccess=constraint.andyetAssumeSetLocalSuccess}})}if(webrtc.prefix==="moz"){if(constraints&&constraints.optional){this.wtFirefox=0;constraints.optional.forEach(function(constraint,idx){if(constraint.andyetFirefoxMakesMeSad){self.wtFirefox=constraint.andyetFirefoxMakesMeSad;if(self.wtFirefox>0){self.firefoxcandidatebuffer=[]}}})}}this.pc=new peerconn(config,constraints);this.getLocalStreams=this.pc.getLocalStreams.bind(this.pc);this.getRemoteStreams=this.pc.getRemoteStreams.bind(this.pc);this.addStream=this.pc.addStream.bind(this.pc);this.removeStream=this.pc.removeStream.bind(this.pc);this.pc.on("*",function(){self.emit.apply(self,arguments)});this.pc.onremovestream=this.emit.bind(this,"removeStream");this.pc.onaddstream=this.emit.bind(this,"addStream");this.pc.onnegotiationneeded=this.emit.bind(this,"negotiationNeeded");this.pc.oniceconnectionstatechange=this.emit.bind(this,"iceConnectionStateChange");this.pc.onsignalingstatechange=this.emit.bind(this,"signalingStateChange");this.pc.onicecandidate=this._onIce.bind(this);this.pc.ondatachannel=this._onDataChannel.bind(this);this.localDescription={contents:[]};this.remoteDescription={contents:[]};this.config={debug:false,ice:{},sid:"",isInitiator:true,sdpSessionID:Date.now(),useJingle:false};for(item in config){this.config[item]=config[item]}if(this.config.debug){this.on("*",function(eventName,event){var logger=config.logger||console;logger.log("PeerConnection event:",arguments)})}this.hadLocalStunCandidate=false;this.hadRemoteStunCandidate=false;this.hadLocalRelayCandidate=false;this.hadRemoteRelayCandidate=false;this.hadLocalIPv6Candidate=false;this.hadRemoteIPv6Candidate=false;this._remoteDataChannels=[];this._localDataChannels=[];this._candidateBuffer=[]}util.inherits(PeerConnection,WildEmitter);Object.defineProperty(PeerConnection.prototype,"signalingState",{get:function(){return this.pc.signalingState}});Object.defineProperty(PeerConnection.prototype,"iceConnectionState",{get:function(){return this.pc.iceConnectionState}});PeerConnection.prototype._role=function(){return this.isInitiator?"initiator":"responder"};PeerConnection.prototype.addStream=function(stream){this.localStream=stream;this.pc.addStream(stream)};PeerConnection.prototype._checkLocalCandidate=function(candidate){var cand=SJJ.toCandidateJSON(candidate);if(cand.type=="srflx"){this.hadLocalStunCandidate=true}else if(cand.type=="relay"){this.hadLocalRelayCandidate=true}if(cand.ip.indexOf(":")!=-1){this.hadLocalIPv6Candidate=true}};PeerConnection.prototype._checkRemoteCandidate=function(candidate){var cand=SJJ.toCandidateJSON(candidate);if(cand.type=="srflx"){this.hadRemoteStunCandidate=true}else if(cand.type=="relay"){this.hadRemoteRelayCandidate=true}if(cand.ip.indexOf(":")!=-1){this.hadRemoteIPv6Candidate=true}};PeerConnection.prototype.processIce=function(update,cb){cb=cb||function(){};var self=this;if(this.pc.signalingState==="closed")return cb();if(update.contents||update.jingle&&update.jingle.contents){var contentNames=pluck(this.remoteDescription.contents,"name");var contents=update.contents||update.jingle.contents;contents.forEach(function(content){var transport=content.transport||{};var candidates=transport.candidates||[];var mline=contentNames.indexOf(content.name);var mid=content.name;candidates.forEach(function(candidate){var iceCandidate=SJJ.toCandidateSDP(candidate)+"\r\n";self.pc.addIceCandidate(new webrtc.IceCandidate({candidate:iceCandidate,sdpMLineIndex:mline,sdpMid:mid}),function(){},function(err){self.emit("error",err)});self._checkRemoteCandidate(iceCandidate)})})}else{if(update.candidate&&update.candidate.candidate.indexOf("a=")!==0){update.candidate.candidate="a="+update.candidate.candidate}if(this.wtFirefox&&this.firefoxcandidatebuffer!==null){if(this.pc.localDescription&&this.pc.localDescription.type==="offer"){this.firefoxcandidatebuffer.push(update.candidate);return cb()}}self.pc.addIceCandidate(new webrtc.IceCandidate(update.candidate),function(){},function(err){self.emit("error",err)});self._checkRemoteCandidate(update.candidate.candidate)}cb()};PeerConnection.prototype.offer=function(constraints,cb){var self=this;var hasConstraints=arguments.length===2;var mediaConstraints=hasConstraints&&constraints?constraints:{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}};cb=hasConstraints?cb:constraints;cb=cb||function(){};if(this.pc.signalingState==="closed")return cb("Already closed");this.pc.createOffer(function(offer){var expandedOffer={type:"offer",sdp:offer.sdp};if(self.assumeSetLocalSuccess){self.emit("offer",expandedOffer);cb(null,expandedOffer)}self._candidateBuffer=[];self.pc.setLocalDescription(offer,function(){var jingle;if(self.config.useJingle){jingle=SJJ.toSessionJSON(offer.sdp,{role:self._role(),direction:"outgoing"});jingle.sid=self.config.sid;self.localDescription=jingle;each(jingle.contents,function(content){var transport=content.transport||{};if(transport.ufrag){self.config.ice[content.name]={ufrag:transport.ufrag,pwd:transport.pwd}}});expandedOffer.jingle=jingle}expandedOffer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkLocalCandidate(line)}});if(!self.assumeSetLocalSuccess){self.emit("offer",expandedOffer);cb(null,expandedOffer)}},function(err){self.emit("error",err);cb(err)})},function(err){self.emit("error",err);cb(err)},mediaConstraints)};PeerConnection.prototype.handleOffer=function(offer,cb){cb=cb||function(){};var self=this;offer.type="offer";if(offer.jingle){if(this.enableChromeNativeSimulcast){offer.jingle.contents.forEach(function(content){if(content.name==="video"){content.description.googConferenceFlag=true}})}if(this.enableMultiStreamHacks){offer.jingle.contents.forEach(function(content){if(content.name==="video"){var sources=content.description.sources||[];if(sources.length===0||sources[0].ssrc!=="3735928559"){sources.unshift({ssrc:"3735928559",parameters:[{key:"cname",value:"deadbeef"},{key:"msid",value:"mixyourfecintothis please"}]});content.description.sources=sources}}})}if(self.restrictBandwidth>0){if(offer.jingle.contents.length>=2&&offer.jingle.contents[1].name==="video"){var content=offer.jingle.contents[1];var hasBw=content.description&&content.description.bandwidth;if(!hasBw){offer.jingle.contents[1].description.bandwidth={type:"AS",bandwidth:self.restrictBandwidth.toString()};offer.sdp=SJJ.toSessionSDP(offer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"outgoing"})}}}offer.sdp=SJJ.toSessionSDP(offer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"incoming"});self.remoteDescription=offer.jingle}offer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkRemoteCandidate(line)}});self.pc.setRemoteDescription(new webrtc.SessionDescription(offer),function(){cb()},cb)};PeerConnection.prototype.answerAudioOnly=function(cb){var mediaConstraints={mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:false}};this._answer(mediaConstraints,cb)};PeerConnection.prototype.answerBroadcastOnly=function(cb){var mediaConstraints={mandatory:{OfferToReceiveAudio:false,OfferToReceiveVideo:false}};this._answer(mediaConstraints,cb)};PeerConnection.prototype.answer=function(constraints,cb){var self=this;var hasConstraints=arguments.length===2;var callback=hasConstraints?cb:constraints;var mediaConstraints=hasConstraints&&constraints?constraints:{mandatory:{OfferToReceiveAudio:true,OfferToReceiveVideo:true}};this._answer(mediaConstraints,callback)};PeerConnection.prototype.handleAnswer=function(answer,cb){cb=cb||function(){};var self=this;if(answer.jingle){answer.sdp=SJJ.toSessionSDP(answer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"incoming"});self.remoteDescription=answer.jingle}answer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkRemoteCandidate(line)}});self.pc.setRemoteDescription(new webrtc.SessionDescription(answer),function(){if(self.wtFirefox){window.setTimeout(function(){self.firefoxcandidatebuffer.forEach(function(candidate){self.pc.addIceCandidate(new webrtc.IceCandidate(candidate),function(){},function(err){self.emit("error",err)});self._checkRemoteCandidate(candidate.candidate)});self.firefoxcandidatebuffer=null},self.wtFirefox)}cb(null)},cb)};PeerConnection.prototype.close=function(){this.pc.close();this._localDataChannels=[];this._remoteDataChannels=[];this.emit("close")};PeerConnection.prototype._answer=function(constraints,cb){cb=cb||function(){};var self=this;if(!this.pc.remoteDescription){throw new Error("remoteDescription not set")}if(this.pc.signalingState==="closed")return cb("Already closed");self.pc.createAnswer(function(answer){var sim=[];var rtx=[];if(self.enableChromeNativeSimulcast){answer.jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"});if(answer.jingle.contents.length>=2&&answer.jingle.contents[1].name==="video"){var hasSimgroup=false;var groups=answer.jingle.contents[1].description.sourceGroups||[];var hasSim=false;groups.forEach(function(group){if(group.semantics=="SIM")hasSim=true});if(!hasSim&&answer.jingle.contents[1].description.sources.length){var newssrc=JSON.parse(JSON.stringify(answer.jingle.contents[1].description.sources[0]));newssrc.ssrc=""+Math.floor(Math.random()*4294967295);answer.jingle.contents[1].description.sources.push(newssrc);sim.push(answer.jingle.contents[1].description.sources[0].ssrc);sim.push(newssrc.ssrc);groups.push({semantics:"SIM",sources:sim});var rtxssrc=JSON.parse(JSON.stringify(newssrc));rtxssrc.ssrc=""+Math.floor(Math.random()*4294967295);answer.jingle.contents[1].description.sources.push(rtxssrc);groups.push({semantics:"FID",sources:[newssrc.ssrc,rtxssrc.ssrc]});answer.jingle.contents[1].description.sourceGroups=groups;answer.sdp=SJJ.toSessionSDP(answer.jingle,{sid:self.config.sdpSessionID,role:self._role(),direction:"outgoing"})}}}var expandedAnswer={type:"answer",sdp:answer.sdp};if(self.assumeSetLocalSuccess){self.emit("answer",expandedAnswer);cb(null,expandedAnswer)}self._candidateBuffer=[];self.pc.setLocalDescription(answer,function(){if(self.config.useJingle){var jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"});jingle.sid=self.config.sid;self.localDescription=jingle;expandedAnswer.jingle=jingle}if(self.enableChromeNativeSimulcast){if(!expandedAnswer.jingle){expandedAnswer.jingle=SJJ.toSessionJSON(answer.sdp,{role:self._role(),direction:"outgoing"})}var groups=expandedAnswer.jingle.contents[1].description.sourceGroups||[];expandedAnswer.jingle.contents[1].description.sources.forEach(function(source,idx){source.parameters=source.parameters.map(function(parameter){if(parameter.key==="msid"){parameter.value+="-"+Math.floor(idx/2)}return parameter})});expandedAnswer.sdp=SJJ.toSessionSDP(expandedAnswer.jingle,{sid:self.sdpSessionID,role:self._role(),direction:"outgoing"})}expandedAnswer.sdp.split("\r\n").forEach(function(line){if(line.indexOf("a=candidate:")===0){self._checkLocalCandidate(line)}});if(!self.assumeSetLocalSuccess){self.emit("answer",expandedAnswer);cb(null,expandedAnswer)}},function(err){self.emit("error",err);cb(err)})},function(err){self.emit("error",err);cb(err)},constraints)};PeerConnection.prototype._onIce=function(event){var self=this;if(event.candidate){if(this.dontSignalCandidates)return;var ice=event.candidate;var expandedCandidate={candidate:{candidate:ice.candidate,sdpMid:ice.sdpMid,sdpMLineIndex:ice.sdpMLineIndex}};this._checkLocalCandidate(ice.candidate);var cand=SJJ.toCandidateJSON(ice.candidate);var already;var idx;if(this.eliminateDuplicateCandidates&&cand.type==="relay"){already=this._candidateBuffer.filter(function(c){return c.type==="relay"}).map(function(c){return c.foundation+":"+c.component});idx=already.indexOf(cand.foundation+":"+cand.component);if(idx>-1&&cand.priority>>24>=already[idx].priority>>24){return}}if(this.config.bundlePolicy==="max-bundle"){already=this._candidateBuffer.filter(function(c){return cand.type===c.type}).map(function(cand){return cand.address+":"+cand.port});idx=already.indexOf(cand.address+":"+cand.port);if(idx>-1)return}if(this.config.rtcpMuxPolicy==="require"&&cand.component==="2"){return}this._candidateBuffer.push(cand);if(self.config.useJingle){if(!ice.sdpMid){if(self.pc.remoteDescription&&self.pc.remoteDescription.type==="offer"){ice.sdpMid=self.remoteDescription.contents[ice.sdpMLineIndex].name}else{ice.sdpMid=self.localDescription.contents[ice.sdpMLineIndex].name}}if(!self.config.ice[ice.sdpMid]){var jingle=SJJ.toSessionJSON(self.pc.localDescription.sdp,{role:self._role(),direction:"outgoing"});each(jingle.contents,function(content){var transport=content.transport||{};if(transport.ufrag){self.config.ice[content.name]={ufrag:transport.ufrag,pwd:transport.pwd}}})}expandedCandidate.jingle={contents:[{name:ice.sdpMid,creator:self._role(),transport:{transType:"iceUdp",ufrag:self.config.ice[ice.sdpMid].ufrag,pwd:self.config.ice[ice.sdpMid].pwd,candidates:[cand]}}]};if(self.batchIceCandidates>0){if(self.batchedIceCandidates.length===0){window.setTimeout(function(){var contents={};self.batchedIceCandidates.forEach(function(content){content=content.contents[0];if(!contents[content.name])contents[content.name]=content;contents[content.name].transport.candidates.push(content.transport.candidates[0])});var newCand={jingle:{contents:[]}};Object.keys(contents).forEach(function(name){newCand.jingle.contents.push(contents[name])});self.batchedIceCandidates=[];self.emit("ice",newCand)},self.batchIceCandidates)}self.batchedIceCandidates.push(expandedCandidate.jingle);return}}this.emit("ice",expandedCandidate)}else{this.emit("endOfCandidates")}};PeerConnection.prototype._onDataChannel=function(event){var channel=event.channel;this._remoteDataChannels.push(channel);this.emit("addChannel",channel)};PeerConnection.prototype.createDataChannel=function(name,opts){var channel=this.pc.createDataChannel(name,opts);this._localDataChannels.push(channel);return channel};PeerConnection.prototype.getStats=function(cb){if(webrtc.prefix==="moz"){this.pc.getStats(function(res){var items=[];for(var result in res){if(typeof res[result]==="object"){items.push(res[result])}}cb(null,items)},cb)}else{this.pc.getStats(function(res){var items=[];res.result().forEach(function(result){var item={};result.names().forEach(function(name){item[name]=result.stat(name)});item.id=result.id;item.type=result.type;item.timestamp=result.timestamp;items.push(item)});cb(null,items)})}};module.exports=PeerConnection},{"lodash.foreach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/index.js","lodash.pluck":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/index.js","sdp-jingle-json":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/sdp-jingle-json/index.js",traceablepeerconnection:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-media-session/node_modules/rtcpeerconnection/node_modules/traceablepeerconnection/index.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js",webrtcsupport:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/webrtcsupport/index-browser.js",wildemitter:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/wildemitter/wildemitter.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-session/index.js":[function(require,module,exports){var util=require("util");var uuid=require("uuid");var async=require("async");var extend=require("extend-object");var WildEmitter=require("wildemitter");var ACTIONS={"content-accept":"onContentAccept","content-add":"onContentAdd","content-modify":"onConentModify","content-reject":"onContentReject","content-remove":"onContentRemove","description-info":"onDescriptionInfo","security-info":"onSecurityInfo","session-accept":"onSessionAccept","session-info":"onSessionInfo","session-initiate":"onSessionInitiate","session-terminate":"onSessionTerminate","transport-accept":"onTransportAccept","transport-info":"onTransportInfo","transport-reject":"onTransportReject","transport-replace":"onTransportReplace","source-add":"onSourceAdd","source-remove":"onSourceRemove"};function JingleSession(opts){WildEmitter.call(this);var self=this;this.sid=opts.sid||uuid.v4();this.peer=opts.peer;this.peerID=opts.peerID||this.peer.full||this.peer;this.isInitiator=opts.initiator||false;this.parent=opts.parent;this.state="starting";this.connectionState="starting";this.pendingDescriptionTypes=opts.descriptionTypes||[];this.pendingAction=false;this.processingQueue=async.queue(function(task,next){if(self.ended){return next()}var action=task.action;var changes=task.changes;var cb=task.cb;self._log("debug",action);if(!ACTIONS[action]){self._log("error","Invalid action: "+action);cb({condition:"bad-request"});return next()}self[ACTIONS[action]](changes,function(err,result){cb(err,result);return next()})})}util.inherits(JingleSession,WildEmitter);Object.keys(ACTIONS).forEach(function(action){var method=ACTIONS[action];JingleSession.prototype[method]=function(changes,cb){this._log("error","Unsupported action: "+action);cb()}});Object.defineProperties(JingleSession.prototype,{state:{get:function(){return this._sessionState},set:function(value){if(value!==this._sessionState){var prev=this._sessionState;this._log("info","Changing session state to: "+value);this._sessionState=value;this.emit("change:sessionState",this,value);this.emit("change:"+value,this,true);if(prev){this.emit("change:"+prev,this,false)}}}},connectionState:{get:function(){return this._connectionState},set:function(value){if(value!==this._connectionState){var prev=this._connectionState;this._log("info","Changing connection state to: "+value);this._connectionState=value;this.emit("change:connectionState",this,value);this.emit("change:"+value,this,true);if(prev){this.emit("change:"+prev,this,false)}}}},starting:{get:function(){return this._sessionState==="starting"}},pending:{get:function(){return this._sessionState==="pending"}},active:{get:function(){return this._sessionState==="active"}},ended:{get:function(){return this._sessionState==="ended"}},connected:{get:function(){return this._connectionState==="connected"}},connecting:{get:function(){return this._connectionState==="connecting"}},disconnected:{get:function(){return this._connectionState==="disconnected"}},interrupted:{get:function(){return this._connectionState==="interrupted"}}});JingleSession.prototype=extend(JingleSession.prototype,{_log:function(level,message){message=this.sid+": "+message;this.emit("log:"+level,message)},send:function(action,data){data=data||{};data.sid=this.sid;data.action=action;var requirePending={"session-inititate":true,"session-accept":true,"content-add":true,"content-remove":true,"content-reject":true,"content-accept":true,"content-modify":true,"transport-replace":true,"transport-reject":true,"transport-accept":true,"source-add":true,"source-remove":true};if(requirePending[action]){this.pendingAction=action}else{this.pendingAction=false}this.emit("send",{to:this.peer,type:"set",jingle:data})},process:function(action,changes,cb){this.processingQueue.push({action:action,changes:changes,cb:cb})},start:function(){this._log("error","Can not start base sessions");this.end("unsupported-applications",true)},accept:function(){this._log("error","Can not accept base sessions");this.end("unsupported-applications")},cancel:function(){this.end("cancel")},decline:function(){this.end("decline")},end:function(reason,silent){this.state="ended";this.processingQueue.kill();if(!reason){reason="success"}if(typeof reason==="string"){reason={condition:reason}}if(!silent){this.send("session-terminate",{reason:reason})}this.emit("terminated",this,reason)},onSessionTerminate:function(changes,cb){this.end(changes.reason,true);cb()},onSessionInfo:function(changes,cb){var okKeys={sid:true,action:true,initiator:true,responder:true};var unknownPayload=false;Object.keys(changes).forEach(function(key){if(!okKeys[key]){unknownPayload=true}});if(unknownPayload){cb({type:"modify",condition:"feature-not-implemented",jingleCondition:"unsupported-info"})}else{cb()}},onDescriptionInfo:function(changes,cb){cb({type:"modify",condition:"feature-not-implemented",jingleCondition:"unsupported-info"})},onTransportInfo:function(changes,cb){cb({type:"modify",condition:"feature-not-implemented",jingleCondition:"unsupported-info"})},onContentAdd:function(changes,cb){cb();this.send("content-reject",{reason:{condition:"failed-application",text:"content-add is not supported"}})},onTransportReplace:function(changes,cb){cb();this.send("transport-reject",{reason:{condition:"failed-application",text:"transport-replace is not supported"}})}});module.exports=JingleSession},{async:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/async/lib/async.js","extend-object":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/extend-object/extend-object.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js",uuid:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/uuid/uuid.js",wildemitter:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/wildemitter/wildemitter.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/webrtcsupport/index-browser.js":[function(require,module,exports){var prefix;var version;if(window.mozRTCPeerConnection||navigator.mozGetUserMedia){prefix="moz";version=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)}else if(window.webkitRTCPeerConnection||navigator.webkitGetUserMedia){prefix="webkit";version=navigator.userAgent.match(/Chrom(e|ium)/)&&parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10)}var PC=window.mozRTCPeerConnection||window.webkitRTCPeerConnection;var IceCandidate=window.mozRTCIceCandidate||window.RTCIceCandidate;var SessionDescription=window.mozRTCSessionDescription||window.RTCSessionDescription;var MediaStream=window.webkitMediaStream||window.MediaStream;var screenSharing=window.location.protocol==="https:"&&(prefix==="webkit"&&version>=26||prefix==="moz"&&version>=33);var AudioContext=window.AudioContext||window.webkitAudioContext;var videoEl=document.createElement("video");var supportVp8=videoEl&&videoEl.canPlayType&&videoEl.canPlayType('video/webm; codecs="vp8", vorbis')==="probably";var getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia;module.exports={prefix:prefix,browserVersion:version,support:!!PC&&supportVp8&&!!getUserMedia,supportRTCPeerConnection:!!PC,supportVp8:supportVp8,supportGetUserMedia:!!getUserMedia,supportDataChannel:!!(PC&&PC.prototype&&PC.prototype.createDataChannel),supportWebAudio:!!(AudioContext&&AudioContext.prototype.createMediaStreamSource),supportMediaStream:!!(MediaStream&&MediaStream.prototype.removeTrack),supportScreenSharing:!!screenSharing,dataChannel:!!(PC&&PC.prototype&&PC.prototype.createDataChannel),webAudio:!!(AudioContext&&AudioContext.prototype.createMediaStreamSource),mediaStream:!!(MediaStream&&MediaStream.prototype.removeTrack),screenSharing:!!screenSharing,AudioContext:AudioContext,PeerConnection:PC,SessionDescription:SessionDescription,
IceCandidate:IceCandidate,MediaStream:MediaStream,getUserMedia:getUserMedia}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt-xmpp-types/index.js":[function(require,module,exports){"use strict";var JID=require("xmpp-jid").JID;module.exports=function(JXT){var types=JXT.utils;JXT.withIq=function(cb){this.withDefinition("iq","jabber:client",cb);this.withDefinition("iq","jabber:component:accept",cb)};JXT.withMessage=function(cb){this.withDefinition("message","jabber:client",cb);this.withDefinition("message","jabber:component:accept",cb)};JXT.withPresence=function(cb){this.withDefinition("presence","jabber:client",cb);this.withDefinition("presence","jabber:component:accept",cb)};JXT.withStreamFeatures=function(cb){this.withDefinition("features","http://etherx.jabber.org/streams",cb)};JXT.withStanzaError=function(cb){this.withDefinition("error","jabber:client",cb);this.withDefinition("error","jabber:component:accept",cb)};JXT.withDataForm=function(cb){this.withDefinition("x","jabber:x:data",cb)};JXT.withPubsubItem=function(cb){this.withDefinition("item","http://jabber.org/protocol/pubsub",cb);this.withDefinition("item","http://jabber.org/protocol/pubsub#event",cb)};JXT.getMessage=function(){return this.getDefinition("message","jabber:client")};JXT.getPresence=function(){return this.getDefinition("presence","jabber:client")};JXT.getIq=function(){return this.getDefinition("iq","jabber:client")};JXT.getStreamError=function(){return this.getDefinition("error","http://etherx.jabber.org/streams")};JXT.getComponentMessage=function(){return this.getDefinition("message","jabber:component:accept")};JXT.getComponentPresence=function(){return this.getDefinition("presence","jabber:component:accept")};JXT.getComponentIq=function(){return this.getDefinition("iq","jabber:component:accept")};JXT.utils.jidAttribute=function(attr,prepped){return{get:function(){var jid=new JID(types.getAttribute(this.xml,attr));if(prepped){jid.prepped=true}return jid},set:function(value){types.setAttribute(this.xml,attr,(value||"").toString())}}};JXT.utils.jidSub=function(NS,sub,prepped){return{get:function(){var jid=new JID(types.getSubText(this.xml,NS,sub));if(prepped){jid.prepped=true}return jid},set:function(value){types.setSubText(this.xml,NS,sub,(value||"").toString())}}};JXT.utils.tzoSub=types.field(function(xml,NS,sub,defaultVal){var split,hrs,min;var sign=-1;var formatted=types.getSubText(xml,NS,sub);if(!formatted){return defaultVal}if(formatted.charAt(0)==="-"){sign=1;formatted=formatted.slice(1)}split=formatted.split(":");hrs=parseInt(split[0],10);min=parseInt(split[1],10);return(hrs*60+min)*sign},function(xml,NS,sub,value){var hrs,min;var formatted="-";if(typeof value==="number"){if(value<0){value=-value;formatted="+"}hrs=value/60;min=value%60;formatted+=(hrs<10?"0":"")+hrs+":"+(min<10?"0":"")+min}else{formatted=value}types.setSubText(xml,NS,sub,formatted)})}},{"xmpp-jid":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/index.js":[function(require,module,exports){"use strict";var extend=require("lodash.assign");var uuid=require("uuid");var ltx=require("ltx");var types=require("./lib/types");var helpers=require("./lib/helpers");var stanzaConstructor=require("./lib/stanza");function JXT(){this._LOOKUP={};this._LOOKUP_EXT={};this._TAGS={};this._CB_DEFINITION={};this._CB_TAG={};this._ID=uuid.v4();this.utils=extend({},types,helpers)}JXT.prototype.use=function(init){if(!init["__JXT_LOADED_"+this._ID]){init(this)}init["__JXT_LOADED_"+this._ID]=true;return this};JXT.prototype.getDefinition=function(el,ns,required){var JXTClass=this._LOOKUP[ns+"|"+el];if(required&&!JXTClass){throw new Error("Could not find definition for <"+el+' xmlns="'+ns+'" />')}return JXTClass};JXT.prototype.getExtensions=function(el,ns){return this._LOOKUP_EXT[ns+"|"+el]||{}};JXT.prototype.withDefinition=function(el,ns,cb){var name=ns+"|"+el;if(!this._CB_DEFINITION[name]){this._CB_DEFINITION[name]=[]}this._CB_DEFINITION[name].push(cb);if(this._LOOKUP[name]){cb(this._LOOKUP[name])}};JXT.prototype.withTag=function(tag,cb){if(!this._CB_TAG[tag]){this._CB_TAG[tag]=[]}this._CB_TAG[tag].push(cb);this.tagged(tag).forEach(function(stanza){cb(stanza)})};JXT.prototype.tagged=function(tag){return this._TAGS[tag]||[]};JXT.prototype.build=function(xml){var JXTClass=this._LOOKUP[xml.namespaceURI+"|"+xml.localName];if(JXTClass){return new JXTClass(null,xml)}};JXT.prototype.parse=function(str){var xml=ltx.parse(str);if(xml.nodeType!==1){return}var JXTClass=this.getDefinition(xml.localName,xml.namespaceURI);if(JXTClass){return new JXTClass(null,xml)}};JXT.prototype.extend=function(ParentJXT,ChildJXT,multiName){var parentName=ParentJXT.prototype._NS+"|"+ParentJXT.prototype._EL;var name=ChildJXT.prototype._name;var qName=ChildJXT.prototype._NS+"|"+ChildJXT.prototype._EL;this._LOOKUP[qName]=ChildJXT;if(!this._LOOKUP_EXT[qName]){this._LOOKUP_EXT[qName]={}}if(!this._LOOKUP_EXT[parentName]){this._LOOKUP_EXT[parentName]={}}this._LOOKUP_EXT[parentName][name]=ChildJXT;this.add(ParentJXT,name,types.extension(ChildJXT));if(multiName){this.add(ParentJXT,multiName,types.multiExtension(ChildJXT))}};JXT.prototype.add=function(ParentJXT,fieldName,field){field.enumerable=true;Object.defineProperty(ParentJXT.prototype,fieldName,field)};JXT.prototype.define=function(opts){var self=this;var Stanza=stanzaConstructor(this,opts);var ns=Stanza.prototype._NS;var el=Stanza.prototype._EL;var tags=Stanza.prototype._TAGS;var name=ns+"|"+el;this._LOOKUP[name]=Stanza;tags.forEach(function(tag){if(!self._TAGS[tag]){self._TAGS[tag]=[]}self._TAGS[tag].push(Stanza)});var fieldNames=Object.keys(opts.fields||{});fieldNames.forEach(function(fieldName){self.add(Stanza,fieldName,opts.fields[fieldName])});if(this._CB_DEFINITION[name]){this._CB_DEFINITION[name].forEach(function(handler){handler(Stanza)})}tags.forEach(function(tag){if(self._CB_TAG[tag]){self._CB_TAG[tag].forEach(function(handler){handler(Stanza)})}});return Stanza};JXT.createRegistry=function(){return new JXT};extend(JXT,helpers);extend(JXT,types);var globalJXT=new JXT;JXT.define=globalJXT.define.bind(globalJXT);JXT.extend=globalJXT.extend.bind(globalJXT);JXT.add=globalJXT.add.bind(globalJXT);JXT.parse=globalJXT.parse.bind(globalJXT);JXT.build=globalJXT.build.bind(globalJXT);JXT.getExtensions=globalJXT.getExtensions.bind(globalJXT);JXT.getDefinition=globalJXT.getDefinition.bind(globalJXT);JXT.withDefinition=globalJXT.withDefinition.bind(globalJXT);JXT.withTag=globalJXT.withTag.bind(globalJXT);JXT.tagged=globalJXT.tagged.bind(globalJXT);JXT.getGlobalJXT=function(){return globalJXT};module.exports=JXT},{"./lib/helpers":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/lib/helpers.js","./lib/stanza":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/lib/stanza.js","./lib/types":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/lib/types.js","lodash.assign":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/index.js",ltx:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/index-browserify.js",uuid:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/uuid/uuid.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/lib/helpers.js":[function(require,module,exports){"use strict";var ltx=require("ltx");var XML_NS=exports.XML_NS="http://www.w3.org/XML/1998/namespace";exports.createElement=function(NS,name,parentNS){var el=new ltx.Element(name);if(!parentNS||parentNS!==NS){exports.setAttribute(el,"xmlns",NS)}return el};var find=exports.find=function(xml,NS,selector){var results=[];var children=xml.getElementsByTagName(selector);for(var i=0,len=children.length;i<len;i++){var child=children[i];if(child.namespaceURI===NS&&child.parentNode===xml){results.push(child)}}return results};exports.findOrCreate=function(xml,NS,selector){var existing=exports.find(xml,NS,selector);if(existing.length){return existing[0]}else{var created=exports.createElement(NS,selector,xml.namespaceURI);xml.appendChild(created);return created}};exports.getAttribute=function(xml,attr,defaultVal){return xml.getAttribute(attr)||defaultVal||""};exports.getAttributeNS=function(xml,NS,attr,defaultVal){return xml.getAttributeNS(NS,attr)||defaultVal||""};exports.setAttribute=function(xml,attr,value,force){if(value||force){xml.setAttribute(attr,value)}else{xml.removeAttribute(attr)}};exports.setAttributeNS=function(xml,NS,attr,value,force){if(value||force){xml.setAttributeNS(NS,attr,value)}else{xml.removeAttributeNS(NS,attr)}};exports.getBoolAttribute=function(xml,attr,defaultVal){var val=xml.getAttribute(attr)||defaultVal||"";return val==="true"||val==="1"};exports.setBoolAttribute=function(xml,attr,value){if(value){xml.setAttribute(attr,"1")}else{xml.removeAttribute(attr)}};exports.getSubAttribute=function(xml,NS,sub,attr,defaultVal){var subs=find(xml,NS,sub);if(!subs){return""}for(var i=0;i<subs.length;i++){return subs[i].getAttribute(attr)||defaultVal||""}return""};exports.setSubAttribute=function(xml,NS,sub,attr,value){var subs=find(xml,NS,sub);if(!subs.length){if(value){sub=exports.createElement(NS,sub,xml.namespaceURI);sub.setAttribute(attr,value);xml.appendChild(sub)}}else{for(var i=0;i<subs.length;i++){if(value){subs[i].setAttribute(attr,value);return}else{subs[i].removeAttribute(attr)}}}};exports.getBoolSubAttribute=function(xml,NS,sub,attr,defaultVal){var val=xml.getSubAttribute(NS,sub,attr)||defaultVal||"";return val==="true"||val==="1"};exports.setBoolSubAttribute=function(xml,NS,sub,attr,value){value=value?"1":"";exports.setSubAttribute(xml,NS,sub,attr,value)};exports.getText=function(xml){return xml.textContent};exports.setText=function(xml,value){xml.textContent=value};exports.getSubText=exports.getTextSub=function(xml,NS,element,defaultVal){var subs=find(xml,NS,element);defaultVal=defaultVal||"";if(!subs.length){return defaultVal}return subs[0].textContent||defaultVal};exports.setSubText=exports.setTextSub=function(xml,NS,element,value){var subs=find(xml,NS,element);if(subs.length){for(var i=0;i<subs.length;i++){xml.removeChild(subs[i])}}if(value){var sub=exports.createElement(NS,element,xml.namespaceURI);if(value!==true){sub.textContent=value}xml.appendChild(sub)}};exports.getMultiSubText=function(xml,NS,element,extractor){var subs=find(xml,NS,element);var results=[];extractor=extractor||function(sub){return sub.textContent||""};for(var i=0;i<subs.length;i++){results.push(extractor(subs[i]))}return results};exports.setMultiSubText=function(xml,NS,element,value,builder){var subs=find(xml,NS,element);var values=[];builder=builder||function(value){if(value){var sub=exports.createElement(NS,element,xml.namespaceURI);sub.textContent=value;xml.appendChild(sub)}};if(typeof value==="string"){values=(value||"").split("\n")}else{values=value}var i,len;for(i=0,len=subs.length;i<len;i++){xml.removeChild(subs[i])}for(i=0,len=values.length;i<len;i++){builder(values[i])}};exports.getMultiSubAttribute=function(xml,NS,element,attr){return exports.getMultiSubText(xml,NS,element,function(sub){return exports.getAttribute(sub,attr)})};exports.setMultiSubAttribute=function(xml,NS,element,attr,value){exports.setMultiSubText(xml,NS,element,value,function(val){var sub=exports.createElement(NS,element,xml.namespaceURI);exports.setAttribute(sub,attr,val);xml.appendChild(sub)})};exports.getSubLangText=function(xml,NS,element,defaultLang){var subs=find(xml,NS,element);if(!subs.length){return{}}var lang,sub;var results={};var langs=[];for(var i=0;i<subs.length;i++){sub=subs[i];lang=sub.getAttributeNS(XML_NS,"lang")||defaultLang;langs.push(lang);results[lang]=sub.textContent||""}return results};exports.setSubLangText=function(xml,NS,element,value,defaultLang){var sub,lang;var subs=find(xml,NS,element);if(subs.length){for(var i=0;i<subs.length;i++){xml.removeChild(subs[i])}}if(typeof value==="string"){sub=exports.createElement(NS,element,xml.namespaceURI);sub.textContent=value;xml.appendChild(sub)}else if(typeof value==="object"){for(lang in value){if(value.hasOwnProperty(lang)){sub=exports.createElement(NS,element,xml.namespaceURI);if(lang!==defaultLang){sub.setAttributeNS(XML_NS,"lang",lang)}sub.textContent=value[lang];xml.appendChild(sub)}}}};exports.getBoolSub=function(xml,NS,element){var subs=find(xml,NS,element);return!!subs.length};exports.setBoolSub=function(xml,NS,element,value){var subs=find(xml,NS,element);if(!subs.length){if(value){var sub=exports.createElement(NS,element,xml.namespaceURI);xml.appendChild(sub)}}else{for(var i=0;i<subs.length;i++){if(value){return}else{xml.removeChild(subs[i])}}}}},{ltx:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/index-browserify.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/lib/stanza.js":[function(require,module,exports){"use strict";var helpers=require("./helpers");var extend=require("lodash.assign");var EXCLUDE={constructor:true,parent:true,prototype:true,toJSON:true,toString:true,xml:true};module.exports=function(JXT,opts){function Stanza(data,xml,parent){var self=this;var parentNode=(xml||{}).parentNode||(parent||{}).xml;var parentNS=(parentNode||{}).namespaceURI;self.xml=xml||helpers.createElement(self._NS,self._EL,parentNS);Object.keys(self._PREFIXES).forEach(function(prefix){var namespace=self._PREFIXES[prefix];self.xml.setAttribute("xmlns:"+prefix,namespace)});self._extensions={};for(var i=0,len=self.xml.childNodes.length;i<len;i++){var child=self.xml.childNodes[i];var ChildJXT=JXT.getDefinition(child.localName,child.namespaceURI);if(ChildJXT!==undefined){var name=ChildJXT.prototype._name;self._extensions[name]=new ChildJXT(null,child);self._extensions[name].parent=self}}extend(self,data);if(opts.init){opts.init.apply(self,[data])}return self}Stanza.prototype._name=opts.name;Stanza.prototype._eventname=opts.eventName;Stanza.prototype._NS=opts.namespace;Stanza.prototype._EL=opts.element||opts.name;Stanza.prototype._PREFIXES=opts.prefixes||{};Stanza.prototype._TAGS=opts.tags||[];Stanza.prototype.toString=function(){return this.xml.toString()};Stanza.prototype.toJSON=function(){var prop;var result={};for(prop in this._extensions){if(this._extensions[prop].toJSON&&prop[0]!=="_"){result[prop]=this._extensions[prop].toJSON()}}for(prop in this){var allowedName=!EXCLUDE[prop]&&prop[0]!=="_";var isExtensionName=JXT.getExtensions(this._EL,this._NS)[prop];if(allowedName&&!isExtensionName){var val=this[prop];if(typeof val==="function"){continue}var type=Object.prototype.toString.call(val);if(type.indexOf("Object")>=0){if(Object.keys(val).length>0){result[prop]=val}}else if(type.indexOf("Array")>=0){if(val.length>0){var vals=[];var len=val.length;for(var n=0;n<len;n++){var nval=val[n];if(typeof nval!=="undefined"){if(nval.toJSON!==undefined){vals.push(nval.toJSON())}else{vals.push(nval)}}}result[prop]=vals}}else if(val!==undefined&&val!==false&&val!==""){result[prop]=val}}}return result};return Stanza}},{"./helpers":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/lib/helpers.js","lodash.assign":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/lib/types.js":[function(require,module,exports){(function(Buffer){"use strict";var helpers=require("./helpers");var extend=require("lodash.assign");var find=helpers.find;var createElement=helpers.createElement;var field=exports.field=function(getter,setter){return function(){var args=Array.prototype.slice.call(arguments);return{get:function(){return getter.apply(null,[this.xml].concat(args))},set:function(value){setter.apply(null,[this.xml].concat(args).concat([value]))}}}};exports.boolAttribute=field(helpers.getBoolAttribute,helpers.setBoolAttribute);exports.subAttribute=field(helpers.getSubAttribute,helpers.setSubAttribute);exports.boolSubAttribute=field(helpers.getSubBoolAttribute,helpers.setSubBoolAttribute);exports.text=field(helpers.getText,helpers.setText);exports.textSub=exports.subText=field(helpers.getSubText,helpers.setSubText);exports.multiTextSub=exports.multiSubText=field(helpers.getMultiSubText,helpers.setMultiSubText);exports.multiSubAttribute=field(helpers.getMultiSubAttribute,helpers.setMultiSubAttribute);exports.langTextSub=exports.subLangText=field(helpers.getSubLangText,helpers.setSubLangText);exports.boolSub=field(helpers.getBoolSub,helpers.setBoolSub);exports.langAttribute=field(function(xml){return xml.getAttributeNS(helpers.XML_NS,"lang")||""},function(xml,value){xml.setAttributeNS(helpers.XML_NS,"lang",value)});exports.b64Text=field(function(xml){if(xml.textContent&&xml.textContent!=="="){return new Buffer(xml.textContent,"base64")}return""},function(xml,value){if(typeof value==="string"){var b64=new Buffer(value).toString("base64");xml.textContent=b64||"="}else{xml.textContent=""}});exports.dateAttribute=function(attr,now){return{get:function(){var data=helpers.getAttribute(this.xml,attr);if(data){return new Date(data)}if(now){return new Date(Date.now())}},set:function(value){if(!value){return}if(typeof value!=="string"){value=value.toISOString()}helpers.setAttribute(this.xml,attr,value)}}};exports.dateSub=function(NS,sub,now){return{get:function(){var data=helpers.getSubText(this.xml,NS,sub);if(data){return new Date(data)}if(now){return new Date(Date.now())}},set:function(value){if(!value){return}if(typeof value!=="string"){value=value.toISOString()}helpers.setSubText(this.xml,NS,sub,value)}}};exports.dateSubAttribute=function(NS,sub,attr,now){return{get:function(){var data=helpers.getSubAttribute(this.xml,NS,sub,attr);if(data){return new Date(data)}if(now){return new Date(Date.now())}},set:function(value){if(!value){return}if(typeof value!=="string"){value=value.toISOString()}helpers.setSubAttribute(this.xml,NS,sub,attr,value)}}};exports.numberAttribute=function(attr,isFloat,defaultVal){return{get:function(){var parse=isFloat?parseFloat:parseInt;var data=helpers.getAttribute(this.xml,attr,"");if(!data){return defaultVal}var parsed=parse(data,10);if(isNaN(parsed)){return defaultVal}return parsed},set:function(value){helpers.setAttribute(this.xml,attr,value.toString())}}};exports.numberSub=function(NS,sub,isFloat,defaultVal){return{get:function(){var parse=isFloat?parseFloat:parseInt;var data=helpers.getSubText(this.xml,NS,sub,"");if(!data){return defaultVal}var parsed=parse(data,10);if(isNaN(parsed)){return defaultVal}return parsed},set:function(value){helpers.setSubText(this.xml,NS,sub,value.toString())}}};exports.attribute=function(name,defaultVal){return{get:function(){return helpers.getAttribute(this.xml,name,defaultVal)},set:function(value){helpers.setAttribute(this.xml,name,value)}}};exports.attributeNS=function(NS,name,defaultVal){return{get:function(){return helpers.getAttributeNS(this.xml,NS,name,defaultVal)},set:function(value){helpers.setAttributeNS(this.xml,NS,name,value)}}};exports.extension=function(ChildJXT){return{get:function(){var self=this;var name=ChildJXT.prototype._name;if(!this._extensions[name]){var existing=find(this.xml,ChildJXT.prototype._NS,ChildJXT.prototype._EL);if(!existing.length){this._extensions[name]=new ChildJXT({},null,self);this.xml.appendChild(this._extensions[name].xml)}else{this._extensions[name]=new ChildJXT(null,existing[0],self)}this._extensions[name].parent=this}return this._extensions[name]},set:function(value){if(value){var child=this[ChildJXT.prototype._name];if(value===true){value={}}extend(child,value)}}}};exports.multiExtension=function(ChildJXT){return{get:function(){var self=this;var data=find(this.xml,ChildJXT.prototype._NS,ChildJXT.prototype._EL);var results=[];for(var i=0,len=data.length;i<len;i++){results.push(new ChildJXT({},data[i],self))}return results},set:function(value){value=value||[];var self=this;var existing=find(this.xml,ChildJXT.prototype._NS,ChildJXT.prototype._EL);var i,len;for(i=0,len=existing.length;i<len;i++){self.xml.removeChild(existing[i])}for(i=0,len=value.length;i<len;i++){var content=new ChildJXT(value[i],null,self);self.xml.appendChild(content.xml)}}}};exports.enumSub=function(NS,enumValues){return{get:function(){var self=this;var result=[];enumValues.forEach(function(enumVal){var exists=find(self.xml,NS,enumVal);if(exists.length){result.push(exists[0].nodeName)}});return result[0]||""},set:function(value){var self=this;enumValues.forEach(function(enumVal){var exists=find(self.xml,NS,enumVal);if(exists.length){self.xml.removeChild(exists[0])}});if(value){var condition=createElement(NS,value);this.xml.appendChild(condition)}}}};exports.subExtension=function(name,NS,sub,ChildJXT){return{get:function(){if(!this._extensions[name]){var wrapper=find(this.xml,NS,sub);if(!wrapper.length){wrapper=createElement(NS,sub,this._NS);this.xml.appendChild(wrapper)}else{wrapper=wrapper[0]}var existing=find(wrapper,ChildJXT.prototype._NS,ChildJXT.prototype._EL);if(!existing.length){this._extensions[name]=new ChildJXT({},null,{xml:wrapper});wrapper.appendChild(this._extensions[name].xml)}else{this._extensions[name]=new ChildJXT(null,existing[0],{xml:wrapper})}this._extensions[name].parent=this}return this._extensions[name]},set:function(value){var wrapper=find(this.xml,NS,sub);if(wrapper.length&&!value){this.xml.removeChild(wrapper[0])}if(value){var child=this[name];if(value===true){value={}}extend(child,value)}}}};exports.subMultiExtension=function(NS,sub,ChildJXT){return{get:function(){var self=this;var results=[];var existing=find(this.xml,NS,sub);if(!existing.length){return results}existing=existing[0];var data=find(existing,ChildJXT.prototype._NS,ChildJXT.prototype._EL);data.forEach(function(xml){results.push(new ChildJXT({},xml,self))});return results},set:function(values){var self=this;var existing=find(this.xml,NS,sub);if(existing.length){self.xml.removeChild(existing[0])}if(!values.length){return}existing=createElement(NS,sub,this._NS);values.forEach(function(value){var content=new ChildJXT(value,null,self);existing.appendChild(content.xml)});self.xml.appendChild(existing)}}}}).call(this,require("buffer").Buffer)},{"./helpers":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/lib/helpers.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js","lodash.assign":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/dom-element.js":[function(require,module,exports){"use strict";var util=require("util"),Element=require("./element").Element;function DOMElement(name,attrs){Element.call(this,name,attrs);this.nodeType=1;this.nodeName=this.localName}util.inherits(DOMElement,Element);DOMElement.prototype._getElement=function(name,attrs){var element=new DOMElement(name,attrs);return element};Object.defineProperty(DOMElement.prototype,"localName",{get:function(){return this.getName()}});Object.defineProperty(DOMElement.prototype,"namespaceURI",{get:function(){return this.getNS()}});Object.defineProperty(DOMElement.prototype,"parentNode",{get:function(){return this.parent}});Object.defineProperty(DOMElement.prototype,"childNodes",{get:function(){return this.children}});Object.defineProperty(DOMElement.prototype,"textContent",{get:function(){return this.getText()},set:function(value){this.children.push(value)}});DOMElement.prototype.getElementsByTagName=function(name){return this.getChildren(name)};DOMElement.prototype.getAttribute=function(name){return this.getAttr(name)};DOMElement.prototype.setAttribute=function(name,value){this.attr(name,value)};DOMElement.prototype.getAttributeNS=function(ns,name){if(ns==="http://www.w3.org/XML/1998/namespace"){return this.getAttr(["xml",name].join(":"))}return this.getAttr(name,ns)};DOMElement.prototype.setAttributeNS=function(ns,name,value){var prefix;if(ns==="http://www.w3.org/XML/1998/namespace"){prefix="xml"}else{var nss=this.getXmlns();prefix=nss[ns]||""}if(prefix){this.attr([prefix,name].join(":"),value)}};DOMElement.prototype.removeAttribute=function(name){this.attr(name,null)};DOMElement.prototype.removeAttributeNS=function(ns,name){var prefix;if(ns==="http://www.w3.org/XML/1998/namespace"){prefix="xml"}else{var nss=this.getXmlns();prefix=nss[ns]||""}if(prefix){this.attr([prefix,name].join(":"),null)}};DOMElement.prototype.appendChild=function(el){this.cnode(el)};DOMElement.prototype.removeChild=function(el){this.remove(el)};module.exports=DOMElement},{"./element":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/element.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/element.js":[function(require,module,exports){"use strict";function Element(name,attrs){this.name=name;this.parent=null;this.children=[];this.setAttrs(attrs)}Element.prototype.is=function(name,xmlns){return this.getName()===name&&(!xmlns||this.getNS()===xmlns)};Element.prototype.getName=function(){if(this.name.indexOf(":")>=0){return this.name.substr(this.name.indexOf(":")+1)}else{return this.name}};Element.prototype.getNS=function(){if(this.name.indexOf(":")>=0){var prefix=this.name.substr(0,this.name.indexOf(":"));return this.findNS(prefix)}return this.findNS()};Element.prototype.findNS=function(prefix){if(!prefix){if(this.attrs.xmlns){return this.attrs.xmlns}else if(this.parent){return this.parent.findNS()}}else{var attr="xmlns:"+prefix;if(this.attrs[attr]){return this.attrs[attr]}else if(this.parent){return this.parent.findNS(prefix)}}};Element.prototype.getXmlns=function(){var namespaces={};if(this.parent){namespaces=this.parent.getXmlns()}for(var attr in this.attrs){var m=attr.match("xmlns:?(.*)");if(this.attrs.hasOwnProperty(attr)&&m){namespaces[this.attrs[attr]]=m[1]}}return namespaces};Element.prototype.setAttrs=function(attrs){this.attrs={};if(typeof attrs==="string")this.attrs.xmlns=attrs;else if(attrs){Object.keys(attrs).forEach(function(key){this.attrs[key]=attrs[key]},this)}};Element.prototype.getAttr=function(name,xmlns){if(!xmlns){return this.attrs[name]}var namespaces=this.getXmlns();if(!namespaces[xmlns]){return null}return this.attrs[[namespaces[xmlns],name].join(":")]};Element.prototype.getChild=function(name,xmlns){return this.getChildren(name,xmlns)[0]};Element.prototype.getChildren=function(name,xmlns){var result=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.getName&&child.getName()===name&&(!xmlns||child.getNS()===xmlns))result.push(child)}return result};Element.prototype.getChildByAttr=function(attr,val,xmlns,recursive){return this.getChildrenByAttr(attr,val,xmlns,recursive)[0]};Element.prototype.getChildrenByAttr=function(attr,val,xmlns,recursive){var result=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.attrs&&child.attrs[attr]===val&&(!xmlns||child.getNS()===xmlns))result.push(child);if(recursive&&child.getChildrenByAttr){result.push(child.getChildrenByAttr(attr,val,xmlns,true))}}if(recursive){result=[].concat.apply([],result)}return result};Element.prototype.getChildrenByFilter=function(filter,recursive){var result=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(filter(child))result.push(child);if(recursive&&child.getChildrenByFilter){result.push(child.getChildrenByFilter(filter,true))}}if(recursive){result=[].concat.apply([],result)}return result};Element.prototype.getText=function(){var text="";for(var i=0;i<this.children.length;i++){var child=this.children[i];if(typeof child==="string"||typeof child==="number"){text+=child}}return text};Element.prototype.getChildText=function(name,xmlns){var child=this.getChild(name,xmlns);return child?child.getText():null};Element.prototype.getChildElements=function(){return this.getChildrenByFilter(function(child){return child instanceof Element})};Element.prototype.root=function(){if(this.parent){return this.parent.root()}return this};Element.prototype.tree=Element.prototype.root;Element.prototype.up=function(){if(this.parent){return this.parent}return this};Element.prototype._getElement=function(name,attrs){var element=new Element(name,attrs);return element};Element.prototype.c=function(name,attrs){return this.cnode(this._getElement(name,attrs))};Element.prototype.cnode=function(child){this.children.push(child);if(typeof child==="object"){child.parent=this}return child};Element.prototype.t=function(text){this.children.push(text);return this};Element.prototype.remove=function(el,xmlns){var filter;if(typeof el==="string"){filter=function(child){return!(child.is&&child.is(el,xmlns))}}else{filter=function(child){return child!==el}}this.children=this.children.filter(filter);return this};Element.prototype.clone=function(){var clone=this._getElement(this.name,this.attrs);for(var i=0;i<this.children.length;i++){var child=this.children[i];clone.cnode(child.clone?child.clone():child)}return clone};Element.prototype.text=function(val){if(val&&this.children.length===1){this.children[0]=val;return this}return this.getText()};Element.prototype.attr=function(attr,val){if(typeof val!=="undefined"||val===null){if(!this.attrs){this.attrs={}}this.attrs[attr]=val;return this}return this.attrs[attr]};Element.prototype.toString=function(){var s="";this.write(function(c){s+=c});return s};Element.prototype.toJSON=function(){return{name:this.name,attrs:this.attrs,children:this.children.map(function(child){return child&&child.toJSON?child.toJSON():child})}};Element.prototype._addChildren=function(writer){writer(">");for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child||child===0){if(child.write){child.write(writer)}else if(typeof child==="string"){writer(escapeXmlText(child))}else if(child.toString){writer(escapeXmlText(child.toString(10)))}}}writer("</");writer(this.name);writer(">")};Element.prototype.write=function(writer){writer("<");writer(this.name);for(var k in this.attrs){var v=this.attrs[k];if(v||v===""||v===0){writer(" ");writer(k);writer('="');if(typeof v!=="string"){v=v.toString(10)}writer(escapeXml(v));writer('"')}}if(this.children.length===0){writer("/>")}else{this._addChildren(writer)}};function escapeXml(s){return s.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/"/g,"&apos;")}function escapeXmlText(s){return s.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}exports.Element=Element;exports.escapeXml=escapeXml},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/index-browserify.js":[function(require,module,exports){"use strict";var parse=require("./parse");parse.availableSaxParsers.push(parse.bestSaxParser=require("./sax/sax_ltx"));module.exports=require("./index")},{"./index":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/index.js","./parse":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/parse.js","./sax/sax_ltx":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/sax/sax_ltx.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/index.js":[function(require,module,exports){"use strict";var parse=require("./parse");exports.Element=require("./dom-element");exports.escapeXml=require("./element").escapeXml;exports.parse=parse.parse;exports.Parser=parse.Parser;exports.availableSaxParsers=parse.availableSaxParsers;exports.bestSaxParser=parse.bestSaxParser},{"./dom-element":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/dom-element.js","./element":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/element.js","./parse":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/parse.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/parse.js":[function(require,module,exports){"use strict";
var events=require("events"),util=require("util"),DOMElement=require("./dom-element");exports.availableSaxParsers=[];exports.bestSaxParser=null;var saxParsers=["./sax/sax_expat.js","./sax/sax_ltx.js","./sax/sax_saxjs.js"];saxParsers.forEach(function(modName){var mod;try{mod=require(modName)}catch(e){}if(mod){exports.availableSaxParsers.push(mod);if(!exports.bestSaxParser){exports.bestSaxParser=mod}}});exports.Parser=function(saxParser){events.EventEmitter.call(this);var self=this;var ParserMod=saxParser||exports.bestSaxParser;if(!ParserMod){throw new Error("No SAX parser available")}this.parser=new ParserMod;var el;this.parser.addListener("startElement",function(name,attrs){var child=new DOMElement(name,attrs);if(!el){el=child}else{el=el.cnode(child)}});this.parser.addListener("endElement",function(name){if(!el){}else if(name===el.name){if(el.parent){el=el.parent}else if(!self.tree){self.tree=el;el=undefined}}});this.parser.addListener("text",function(str){if(el){el.t(str)}});this.parser.addListener("error",function(e){self.error=e;self.emit("error",e)})};util.inherits(exports.Parser,events.EventEmitter);exports.Parser.prototype.write=function(data){this.parser.write(data)};exports.Parser.prototype.end=function(data){this.parser.end(data);if(!this.error){if(this.tree){this.emit("tree",this.tree)}else{this.emit("error",new Error("Incomplete document"))}}};exports.parse=function(data,saxParser){var p=new exports.Parser(saxParser);var result=null,error=null;p.on("tree",function(tree){result=tree});p.on("error",function(e){error=e});p.write(data);p.end();if(error){throw error}else{return result}}},{"./dom-element":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/dom-element.js",events:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/events/events.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jxt/node_modules/ltx/lib/sax/sax_ltx.js":[function(require,module,exports){"use strict";var util=require("util"),events=require("events");var STATE_TEXT=0,STATE_IGNORE_TAG=1,STATE_TAG_NAME=2,STATE_TAG=3,STATE_ATTR_NAME=4,STATE_ATTR_EQ=5,STATE_ATTR_QUOT=6,STATE_ATTR_VALUE=7;var SaxLtx=module.exports=function SaxLtx(){events.EventEmitter.call(this);var state=STATE_TEXT,remainder;var tagName,attrs,endTag,selfClosing,attrQuote;var recordStart=0;var attrName;this._handleTagOpening=function(endTag,tagName,attrs){if(!endTag){this.emit("startElement",tagName,attrs);if(selfClosing){this.emit("endElement",tagName)}}else{this.emit("endElement",tagName)}};this.write=function(data){if(typeof data!=="string"){data=data.toString()}var pos=0;if(remainder){data=remainder+data;pos+=remainder.length;remainder=null}function endRecording(){if(typeof recordStart==="number"){var recorded=data.slice(recordStart,pos);recordStart=undefined;return recorded}}for(;pos<data.length;pos++){var c=data.charCodeAt(pos);switch(state){case STATE_TEXT:if(c===60){var text=endRecording();if(text){this.emit("text",unescapeXml(text))}state=STATE_TAG_NAME;recordStart=pos+1;attrs={}}break;case STATE_TAG_NAME:if(c===47&&recordStart===pos){recordStart=pos+1;endTag=true}else if(c===33||c===63){recordStart=undefined;state=STATE_IGNORE_TAG}else if(c<=32||c===47||c===62){tagName=endRecording();pos--;state=STATE_TAG}break;case STATE_IGNORE_TAG:if(c===62){state=STATE_TEXT}break;case STATE_TAG:if(c===62){this._handleTagOpening(endTag,tagName,attrs);tagName=undefined;attrs=undefined;endTag=undefined;selfClosing=undefined;state=STATE_TEXT;recordStart=pos+1}else if(c===47){selfClosing=true}else if(c>32){recordStart=pos;state=STATE_ATTR_NAME}break;case STATE_ATTR_NAME:if(c<=32||c===61){attrName=endRecording();pos--;state=STATE_ATTR_EQ}break;case STATE_ATTR_EQ:if(c===61){state=STATE_ATTR_QUOT}break;case STATE_ATTR_QUOT:if(c===34||c===39){attrQuote=c;state=STATE_ATTR_VALUE;recordStart=pos+1}break;case STATE_ATTR_VALUE:if(c===attrQuote){var value=unescapeXml(endRecording());attrs[attrName]=value;attrName=undefined;state=STATE_TAG}break}}if(typeof recordStart==="number"&&recordStart<=data.length){remainder=data.slice(recordStart);recordStart=0}}};util.inherits(SaxLtx,events.EventEmitter);SaxLtx.prototype.end=function(data){if(data){this.write(data)}this.write=function(){}};function unescapeXml(s){return s.replace(/\&(amp|#38);/g,"&").replace(/\&(lt|#60);/g,"<").replace(/\&(gt|#62);/g,">").replace(/\&(quot|#34);/g,'"').replace(/\&(apos|#39);/g,"'").replace(/\&(nbsp|#160);/g,"\n")}},{events:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/events/events.js",util:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/util/util.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/index.js":[function(require,module,exports){var baseAssign=require("lodash._baseassign"),createAssigner=require("lodash._createassigner"),keys=require("lodash.keys");function assignWith(object,source,customizer){var index=-1,props=keys(source),length=props.length;while(++index<length){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);if((result===result?result!==value:value===value)||value===undefined&&!(key in object)){object[key]=result}}return object}var assign=createAssigner(function(object,source,customizer){return customizer?assignWith(object,source,customizer):baseAssign(object,source)});module.exports=assign},{"lodash._baseassign":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._baseassign/index.js","lodash._createassigner":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._createassigner/index.js","lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._baseassign/index.js":[function(require,module,exports){var baseCopy=require("lodash._basecopy"),keys=require("lodash.keys");function baseAssign(object,source){return source==null?object:baseCopy(source,keys(source),object)}module.exports=baseAssign},{"lodash._basecopy":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._baseassign/node_modules/lodash._basecopy/index.js","lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._baseassign/node_modules/lodash._basecopy/index.js":[function(require,module,exports){function baseCopy(source,props,object){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];object[key]=source[key]}return object}module.exports=baseCopy},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._createassigner/index.js":[function(require,module,exports){var bindCallback=require("lodash._bindcallback"),isIterateeCall=require("lodash._isiterateecall"),restParam=require("lodash.restparam");function createAssigner(assigner){return restParam(function(object,sources){var index=-1,length=object==null?0:sources.length,customizer=length>2?sources[length-2]:undefined,guard=length>2?sources[2]:undefined,thisArg=length>1?sources[length-1]:undefined;if(typeof customizer=="function"){customizer=bindCallback(customizer,thisArg,5);length-=2}else{customizer=typeof thisArg=="function"?thisArg:undefined;length-=customizer?1:0}if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}while(++index<length){var source=sources[index];if(source){assigner(object,source,customizer)}}return object})}module.exports=createAssigner},{"lodash._bindcallback":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._createassigner/node_modules/lodash._bindcallback/index.js","lodash._isiterateecall":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._createassigner/node_modules/lodash._isiterateecall/index.js","lodash.restparam":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._createassigner/node_modules/lodash.restparam/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._createassigner/node_modules/lodash._bindcallback/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._createassigner/node_modules/lodash._isiterateecall/index.js":[function(require,module,exports){var reIsUint=/^\d+$/;var MAX_SAFE_INTEGER=9007199254740991;function baseProperty(key){return function(object){return object==null?undefined:object[key]}}var getLength=baseProperty("length");function isArrayLike(value){return value!=null&&isLength(getLength(value))}function isIndex(value,length){value=typeof value=="number"||reIsUint.test(value)?+value:-1;length=length==null?MAX_SAFE_INTEGER:length;return value>-1&&value%1==0&&value<length}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){var other=object[index];return value===value?value===other:other!==other}return false}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=isIterateeCall},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._createassigner/node_modules/lodash.restparam/index.js":[function(require,module,exports){var FUNC_ERROR_TEXT="Expected a function";var nativeMax=Math.max;function restParam(func,start){if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}start=nativeMax(start===undefined?func.length-1:+start||0,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),rest=Array(length);while(++index<length){rest[index]=args[start+index]}switch(start){case 0:return func.call(this,rest);case 1:return func.call(this,args[0],rest);case 2:return func.call(this,args[0],args[1],rest)}var otherArgs=Array(start+1);index=-1;while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=rest;return func.apply(this,otherArgs)}}module.exports=restParam},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash.keys/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"][0].apply(exports,arguments)},{"lodash._getnative":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash.keys/node_modules/lodash._getnative/index.js","lodash.isarguments":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash.keys/node_modules/lodash._getnative/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash._getnative/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/index.js":[function(require,module,exports){var arrayFilter=require("lodash._arrayfilter"),baseCallback=require("lodash._basecallback"),baseFilter=require("lodash._basefilter"),isArray=require("lodash.isarray");function filter(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;predicate=baseCallback(predicate,thisArg,3);return func(collection,predicate)}module.exports=filter},{"lodash._arrayfilter":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._arrayfilter/index.js","lodash._basecallback":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basecallback/index.js","lodash._basefilter":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basefilter/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._arrayfilter/index.js":[function(require,module,exports){function arrayFilter(array,predicate){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[++resIndex]=value}}return result}module.exports=arrayFilter},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basecallback/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/index.js"][0].apply(exports,arguments)},{"lodash._baseisequal":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/index.js","lodash._bindcallback":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js","lodash.pairs":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basecallback/node_modules/lodash.pairs/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/index.js"][0].apply(exports,arguments)},{"lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js","lodash.istypedarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.istypedarray/index.js","lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.istypedarray/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.istypedarray/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basecallback/node_modules/lodash.pairs/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash.pairs/index.js"][0].apply(exports,arguments)},{"lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basefilter/index.js":[function(require,module,exports){var baseEach=require("lodash._baseeach");function baseFilter(collection,predicate){var result=[];baseEach(collection,function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}});return result}module.exports=baseFilter},{"lodash._baseeach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basefilter/node_modules/lodash._baseeach/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash._basefilter/node_modules/lodash._baseeach/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._baseeach/index.js"][0].apply(exports,arguments)},{"lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash.keys/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"][0].apply(exports,arguments)},{"lodash._getnative":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash.keys/node_modules/lodash._getnative/index.js","lodash.isarguments":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash.keys/node_modules/lodash._getnative/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash._getnative/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.filter/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/index.js":[function(require,module,exports){var arrayEach=require("lodash._arrayeach"),baseEach=require("lodash._baseeach"),bindCallback=require("lodash._bindcallback"),isArray=require("lodash.isarray");function createForEach(arrayFunc,eachFunc){return function(collection,iteratee,thisArg){return typeof iteratee=="function"&&thisArg===undefined&&isArray(collection)?arrayFunc(collection,iteratee):eachFunc(collection,bindCallback(iteratee,thisArg,3))}}var forEach=createForEach(arrayEach,baseEach);module.exports=forEach},{"lodash._arrayeach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._arrayeach/index.js","lodash._baseeach":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._baseeach/index.js","lodash._bindcallback":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._bindcallback/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._arrayeach/index.js":[function(require,module,exports){function arrayEach(array,iteratee){var index=-1,length=array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}module.exports=arrayEach},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._baseeach/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._baseeach/index.js"][0].apply(exports,arguments)},{"lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._baseeach/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._baseeach/node_modules/lodash.keys/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"][0].apply(exports,arguments)},{"lodash._getnative":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._baseeach/node_modules/lodash.keys/node_modules/lodash._getnative/index.js","lodash.isarguments":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._baseeach/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._baseeach/node_modules/lodash.keys/node_modules/lodash._getnative/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash._getnative/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._baseeach/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.foreach/node_modules/lodash._bindcallback/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js":[function(require,module,exports){var arrayTag="[object Array]",funcTag="[object Function]";var reIsHostCtor=/^\[object .+?Constructor\]$/;function isObjectLike(value){return!!value&&typeof value=="object"}var objectProto=Object.prototype;var fnToString=Function.prototype.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objToString=objectProto.toString;var reIsNative=RegExp("^"+fnToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var nativeIsArray=getNative(Array,"isArray");var MAX_SAFE_INTEGER=9007199254740991;function getNative(object,key){var value=object==null?undefined:object[key];return isNative(value)?value:undefined}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}var isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag};function isFunction(value){return isObject(value)&&objToString.call(value)==funcTag}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isNative(value){if(value==null){return false}if(isFunction(value)){return reIsNative.test(fnToString.call(value))}return isObjectLike(value)&&reIsHostCtor.test(value)}module.exports=isArray},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/index.js":[function(require,module,exports){var baseCallback=require("lodash._basecallback"),baseUniq=require("lodash._baseuniq"),isIterateeCall=require("lodash._isiterateecall");function sortedUniq(array,iteratee){var seen,index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(!index||seen!==computed){seen=computed;result[++resIndex]=value}}return result}function uniq(array,isSorted,iteratee,thisArg){var length=array?array.length:0;if(!length){return[]}if(isSorted!=null&&typeof isSorted!="boolean"){thisArg=iteratee;iteratee=isIterateeCall(array,isSorted,thisArg)?undefined:isSorted;isSorted=false}iteratee=iteratee==null?iteratee:baseCallback(iteratee,thisArg,3);return isSorted?sortedUniq(array,iteratee):baseUniq(array,iteratee)}module.exports=uniq},{"lodash._basecallback":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/index.js","lodash._baseuniq":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._baseuniq/index.js","lodash._isiterateecall":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._isiterateecall/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/index.js"][0].apply(exports,arguments)},{"lodash._baseisequal":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/index.js","lodash._bindcallback":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js","lodash.pairs":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash.pairs/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/index.js"][0].apply(exports,arguments)},{"lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js","lodash.istypedarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.istypedarray/index.js","lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.istypedarray/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.istypedarray/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.keys/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"][0].apply(exports,arguments)},{"lodash._getnative":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._getnative/index.js","lodash.isarguments":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash._baseisequal/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js":[function(require,module,exports){
arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash._bindcallback/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash.pairs/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash._basecallback/node_modules/lodash.pairs/index.js"][0].apply(exports,arguments)},{"lodash.keys":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash.pairs/node_modules/lodash.keys/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash.pairs/node_modules/lodash.keys/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/index.js"][0].apply(exports,arguments)},{"lodash._getnative":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._getnative/index.js","lodash.isarguments":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash.pairs/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js","lodash.isarray":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.isarray/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._basecallback/node_modules/lodash.pairs/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash.isarguments/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._baseuniq/index.js":[function(require,module,exports){var baseIndexOf=require("lodash._baseindexof"),cacheIndexOf=require("lodash._cacheindexof"),createCache=require("lodash._createcache");var LARGE_ARRAY_SIZE=200;function baseUniq(array,iteratee){var index=-1,indexOf=baseIndexOf,length=array.length,isCommon=true,isLarge=isCommon&&length>=LARGE_ARRAY_SIZE,seen=isLarge?createCache():null,result=[];if(seen){indexOf=cacheIndexOf;isCommon=false}else{isLarge=false;seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(isCommon&&value===value){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(indexOf(seen,computed,0)<0){if(iteratee||isLarge){seen.push(computed)}result.push(value)}}return result}module.exports=baseUniq},{"lodash._baseindexof":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._baseuniq/node_modules/lodash._baseindexof/index.js","lodash._cacheindexof":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._baseuniq/node_modules/lodash._cacheindexof/index.js","lodash._createcache":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._baseuniq/node_modules/lodash._createcache/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._baseuniq/node_modules/lodash._baseindexof/index.js":[function(require,module,exports){function baseIndexOf(array,value,fromIndex){if(value!==value){return indexOfNaN(array,fromIndex)}var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function indexOfNaN(array,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?0:-1);while(fromRight?index--:++index<length){var other=array[index];if(other!==other){return index}}return-1}module.exports=baseIndexOf},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._baseuniq/node_modules/lodash._cacheindexof/index.js":[function(require,module,exports){function cacheIndexOf(cache,value){var data=cache.data,result=typeof value=="string"||isObject(value)?data.set.has(value):data.hash[value];return result?0:-1}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=cacheIndexOf},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._baseuniq/node_modules/lodash._createcache/index.js":[function(require,module,exports){(function(global){var getNative=require("lodash._getnative");var Set=getNative(global,"Set");var nativeCreate=getNative(Object,"create");function SetCache(values){var length=values?values.length:0;this.data={hash:nativeCreate(null),set:new Set};while(length--){this.push(values[length])}}function cachePush(value){var data=this.data;if(typeof value=="string"||isObject(value)){data.set.add(value)}else{data.hash[value]=true}}function createCache(values){return nativeCreate&&Set?new SetCache(values):null}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}SetCache.prototype.push=cachePush;module.exports=createCache}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"lodash._getnative":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._getnative/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._getnative/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/jingle/node_modules/jingle-filetransfer-session/node_modules/rtcpeerconnection/node_modules/lodash.pluck/node_modules/lodash.map/node_modules/lodash.keys/node_modules/lodash._getnative/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.uniq/node_modules/lodash._isiterateecall/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/lodash.assign/node_modules/lodash._createassigner/node_modules/lodash._isiterateecall/index.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-anonymous/lib/mechanism.js":[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module)}else if(typeof define==="function"&&define.amd){define(["exports","module"],factory)}})(this,function(exports,module){function Mechanism(){}Mechanism.prototype.name="ANONYMOUS";Mechanism.prototype.clientFirst=true;Mechanism.prototype.response=function(cred){return cred.trace||""};Mechanism.prototype.challenge=function(chal){};exports=module.exports=Mechanism})},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-anonymous/main.js":[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module,require("./lib/mechanism"))}else if(typeof define==="function"&&define.amd){define(["exports","module","./lib/mechanism"],factory)}})(this,function(exports,module,Mechanism){exports=module.exports=Mechanism;exports.Mechanism=Mechanism})},{"./lib/mechanism":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-anonymous/lib/mechanism.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-external/lib/mechanism.js":[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module)}else if(typeof define==="function"&&define.amd){define(["exports","module"],factory)}})(this,function(exports,module){function Mechanism(){}Mechanism.prototype.name="EXTERNAL";Mechanism.prototype.clientFirst=true;Mechanism.prototype.response=function(cred){return cred.authzid||""};Mechanism.prototype.challenge=function(chal){};exports=module.exports=Mechanism})},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-external/main.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-anonymous/main.js"][0].apply(exports,arguments)},{"./lib/mechanism":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-external/lib/mechanism.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-plain/lib/mechanism.js":[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module)}else if(typeof define==="function"&&define.amd){define(["exports","module"],factory)}})(this,function(exports,module){function Mechanism(){}Mechanism.prototype.name="PLAIN";Mechanism.prototype.clientFirst=true;Mechanism.prototype.response=function(cred){var str="";str+=cred.authzid||"";str+="\x00";str+=cred.username;str+="\x00";str+=cred.password;return str};Mechanism.prototype.challenge=function(chal){return this};exports=module.exports=Mechanism})},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-plain/main.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-anonymous/main.js"][0].apply(exports,arguments)},{"./lib/mechanism":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-plain/lib/mechanism.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/index.js":[function(require,module,exports){(function(Buffer){var bitops=require("./lib/bitops");var utils=require("./lib/utils");var RESP={};function Mechanism(options){options=options||{};this._genNonce=options.genNonce||utils.genNonce;this._stage="initial"}Mechanism.Mechanism=Mechanism;Mechanism.prototype.name="SCRAM-SHA-1";Mechanism.prototype.clientFirst=true;Mechanism.prototype.response=function(cred){return RESP[this._stage](this,cred)};Mechanism.prototype.challenge=function(chal){var values=utils.parse(chal);this._salt=new Buffer(values.s||"","base64");this._iterationCount=parseInt(values.i,10);this._nonce=values.r;this._verifier=values.v;this._error=values.e;this._challenge=chal;return this};RESP.initial=function(mech,cred){mech._cnonce=mech._genNonce();var authzid="";if(cred.authzid){authzid="a="+utils.saslname(cred.authzid)}mech._gs2Header="n,"+authzid+",";var nonce="r="+mech._cnonce;var username="n="+utils.saslname(cred.username);mech._clientFirstMessageBare=username+","+nonce;var result=mech._gs2Header+mech._clientFirstMessageBare;mech._stage="challenge";return result};RESP.challenge=function(mech,cred){var gs2Header=new Buffer(mech._gs2Header).toString("base64");mech._clientFinalMessageWithoutProof="c="+gs2Header+",r="+mech._nonce;var saltedPassword,clientKey,serverKey;if(cred.clientKey&&cred.serverKey){clientKey=cred.clientKey;serverKey=cred.serverKey}else{saltedPassword=cred.saltedPassword||bitops.Hi(cred.password,mech._salt,mech._iterationCount);clientKey=bitops.HMAC(saltedPassword,"Client Key");serverKey=bitops.HMAC(saltedPassword,"Server Key")}var storedKey=bitops.H(clientKey);var authMessage=mech._clientFirstMessageBare+","+mech._challenge+","+mech._clientFinalMessageWithoutProof;var clientSignature=bitops.HMAC(storedKey,authMessage);var clientProof=bitops.XOR(clientKey,clientSignature).toString("base64");mech._serverSignature=bitops.HMAC(serverKey,authMessage);var result=mech._clientFinalMessageWithoutProof+",p="+clientProof;mech._stage="final";mech.cache={saltedPassword:saltedPassword,clientKey:clientKey,serverKey:serverKey};return result};RESP.final=function(){return""};module.exports=Mechanism}).call(this,require("buffer").Buffer)},{"./lib/bitops":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/lib/bitops.js","./lib/utils":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/lib/utils.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/lib/bitops.js":[function(require,module,exports){(function(Buffer){var createHash=require("create-hash");var createHmac=require("create-hmac");var xor=require("bitwise-xor");exports.XOR=xor;exports.H=function(text){return createHash("sha1").update(text).digest()};exports.HMAC=function(key,msg){return createHmac("sha1",key).update(msg).digest()};exports.Hi=function(text,salt,iterations){var ui1=exports.HMAC(text,Buffer.concat([salt,new Buffer([0,0,0,1],"binary")]));var ui=ui1;for(var i=0;i<iterations-1;i++){ui1=exports.HMAC(text,ui1);ui=exports.XOR(ui,ui1)}return ui}}).call(this,require("buffer").Buffer)},{"bitwise-xor":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/bitwise-xor/index.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js","create-hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/browser.js","create-hmac":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hmac/browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/lib/utils.js":[function(require,module,exports){var randomBytes=require("randombytes");exports.parse=function(chal){var dtives={};var tokens=chal.split(/,(?=(?:[^"]|"[^"]*")*$)/);for(var i=0,len=tokens.length;i<len;i++){var dtiv=/(\w+)=["]?([^"]+)["]?$/.exec(tokens[i]);if(dtiv){dtives[dtiv[1]]=dtiv[2]}}return dtives};exports.saslname=function(name){var escaped=[];var curr="";for(var i=0;i<name.length;i++){curr=name[i];if(curr===","){escaped.push("=2C")}else if(curr==="="){escaped.push("=3D")}else{escaped.push(curr)}}return escaped.join("")};exports.genNonce=function(len){return randomBytes((len||32)/2).toString("hex")}},{randombytes:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/randombytes/browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/bitwise-xor/index.js":[function(require,module,exports){(function(Buffer){module.exports=xor;function xor(a,b){if(!Buffer.isBuffer(a))a=new Buffer(a);if(!Buffer.isBuffer(b))b=new Buffer(b);var res=[];if(a.length>b.length){for(var i=0;i<b.length;i++){res.push(a[i]^b[i])}}else{for(var i=0;i<a.length;i++){res.push(a[i]^b[i])}}return new Buffer(res)}}).call(this,require("buffer").Buffer)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/browser.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/browser.js"][0].apply(exports,arguments)},{"./md5":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/md5.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/inherits/inherits_browser.js",ripemd160:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/ripemd160/lib/ripemd160.js","sha.js":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/index.js",stream:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/stream-browserify/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/helpers.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/helpers.js"][0].apply(exports,arguments)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/md5.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/md5.js"][0].apply(exports,arguments)},{"./helpers":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/helpers.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/inherits/inherits_browser.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/ripemd160/lib/ripemd160.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/ripemd160/lib/ripemd160.js"][0].apply(exports,arguments)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/hash.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/hash.js"][0].apply(exports,arguments)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/index.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/index.js"][0].apply(exports,arguments)},{"./sha":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha.js","./sha1":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha1.js","./sha224":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha224.js","./sha256":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha256.js","./sha384":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha384.js","./sha512":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha512.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha1.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha1.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha224.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha224.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/hash.js","./sha256":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha256.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha256.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha256.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha384.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha384.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/hash.js","./sha512":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha512.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/sha512.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/sha.js/sha512.js"][0].apply(exports,arguments)},{"./hash":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/sha.js/hash.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/node_modules/inherits/inherits_browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hmac/browser.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/iana-hashes/node_modules/create-hmac/browser.js"][0].apply(exports,arguments)},{buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js","create-hash/browser":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hash/browser.js",inherits:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hmac/node_modules/inherits/inherits_browser.js",stream:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/stream-browserify/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/create-hmac/node_modules/inherits/inherits_browser.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/create-hash/node_modules/inherits/inherits_browser.js"][0].apply(exports,arguments)},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/sasl-scram-sha-1/node_modules/randombytes/browser.js":[function(require,module,exports){arguments[4]["/Users/spaksa/stanza/node_modules/stanza.io/node_modules/alt-sasl-digest-md5/node_modules/randombytes/browser.js"][0].apply(exports,arguments)},{_process:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/process/browser.js",buffer:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/buffer/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/saslmechanisms/lib/factory.js":[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module)}else if(typeof define==="function"&&define.amd){define(["exports","module"],factory)}})(this,function(exports,module){function Factory(){this._mechs=[]}Factory.prototype.use=function(name,mech){if(!mech){mech=name;name=mech.prototype.name}this._mechs.push({name:name,mech:mech});return this};Factory.prototype.create=function(mechs){for(var i=0,len=this._mechs.length;i<len;i++){for(var j=0,jlen=mechs.length;j<jlen;j++){var entry=this._mechs[i];if(entry.name==mechs[j]){return new entry.mech}}}return null};exports=module.exports=Factory})},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/saslmechanisms/main.js":[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){factory(exports,module,require("./lib/factory"))}else if(typeof define==="function"&&define.amd){define(["exports","module","./lib/factory"],factory)}})(this,function(exports,module,Factory){exports=module.exports=Factory;exports.Factory=Factory})},{"./lib/factory":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/saslmechanisms/lib/factory.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/uuid/rng-browser.js":[function(require,module,exports){(function(global){var rng;if(global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function whatwgRNG(){crypto.getRandomValues(_rnds8);return _rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;_rnds[i]=r>>>((i&3)<<3)&255}return _rnds}}module.exports=rng}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/uuid/uuid.js":[function(require,module,exports){var _rng=require("./rng");var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}function parse(s,buf,offset){var i=buf&&offset||0,ii=0;buf=buf||[];s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){if(ii<16){buf[i+ii++]=_hexToByte[oct]}});while(ii<16){buf[i+ii++]=0}return buf}function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng();var _nodeId=[_seedBytes[0]|1,_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]];var _clockseq=(_seedBytes[6]<<8|_seedBytes[7])&16383;var _lastMSecs=0,_lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var clockseq=options.clockseq!==undefined?options.clockseq:_clockseq;var msecs=options.msecs!==undefined?options.msecs:(new Date).getTime();var nsecs=options.nsecs!==undefined?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===undefined){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs===undefined){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;var node=options.node||_nodeId;for(var n=0;n<6;n++){b[i+n]=node[n]}return buf?buf:unparse(b)}function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options=="binary"?new Array(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||_rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;ii++){buf[i+ii]=rnds[ii]}}return buf||unparse(rnds)}var uuid=v4;uuid.v1=v1;uuid.v4=v4;uuid.parse=parse;uuid.unparse=unparse;module.exports=uuid},{"./rng":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/uuid/rng-browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/wildemitter/wildemitter.js":[function(require,module,exports){module.exports=WildEmitter;function WildEmitter(){this.isWildEmitter=true;this.callbacks={}}WildEmitter.prototype.on=function(event,groupName,fn){var hasGroup=arguments.length===3,group=hasGroup?arguments[1]:undefined,func=hasGroup?arguments[2]:arguments[1];func._groupName=group;(this.callbacks[event]=this.callbacks[event]||[]).push(func);return this};WildEmitter.prototype.once=function(event,groupName,fn){var self=this,hasGroup=arguments.length===3,group=hasGroup?arguments[1]:undefined,func=hasGroup?arguments[2]:arguments[1];function on(){self.off(event,on);func.apply(this,arguments)}this.on(event,group,on);return this};WildEmitter.prototype.releaseGroup=function(groupName){var item,i,len,handlers;for(item in this.callbacks){handlers=this.callbacks[item];for(i=0,len=handlers.length;i<len;i++){if(handlers[i]._groupName===groupName){handlers.splice(i,1);i--;len--}}}return this};WildEmitter.prototype.off=function(event,fn){var callbacks=this.callbacks[event],i;if(!callbacks)return this;if(arguments.length===1){delete this.callbacks[event];return this}i=callbacks.indexOf(fn);callbacks.splice(i,1);if(callbacks.length===0){delete this.callbacks[event]}return this};WildEmitter.prototype.emit=function(event){var args=[].slice.call(arguments,1),callbacks=this.callbacks[event],specialCallbacks=this.getWildcardCallbacks(event),i,len,item,listeners;if(callbacks){listeners=callbacks.slice();for(i=0,len=listeners.length;i<len;++i){if(listeners[i]){listeners[i].apply(this,args)}else{break}}}if(specialCallbacks){len=specialCallbacks.length;listeners=specialCallbacks.slice();for(i=0,len=listeners.length;i<len;++i){if(listeners[i]){
listeners[i].apply(this,[event].concat(args))}else{break}}}return this};WildEmitter.prototype.getWildcardCallbacks=function(eventName){var item,split,result=[];for(item in this.callbacks){split=item.split("*");if(item==="*"||split.length===2&&eventName.slice(0,split[0].length)===split[0]){result=result.concat(this.callbacks[item])}}return result}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/index.js":[function(require,module,exports){"use strict";var window=require("global/window");var once=require("once");var parseHeaders=require("parse-headers");var XHR=window.XMLHttpRequest||noop;var XDR="withCredentials"in new XHR?XHR:window.XDomainRequest;module.exports=createXHR;function createXHR(options,callback){function readystatechange(){if(xhr.readyState===4){loadFunc()}}function getBody(){var body=undefined;if(xhr.response){body=xhr.response}else if(xhr.responseType==="text"||!xhr.responseType){body=xhr.responseText||xhr.responseXML}if(isJson){try{body=JSON.parse(body)}catch(e){}}return body}var failureResponse={body:undefined,headers:{},statusCode:0,method:method,url:uri,rawRequest:xhr};function errorFunc(evt){clearTimeout(timeoutTimer);if(!(evt instanceof Error)){evt=new Error(""+(evt||"unknown"))}evt.statusCode=0;callback(evt,failureResponse)}function loadFunc(){clearTimeout(timeoutTimer);var status=xhr.status===1223?204:xhr.status;var response=failureResponse;var err=null;if(status!==0){response={body:getBody(),statusCode:status,method:method,headers:{},url:uri,rawRequest:xhr};if(xhr.getAllResponseHeaders){response.headers=parseHeaders(xhr.getAllResponseHeaders())}}else{err=new Error("Internal XMLHttpRequest Error")}callback(err,response,response.body)}if(typeof options==="string"){options={uri:options}}options=options||{};if(typeof callback==="undefined"){throw new Error("callback argument missing")}callback=once(callback);var xhr=options.xhr||null;if(!xhr){if(options.cors||options.useXDR){xhr=new XDR}else{xhr=new XHR}}var key;var uri=xhr.url=options.uri||options.url;var method=xhr.method=options.method||"GET";var body=options.body||options.data;var headers=xhr.headers=options.headers||{};var sync=!!options.sync;var isJson=false;var timeoutTimer;if("json"in options){isJson=true;headers["Accept"]||(headers["Accept"]="application/json");if(method!=="GET"&&method!=="HEAD"){headers["Content-Type"]="application/json";body=JSON.stringify(options.json)}}xhr.onreadystatechange=readystatechange;xhr.onload=loadFunc;xhr.onerror=errorFunc;xhr.onprogress=function(){};xhr.ontimeout=errorFunc;xhr.open(method,uri,!sync,options.username,options.password);if(!sync){xhr.withCredentials=!!options.withCredentials}if(!sync&&options.timeout>0){timeoutTimer=setTimeout(function(){xhr.abort("timeout")},options.timeout+2)}if(xhr.setRequestHeader){for(key in headers){if(headers.hasOwnProperty(key)){xhr.setRequestHeader(key,headers[key])}}}else if(options.headers){throw new Error("Headers cannot be set on an XDomainRequest object")}if("responseType"in options){xhr.responseType=options.responseType}if("beforeSend"in options&&typeof options.beforeSend==="function"){options.beforeSend(xhr)}xhr.send(body);return xhr}function noop(){}},{"global/window":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/global/window.js",once:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/once/once.js","parse-headers":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/parse-headers/parse-headers.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/global/window.js":[function(require,module,exports){(function(global){if(typeof window!=="undefined"){module.exports=window}else if(typeof global!=="undefined"){module.exports=global}else if(typeof self!=="undefined"){module.exports=self}else{module.exports={}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/once/once.js":[function(require,module,exports){module.exports=once;once.proto=once(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return once(this)},configurable:true})});function once(fn){var called=false;return function(){if(called)return;called=true;return fn.apply(this,arguments)}}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/parse-headers/node_modules/for-each/index.js":[function(require,module,exports){var isFunction=require("is-function");module.exports=forEach;var toString=Object.prototype.toString;var hasOwnProperty=Object.prototype.hasOwnProperty;function forEach(list,iterator,context){if(!isFunction(iterator)){throw new TypeError("iterator must be a function")}if(arguments.length<3){context=this}if(toString.call(list)==="[object Array]")forEachArray(list,iterator,context);else if(typeof list==="string")forEachString(list,iterator,context);else forEachObject(list,iterator,context)}function forEachArray(array,iterator,context){for(var i=0,len=array.length;i<len;i++){if(hasOwnProperty.call(array,i)){iterator.call(context,array[i],i,array)}}}function forEachString(string,iterator,context){for(var i=0,len=string.length;i<len;i++){iterator.call(context,string.charAt(i),i,string)}}function forEachObject(object,iterator,context){for(var k in object){if(hasOwnProperty.call(object,k)){iterator.call(context,object[k],k,object)}}}},{"is-function":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/parse-headers/node_modules/for-each/node_modules/is-function/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/parse-headers/node_modules/for-each/node_modules/is-function/index.js":[function(require,module,exports){module.exports=isFunction;var toString=Object.prototype.toString;function isFunction(fn){var string=toString.call(fn);return string==="[object Function]"||typeof fn==="function"&&string!=="[object RegExp]"||typeof window!=="undefined"&&(fn===window.setTimeout||fn===window.alert||fn===window.confirm||fn===window.prompt)}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/parse-headers/node_modules/trim/index.js":[function(require,module,exports){exports=module.exports=trim;function trim(str){return str.replace(/^\s*|\s*$/g,"")}exports.left=function(str){return str.replace(/^\s*/,"")};exports.right=function(str){return str.replace(/\s*$/,"")}},{}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/parse-headers/parse-headers.js":[function(require,module,exports){var trim=require("trim"),forEach=require("for-each"),isArray=function(arg){return Object.prototype.toString.call(arg)==="[object Array]"};module.exports=function(headers){if(!headers)return{};var result={};forEach(trim(headers).split("\n"),function(row){var index=row.indexOf(":"),key=trim(row.slice(0,index)).toLowerCase(),value=trim(row.slice(index+1));if(typeof result[key]==="undefined"){result[key]=value}else if(isArray(result[key])){result[key].push(value)}else{result[key]=[result[key],value]}});return result}},{"for-each":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/parse-headers/node_modules/for-each/index.js",trim:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xhr/node_modules/parse-headers/node_modules/trim/index.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/index.js":[function(require,module,exports){"use strict";var StringPrep=require("./lib/stringprep");var ASCII=/^[\x00-\x7F]*$/;function bareJID(local,domain){if(local){return local+"@"+domain}return domain}function fullJID(local,domain,resource){if(resource){return bareJID(local,domain)+"/"+resource}return bareJID(local,domain)}exports.prep=function(data){var local=data.local;var domain=data.domain;var resource=data.resource;var unescapedLocal=local;if(local){local=StringPrep.nodeprep(local);unescapedLocal=exports.unescape(local)}if(resource){resource=StringPrep.resourceprep(resource)}if(domain[domain.length-1]==="."){domain=domain.slice(0,domain.length-1)}domain=StringPrep.nameprep(domain.split(".").map(StringPrep.toUnicode).join("."));return{prepped:data.prepped||StringPrep.available,local:local,domain:domain,resource:resource,bare:bareJID(local,domain),full:fullJID(local,domain,resource),unescapedLocal:unescapedLocal,unescapedBare:bareJID(unescapedLocal,domain),unescapedFull:fullJID(unescapedLocal,domain,resource)}};exports.parse=function(jid,trusted){var local="";var domain="";var resource="";trusted=trusted||ASCII.test(jid);var resourceStart=jid.indexOf("/");if(resourceStart>0){resource=jid.slice(resourceStart+1);jid=jid.slice(0,resourceStart)}var localEnd=jid.indexOf("@");if(localEnd>0){local=jid.slice(0,localEnd);jid=jid.slice(localEnd+1)}domain=jid;var preppedJID=exports.prep({local:local,domain:domain,resource:resource});preppedJID.prepped=preppedJID.prepped||trusted;return preppedJID};exports.equal=function(jid1,jid2,requirePrep){jid1=new exports.JID(jid1);jid2=new exports.JID(jid2);if(arguments.length===2){requirePrep=true}return jid1.local===jid2.local&&jid1.domain===jid2.domain&&jid1.resource===jid2.resource&&(requirePrep?jid1.prepped&&jid2.prepped:true)};exports.equalBare=function(jid1,jid2,requirePrep){jid1=new exports.JID(jid1);jid2=new exports.JID(jid2);if(arguments.length===2){requirePrep=true}return jid1.local===jid2.local&&jid1.domain===jid2.domain&&(requirePrep?jid1.prepped&&jid2.prepped:true)};exports.isBare=function(jid){jid=new exports.JID(jid);var hasResource=!!jid.resource;return!hasResource};exports.isFull=function(jid){jid=new exports.JID(jid);var hasResource=!!jid.resource;return hasResource};exports.escape=function(val){return val.replace(/^\s+|\s+$/g,"").replace(/\\5c/g,"\\5c5c").replace(/\\20/g,"\\5c20").replace(/\\22/g,"\\5c22").replace(/\\26/g,"\\5c26").replace(/\\27/g,"\\5c27").replace(/\\2f/g,"\\5c2f").replace(/\\3a/g,"\\5c3a").replace(/\\3c/g,"\\5c3c").replace(/\\3e/g,"\\5c3e").replace(/\\40/g,"\\5c40").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")};exports.unescape=function(val){return val.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")};exports.create=function(local,domain,resource){return new exports.JID(local,domain,resource)};exports.JID=function JID(localOrJID,domain,resource){var parsed={};if(localOrJID&&!domain&&!resource){if(typeof localOrJID==="string"){parsed=exports.parse(localOrJID)}else if(localOrJID._isJID||localOrJID instanceof exports.JID){parsed=localOrJID}else{throw new Error("Invalid argument type")}}else if(domain){var trusted=ASCII.test(localOrJID)&&ASCII.test(domain);if(resource){trusted=trusted&&ASCII.test(resource)}parsed=exports.prep({local:exports.escape(localOrJID),domain:domain,resource:resource,prepped:trusted})}else{parsed={}}this._isJID=true;this.local=parsed.local||"";this.domain=parsed.domain||"";this.resource=parsed.resource||"";this.bare=parsed.bare||"";this.full=parsed.full||"";this.unescapedLocal=parsed.unescapedLocal||"";this.unescapedBare=parsed.unescapedBare||"";this.unescapedFull=parsed.unescapedFull||"";this.prepped=parsed.prepped};exports.JID.prototype.toString=function(){return this.full};exports.JID.prototype.toJSON=function(){return this.full}},{"./lib/stringprep":"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/lib/stringprep-browser.js"}],"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/xmpp-jid/lib/stringprep-browser.js":[function(require,module,exports){"use strict";var punycode=require("punycode");exports.available=false;exports.toUnicode=punycode.toUnicode;exports.nameprep=function(str){return str.toLowerCase()};exports.nodeprep=function(str){return str.toLowerCase()};exports.resourceprep=function(str){return str}},{punycode:"/Users/spaksa/stanza/node_modules/stanza.io/node_modules/browserify/node_modules/punycode/punycode.js"}]},{},["/Users/spaksa/stanza/node_modules/stanza.io/index.js"])("/Users/spaksa/stanza/node_modules/stanza.io/index.js")});
